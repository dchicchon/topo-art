(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const T of document.querySelectorAll('link[rel="modulepreload"]'))x(T);new MutationObserver(T=>{for(const A of T)if(A.type==="childList")for(const R of A.addedNodes)R.tagName==="LINK"&&R.rel==="modulepreload"&&x(R)}).observe(document,{childList:!0,subtree:!0});function f(T){const A={};return T.integrity&&(A.integrity=T.integrity),T.referrerpolicy&&(A.referrerPolicy=T.referrerpolicy),T.crossorigin==="use-credentials"?A.credentials="include":T.crossorigin==="anonymous"?A.credentials="omit":A.credentials="same-origin",A}function x(T){if(T.ep)return;T.ep=!0;const A=f(T);fetch(T.href,A)}})();var Nw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function V0(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var gi={},Vw={get exports(){return gi},set exports(r){gi=r}},Ot={};/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Ty=Object.getOwnPropertySymbols,jw=Object.prototype.hasOwnProperty,$w=Object.prototype.propertyIsEnumerable;function Gw(r){if(r==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}function Zw(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de",Object.getOwnPropertyNames(r)[0]==="5")return!1;for(var l={},f=0;f<10;f++)l["_"+String.fromCharCode(f)]=f;var x=Object.getOwnPropertyNames(l).map(function(A){return l[A]});if(x.join("")!=="0123456789")return!1;var T={};return"abcdefghijklmnopqrst".split("").forEach(function(A){T[A]=A}),Object.keys(Object.assign({},T)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var j0=Zw()?Object.assign:function(r,l){for(var f,x=Gw(r),T,A=1;A<arguments.length;A++){f=Object(arguments[A]);for(var R in f)jw.call(f,R)&&(x[R]=f[R]);if(Ty){T=Ty(f);for(var a=0;a<T.length;a++)$w.call(f,T[a])&&(x[T[a]]=f[T[a]])}}return x};/** @license React v17.0.2
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Im=j0,Il=60103,$0=60106;Ot.Fragment=60107;Ot.StrictMode=60108;Ot.Profiler=60114;var G0=60109,Z0=60110,q0=60112;Ot.Suspense=60113;var W0=60115,X0=60116;if(typeof Symbol=="function"&&Symbol.for){var pr=Symbol.for;Il=pr("react.element"),$0=pr("react.portal"),Ot.Fragment=pr("react.fragment"),Ot.StrictMode=pr("react.strict_mode"),Ot.Profiler=pr("react.profiler"),G0=pr("react.provider"),Z0=pr("react.context"),q0=pr("react.forward_ref"),Ot.Suspense=pr("react.suspense"),W0=pr("react.memo"),X0=pr("react.lazy")}var Ey=typeof Symbol=="function"&&Symbol.iterator;function qw(r){return r===null||typeof r!="object"?null:(r=Ey&&r[Ey]||r["@@iterator"],typeof r=="function"?r:null)}function zu(r){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+r,f=1;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+r+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var H0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Y0={};function Al(r,l,f){this.props=r,this.context=l,this.refs=Y0,this.updater=f||H0}Al.prototype.isReactComponent={};Al.prototype.setState=function(r,l){if(typeof r!="object"&&typeof r!="function"&&r!=null)throw Error(zu(85));this.updater.enqueueSetState(this,r,l,"setState")};Al.prototype.forceUpdate=function(r){this.updater.enqueueForceUpdate(this,r,"forceUpdate")};function K0(){}K0.prototype=Al.prototype;function Am(r,l,f){this.props=r,this.context=l,this.refs=Y0,this.updater=f||H0}var Mm=Am.prototype=new K0;Mm.constructor=Am;Im(Mm,Al.prototype);Mm.isPureReactComponent=!0;var zm={current:null},Q0=Object.prototype.hasOwnProperty,J0={key:!0,ref:!0,__self:!0,__source:!0};function ex(r,l,f){var x,T={},A=null,R=null;if(l!=null)for(x in l.ref!==void 0&&(R=l.ref),l.key!==void 0&&(A=""+l.key),l)Q0.call(l,x)&&!J0.hasOwnProperty(x)&&(T[x]=l[x]);var a=arguments.length-2;if(a===1)T.children=f;else if(1<a){for(var H=Array(a),pe=0;pe<a;pe++)H[pe]=arguments[pe+2];T.children=H}if(r&&r.defaultProps)for(x in a=r.defaultProps,a)T[x]===void 0&&(T[x]=a[x]);return{$$typeof:Il,type:r,key:A,ref:R,props:T,_owner:zm.current}}function Ww(r,l){return{$$typeof:Il,type:r.type,key:l,ref:r.ref,props:r.props,_owner:r._owner}}function Pm(r){return typeof r=="object"&&r!==null&&r.$$typeof===Il}function Xw(r){var l={"=":"=0",":":"=2"};return"$"+r.replace(/[=:]/g,function(f){return l[f]})}var Sy=/\/+/g;function mf(r,l){return typeof r=="object"&&r!==null&&r.key!=null?Xw(""+r.key):l.toString(36)}function ld(r,l,f,x,T){var A=typeof r;(A==="undefined"||A==="boolean")&&(r=null);var R=!1;if(r===null)R=!0;else switch(A){case"string":case"number":R=!0;break;case"object":switch(r.$$typeof){case Il:case $0:R=!0}}if(R)return R=r,T=T(R),r=x===""?"."+mf(R,0):x,Array.isArray(T)?(f="",r!=null&&(f=r.replace(Sy,"$&/")+"/"),ld(T,l,f,"",function(pe){return pe})):T!=null&&(Pm(T)&&(T=Ww(T,f+(!T.key||R&&R.key===T.key?"":(""+T.key).replace(Sy,"$&/")+"/")+r)),l.push(T)),1;if(R=0,x=x===""?".":x+":",Array.isArray(r))for(var a=0;a<r.length;a++){A=r[a];var H=x+mf(A,a);R+=ld(A,l,f,H,T)}else if(H=qw(r),typeof H=="function")for(r=H.call(r),a=0;!(A=r.next()).done;)A=A.value,H=x+mf(A,a++),R+=ld(A,l,f,H,T);else if(A==="object")throw l=""+r,Error(zu(31,l==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":l));return R}function Yh(r,l,f){if(r==null)return r;var x=[],T=0;return ld(r,x,"","",function(A){return l.call(f,A,T++)}),x}function Hw(r){if(r._status===-1){var l=r._result;l=l(),r._status=0,r._result=l,l.then(function(f){r._status===0&&(f=f.default,r._status=1,r._result=f)},function(f){r._status===0&&(r._status=2,r._result=f)})}if(r._status===1)return r._result;throw r._result}var tx={current:null};function uo(){var r=tx.current;if(r===null)throw Error(zu(321));return r}var Yw={ReactCurrentDispatcher:tx,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:zm,IsSomeRendererActing:{current:!1},assign:Im};Ot.Children={map:Yh,forEach:function(r,l,f){Yh(r,function(){l.apply(this,arguments)},f)},count:function(r){var l=0;return Yh(r,function(){l++}),l},toArray:function(r){return Yh(r,function(l){return l})||[]},only:function(r){if(!Pm(r))throw Error(zu(143));return r}};Ot.Component=Al;Ot.PureComponent=Am;Ot.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Yw;Ot.cloneElement=function(r,l,f){if(r==null)throw Error(zu(267,r));var x=Im({},r.props),T=r.key,A=r.ref,R=r._owner;if(l!=null){if(l.ref!==void 0&&(A=l.ref,R=zm.current),l.key!==void 0&&(T=""+l.key),r.type&&r.type.defaultProps)var a=r.type.defaultProps;for(H in l)Q0.call(l,H)&&!J0.hasOwnProperty(H)&&(x[H]=l[H]===void 0&&a!==void 0?a[H]:l[H])}var H=arguments.length-2;if(H===1)x.children=f;else if(1<H){a=Array(H);for(var pe=0;pe<H;pe++)a[pe]=arguments[pe+2];x.children=a}return{$$typeof:Il,type:r.type,key:T,ref:A,props:x,_owner:R}};Ot.createContext=function(r,l){return l===void 0&&(l=null),r={$$typeof:Z0,_calculateChangedBits:l,_currentValue:r,_currentValue2:r,_threadCount:0,Provider:null,Consumer:null},r.Provider={$$typeof:G0,_context:r},r.Consumer=r};Ot.createElement=ex;Ot.createFactory=function(r){var l=ex.bind(null,r);return l.type=r,l};Ot.createRef=function(){return{current:null}};Ot.forwardRef=function(r){return{$$typeof:q0,render:r}};Ot.isValidElement=Pm;Ot.lazy=function(r){return{$$typeof:X0,_payload:{_status:-1,_result:r},_init:Hw}};Ot.memo=function(r,l){return{$$typeof:W0,type:r,compare:l===void 0?null:l}};Ot.useCallback=function(r,l){return uo().useCallback(r,l)};Ot.useContext=function(r,l){return uo().useContext(r,l)};Ot.useDebugValue=function(){};Ot.useEffect=function(r,l){return uo().useEffect(r,l)};Ot.useImperativeHandle=function(r,l,f){return uo().useImperativeHandle(r,l,f)};Ot.useLayoutEffect=function(r,l){return uo().useLayoutEffect(r,l)};Ot.useMemo=function(r,l){return uo().useMemo(r,l)};Ot.useReducer=function(r,l,f){return uo().useReducer(r,l,f)};Ot.useRef=function(r){return uo().useRef(r)};Ot.useState=function(r){return uo().useState(r)};Ot.version="17.0.2";(function(r){r.exports=Ot})(Vw);const Bt=V0(gi);var Uf={},Kw={get exports(){return Uf},set exports(r){Uf=r}},Jn={},Nf={},Qw={get exports(){return Nf},set exports(r){Nf=r}},ix={};/** @license React v0.20.2
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(r){var l,f,x,T;if(typeof performance=="object"&&typeof performance.now=="function"){var A=performance;r.unstable_now=function(){return A.now()}}else{var R=Date,a=R.now();r.unstable_now=function(){return R.now()-a}}if(typeof window>"u"||typeof MessageChannel!="function"){var H=null,pe=null,Fe=function(){if(H!==null)try{var Ge=r.unstable_now();H(!0,Ge),H=null}catch(Ye){throw setTimeout(Fe,0),Ye}};l=function(Ge){H!==null?setTimeout(l,0,Ge):(H=Ge,setTimeout(Fe,0))},f=function(Ge,Ye){pe=setTimeout(Ge,Ye)},x=function(){clearTimeout(pe)},r.unstable_shouldYield=function(){return!1},T=r.unstable_forceFrameRate=function(){}}else{var ye=window.setTimeout,ie=window.clearTimeout;if(typeof console<"u"){var Se=window.cancelAnimationFrame;typeof window.requestAnimationFrame!="function"&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),typeof Se!="function"&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var Ke=!1,Qe=null,ue=-1,ne=5,ce=0;r.unstable_shouldYield=function(){return r.unstable_now()>=ce},T=function(){},r.unstable_forceFrameRate=function(Ge){0>Ge||125<Ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ne=0<Ge?Math.floor(1e3/Ge):5};var ve=new MessageChannel,Ee=ve.port2;ve.port1.onmessage=function(){if(Qe!==null){var Ge=r.unstable_now();ce=Ge+ne;try{Qe(!0,Ge)?Ee.postMessage(null):(Ke=!1,Qe=null)}catch(Ye){throw Ee.postMessage(null),Ye}}else Ke=!1},l=function(Ge){Qe=Ge,Ke||(Ke=!0,Ee.postMessage(null))},f=function(Ge,Ye){ue=ye(function(){Ge(r.unstable_now())},Ye)},x=function(){ie(ue),ue=-1}}function nt(Ge,Ye){var ut=Ge.length;Ge.push(Ye);e:for(;;){var Zt=ut-1>>>1,Wt=Ge[Zt];if(Wt!==void 0&&0<ht(Wt,Ye))Ge[Zt]=Ye,Ge[ut]=Wt,ut=Zt;else break e}}function Be(Ge){return Ge=Ge[0],Ge===void 0?null:Ge}function rt(Ge){var Ye=Ge[0];if(Ye!==void 0){var ut=Ge.pop();if(ut!==Ye){Ge[0]=ut;e:for(var Zt=0,Wt=Ge.length;Zt<Wt;){var Di=2*(Zt+1)-1,Li=Ge[Di],vt=Di+1,rn=Ge[vt];if(Li!==void 0&&0>ht(Li,ut))rn!==void 0&&0>ht(rn,Li)?(Ge[Zt]=rn,Ge[vt]=ut,Zt=vt):(Ge[Zt]=Li,Ge[Di]=ut,Zt=Di);else if(rn!==void 0&&0>ht(rn,ut))Ge[Zt]=rn,Ge[vt]=ut,Zt=vt;else break e}}return Ye}return null}function ht(Ge,Ye){var ut=Ge.sortIndex-Ye.sortIndex;return ut!==0?ut:Ge.id-Ye.id}var tt=[],St=[],Br=1,xi=null,ei=3,In=!1,nn=!1,An=!1;function pn(Ge){for(var Ye=Be(St);Ye!==null;){if(Ye.callback===null)rt(St);else if(Ye.startTime<=Ge)rt(St),Ye.sortIndex=Ye.expirationTime,nt(tt,Ye);else break;Ye=Be(St)}}function Vn(Ge){if(An=!1,pn(Ge),!nn)if(Be(tt)!==null)nn=!0,l(Pi);else{var Ye=Be(St);Ye!==null&&f(Vn,Ye.startTime-Ge)}}function Pi(Ge,Ye){nn=!1,An&&(An=!1,x()),In=!0;var ut=ei;try{for(pn(Ye),xi=Be(tt);xi!==null&&(!(xi.expirationTime>Ye)||Ge&&!r.unstable_shouldYield());){var Zt=xi.callback;if(typeof Zt=="function"){xi.callback=null,ei=xi.priorityLevel;var Wt=Zt(xi.expirationTime<=Ye);Ye=r.unstable_now(),typeof Wt=="function"?xi.callback=Wt:xi===Be(tt)&&rt(tt),pn(Ye)}else rt(tt);xi=Be(tt)}if(xi!==null)var Di=!0;else{var Li=Be(St);Li!==null&&f(Vn,Li.startTime-Ye),Di=!1}return Di}finally{xi=null,ei=ut,In=!1}}var Gt=T;r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Ge){Ge.callback=null},r.unstable_continueExecution=function(){nn||In||(nn=!0,l(Pi))},r.unstable_getCurrentPriorityLevel=function(){return ei},r.unstable_getFirstCallbackNode=function(){return Be(tt)},r.unstable_next=function(Ge){switch(ei){case 1:case 2:case 3:var Ye=3;break;default:Ye=ei}var ut=ei;ei=Ye;try{return Ge()}finally{ei=ut}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=Gt,r.unstable_runWithPriority=function(Ge,Ye){switch(Ge){case 1:case 2:case 3:case 4:case 5:break;default:Ge=3}var ut=ei;ei=Ge;try{return Ye()}finally{ei=ut}},r.unstable_scheduleCallback=function(Ge,Ye,ut){var Zt=r.unstable_now();switch(typeof ut=="object"&&ut!==null?(ut=ut.delay,ut=typeof ut=="number"&&0<ut?Zt+ut:Zt):ut=Zt,Ge){case 1:var Wt=-1;break;case 2:Wt=250;break;case 5:Wt=1073741823;break;case 4:Wt=1e4;break;default:Wt=5e3}return Wt=ut+Wt,Ge={id:Br++,callback:Ye,priorityLevel:Ge,startTime:ut,expirationTime:Wt,sortIndex:-1},ut>Zt?(Ge.sortIndex=ut,nt(St,Ge),Be(tt)===null&&Ge===Be(St)&&(An?x():An=!0,f(Vn,ut-Zt))):(Ge.sortIndex=Wt,nt(tt,Ge),nn||In||(nn=!0,l(Pi))),Ge},r.unstable_wrapCallback=function(Ge){var Ye=ei;return function(){var ut=ei;ei=Ye;try{return Ge.apply(this,arguments)}finally{ei=ut}}}})(ix);(function(r){r.exports=ix})(Qw);/** @license React v17.0.2
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jd=gi,hi=j0,Oi=Nf;function je(r){for(var l="https://reactjs.org/docs/error-decoder.html?invariant="+r,f=1;f<arguments.length;f++)l+="&args[]="+encodeURIComponent(arguments[f]);return"Minified React error #"+r+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!jd)throw Error(je(227));var nx=new Set,gu={};function ta(r,l){El(r,l),El(r+"Capture",l)}function El(r,l){for(gu[r]=l,r=0;r<l.length;r++)nx.add(l[r])}var co=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Cy=Object.prototype.hasOwnProperty,ky={},Iy={};function eb(r){return Cy.call(Iy,r)?!0:Cy.call(ky,r)?!1:Jw.test(r)?Iy[r]=!0:(ky[r]=!0,!1)}function tb(r,l,f,x){if(f!==null&&f.type===0)return!1;switch(typeof l){case"function":case"symbol":return!0;case"boolean":return x?!1:f!==null?!f.acceptsBooleans:(r=r.toLowerCase().slice(0,5),r!=="data-"&&r!=="aria-");default:return!1}}function ib(r,l,f,x){if(l===null||typeof l>"u"||tb(r,l,f,x))return!0;if(x)return!1;if(f!==null)switch(f.type){case 3:return!l;case 4:return l===!1;case 5:return isNaN(l);case 6:return isNaN(l)||1>l}return!1}function dn(r,l,f,x,T,A,R){this.acceptsBooleans=l===2||l===3||l===4,this.attributeName=x,this.attributeNamespace=T,this.mustUseProperty=f,this.propertyName=r,this.type=l,this.sanitizeURL=A,this.removeEmptyString=R}var Zi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(r){Zi[r]=new dn(r,0,!1,r,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(r){var l=r[0];Zi[l]=new dn(l,1,!1,r[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(r){Zi[r]=new dn(r,2,!1,r.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(r){Zi[r]=new dn(r,2,!1,r,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(r){Zi[r]=new dn(r,3,!1,r.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(r){Zi[r]=new dn(r,3,!0,r,null,!1,!1)});["capture","download"].forEach(function(r){Zi[r]=new dn(r,4,!1,r,null,!1,!1)});["cols","rows","size","span"].forEach(function(r){Zi[r]=new dn(r,6,!1,r,null,!1,!1)});["rowSpan","start"].forEach(function(r){Zi[r]=new dn(r,5,!1,r.toLowerCase(),null,!1,!1)});var Dm=/[\-:]([a-z])/g;function Lm(r){return r[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(r){var l=r.replace(Dm,Lm);Zi[l]=new dn(l,1,!1,r,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(r){var l=r.replace(Dm,Lm);Zi[l]=new dn(l,1,!1,r,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(r){var l=r.replace(Dm,Lm);Zi[l]=new dn(l,1,!1,r,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(r){Zi[r]=new dn(r,1,!1,r.toLowerCase(),null,!1,!1)});Zi.xlinkHref=new dn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(r){Zi[r]=new dn(r,1,!1,r.toLowerCase(),null,!0,!0)});function Rm(r,l,f,x){var T=Zi.hasOwnProperty(l)?Zi[l]:null,A=T!==null?T.type===0:x?!1:!(!(2<l.length)||l[0]!=="o"&&l[0]!=="O"||l[1]!=="n"&&l[1]!=="N");A||(ib(l,f,T,x)&&(f=null),x||T===null?eb(l)&&(f===null?r.removeAttribute(l):r.setAttribute(l,""+f)):T.mustUseProperty?r[T.propertyName]=f===null?T.type===3?!1:"":f:(l=T.attributeName,x=T.attributeNamespace,f===null?r.removeAttribute(l):(T=T.type,f=T===3||T===4&&f===!0?"":""+f,x?r.setAttributeNS(x,l,f):r.setAttribute(l,f))))}var ia=jd.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,eu=60103,qs=60106,$o=60107,Fm=60108,ou=60114,Bm=60109,Om=60110,$d=60112,su=60113,xd=60120,Gd=60115,Um=60116,Nm=60121,Vm=60128,rx=60129,jm=60130,Vf=60131;if(typeof Symbol=="function"&&Symbol.for){var Bi=Symbol.for;eu=Bi("react.element"),qs=Bi("react.portal"),$o=Bi("react.fragment"),Fm=Bi("react.strict_mode"),ou=Bi("react.profiler"),Bm=Bi("react.provider"),Om=Bi("react.context"),$d=Bi("react.forward_ref"),su=Bi("react.suspense"),xd=Bi("react.suspense_list"),Gd=Bi("react.memo"),Um=Bi("react.lazy"),Nm=Bi("react.block"),Bi("react.scope"),Vm=Bi("react.opaque.id"),rx=Bi("react.debug_trace_mode"),jm=Bi("react.offscreen"),Vf=Bi("react.legacy_hidden")}var Ay=typeof Symbol=="function"&&Symbol.iterator;function jc(r){return r===null||typeof r!="object"?null:(r=Ay&&r[Ay]||r["@@iterator"],typeof r=="function"?r:null)}var _f;function tu(r){if(_f===void 0)try{throw Error()}catch(f){var l=f.stack.trim().match(/\n( *(at )?)/);_f=l&&l[1]||""}return`
`+_f+r}var gf=!1;function Kh(r,l){if(!r||gf)return"";gf=!0;var f=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(l)if(l=function(){throw Error()},Object.defineProperty(l.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(l,[])}catch(H){var x=H}Reflect.construct(r,[],l)}else{try{l.call()}catch(H){x=H}r.call(l.prototype)}else{try{throw Error()}catch(H){x=H}r()}}catch(H){if(H&&x&&typeof H.stack=="string"){for(var T=H.stack.split(`
`),A=x.stack.split(`
`),R=T.length-1,a=A.length-1;1<=R&&0<=a&&T[R]!==A[a];)a--;for(;1<=R&&0<=a;R--,a--)if(T[R]!==A[a]){if(R!==1||a!==1)do if(R--,a--,0>a||T[R]!==A[a])return`
`+T[R].replace(" at new "," at ");while(1<=R&&0<=a);break}}}finally{gf=!1,Error.prepareStackTrace=f}return(r=r?r.displayName||r.name:"")?tu(r):""}function nb(r){switch(r.tag){case 5:return tu(r.type);case 16:return tu("Lazy");case 13:return tu("Suspense");case 19:return tu("SuspenseList");case 0:case 2:case 15:return r=Kh(r.type,!1),r;case 11:return r=Kh(r.type.render,!1),r;case 22:return r=Kh(r.type._render,!1),r;case 1:return r=Kh(r.type,!0),r;default:return""}}function fl(r){if(r==null)return null;if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case $o:return"Fragment";case qs:return"Portal";case ou:return"Profiler";case Fm:return"StrictMode";case su:return"Suspense";case xd:return"SuspenseList"}if(typeof r=="object")switch(r.$$typeof){case Om:return(r.displayName||"Context")+".Consumer";case Bm:return(r._context.displayName||"Context")+".Provider";case $d:var l=r.render;return l=l.displayName||l.name||"",r.displayName||(l!==""?"ForwardRef("+l+")":"ForwardRef");case Gd:return fl(r.type);case Nm:return fl(r._render);case Um:l=r._payload,r=r._init;try{return fl(r(l))}catch{}}return null}function ts(r){switch(typeof r){case"boolean":case"number":case"object":case"string":case"undefined":return r;default:return""}}function ox(r){var l=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function rb(r){var l=ox(r)?"checked":"value",f=Object.getOwnPropertyDescriptor(r.constructor.prototype,l),x=""+r[l];if(!r.hasOwnProperty(l)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var T=f.get,A=f.set;return Object.defineProperty(r,l,{configurable:!0,get:function(){return T.call(this)},set:function(R){x=""+R,A.call(this,R)}}),Object.defineProperty(r,l,{enumerable:f.enumerable}),{getValue:function(){return x},setValue:function(R){x=""+R},stopTracking:function(){r._valueTracker=null,delete r[l]}}}}function Qh(r){r._valueTracker||(r._valueTracker=rb(r))}function sx(r){if(!r)return!1;var l=r._valueTracker;if(!l)return!0;var f=l.getValue(),x="";return r&&(x=ox(r)?r.checked?"true":"false":r.value),r=x,r!==f?(l.setValue(r),!0):!1}function vd(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}function jf(r,l){var f=l.checked;return hi({},l,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:f??r._wrapperState.initialChecked})}function My(r,l){var f=l.defaultValue==null?"":l.defaultValue,x=l.checked!=null?l.checked:l.defaultChecked;f=ts(l.value!=null?l.value:f),r._wrapperState={initialChecked:x,initialValue:f,controlled:l.type==="checkbox"||l.type==="radio"?l.checked!=null:l.value!=null}}function ax(r,l){l=l.checked,l!=null&&Rm(r,"checked",l,!1)}function $f(r,l){ax(r,l);var f=ts(l.value),x=l.type;if(f!=null)x==="number"?(f===0&&r.value===""||r.value!=f)&&(r.value=""+f):r.value!==""+f&&(r.value=""+f);else if(x==="submit"||x==="reset"){r.removeAttribute("value");return}l.hasOwnProperty("value")?Gf(r,l.type,f):l.hasOwnProperty("defaultValue")&&Gf(r,l.type,ts(l.defaultValue)),l.checked==null&&l.defaultChecked!=null&&(r.defaultChecked=!!l.defaultChecked)}function zy(r,l,f){if(l.hasOwnProperty("value")||l.hasOwnProperty("defaultValue")){var x=l.type;if(!(x!=="submit"&&x!=="reset"||l.value!==void 0&&l.value!==null))return;l=""+r._wrapperState.initialValue,f||l===r.value||(r.value=l),r.defaultValue=l}f=r.name,f!==""&&(r.name=""),r.defaultChecked=!!r._wrapperState.initialChecked,f!==""&&(r.name=f)}function Gf(r,l,f){(l!=="number"||vd(r.ownerDocument)!==r)&&(f==null?r.defaultValue=""+r._wrapperState.initialValue:r.defaultValue!==""+f&&(r.defaultValue=""+f))}function ob(r){var l="";return jd.Children.forEach(r,function(f){f!=null&&(l+=f)}),l}function Zf(r,l){return r=hi({children:void 0},l),(l=ob(l.children))&&(r.children=l),r}function ml(r,l,f,x){if(r=r.options,l){l={};for(var T=0;T<f.length;T++)l["$"+f[T]]=!0;for(f=0;f<r.length;f++)T=l.hasOwnProperty("$"+r[f].value),r[f].selected!==T&&(r[f].selected=T),T&&x&&(r[f].defaultSelected=!0)}else{for(f=""+ts(f),l=null,T=0;T<r.length;T++){if(r[T].value===f){r[T].selected=!0,x&&(r[T].defaultSelected=!0);return}l!==null||r[T].disabled||(l=r[T])}l!==null&&(l.selected=!0)}}function qf(r,l){if(l.dangerouslySetInnerHTML!=null)throw Error(je(91));return hi({},l,{value:void 0,defaultValue:void 0,children:""+r._wrapperState.initialValue})}function Py(r,l){var f=l.value;if(f==null){if(f=l.children,l=l.defaultValue,f!=null){if(l!=null)throw Error(je(92));if(Array.isArray(f)){if(!(1>=f.length))throw Error(je(93));f=f[0]}l=f}l==null&&(l=""),f=l}r._wrapperState={initialValue:ts(f)}}function lx(r,l){var f=ts(l.value),x=ts(l.defaultValue);f!=null&&(f=""+f,f!==r.value&&(r.value=f),l.defaultValue==null&&r.defaultValue!==f&&(r.defaultValue=f)),x!=null&&(r.defaultValue=""+x)}function Dy(r){var l=r.textContent;l===r._wrapperState.initialValue&&l!==""&&l!==null&&(r.value=l)}var Wf={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function cx(r){switch(r){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xf(r,l){return r==null||r==="http://www.w3.org/1999/xhtml"?cx(l):r==="http://www.w3.org/2000/svg"&&l==="foreignObject"?"http://www.w3.org/1999/xhtml":r}var Jh,ux=function(r){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(l,f,x,T){MSApp.execUnsafeLocalFunction(function(){return r(l,f,x,T)})}:r}(function(r,l){if(r.namespaceURI!==Wf.svg||"innerHTML"in r)r.innerHTML=l;else{for(Jh=Jh||document.createElement("div"),Jh.innerHTML="<svg>"+l.valueOf().toString()+"</svg>",l=Jh.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(;l.firstChild;)r.appendChild(l.firstChild)}});function yu(r,l){if(l){var f=r.firstChild;if(f&&f===r.lastChild&&f.nodeType===3){f.nodeValue=l;return}}r.textContent=l}var au={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sb=["Webkit","ms","Moz","O"];Object.keys(au).forEach(function(r){sb.forEach(function(l){l=l+r.charAt(0).toUpperCase()+r.substring(1),au[l]=au[r]})});function hx(r,l,f){return l==null||typeof l=="boolean"||l===""?"":f||typeof l!="number"||l===0||au.hasOwnProperty(r)&&au[r]?(""+l).trim():l+"px"}function dx(r,l){r=r.style;for(var f in l)if(l.hasOwnProperty(f)){var x=f.indexOf("--")===0,T=hx(f,l[f],x);f==="float"&&(f="cssFloat"),x?r.setProperty(f,T):r[f]=T}}var ab=hi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Hf(r,l){if(l){if(ab[r]&&(l.children!=null||l.dangerouslySetInnerHTML!=null))throw Error(je(137,r));if(l.dangerouslySetInnerHTML!=null){if(l.children!=null)throw Error(je(60));if(!(typeof l.dangerouslySetInnerHTML=="object"&&"__html"in l.dangerouslySetInnerHTML))throw Error(je(61))}if(l.style!=null&&typeof l.style!="object")throw Error(je(62))}}function Yf(r,l){if(r.indexOf("-")===-1)return typeof l.is=="string";switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function $m(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Kf=null,_l=null,gl=null;function Ly(r){if(r=Du(r)){if(typeof Kf!="function")throw Error(je(280));var l=r.stateNode;l&&(l=Yd(l),Kf(r.stateNode,r.type,l))}}function px(r){_l?gl?gl.push(r):gl=[r]:_l=r}function fx(){if(_l){var r=_l,l=gl;if(gl=_l=null,Ly(r),l)for(r=0;r<l.length;r++)Ly(l[r])}}function Gm(r,l){return r(l)}function mx(r,l,f,x,T){return r(l,f,x,T)}function Zm(){}var _x=Gm,Ws=!1,yf=!1;function qm(){(_l!==null||gl!==null)&&(Zm(),fx())}function lb(r,l,f){if(yf)return r(l,f);yf=!0;try{return _x(r,l,f)}finally{yf=!1,qm()}}function xu(r,l){var f=r.stateNode;if(f===null)return null;var x=Yd(f);if(x===null)return null;f=x[l];e:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(r=r.type,x=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!x;break e;default:r=!1}if(r)return null;if(f&&typeof f!="function")throw Error(je(231,l,typeof f));return f}var Qf=!1;if(co)try{var $c={};Object.defineProperty($c,"passive",{get:function(){Qf=!0}}),window.addEventListener("test",$c,$c),window.removeEventListener("test",$c,$c)}catch{Qf=!1}function cb(r,l,f,x,T,A,R,a,H){var pe=Array.prototype.slice.call(arguments,3);try{l.apply(f,pe)}catch(Fe){this.onError(Fe)}}var lu=!1,wd=null,bd=!1,Jf=null,ub={onError:function(r){lu=!0,wd=r}};function hb(r,l,f,x,T,A,R,a,H){lu=!1,wd=null,cb.apply(ub,arguments)}function db(r,l,f,x,T,A,R,a,H){if(hb.apply(this,arguments),lu){if(lu){var pe=wd;lu=!1,wd=null}else throw Error(je(198));bd||(bd=!0,Jf=pe)}}function na(r){var l=r,f=r;if(r.alternate)for(;l.return;)l=l.return;else{r=l;do l=r,l.flags&1026&&(f=l.return),r=l.return;while(r)}return l.tag===3?f:null}function gx(r){if(r.tag===13){var l=r.memoizedState;if(l===null&&(r=r.alternate,r!==null&&(l=r.memoizedState)),l!==null)return l.dehydrated}return null}function Ry(r){if(na(r)!==r)throw Error(je(188))}function pb(r){var l=r.alternate;if(!l){if(l=na(r),l===null)throw Error(je(188));return l!==r?null:r}for(var f=r,x=l;;){var T=f.return;if(T===null)break;var A=T.alternate;if(A===null){if(x=T.return,x!==null){f=x;continue}break}if(T.child===A.child){for(A=T.child;A;){if(A===f)return Ry(T),r;if(A===x)return Ry(T),l;A=A.sibling}throw Error(je(188))}if(f.return!==x.return)f=T,x=A;else{for(var R=!1,a=T.child;a;){if(a===f){R=!0,f=T,x=A;break}if(a===x){R=!0,x=T,f=A;break}a=a.sibling}if(!R){for(a=A.child;a;){if(a===f){R=!0,f=A,x=T;break}if(a===x){R=!0,x=A,f=T;break}a=a.sibling}if(!R)throw Error(je(189))}}if(f.alternate!==x)throw Error(je(190))}if(f.tag!==3)throw Error(je(188));return f.stateNode.current===f?r:l}function yx(r){if(r=pb(r),!r)return null;for(var l=r;;){if(l.tag===5||l.tag===6)return l;if(l.child)l.child.return=l,l=l.child;else{if(l===r)break;for(;!l.sibling;){if(!l.return||l.return===r)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}}return null}function Fy(r,l){for(var f=r.alternate;l!==null;){if(l===r||l===f)return!0;l=l.return}return!1}var xx,Wm,vx,wx,em=!1,zr=[],Wo=null,Xo=null,Ho=null,vu=new Map,wu=new Map,Gc=[],By="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function tm(r,l,f,x,T){return{blockedOn:r,domEventName:l,eventSystemFlags:f|16,nativeEvent:T,targetContainers:[x]}}function Oy(r,l){switch(r){case"focusin":case"focusout":Wo=null;break;case"dragenter":case"dragleave":Xo=null;break;case"mouseover":case"mouseout":Ho=null;break;case"pointerover":case"pointerout":vu.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":wu.delete(l.pointerId)}}function Zc(r,l,f,x,T,A){return r===null||r.nativeEvent!==A?(r=tm(l,f,x,T,A),l!==null&&(l=Du(l),l!==null&&Wm(l)),r):(r.eventSystemFlags|=x,l=r.targetContainers,T!==null&&l.indexOf(T)===-1&&l.push(T),r)}function fb(r,l,f,x,T){switch(l){case"focusin":return Wo=Zc(Wo,r,l,f,x,T),!0;case"dragenter":return Xo=Zc(Xo,r,l,f,x,T),!0;case"mouseover":return Ho=Zc(Ho,r,l,f,x,T),!0;case"pointerover":var A=T.pointerId;return vu.set(A,Zc(vu.get(A)||null,r,l,f,x,T)),!0;case"gotpointercapture":return A=T.pointerId,wu.set(A,Zc(wu.get(A)||null,r,l,f,x,T)),!0}return!1}function mb(r){var l=Xs(r.target);if(l!==null){var f=na(l);if(f!==null){if(l=f.tag,l===13){if(l=gx(f),l!==null){r.blockedOn=l,wx(r.lanePriority,function(){Oi.unstable_runWithPriority(r.priority,function(){vx(f)})});return}}else if(l===3&&f.stateNode.hydrate){r.blockedOn=f.tag===3?f.stateNode.containerInfo:null;return}}}r.blockedOn=null}function cd(r){if(r.blockedOn!==null)return!1;for(var l=r.targetContainers;0<l.length;){var f=Km(r.domEventName,r.eventSystemFlags,l[0],r.nativeEvent);if(f!==null)return l=Du(f),l!==null&&Wm(l),r.blockedOn=f,!1;l.shift()}return!0}function Uy(r,l,f){cd(r)&&f.delete(l)}function _b(){for(em=!1;0<zr.length;){var r=zr[0];if(r.blockedOn!==null){r=Du(r.blockedOn),r!==null&&xx(r);break}for(var l=r.targetContainers;0<l.length;){var f=Km(r.domEventName,r.eventSystemFlags,l[0],r.nativeEvent);if(f!==null){r.blockedOn=f;break}l.shift()}r.blockedOn===null&&zr.shift()}Wo!==null&&cd(Wo)&&(Wo=null),Xo!==null&&cd(Xo)&&(Xo=null),Ho!==null&&cd(Ho)&&(Ho=null),vu.forEach(Uy),wu.forEach(Uy)}function qc(r,l){r.blockedOn===l&&(r.blockedOn=null,em||(em=!0,Oi.unstable_scheduleCallback(Oi.unstable_NormalPriority,_b)))}function bx(r){function l(T){return qc(T,r)}if(0<zr.length){qc(zr[0],r);for(var f=1;f<zr.length;f++){var x=zr[f];x.blockedOn===r&&(x.blockedOn=null)}}for(Wo!==null&&qc(Wo,r),Xo!==null&&qc(Xo,r),Ho!==null&&qc(Ho,r),vu.forEach(l),wu.forEach(l),f=0;f<Gc.length;f++)x=Gc[f],x.blockedOn===r&&(x.blockedOn=null);for(;0<Gc.length&&(f=Gc[0],f.blockedOn===null);)mb(f),f.blockedOn===null&&Gc.shift()}function ed(r,l){var f={};return f[r.toLowerCase()]=l.toLowerCase(),f["Webkit"+r]="webkit"+l,f["Moz"+r]="moz"+l,f}var ll={animationend:ed("Animation","AnimationEnd"),animationiteration:ed("Animation","AnimationIteration"),animationstart:ed("Animation","AnimationStart"),transitionend:ed("Transition","TransitionEnd")},xf={},Tx={};co&&(Tx=document.createElement("div").style,"AnimationEvent"in window||(delete ll.animationend.animation,delete ll.animationiteration.animation,delete ll.animationstart.animation),"TransitionEvent"in window||delete ll.transitionend.transition);function Zd(r){if(xf[r])return xf[r];if(!ll[r])return r;var l=ll[r],f;for(f in l)if(l.hasOwnProperty(f)&&f in Tx)return xf[r]=l[f];return r}var Ex=Zd("animationend"),Sx=Zd("animationiteration"),Cx=Zd("animationstart"),kx=Zd("transitionend"),Ix=new Map,Xm=new Map,gb=["abort","abort",Ex,"animationEnd",Sx,"animationIteration",Cx,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",kx,"transitionEnd","waiting","waiting"];function Hm(r,l){for(var f=0;f<r.length;f+=2){var x=r[f],T=r[f+1];T="on"+(T[0].toUpperCase()+T.slice(1)),Xm.set(x,l),Ix.set(x,T),ta(T,[x])}}var yb=Oi.unstable_now;yb();var Jt=8;function sl(r){if(1&r)return Jt=15,1;if(2&r)return Jt=14,2;if(4&r)return Jt=13,4;var l=24&r;return l!==0?(Jt=12,l):r&32?(Jt=11,32):(l=192&r,l!==0?(Jt=10,l):r&256?(Jt=9,256):(l=3584&r,l!==0?(Jt=8,l):r&4096?(Jt=7,4096):(l=4186112&r,l!==0?(Jt=6,l):(l=62914560&r,l!==0?(Jt=5,l):r&67108864?(Jt=4,67108864):r&134217728?(Jt=3,134217728):(l=805306368&r,l!==0?(Jt=2,l):1073741824&r?(Jt=1,1073741824):(Jt=8,r))))))}function xb(r){switch(r){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}function vb(r){switch(r){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(je(358,r))}}function bu(r,l){var f=r.pendingLanes;if(f===0)return Jt=0;var x=0,T=0,A=r.expiredLanes,R=r.suspendedLanes,a=r.pingedLanes;if(A!==0)x=A,T=Jt=15;else if(A=f&134217727,A!==0){var H=A&~R;H!==0?(x=sl(H),T=Jt):(a&=A,a!==0&&(x=sl(a),T=Jt))}else A=f&~R,A!==0?(x=sl(A),T=Jt):a!==0&&(x=sl(a),T=Jt);if(x===0)return 0;if(x=31-is(x),x=f&((0>x?0:1<<x)<<1)-1,l!==0&&l!==x&&!(l&R)){if(sl(l),T<=Jt)return l;Jt=T}if(l=r.entangledLanes,l!==0)for(r=r.entanglements,l&=x;0<l;)f=31-is(l),T=1<<f,x|=r[f],l&=~T;return x}function Ax(r){return r=r.pendingLanes&-1073741825,r!==0?r:r&1073741824?1073741824:0}function Td(r,l){switch(r){case 15:return 1;case 14:return 2;case 12:return r=al(24&~l),r===0?Td(10,l):r;case 10:return r=al(192&~l),r===0?Td(8,l):r;case 8:return r=al(3584&~l),r===0&&(r=al(4186112&~l),r===0&&(r=512)),r;case 2:return l=al(805306368&~l),l===0&&(l=268435456),l}throw Error(je(358,r))}function al(r){return r&-r}function vf(r){for(var l=[],f=0;31>f;f++)l.push(r);return l}function qd(r,l,f){r.pendingLanes|=l;var x=l-1;r.suspendedLanes&=x,r.pingedLanes&=x,r=r.eventTimes,l=31-is(l),r[l]=f}var is=Math.clz32?Math.clz32:Tb,wb=Math.log,bb=Math.LN2;function Tb(r){return r===0?32:31-(wb(r)/bb|0)|0}var Eb=Oi.unstable_UserBlockingPriority,Sb=Oi.unstable_runWithPriority,ud=!0;function Cb(r,l,f,x){Ws||Zm();var T=Ym,A=Ws;Ws=!0;try{mx(T,r,l,f,x)}finally{(Ws=A)||qm()}}function kb(r,l,f,x){Sb(Eb,Ym.bind(null,r,l,f,x))}function Ym(r,l,f,x){if(ud){var T;if((T=(l&4)===0)&&0<zr.length&&-1<By.indexOf(r))r=tm(null,r,l,f,x),zr.push(r);else{var A=Km(r,l,f,x);if(A===null)T&&Oy(r,x);else{if(T){if(-1<By.indexOf(r)){r=tm(A,r,l,f,x),zr.push(r);return}if(fb(A,r,l,f,x))return;Oy(r,x)}jx(r,l,x,null,f)}}}}function Km(r,l,f,x){var T=$m(x);if(T=Xs(T),T!==null){var A=na(T);if(A===null)T=null;else{var R=A.tag;if(R===13){if(T=gx(A),T!==null)return T;T=null}else if(R===3){if(A.stateNode.hydrate)return A.tag===3?A.stateNode.containerInfo:null;T=null}else A!==T&&(T=null)}}return jx(r,l,x,T,f),null}var Go=null,Qm=null,hd=null;function Mx(){if(hd)return hd;var r,l=Qm,f=l.length,x,T="value"in Go?Go.value:Go.textContent,A=T.length;for(r=0;r<f&&l[r]===T[r];r++);var R=f-r;for(x=1;x<=R&&l[f-x]===T[A-x];x++);return hd=T.slice(r,1<x?1-x:void 0)}function dd(r){var l=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&l===13&&(r=13)):r=l,r===10&&(r=13),32<=r||r===13?r:0}function td(){return!0}function Ny(){return!1}function Nn(r){function l(f,x,T,A,R){this._reactName=f,this._targetInst=T,this.type=x,this.nativeEvent=A,this.target=R,this.currentTarget=null;for(var a in r)r.hasOwnProperty(a)&&(f=r[a],this[a]=f?f(A):A[a]);return this.isDefaultPrevented=(A.defaultPrevented!=null?A.defaultPrevented:A.returnValue===!1)?td:Ny,this.isPropagationStopped=Ny,this}return hi(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var f=this.nativeEvent;f&&(f.preventDefault?f.preventDefault():typeof f.returnValue!="unknown"&&(f.returnValue=!1),this.isDefaultPrevented=td)},stopPropagation:function(){var f=this.nativeEvent;f&&(f.stopPropagation?f.stopPropagation():typeof f.cancelBubble!="unknown"&&(f.cancelBubble=!0),this.isPropagationStopped=td)},persist:function(){},isPersistent:td}),l}var Ml={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jm=Nn(Ml),Pu=hi({},Ml,{view:0,detail:0}),Ib=Nn(Pu),wf,bf,Wc,Wd=hi({},Pu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:e_,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Wc&&(Wc&&r.type==="mousemove"?(wf=r.screenX-Wc.screenX,bf=r.screenY-Wc.screenY):bf=wf=0,Wc=r),wf)},movementY:function(r){return"movementY"in r?r.movementY:bf}}),Vy=Nn(Wd),Ab=hi({},Wd,{dataTransfer:0}),Mb=Nn(Ab),zb=hi({},Pu,{relatedTarget:0}),Tf=Nn(zb),Pb=hi({},Ml,{animationName:0,elapsedTime:0,pseudoElement:0}),Db=Nn(Pb),Lb=hi({},Ml,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Rb=Nn(Lb),Fb=hi({},Ml,{data:0}),jy=Nn(Fb),Bb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ob={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ub={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Nb(r){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(r):(r=Ub[r])?!!l[r]:!1}function e_(){return Nb}var Vb=hi({},Pu,{key:function(r){if(r.key){var l=Bb[r.key]||r.key;if(l!=="Unidentified")return l}return r.type==="keypress"?(r=dd(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Ob[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:e_,charCode:function(r){return r.type==="keypress"?dd(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?dd(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),jb=Nn(Vb),$b=hi({},Wd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),$y=Nn($b),Gb=hi({},Pu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:e_}),Zb=Nn(Gb),qb=hi({},Ml,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wb=Nn(qb),Xb=hi({},Wd,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Hb=Nn(Xb),Yb=[9,13,27,32],t_=co&&"CompositionEvent"in window,cu=null;co&&"documentMode"in document&&(cu=document.documentMode);var Kb=co&&"TextEvent"in window&&!cu,zx=co&&(!t_||cu&&8<cu&&11>=cu),Gy=String.fromCharCode(32),Zy=!1;function Px(r,l){switch(r){case"keyup":return Yb.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Dx(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var cl=!1;function Qb(r,l){switch(r){case"compositionend":return Dx(l);case"keypress":return l.which!==32?null:(Zy=!0,Gy);case"textInput":return r=l.data,r===Gy&&Zy?null:r;default:return null}}function Jb(r,l){if(cl)return r==="compositionend"||!t_&&Px(r,l)?(r=Mx(),hd=Qm=Go=null,cl=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return zx&&l.locale!=="ko"?null:l.data;default:return null}}var e2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qy(r){var l=r&&r.nodeName&&r.nodeName.toLowerCase();return l==="input"?!!e2[r.type]:l==="textarea"}function Lx(r,l,f,x){px(x),l=Ed(l,"onChange"),0<l.length&&(f=new Jm("onChange","change",null,f,x),r.push({event:f,listeners:l}))}var uu=null,Tu=null;function t2(r){Ux(r,0)}function Xd(r){var l=hl(r);if(sx(l))return r}function i2(r,l){if(r==="change")return l}var Rx=!1;if(co){var Ef;if(co){var Sf="oninput"in document;if(!Sf){var Wy=document.createElement("div");Wy.setAttribute("oninput","return;"),Sf=typeof Wy.oninput=="function"}Ef=Sf}else Ef=!1;Rx=Ef&&(!document.documentMode||9<document.documentMode)}function Xy(){uu&&(uu.detachEvent("onpropertychange",Fx),Tu=uu=null)}function Fx(r){if(r.propertyName==="value"&&Xd(Tu)){var l=[];if(Lx(l,Tu,r,$m(r)),r=t2,Ws)r(l);else{Ws=!0;try{Gm(r,l)}finally{Ws=!1,qm()}}}}function n2(r,l,f){r==="focusin"?(Xy(),uu=l,Tu=f,uu.attachEvent("onpropertychange",Fx)):r==="focusout"&&Xy()}function r2(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Xd(Tu)}function o2(r,l){if(r==="click")return Xd(l)}function s2(r,l){if(r==="input"||r==="change")return Xd(l)}function a2(r,l){return r===l&&(r!==0||1/r===1/l)||r!==r&&l!==l}var Xn=typeof Object.is=="function"?Object.is:a2,l2=Object.prototype.hasOwnProperty;function Eu(r,l){if(Xn(r,l))return!0;if(typeof r!="object"||r===null||typeof l!="object"||l===null)return!1;var f=Object.keys(r),x=Object.keys(l);if(f.length!==x.length)return!1;for(x=0;x<f.length;x++)if(!l2.call(l,f[x])||!Xn(r[f[x]],l[f[x]]))return!1;return!0}function Hy(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function Yy(r,l){var f=Hy(r);r=0;for(var x;f;){if(f.nodeType===3){if(x=r+f.textContent.length,r<=l&&x>=l)return{node:f,offset:l-r};r=x}e:{for(;f;){if(f.nextSibling){f=f.nextSibling;break e}f=f.parentNode}f=void 0}f=Hy(f)}}function Bx(r,l){return r&&l?r===l?!0:r&&r.nodeType===3?!1:l&&l.nodeType===3?Bx(r,l.parentNode):"contains"in r?r.contains(l):r.compareDocumentPosition?!!(r.compareDocumentPosition(l)&16):!1:!1}function Ky(){for(var r=window,l=vd();l instanceof r.HTMLIFrameElement;){try{var f=typeof l.contentWindow.location.href=="string"}catch{f=!1}if(f)r=l.contentWindow;else break;l=vd(r.document)}return l}function im(r){var l=r&&r.nodeName&&r.nodeName.toLowerCase();return l&&(l==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||l==="textarea"||r.contentEditable==="true")}var c2=co&&"documentMode"in document&&11>=document.documentMode,ul=null,nm=null,hu=null,rm=!1;function Qy(r,l,f){var x=f.window===f?f.document:f.nodeType===9?f:f.ownerDocument;rm||ul==null||ul!==vd(x)||(x=ul,"selectionStart"in x&&im(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),hu&&Eu(hu,x)||(hu=x,x=Ed(nm,"onSelect"),0<x.length&&(l=new Jm("onSelect","select",null,l,f),r.push({event:l,listeners:x}),l.target=ul)))}Hm("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0);Hm("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Hm(gb,2);for(var Jy="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Cf=0;Cf<Jy.length;Cf++)Xm.set(Jy[Cf],0);El("onMouseEnter",["mouseout","mouseover"]);El("onMouseLeave",["mouseout","mouseover"]);El("onPointerEnter",["pointerout","pointerover"]);El("onPointerLeave",["pointerout","pointerover"]);ta("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ta("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ta("onBeforeInput",["compositionend","keypress","textInput","paste"]);ta("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ta("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ta("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var iu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ox=new Set("cancel close invalid load scroll toggle".split(" ").concat(iu));function e0(r,l,f){var x=r.type||"unknown-event";r.currentTarget=f,db(x,l,void 0,r),r.currentTarget=null}function Ux(r,l){l=(l&4)!==0;for(var f=0;f<r.length;f++){var x=r[f],T=x.event;x=x.listeners;e:{var A=void 0;if(l)for(var R=x.length-1;0<=R;R--){var a=x[R],H=a.instance,pe=a.currentTarget;if(a=a.listener,H!==A&&T.isPropagationStopped())break e;e0(T,a,pe),A=H}else for(R=0;R<x.length;R++){if(a=x[R],H=a.instance,pe=a.currentTarget,a=a.listener,H!==A&&T.isPropagationStopped())break e;e0(T,a,pe),A=H}}}if(bd)throw r=Jf,bd=!1,Jf=null,r}function oi(r,l){var f=Gx(l),x=r+"__bubble";f.has(x)||(Vx(l,r,2,!1),f.add(x))}var t0="_reactListening"+Math.random().toString(36).slice(2);function Nx(r){r[t0]||(r[t0]=!0,nx.forEach(function(l){Ox.has(l)||i0(l,!1,r,null),i0(l,!0,r,null)}))}function i0(r,l,f,x){var T=4<arguments.length&&arguments[4]!==void 0?arguments[4]:0,A=f;if(r==="selectionchange"&&f.nodeType!==9&&(A=f.ownerDocument),x!==null&&!l&&Ox.has(r)){if(r!=="scroll")return;T|=2,A=x}var R=Gx(A),a=r+"__"+(l?"capture":"bubble");R.has(a)||(l&&(T|=4),Vx(A,r,T,l),R.add(a))}function Vx(r,l,f,x){var T=Xm.get(l);switch(T===void 0?2:T){case 0:T=Cb;break;case 1:T=kb;break;default:T=Ym}f=T.bind(null,l,f,r),T=void 0,!Qf||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(T=!0),x?T!==void 0?r.addEventListener(l,f,{capture:!0,passive:T}):r.addEventListener(l,f,!0):T!==void 0?r.addEventListener(l,f,{passive:T}):r.addEventListener(l,f,!1)}function jx(r,l,f,x,T){var A=x;if(!(l&1)&&!(l&2)&&x!==null)e:for(;;){if(x===null)return;var R=x.tag;if(R===3||R===4){var a=x.stateNode.containerInfo;if(a===T||a.nodeType===8&&a.parentNode===T)break;if(R===4)for(R=x.return;R!==null;){var H=R.tag;if((H===3||H===4)&&(H=R.stateNode.containerInfo,H===T||H.nodeType===8&&H.parentNode===T))return;R=R.return}for(;a!==null;){if(R=Xs(a),R===null)return;if(H=R.tag,H===5||H===6){x=A=R;continue e}a=a.parentNode}}x=x.return}lb(function(){var pe=A,Fe=$m(f),ye=[];e:{var ie=Ix.get(r);if(ie!==void 0){var Se=Jm,Ke=r;switch(r){case"keypress":if(dd(f)===0)break e;case"keydown":case"keyup":Se=jb;break;case"focusin":Ke="focus",Se=Tf;break;case"focusout":Ke="blur",Se=Tf;break;case"beforeblur":case"afterblur":Se=Tf;break;case"click":if(f.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Se=Vy;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Se=Mb;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Se=Zb;break;case Ex:case Sx:case Cx:Se=Db;break;case kx:Se=Wb;break;case"scroll":Se=Ib;break;case"wheel":Se=Hb;break;case"copy":case"cut":case"paste":Se=Rb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Se=$y}var Qe=(l&4)!==0,ue=!Qe&&r==="scroll",ne=Qe?ie!==null?ie+"Capture":null:ie;Qe=[];for(var ce=pe,ve;ce!==null;){ve=ce;var Ee=ve.stateNode;if(ve.tag===5&&Ee!==null&&(ve=Ee,ne!==null&&(Ee=xu(ce,ne),Ee!=null&&Qe.push(Su(ce,Ee,ve)))),ue)break;ce=ce.return}0<Qe.length&&(ie=new Se(ie,Ke,null,f,Fe),ye.push({event:ie,listeners:Qe}))}}if(!(l&7)){e:{if(ie=r==="mouseover"||r==="pointerover",Se=r==="mouseout"||r==="pointerout",ie&&!(l&16)&&(Ke=f.relatedTarget||f.fromElement)&&(Xs(Ke)||Ke[zl]))break e;if((Se||ie)&&(ie=Fe.window===Fe?Fe:(ie=Fe.ownerDocument)?ie.defaultView||ie.parentWindow:window,Se?(Ke=f.relatedTarget||f.toElement,Se=pe,Ke=Ke?Xs(Ke):null,Ke!==null&&(ue=na(Ke),Ke!==ue||Ke.tag!==5&&Ke.tag!==6)&&(Ke=null)):(Se=null,Ke=pe),Se!==Ke)){if(Qe=Vy,Ee="onMouseLeave",ne="onMouseEnter",ce="mouse",(r==="pointerout"||r==="pointerover")&&(Qe=$y,Ee="onPointerLeave",ne="onPointerEnter",ce="pointer"),ue=Se==null?ie:hl(Se),ve=Ke==null?ie:hl(Ke),ie=new Qe(Ee,ce+"leave",Se,f,Fe),ie.target=ue,ie.relatedTarget=ve,Ee=null,Xs(Fe)===pe&&(Qe=new Qe(ne,ce+"enter",Ke,f,Fe),Qe.target=ve,Qe.relatedTarget=ue,Ee=Qe),ue=Ee,Se&&Ke)t:{for(Qe=Se,ne=Ke,ce=0,ve=Qe;ve;ve=ol(ve))ce++;for(ve=0,Ee=ne;Ee;Ee=ol(Ee))ve++;for(;0<ce-ve;)Qe=ol(Qe),ce--;for(;0<ve-ce;)ne=ol(ne),ve--;for(;ce--;){if(Qe===ne||ne!==null&&Qe===ne.alternate)break t;Qe=ol(Qe),ne=ol(ne)}Qe=null}else Qe=null;Se!==null&&n0(ye,ie,Se,Qe,!1),Ke!==null&&ue!==null&&n0(ye,ue,Ke,Qe,!0)}}e:{if(ie=pe?hl(pe):window,Se=ie.nodeName&&ie.nodeName.toLowerCase(),Se==="select"||Se==="input"&&ie.type==="file")var nt=i2;else if(qy(ie))if(Rx)nt=s2;else{nt=r2;var Be=n2}else(Se=ie.nodeName)&&Se.toLowerCase()==="input"&&(ie.type==="checkbox"||ie.type==="radio")&&(nt=o2);if(nt&&(nt=nt(r,pe))){Lx(ye,nt,f,Fe);break e}Be&&Be(r,ie,pe),r==="focusout"&&(Be=ie._wrapperState)&&Be.controlled&&ie.type==="number"&&Gf(ie,"number",ie.value)}switch(Be=pe?hl(pe):window,r){case"focusin":(qy(Be)||Be.contentEditable==="true")&&(ul=Be,nm=pe,hu=null);break;case"focusout":hu=nm=ul=null;break;case"mousedown":rm=!0;break;case"contextmenu":case"mouseup":case"dragend":rm=!1,Qy(ye,f,Fe);break;case"selectionchange":if(c2)break;case"keydown":case"keyup":Qy(ye,f,Fe)}var rt;if(t_)e:{switch(r){case"compositionstart":var ht="onCompositionStart";break e;case"compositionend":ht="onCompositionEnd";break e;case"compositionupdate":ht="onCompositionUpdate";break e}ht=void 0}else cl?Px(r,f)&&(ht="onCompositionEnd"):r==="keydown"&&f.keyCode===229&&(ht="onCompositionStart");ht&&(zx&&f.locale!=="ko"&&(cl||ht!=="onCompositionStart"?ht==="onCompositionEnd"&&cl&&(rt=Mx()):(Go=Fe,Qm="value"in Go?Go.value:Go.textContent,cl=!0)),Be=Ed(pe,ht),0<Be.length&&(ht=new jy(ht,r,null,f,Fe),ye.push({event:ht,listeners:Be}),rt?ht.data=rt:(rt=Dx(f),rt!==null&&(ht.data=rt)))),(rt=Kb?Qb(r,f):Jb(r,f))&&(pe=Ed(pe,"onBeforeInput"),0<pe.length&&(Fe=new jy("onBeforeInput","beforeinput",null,f,Fe),ye.push({event:Fe,listeners:pe}),Fe.data=rt))}Ux(ye,l)})}function Su(r,l,f){return{instance:r,listener:l,currentTarget:f}}function Ed(r,l){for(var f=l+"Capture",x=[];r!==null;){var T=r,A=T.stateNode;T.tag===5&&A!==null&&(T=A,A=xu(r,f),A!=null&&x.unshift(Su(r,A,T)),A=xu(r,l),A!=null&&x.push(Su(r,A,T))),r=r.return}return x}function ol(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5);return r||null}function n0(r,l,f,x,T){for(var A=l._reactName,R=[];f!==null&&f!==x;){var a=f,H=a.alternate,pe=a.stateNode;if(H!==null&&H===x)break;a.tag===5&&pe!==null&&(a=pe,T?(H=xu(f,A),H!=null&&R.unshift(Su(f,H,a))):T||(H=xu(f,A),H!=null&&R.push(Su(f,H,a)))),f=f.return}R.length!==0&&r.push({event:l,listeners:R})}function Sd(){}var kf=null,If=null;function $x(r,l){switch(r){case"button":case"input":case"select":case"textarea":return!!l.autoFocus}return!1}function om(r,l){return r==="textarea"||r==="option"||r==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var r0=typeof setTimeout=="function"?setTimeout:void 0,u2=typeof clearTimeout=="function"?clearTimeout:void 0;function i_(r){r.nodeType===1?r.textContent="":r.nodeType===9&&(r=r.body,r!=null&&(r.textContent=""))}function yl(r){for(;r!=null;r=r.nextSibling){var l=r.nodeType;if(l===1||l===3)break}return r}function o0(r){r=r.previousSibling;for(var l=0;r;){if(r.nodeType===8){var f=r.data;if(f==="$"||f==="$!"||f==="$?"){if(l===0)return r;l--}else f==="/$"&&l++}r=r.previousSibling}return null}var Af=0;function h2(r){return{$$typeof:Vm,toString:r,valueOf:r}}var Hd=Math.random().toString(36).slice(2),Zo="__reactFiber$"+Hd,Cd="__reactProps$"+Hd,zl="__reactContainer$"+Hd,s0="__reactEvents$"+Hd;function Xs(r){var l=r[Zo];if(l)return l;for(var f=r.parentNode;f;){if(l=f[zl]||f[Zo]){if(f=l.alternate,l.child!==null||f!==null&&f.child!==null)for(r=o0(r);r!==null;){if(f=r[Zo])return f;r=o0(r)}return l}r=f,f=r.parentNode}return null}function Du(r){return r=r[Zo]||r[zl],!r||r.tag!==5&&r.tag!==6&&r.tag!==13&&r.tag!==3?null:r}function hl(r){if(r.tag===5||r.tag===6)return r.stateNode;throw Error(je(33))}function Yd(r){return r[Cd]||null}function Gx(r){var l=r[s0];return l===void 0&&(l=r[s0]=new Set),l}var sm=[],dl=-1;function ss(r){return{current:r}}function si(r){0>dl||(r.current=sm[dl],sm[dl]=null,dl--)}function _i(r,l){dl++,sm[dl]=r.current,r.current=l}var ns={},tn=ss(ns),Cn=ss(!1),Qs=ns;function Sl(r,l){var f=r.type.contextTypes;if(!f)return ns;var x=r.stateNode;if(x&&x.__reactInternalMemoizedUnmaskedChildContext===l)return x.__reactInternalMemoizedMaskedChildContext;var T={},A;for(A in f)T[A]=l[A];return x&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=l,r.__reactInternalMemoizedMaskedChildContext=T),T}function kn(r){return r=r.childContextTypes,r!=null}function kd(){si(Cn),si(tn)}function a0(r,l,f){if(tn.current!==ns)throw Error(je(168));_i(tn,l),_i(Cn,f)}function Zx(r,l,f){var x=r.stateNode;if(r=l.childContextTypes,typeof x.getChildContext!="function")return f;x=x.getChildContext();for(var T in x)if(!(T in r))throw Error(je(108,fl(l)||"Unknown",T));return hi({},f,x)}function pd(r){return r=(r=r.stateNode)&&r.__reactInternalMemoizedMergedChildContext||ns,Qs=tn.current,_i(tn,r),_i(Cn,Cn.current),!0}function l0(r,l,f){var x=r.stateNode;if(!x)throw Error(je(169));f?(r=Zx(r,l,Qs),x.__reactInternalMemoizedMergedChildContext=r,si(Cn),si(tn),_i(tn,r)):si(Cn),_i(Cn,f)}var n_=null,Ks=null,d2=Oi.unstable_runWithPriority,r_=Oi.unstable_scheduleCallback,am=Oi.unstable_cancelCallback,p2=Oi.unstable_shouldYield,c0=Oi.unstable_requestPaint,lm=Oi.unstable_now,f2=Oi.unstable_getCurrentPriorityLevel,Kd=Oi.unstable_ImmediatePriority,qx=Oi.unstable_UserBlockingPriority,Wx=Oi.unstable_NormalPriority,Xx=Oi.unstable_LowPriority,Hx=Oi.unstable_IdlePriority,Mf={},m2=c0!==void 0?c0:function(){},ro=null,fd=null,zf=!1,u0=lm(),Ji=1e4>u0?lm:function(){return lm()-u0};function Cl(){switch(f2()){case Kd:return 99;case qx:return 98;case Wx:return 97;case Xx:return 96;case Hx:return 95;default:throw Error(je(332))}}function Yx(r){switch(r){case 99:return Kd;case 98:return qx;case 97:return Wx;case 96:return Xx;case 95:return Hx;default:throw Error(je(332))}}function Js(r,l){return r=Yx(r),d2(r,l)}function Cu(r,l,f){return r=Yx(r),r_(r,l,f)}function Fr(){if(fd!==null){var r=fd;fd=null,am(r)}Kx()}function Kx(){if(!zf&&ro!==null){zf=!0;var r=0;try{var l=ro;Js(99,function(){for(;r<l.length;r++){var f=l[r];do f=f(!0);while(f!==null)}}),ro=null}catch(f){throw ro!==null&&(ro=ro.slice(r+1)),r_(Kd,Fr),f}finally{zf=!1}}}var _2=ia.ReactCurrentBatchConfig;function fr(r,l){if(r&&r.defaultProps){l=hi({},l),r=r.defaultProps;for(var f in r)l[f]===void 0&&(l[f]=r[f]);return l}return l}var Id=ss(null),Ad=null,pl=null,Md=null;function o_(){Md=pl=Ad=null}function s_(r){var l=Id.current;si(Id),r.type._context._currentValue=l}function Qx(r,l){for(;r!==null;){var f=r.alternate;if((r.childLanes&l)===l){if(f===null||(f.childLanes&l)===l)break;f.childLanes|=l}else r.childLanes|=l,f!==null&&(f.childLanes|=l);r=r.return}}function xl(r,l){Ad=r,Md=pl=null,r=r.dependencies,r!==null&&r.firstContext!==null&&(r.lanes&l&&(mr=!0),r.firstContext=null)}function Kn(r,l){if(Md!==r&&l!==!1&&l!==0)if((typeof l!="number"||l===1073741823)&&(Md=r,l=1073741823),l={context:r,observedBits:l,next:null},pl===null){if(Ad===null)throw Error(je(308));pl=l,Ad.dependencies={lanes:0,firstContext:l,responders:null}}else pl=pl.next=l;return r._currentValue}var jo=!1;function a_(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function Jx(r,l){r=r.updateQueue,l.updateQueue===r&&(l.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,effects:r.effects})}function Yo(r,l){return{eventTime:r,lane:l,tag:0,payload:null,callback:null,next:null}}function Ko(r,l){if(r=r.updateQueue,r!==null){r=r.shared;var f=r.pending;f===null?l.next=l:(l.next=f.next,f.next=l),r.pending=l}}function h0(r,l){var f=r.updateQueue,x=r.alternate;if(x!==null&&(x=x.updateQueue,f===x)){var T=null,A=null;if(f=f.firstBaseUpdate,f!==null){do{var R={eventTime:f.eventTime,lane:f.lane,tag:f.tag,payload:f.payload,callback:f.callback,next:null};A===null?T=A=R:A=A.next=R,f=f.next}while(f!==null);A===null?T=A=l:A=A.next=l}else T=A=l;f={baseState:x.baseState,firstBaseUpdate:T,lastBaseUpdate:A,shared:x.shared,effects:x.effects},r.updateQueue=f;return}r=f.lastBaseUpdate,r===null?f.firstBaseUpdate=l:r.next=l,f.lastBaseUpdate=l}function ku(r,l,f,x){var T=r.updateQueue;jo=!1;var A=T.firstBaseUpdate,R=T.lastBaseUpdate,a=T.shared.pending;if(a!==null){T.shared.pending=null;var H=a,pe=H.next;H.next=null,R===null?A=pe:R.next=pe,R=H;var Fe=r.alternate;if(Fe!==null){Fe=Fe.updateQueue;var ye=Fe.lastBaseUpdate;ye!==R&&(ye===null?Fe.firstBaseUpdate=pe:ye.next=pe,Fe.lastBaseUpdate=H)}}if(A!==null){ye=T.baseState,R=0,Fe=pe=H=null;do{a=A.lane;var ie=A.eventTime;if((x&a)===a){Fe!==null&&(Fe=Fe.next={eventTime:ie,lane:0,tag:A.tag,payload:A.payload,callback:A.callback,next:null});e:{var Se=r,Ke=A;switch(a=l,ie=f,Ke.tag){case 1:if(Se=Ke.payload,typeof Se=="function"){ye=Se.call(ie,ye,a);break e}ye=Se;break e;case 3:Se.flags=Se.flags&-4097|64;case 0:if(Se=Ke.payload,a=typeof Se=="function"?Se.call(ie,ye,a):Se,a==null)break e;ye=hi({},ye,a);break e;case 2:jo=!0}}A.callback!==null&&(r.flags|=32,a=T.effects,a===null?T.effects=[A]:a.push(A))}else ie={eventTime:ie,lane:a,tag:A.tag,payload:A.payload,callback:A.callback,next:null},Fe===null?(pe=Fe=ie,H=ye):Fe=Fe.next=ie,R|=a;if(A=A.next,A===null){if(a=T.shared.pending,a===null)break;A=a.next,a.next=null,T.lastBaseUpdate=a,T.shared.pending=null}}while(1);Fe===null&&(H=ye),T.baseState=H,T.firstBaseUpdate=pe,T.lastBaseUpdate=Fe,Ru|=R,r.lanes=R,r.memoizedState=ye}}function d0(r,l,f){if(r=l.effects,l.effects=null,r!==null)for(l=0;l<r.length;l++){var x=r[l],T=x.callback;if(T!==null){if(x.callback=null,x=f,typeof T!="function")throw Error(je(191,T));T.call(x)}}}var ev=new jd.Component().refs;function zd(r,l,f,x){l=r.memoizedState,f=f(x,l),f=f==null?l:hi({},l,f),r.memoizedState=f,r.lanes===0&&(r.updateQueue.baseState=f)}var Qd={isMounted:function(r){return(r=r._reactInternals)?na(r)===r:!1},enqueueSetState:function(r,l,f){r=r._reactInternals;var x=Un(),T=Qo(r),A=Yo(x,T);A.payload=l,f!=null&&(A.callback=f),Ko(r,A),Jo(r,T,x)},enqueueReplaceState:function(r,l,f){r=r._reactInternals;var x=Un(),T=Qo(r),A=Yo(x,T);A.tag=1,A.payload=l,f!=null&&(A.callback=f),Ko(r,A),Jo(r,T,x)},enqueueForceUpdate:function(r,l){r=r._reactInternals;var f=Un(),x=Qo(r),T=Yo(f,x);T.tag=2,l!=null&&(T.callback=l),Ko(r,T),Jo(r,x,f)}};function p0(r,l,f,x,T,A,R){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(x,A,R):l.prototype&&l.prototype.isPureReactComponent?!Eu(f,x)||!Eu(T,A):!0}function tv(r,l,f){var x=!1,T=ns,A=l.contextType;return typeof A=="object"&&A!==null?A=Kn(A):(T=kn(l)?Qs:tn.current,x=l.contextTypes,A=(x=x!=null)?Sl(r,T):ns),l=new l(f,A),r.memoizedState=l.state!==null&&l.state!==void 0?l.state:null,l.updater=Qd,r.stateNode=l,l._reactInternals=r,x&&(r=r.stateNode,r.__reactInternalMemoizedUnmaskedChildContext=T,r.__reactInternalMemoizedMaskedChildContext=A),l}function f0(r,l,f,x){r=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(f,x),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(f,x),l.state!==r&&Qd.enqueueReplaceState(l,l.state,null)}function cm(r,l,f,x){var T=r.stateNode;T.props=f,T.state=r.memoizedState,T.refs=ev,a_(r);var A=l.contextType;typeof A=="object"&&A!==null?T.context=Kn(A):(A=kn(l)?Qs:tn.current,T.context=Sl(r,A)),ku(r,f,T,x),T.state=r.memoizedState,A=l.getDerivedStateFromProps,typeof A=="function"&&(zd(r,l,A,f),T.state=r.memoizedState),typeof l.getDerivedStateFromProps=="function"||typeof T.getSnapshotBeforeUpdate=="function"||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(l=T.state,typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount(),l!==T.state&&Qd.enqueueReplaceState(T,T.state,null),ku(r,f,T,x),T.state=r.memoizedState),typeof T.componentDidMount=="function"&&(r.flags|=4)}var id=Array.isArray;function Xc(r,l,f){if(r=f.ref,r!==null&&typeof r!="function"&&typeof r!="object"){if(f._owner){if(f=f._owner,f){if(f.tag!==1)throw Error(je(309));var x=f.stateNode}if(!x)throw Error(je(147,r));var T=""+r;return l!==null&&l.ref!==null&&typeof l.ref=="function"&&l.ref._stringRef===T?l.ref:(l=function(A){var R=x.refs;R===ev&&(R=x.refs={}),A===null?delete R[T]:R[T]=A},l._stringRef=T,l)}if(typeof r!="string")throw Error(je(284));if(!f._owner)throw Error(je(290,r))}return r}function nd(r,l){if(r.type!=="textarea")throw Error(je(31,Object.prototype.toString.call(l)==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":l))}function iv(r){function l(ue,ne){if(r){var ce=ue.lastEffect;ce!==null?(ce.nextEffect=ne,ue.lastEffect=ne):ue.firstEffect=ue.lastEffect=ne,ne.nextEffect=null,ne.flags=8}}function f(ue,ne){if(!r)return null;for(;ne!==null;)l(ue,ne),ne=ne.sibling;return null}function x(ue,ne){for(ue=new Map;ne!==null;)ne.key!==null?ue.set(ne.key,ne):ue.set(ne.index,ne),ne=ne.sibling;return ue}function T(ue,ne){return ue=os(ue,ne),ue.index=0,ue.sibling=null,ue}function A(ue,ne,ce){return ue.index=ce,r?(ce=ue.alternate,ce!==null?(ce=ce.index,ce<ne?(ue.flags=2,ne):ce):(ue.flags=2,ne)):ne}function R(ue){return r&&ue.alternate===null&&(ue.flags=2),ue}function a(ue,ne,ce,ve){return ne===null||ne.tag!==6?(ne=Ff(ce,ue.mode,ve),ne.return=ue,ne):(ne=T(ne,ce),ne.return=ue,ne)}function H(ue,ne,ce,ve){return ne!==null&&ne.elementType===ce.type?(ve=T(ne,ce.props),ve.ref=Xc(ue,ne,ce),ve.return=ue,ve):(ve=yd(ce.type,ce.key,ce.props,null,ue.mode,ve),ve.ref=Xc(ue,ne,ce),ve.return=ue,ve)}function pe(ue,ne,ce,ve){return ne===null||ne.tag!==4||ne.stateNode.containerInfo!==ce.containerInfo||ne.stateNode.implementation!==ce.implementation?(ne=Bf(ce,ue.mode,ve),ne.return=ue,ne):(ne=T(ne,ce.children||[]),ne.return=ue,ne)}function Fe(ue,ne,ce,ve,Ee){return ne===null||ne.tag!==7?(ne=Tl(ce,ue.mode,ve,Ee),ne.return=ue,ne):(ne=T(ne,ce),ne.return=ue,ne)}function ye(ue,ne,ce){if(typeof ne=="string"||typeof ne=="number")return ne=Ff(""+ne,ue.mode,ce),ne.return=ue,ne;if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case eu:return ce=yd(ne.type,ne.key,ne.props,null,ue.mode,ce),ce.ref=Xc(ue,null,ne),ce.return=ue,ce;case qs:return ne=Bf(ne,ue.mode,ce),ne.return=ue,ne}if(id(ne)||jc(ne))return ne=Tl(ne,ue.mode,ce,null),ne.return=ue,ne;nd(ue,ne)}return null}function ie(ue,ne,ce,ve){var Ee=ne!==null?ne.key:null;if(typeof ce=="string"||typeof ce=="number")return Ee!==null?null:a(ue,ne,""+ce,ve);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case eu:return ce.key===Ee?ce.type===$o?Fe(ue,ne,ce.props.children,ve,Ee):H(ue,ne,ce,ve):null;case qs:return ce.key===Ee?pe(ue,ne,ce,ve):null}if(id(ce)||jc(ce))return Ee!==null?null:Fe(ue,ne,ce,ve,null);nd(ue,ce)}return null}function Se(ue,ne,ce,ve,Ee){if(typeof ve=="string"||typeof ve=="number")return ue=ue.get(ce)||null,a(ne,ue,""+ve,Ee);if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case eu:return ue=ue.get(ve.key===null?ce:ve.key)||null,ve.type===$o?Fe(ne,ue,ve.props.children,Ee,ve.key):H(ne,ue,ve,Ee);case qs:return ue=ue.get(ve.key===null?ce:ve.key)||null,pe(ne,ue,ve,Ee)}if(id(ve)||jc(ve))return ue=ue.get(ce)||null,Fe(ne,ue,ve,Ee,null);nd(ne,ve)}return null}function Ke(ue,ne,ce,ve){for(var Ee=null,nt=null,Be=ne,rt=ne=0,ht=null;Be!==null&&rt<ce.length;rt++){Be.index>rt?(ht=Be,Be=null):ht=Be.sibling;var tt=ie(ue,Be,ce[rt],ve);if(tt===null){Be===null&&(Be=ht);break}r&&Be&&tt.alternate===null&&l(ue,Be),ne=A(tt,ne,rt),nt===null?Ee=tt:nt.sibling=tt,nt=tt,Be=ht}if(rt===ce.length)return f(ue,Be),Ee;if(Be===null){for(;rt<ce.length;rt++)Be=ye(ue,ce[rt],ve),Be!==null&&(ne=A(Be,ne,rt),nt===null?Ee=Be:nt.sibling=Be,nt=Be);return Ee}for(Be=x(ue,Be);rt<ce.length;rt++)ht=Se(Be,ue,rt,ce[rt],ve),ht!==null&&(r&&ht.alternate!==null&&Be.delete(ht.key===null?rt:ht.key),ne=A(ht,ne,rt),nt===null?Ee=ht:nt.sibling=ht,nt=ht);return r&&Be.forEach(function(St){return l(ue,St)}),Ee}function Qe(ue,ne,ce,ve){var Ee=jc(ce);if(typeof Ee!="function")throw Error(je(150));if(ce=Ee.call(ce),ce==null)throw Error(je(151));for(var nt=Ee=null,Be=ne,rt=ne=0,ht=null,tt=ce.next();Be!==null&&!tt.done;rt++,tt=ce.next()){Be.index>rt?(ht=Be,Be=null):ht=Be.sibling;var St=ie(ue,Be,tt.value,ve);if(St===null){Be===null&&(Be=ht);break}r&&Be&&St.alternate===null&&l(ue,Be),ne=A(St,ne,rt),nt===null?Ee=St:nt.sibling=St,nt=St,Be=ht}if(tt.done)return f(ue,Be),Ee;if(Be===null){for(;!tt.done;rt++,tt=ce.next())tt=ye(ue,tt.value,ve),tt!==null&&(ne=A(tt,ne,rt),nt===null?Ee=tt:nt.sibling=tt,nt=tt);return Ee}for(Be=x(ue,Be);!tt.done;rt++,tt=ce.next())tt=Se(Be,ue,rt,tt.value,ve),tt!==null&&(r&&tt.alternate!==null&&Be.delete(tt.key===null?rt:tt.key),ne=A(tt,ne,rt),nt===null?Ee=tt:nt.sibling=tt,nt=tt);return r&&Be.forEach(function(Br){return l(ue,Br)}),Ee}return function(ue,ne,ce,ve){var Ee=typeof ce=="object"&&ce!==null&&ce.type===$o&&ce.key===null;Ee&&(ce=ce.props.children);var nt=typeof ce=="object"&&ce!==null;if(nt)switch(ce.$$typeof){case eu:e:{for(nt=ce.key,Ee=ne;Ee!==null;){if(Ee.key===nt){switch(Ee.tag){case 7:if(ce.type===$o){f(ue,Ee.sibling),ne=T(Ee,ce.props.children),ne.return=ue,ue=ne;break e}break;default:if(Ee.elementType===ce.type){f(ue,Ee.sibling),ne=T(Ee,ce.props),ne.ref=Xc(ue,Ee,ce),ne.return=ue,ue=ne;break e}}f(ue,Ee);break}else l(ue,Ee);Ee=Ee.sibling}ce.type===$o?(ne=Tl(ce.props.children,ue.mode,ve,ce.key),ne.return=ue,ue=ne):(ve=yd(ce.type,ce.key,ce.props,null,ue.mode,ve),ve.ref=Xc(ue,ne,ce),ve.return=ue,ue=ve)}return R(ue);case qs:e:{for(Ee=ce.key;ne!==null;){if(ne.key===Ee)if(ne.tag===4&&ne.stateNode.containerInfo===ce.containerInfo&&ne.stateNode.implementation===ce.implementation){f(ue,ne.sibling),ne=T(ne,ce.children||[]),ne.return=ue,ue=ne;break e}else{f(ue,ne);break}else l(ue,ne);ne=ne.sibling}ne=Bf(ce,ue.mode,ve),ne.return=ue,ue=ne}return R(ue)}if(typeof ce=="string"||typeof ce=="number")return ce=""+ce,ne!==null&&ne.tag===6?(f(ue,ne.sibling),ne=T(ne,ce),ne.return=ue,ue=ne):(f(ue,ne),ne=Ff(ce,ue.mode,ve),ne.return=ue,ue=ne),R(ue);if(id(ce))return Ke(ue,ne,ce,ve);if(jc(ce))return Qe(ue,ne,ce,ve);if(nt&&nd(ue,ce),typeof ce>"u"&&!Ee)switch(ue.tag){case 1:case 22:case 0:case 11:case 15:throw Error(je(152,fl(ue.type)||"Component"))}return f(ue,ne)}}var Pd=iv(!0),nv=iv(!1),Lu={},Lr=ss(Lu),Iu=ss(Lu),Au=ss(Lu);function Hs(r){if(r===Lu)throw Error(je(174));return r}function um(r,l){switch(_i(Au,l),_i(Iu,r),_i(Lr,Lu),r=l.nodeType,r){case 9:case 11:l=(l=l.documentElement)?l.namespaceURI:Xf(null,"");break;default:r=r===8?l.parentNode:l,l=r.namespaceURI||null,r=r.tagName,l=Xf(l,r)}si(Lr),_i(Lr,l)}function kl(){si(Lr),si(Iu),si(Au)}function m0(r){Hs(Au.current);var l=Hs(Lr.current),f=Xf(l,r.type);l!==f&&(_i(Iu,r),_i(Lr,f))}function l_(r){Iu.current===r&&(si(Lr),si(Iu))}var mi=ss(0);function Dd(r){for(var l=r;l!==null;){if(l.tag===13){var f=l.memoizedState;if(f!==null&&(f=f.dehydrated,f===null||f.data==="$?"||f.data==="$!"))return l}else if(l.tag===19&&l.memoizedProps.revealOrder!==void 0){if(l.flags&64)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var so=null,qo=null,Rr=!1;function rv(r,l){var f=Hn(5,null,null,0);f.elementType="DELETED",f.type="DELETED",f.stateNode=l,f.return=r,f.flags=8,r.lastEffect!==null?(r.lastEffect.nextEffect=f,r.lastEffect=f):r.firstEffect=r.lastEffect=f}function _0(r,l){switch(r.tag){case 5:var f=r.type;return l=l.nodeType!==1||f.toLowerCase()!==l.nodeName.toLowerCase()?null:l,l!==null?(r.stateNode=l,!0):!1;case 6:return l=r.pendingProps===""||l.nodeType!==3?null:l,l!==null?(r.stateNode=l,!0):!1;case 13:return!1;default:return!1}}function hm(r){if(Rr){var l=qo;if(l){var f=l;if(!_0(r,l)){if(l=yl(f.nextSibling),!l||!_0(r,l)){r.flags=r.flags&-1025|2,Rr=!1,so=r;return}rv(so,f)}so=r,qo=yl(l.firstChild)}else r.flags=r.flags&-1025|2,Rr=!1,so=r}}function g0(r){for(r=r.return;r!==null&&r.tag!==5&&r.tag!==3&&r.tag!==13;)r=r.return;so=r}function rd(r){if(r!==so)return!1;if(!Rr)return g0(r),Rr=!0,!1;var l=r.type;if(r.tag!==5||l!=="head"&&l!=="body"&&!om(l,r.memoizedProps))for(l=qo;l;)rv(r,l),l=yl(l.nextSibling);if(g0(r),r.tag===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(je(317));e:{for(r=r.nextSibling,l=0;r;){if(r.nodeType===8){var f=r.data;if(f==="/$"){if(l===0){qo=yl(r.nextSibling);break e}l--}else f!=="$"&&f!=="$!"&&f!=="$?"||l++}r=r.nextSibling}qo=null}}else qo=so?yl(r.stateNode.nextSibling):null;return!0}function Pf(){qo=so=null,Rr=!1}var vl=[];function c_(){for(var r=0;r<vl.length;r++)vl[r]._workInProgressVersionPrimary=null;vl.length=0}var du=ia.ReactCurrentDispatcher,Yn=ia.ReactCurrentBatchConfig,Mu=0,yi=null,Qi=null,$i=null,Ld=!1,pu=!1;function En(){throw Error(je(321))}function u_(r,l){if(l===null)return!1;for(var f=0;f<l.length&&f<r.length;f++)if(!Xn(r[f],l[f]))return!1;return!0}function h_(r,l,f,x,T,A){if(Mu=A,yi=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,du.current=r===null||r.memoizedState===null?y2:x2,r=f(x,T),pu){A=0;do{if(pu=!1,!(25>A))throw Error(je(301));A+=1,$i=Qi=null,l.updateQueue=null,du.current=v2,r=f(x,T)}while(pu)}if(du.current=Od,l=Qi!==null&&Qi.next!==null,Mu=0,$i=Qi=yi=null,Ld=!1,l)throw Error(je(300));return r}function Ys(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $i===null?yi.memoizedState=$i=r:$i=$i.next=r,$i}function ra(){if(Qi===null){var r=yi.alternate;r=r!==null?r.memoizedState:null}else r=Qi.next;var l=$i===null?yi.memoizedState:$i.next;if(l!==null)$i=l,Qi=r;else{if(r===null)throw Error(je(310));Qi=r,r={memoizedState:Qi.memoizedState,baseState:Qi.baseState,baseQueue:Qi.baseQueue,queue:Qi.queue,next:null},$i===null?yi.memoizedState=$i=r:$i=$i.next=r}return $i}function Pr(r,l){return typeof l=="function"?l(r):l}function Hc(r){var l=ra(),f=l.queue;if(f===null)throw Error(je(311));f.lastRenderedReducer=r;var x=Qi,T=x.baseQueue,A=f.pending;if(A!==null){if(T!==null){var R=T.next;T.next=A.next,A.next=R}x.baseQueue=T=A,f.pending=null}if(T!==null){T=T.next,x=x.baseState;var a=R=A=null,H=T;do{var pe=H.lane;if((Mu&pe)===pe)a!==null&&(a=a.next={lane:0,action:H.action,eagerReducer:H.eagerReducer,eagerState:H.eagerState,next:null}),x=H.eagerReducer===r?H.eagerState:r(x,H.action);else{var Fe={lane:pe,action:H.action,eagerReducer:H.eagerReducer,eagerState:H.eagerState,next:null};a===null?(R=a=Fe,A=x):a=a.next=Fe,yi.lanes|=pe,Ru|=pe}H=H.next}while(H!==null&&H!==T);a===null?A=x:a.next=R,Xn(x,l.memoizedState)||(mr=!0),l.memoizedState=x,l.baseState=A,l.baseQueue=a,f.lastRenderedState=x}return[l.memoizedState,f.dispatch]}function Yc(r){var l=ra(),f=l.queue;if(f===null)throw Error(je(311));f.lastRenderedReducer=r;var x=f.dispatch,T=f.pending,A=l.memoizedState;if(T!==null){f.pending=null;var R=T=T.next;do A=r(A,R.action),R=R.next;while(R!==T);Xn(A,l.memoizedState)||(mr=!0),l.memoizedState=A,l.baseQueue===null&&(l.baseState=A),f.lastRenderedState=A}return[A,x]}function y0(r,l,f){var x=l._getVersion;x=x(l._source);var T=l._workInProgressVersionPrimary;if(T!==null?r=T===x:(r=r.mutableReadLanes,(r=(Mu&r)===r)&&(l._workInProgressVersionPrimary=x,vl.push(l))),r)return f(l._source);throw vl.push(l),Error(je(350))}function ov(r,l,f,x){var T=hn;if(T===null)throw Error(je(349));var A=l._getVersion,R=A(l._source),a=du.current,H=a.useState(function(){return y0(T,l,f)}),pe=H[1],Fe=H[0];H=$i;var ye=r.memoizedState,ie=ye.refs,Se=ie.getSnapshot,Ke=ye.source;ye=ye.subscribe;var Qe=yi;return r.memoizedState={refs:ie,source:l,subscribe:x},a.useEffect(function(){ie.getSnapshot=f,ie.setSnapshot=pe;var ue=A(l._source);if(!Xn(R,ue)){ue=f(l._source),Xn(Fe,ue)||(pe(ue),ue=Qo(Qe),T.mutableReadLanes|=ue&T.pendingLanes),ue=T.mutableReadLanes,T.entangledLanes|=ue;for(var ne=T.entanglements,ce=ue;0<ce;){var ve=31-is(ce),Ee=1<<ve;ne[ve]|=ue,ce&=~Ee}}},[f,l,x]),a.useEffect(function(){return x(l._source,function(){var ue=ie.getSnapshot,ne=ie.setSnapshot;try{ne(ue(l._source));var ce=Qo(Qe);T.mutableReadLanes|=ce&T.pendingLanes}catch(ve){ne(function(){throw ve})}})},[l,x]),Xn(Se,f)&&Xn(Ke,l)&&Xn(ye,x)||(r={pending:null,dispatch:null,lastRenderedReducer:Pr,lastRenderedState:Fe},r.dispatch=pe=f_.bind(null,yi,r),H.queue=r,H.baseQueue=null,Fe=y0(T,l,f),H.memoizedState=H.baseState=Fe),Fe}function sv(r,l,f){var x=ra();return ov(x,r,l,f)}function Kc(r){var l=Ys();return typeof r=="function"&&(r=r()),l.memoizedState=l.baseState=r,r=l.queue={pending:null,dispatch:null,lastRenderedReducer:Pr,lastRenderedState:r},r=r.dispatch=f_.bind(null,yi,r),[l.memoizedState,r]}function Rd(r,l,f,x){return r={tag:r,create:l,destroy:f,deps:x,next:null},l=yi.updateQueue,l===null?(l={lastEffect:null},yi.updateQueue=l,l.lastEffect=r.next=r):(f=l.lastEffect,f===null?l.lastEffect=r.next=r:(x=f.next,f.next=r,r.next=x,l.lastEffect=r)),r}function x0(r){var l=Ys();return r={current:r},l.memoizedState=r}function Fd(){return ra().memoizedState}function dm(r,l,f,x){var T=Ys();yi.flags|=r,T.memoizedState=Rd(1|l,f,void 0,x===void 0?null:x)}function d_(r,l,f,x){var T=ra();x=x===void 0?null:x;var A=void 0;if(Qi!==null){var R=Qi.memoizedState;if(A=R.destroy,x!==null&&u_(x,R.deps)){Rd(l,f,A,x);return}}yi.flags|=r,T.memoizedState=Rd(1|l,f,A,x)}function v0(r,l){return dm(516,4,r,l)}function Bd(r,l){return d_(516,4,r,l)}function av(r,l){return d_(4,2,r,l)}function lv(r,l){if(typeof l=="function")return r=r(),l(r),function(){l(null)};if(l!=null)return r=r(),l.current=r,function(){l.current=null}}function cv(r,l,f){return f=f!=null?f.concat([r]):null,d_(4,2,lv.bind(null,l,r),f)}function p_(){}function uv(r,l){var f=ra();l=l===void 0?null:l;var x=f.memoizedState;return x!==null&&l!==null&&u_(l,x[1])?x[0]:(f.memoizedState=[r,l],r)}function hv(r,l){var f=ra();l=l===void 0?null:l;var x=f.memoizedState;return x!==null&&l!==null&&u_(l,x[1])?x[0]:(r=r(),f.memoizedState=[r,l],r)}function g2(r,l){var f=Cl();Js(98>f?98:f,function(){r(!0)}),Js(97<f?97:f,function(){var x=Yn.transition;Yn.transition=1;try{r(!1),l()}finally{Yn.transition=x}})}function f_(r,l,f){var x=Un(),T=Qo(r),A={lane:T,action:f,eagerReducer:null,eagerState:null,next:null},R=l.pending;if(R===null?A.next=A:(A.next=R.next,R.next=A),l.pending=A,R=r.alternate,r===yi||R!==null&&R===yi)pu=Ld=!0;else{if(r.lanes===0&&(R===null||R.lanes===0)&&(R=l.lastRenderedReducer,R!==null))try{var a=l.lastRenderedState,H=R(a,f);if(A.eagerReducer=R,A.eagerState=H,Xn(H,a))return}catch{}finally{}Jo(r,T,x)}}var Od={readContext:Kn,useCallback:En,useContext:En,useEffect:En,useImperativeHandle:En,useLayoutEffect:En,useMemo:En,useReducer:En,useRef:En,useState:En,useDebugValue:En,useDeferredValue:En,useTransition:En,useMutableSource:En,useOpaqueIdentifier:En,unstable_isNewReconciler:!1},y2={readContext:Kn,useCallback:function(r,l){return Ys().memoizedState=[r,l===void 0?null:l],r},useContext:Kn,useEffect:v0,useImperativeHandle:function(r,l,f){return f=f!=null?f.concat([r]):null,dm(4,2,lv.bind(null,l,r),f)},useLayoutEffect:function(r,l){return dm(4,2,r,l)},useMemo:function(r,l){var f=Ys();return l=l===void 0?null:l,r=r(),f.memoizedState=[r,l],r},useReducer:function(r,l,f){var x=Ys();return l=f!==void 0?f(l):l,x.memoizedState=x.baseState=l,r=x.queue={pending:null,dispatch:null,lastRenderedReducer:r,lastRenderedState:l},r=r.dispatch=f_.bind(null,yi,r),[x.memoizedState,r]},useRef:x0,useState:Kc,useDebugValue:p_,useDeferredValue:function(r){var l=Kc(r),f=l[0],x=l[1];return v0(function(){var T=Yn.transition;Yn.transition=1;try{x(r)}finally{Yn.transition=T}},[r]),f},useTransition:function(){var r=Kc(!1),l=r[0];return r=g2.bind(null,r[1]),x0(r),[r,l]},useMutableSource:function(r,l,f){var x=Ys();return x.memoizedState={refs:{getSnapshot:l,setSnapshot:null},source:r,subscribe:f},ov(x,r,l,f)},useOpaqueIdentifier:function(){if(Rr){var r=!1,l=h2(function(){throw r||(r=!0,f("r:"+(Af++).toString(36))),Error(je(355))}),f=Kc(l)[1];return!(yi.mode&2)&&(yi.flags|=516,Rd(5,function(){f("r:"+(Af++).toString(36))},void 0,null)),l}return l="r:"+(Af++).toString(36),Kc(l),l},unstable_isNewReconciler:!1},x2={readContext:Kn,useCallback:uv,useContext:Kn,useEffect:Bd,useImperativeHandle:cv,useLayoutEffect:av,useMemo:hv,useReducer:Hc,useRef:Fd,useState:function(){return Hc(Pr)},useDebugValue:p_,useDeferredValue:function(r){var l=Hc(Pr),f=l[0],x=l[1];return Bd(function(){var T=Yn.transition;Yn.transition=1;try{x(r)}finally{Yn.transition=T}},[r]),f},useTransition:function(){var r=Hc(Pr)[0];return[Fd().current,r]},useMutableSource:sv,useOpaqueIdentifier:function(){return Hc(Pr)[0]},unstable_isNewReconciler:!1},v2={readContext:Kn,useCallback:uv,useContext:Kn,useEffect:Bd,useImperativeHandle:cv,useLayoutEffect:av,useMemo:hv,useReducer:Yc,useRef:Fd,useState:function(){return Yc(Pr)},useDebugValue:p_,useDeferredValue:function(r){var l=Yc(Pr),f=l[0],x=l[1];return Bd(function(){var T=Yn.transition;Yn.transition=1;try{x(r)}finally{Yn.transition=T}},[r]),f},useTransition:function(){var r=Yc(Pr)[0];return[Fd().current,r]},useMutableSource:sv,useOpaqueIdentifier:function(){return Yc(Pr)[0]},unstable_isNewReconciler:!1},w2=ia.ReactCurrentOwner,mr=!1;function Sn(r,l,f,x){l.child=r===null?nv(l,null,f,x):Pd(l,r.child,f,x)}function w0(r,l,f,x,T){f=f.render;var A=l.ref;return xl(l,T),x=h_(r,l,f,x,A,T),r!==null&&!mr?(l.updateQueue=r.updateQueue,l.flags&=-517,r.lanes&=~T,ao(r,l,T)):(l.flags|=1,Sn(r,l,x,T),l.child)}function b0(r,l,f,x,T,A){if(r===null){var R=f.type;return typeof R=="function"&&!v_(R)&&R.defaultProps===void 0&&f.compare===null&&f.defaultProps===void 0?(l.tag=15,l.type=R,dv(r,l,R,x,T,A)):(r=yd(f.type,null,x,l,l.mode,A),r.ref=l.ref,r.return=l,l.child=r)}return R=r.child,!(T&A)&&(T=R.memoizedProps,f=f.compare,f=f!==null?f:Eu,f(T,x)&&r.ref===l.ref)?ao(r,l,A):(l.flags|=1,r=os(R,x),r.ref=l.ref,r.return=l,l.child=r)}function dv(r,l,f,x,T,A){if(r!==null&&Eu(r.memoizedProps,x)&&r.ref===l.ref)if(mr=!1,(A&T)!==0)r.flags&16384&&(mr=!0);else return l.lanes=r.lanes,ao(r,l,A);return pm(r,l,f,x,A)}function Df(r,l,f){var x=l.pendingProps,T=x.children,A=r!==null?r.memoizedState:null;if(x.mode==="hidden"||x.mode==="unstable-defer-without-hiding")if(!(l.mode&4))l.memoizedState={baseLanes:0},sd(l,f);else if(f&1073741824)l.memoizedState={baseLanes:0},sd(l,A!==null?A.baseLanes:f);else return r=A!==null?A.baseLanes|f:f,l.lanes=l.childLanes=1073741824,l.memoizedState={baseLanes:r},sd(l,r),null;else A!==null?(x=A.baseLanes|f,l.memoizedState=null):x=f,sd(l,x);return Sn(r,l,T,f),l.child}function pv(r,l){var f=l.ref;(r===null&&f!==null||r!==null&&r.ref!==f)&&(l.flags|=128)}function pm(r,l,f,x,T){var A=kn(f)?Qs:tn.current;return A=Sl(l,A),xl(l,T),f=h_(r,l,f,x,A,T),r!==null&&!mr?(l.updateQueue=r.updateQueue,l.flags&=-517,r.lanes&=~T,ao(r,l,T)):(l.flags|=1,Sn(r,l,f,T),l.child)}function T0(r,l,f,x,T){if(kn(f)){var A=!0;pd(l)}else A=!1;if(xl(l,T),l.stateNode===null)r!==null&&(r.alternate=null,l.alternate=null,l.flags|=2),tv(l,f,x),cm(l,f,x,T),x=!0;else if(r===null){var R=l.stateNode,a=l.memoizedProps;R.props=a;var H=R.context,pe=f.contextType;typeof pe=="object"&&pe!==null?pe=Kn(pe):(pe=kn(f)?Qs:tn.current,pe=Sl(l,pe));var Fe=f.getDerivedStateFromProps,ye=typeof Fe=="function"||typeof R.getSnapshotBeforeUpdate=="function";ye||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(a!==x||H!==pe)&&f0(l,R,x,pe),jo=!1;var ie=l.memoizedState;R.state=ie,ku(l,x,R,T),H=l.memoizedState,a!==x||ie!==H||Cn.current||jo?(typeof Fe=="function"&&(zd(l,f,Fe,x),H=l.memoizedState),(a=jo||p0(l,f,a,x,ie,H,pe))?(ye||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(l.flags|=4)):(typeof R.componentDidMount=="function"&&(l.flags|=4),l.memoizedProps=x,l.memoizedState=H),R.props=x,R.state=H,R.context=pe,x=a):(typeof R.componentDidMount=="function"&&(l.flags|=4),x=!1)}else{R=l.stateNode,Jx(r,l),a=l.memoizedProps,pe=l.type===l.elementType?a:fr(l.type,a),R.props=pe,ye=l.pendingProps,ie=R.context,H=f.contextType,typeof H=="object"&&H!==null?H=Kn(H):(H=kn(f)?Qs:tn.current,H=Sl(l,H));var Se=f.getDerivedStateFromProps;(Fe=typeof Se=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(a!==ye||ie!==H)&&f0(l,R,x,H),jo=!1,ie=l.memoizedState,R.state=ie,ku(l,x,R,T);var Ke=l.memoizedState;a!==ye||ie!==Ke||Cn.current||jo?(typeof Se=="function"&&(zd(l,f,Se,x),Ke=l.memoizedState),(pe=jo||p0(l,f,pe,x,ie,Ke,H))?(Fe||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(x,Ke,H),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(x,Ke,H)),typeof R.componentDidUpdate=="function"&&(l.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(l.flags|=256)):(typeof R.componentDidUpdate!="function"||a===r.memoizedProps&&ie===r.memoizedState||(l.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&ie===r.memoizedState||(l.flags|=256),l.memoizedProps=x,l.memoizedState=Ke),R.props=x,R.state=Ke,R.context=H,x=pe):(typeof R.componentDidUpdate!="function"||a===r.memoizedProps&&ie===r.memoizedState||(l.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||a===r.memoizedProps&&ie===r.memoizedState||(l.flags|=256),x=!1)}return fm(r,l,f,x,A,T)}function fm(r,l,f,x,T,A){pv(r,l);var R=(l.flags&64)!==0;if(!x&&!R)return T&&l0(l,f,!1),ao(r,l,A);x=l.stateNode,w2.current=l;var a=R&&typeof f.getDerivedStateFromError!="function"?null:x.render();return l.flags|=1,r!==null&&R?(l.child=Pd(l,r.child,null,A),l.child=Pd(l,null,a,A)):Sn(r,l,a,A),l.memoizedState=x.state,T&&l0(l,f,!0),l.child}function E0(r){var l=r.stateNode;l.pendingContext?a0(r,l.pendingContext,l.pendingContext!==l.context):l.context&&a0(r,l.context,!1),um(r,l.containerInfo)}var od={dehydrated:null,retryLane:0};function S0(r,l,f){var x=l.pendingProps,T=mi.current,A=!1,R;return(R=(l.flags&64)!==0)||(R=r!==null&&r.memoizedState===null?!1:(T&2)!==0),R?(A=!0,l.flags&=-65):r!==null&&r.memoizedState===null||x.fallback===void 0||x.unstable_avoidThisFallback===!0||(T|=1),_i(mi,T&1),r===null?(x.fallback!==void 0&&hm(l),r=x.children,T=x.fallback,A?(r=C0(l,r,T,f),l.child.memoizedState={baseLanes:f},l.memoizedState=od,r):typeof x.unstable_expectedLoadTime=="number"?(r=C0(l,r,T,f),l.child.memoizedState={baseLanes:f},l.memoizedState=od,l.lanes=33554432,r):(f=w_({mode:"visible",children:r},l.mode,f,null),f.return=l,l.child=f)):r.memoizedState!==null?A?(x=I0(r,l,x.children,x.fallback,f),A=l.child,T=r.child.memoizedState,A.memoizedState=T===null?{baseLanes:f}:{baseLanes:T.baseLanes|f},A.childLanes=r.childLanes&~f,l.memoizedState=od,x):(f=k0(r,l,x.children,f),l.memoizedState=null,f):A?(x=I0(r,l,x.children,x.fallback,f),A=l.child,T=r.child.memoizedState,A.memoizedState=T===null?{baseLanes:f}:{baseLanes:T.baseLanes|f},A.childLanes=r.childLanes&~f,l.memoizedState=od,x):(f=k0(r,l,x.children,f),l.memoizedState=null,f)}function C0(r,l,f,x){var T=r.mode,A=r.child;return l={mode:"hidden",children:l},!(T&2)&&A!==null?(A.childLanes=0,A.pendingProps=l):A=w_(l,T,0,null),f=Tl(f,T,x,null),A.return=r,f.return=r,A.sibling=f,r.child=A,f}function k0(r,l,f,x){var T=r.child;return r=T.sibling,f=os(T,{mode:"visible",children:f}),!(l.mode&2)&&(f.lanes=x),f.return=l,f.sibling=null,r!==null&&(r.nextEffect=null,r.flags=8,l.firstEffect=l.lastEffect=r),l.child=f}function I0(r,l,f,x,T){var A=l.mode,R=r.child;r=R.sibling;var a={mode:"hidden",children:f};return!(A&2)&&l.child!==R?(f=l.child,f.childLanes=0,f.pendingProps=a,R=f.lastEffect,R!==null?(l.firstEffect=f.firstEffect,l.lastEffect=R,R.nextEffect=null):l.firstEffect=l.lastEffect=null):f=os(R,a),r!==null?x=os(r,x):(x=Tl(x,A,T,null),x.flags|=2),x.return=l,f.return=l,f.sibling=x,l.child=f,x}function A0(r,l){r.lanes|=l;var f=r.alternate;f!==null&&(f.lanes|=l),Qx(r.return,l)}function Lf(r,l,f,x,T,A){var R=r.memoizedState;R===null?r.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:x,tail:f,tailMode:T,lastEffect:A}:(R.isBackwards=l,R.rendering=null,R.renderingStartTime=0,R.last=x,R.tail=f,R.tailMode=T,R.lastEffect=A)}function M0(r,l,f){var x=l.pendingProps,T=x.revealOrder,A=x.tail;if(Sn(r,l,x.children,f),x=mi.current,x&2)x=x&1|2,l.flags|=64;else{if(r!==null&&r.flags&64)e:for(r=l.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&A0(r,f);else if(r.tag===19)A0(r,f);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===l)break e;for(;r.sibling===null;){if(r.return===null||r.return===l)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}x&=1}if(_i(mi,x),!(l.mode&2))l.memoizedState=null;else switch(T){case"forwards":for(f=l.child,T=null;f!==null;)r=f.alternate,r!==null&&Dd(r)===null&&(T=f),f=f.sibling;f=T,f===null?(T=l.child,l.child=null):(T=f.sibling,f.sibling=null),Lf(l,!1,T,f,A,l.lastEffect);break;case"backwards":for(f=null,T=l.child,l.child=null;T!==null;){if(r=T.alternate,r!==null&&Dd(r)===null){l.child=T;break}r=T.sibling,T.sibling=f,f=T,T=r}Lf(l,!0,f,null,A,l.lastEffect);break;case"together":Lf(l,!1,null,null,void 0,l.lastEffect);break;default:l.memoizedState=null}return l.child}function ao(r,l,f){if(r!==null&&(l.dependencies=r.dependencies),Ru|=l.lanes,f&l.childLanes){if(r!==null&&l.child!==r.child)throw Error(je(153));if(l.child!==null){for(r=l.child,f=os(r,r.pendingProps),l.child=f,f.return=l;r.sibling!==null;)r=r.sibling,f=f.sibling=os(r,r.pendingProps),f.return=l;f.sibling=null}return l.child}return null}var fv,mm,mv,_v;fv=function(r,l){for(var f=l.child;f!==null;){if(f.tag===5||f.tag===6)r.appendChild(f.stateNode);else if(f.tag!==4&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return;f=f.return}f.sibling.return=f.return,f=f.sibling}};mm=function(){};mv=function(r,l,f,x){var T=r.memoizedProps;if(T!==x){r=l.stateNode,Hs(Lr.current);var A=null;switch(f){case"input":T=jf(r,T),x=jf(r,x),A=[];break;case"option":T=Zf(r,T),x=Zf(r,x),A=[];break;case"select":T=hi({},T,{value:void 0}),x=hi({},x,{value:void 0}),A=[];break;case"textarea":T=qf(r,T),x=qf(r,x),A=[];break;default:typeof T.onClick!="function"&&typeof x.onClick=="function"&&(r.onclick=Sd)}Hf(f,x);var R;f=null;for(pe in T)if(!x.hasOwnProperty(pe)&&T.hasOwnProperty(pe)&&T[pe]!=null)if(pe==="style"){var a=T[pe];for(R in a)a.hasOwnProperty(R)&&(f||(f={}),f[R]="")}else pe!=="dangerouslySetInnerHTML"&&pe!=="children"&&pe!=="suppressContentEditableWarning"&&pe!=="suppressHydrationWarning"&&pe!=="autoFocus"&&(gu.hasOwnProperty(pe)?A||(A=[]):(A=A||[]).push(pe,null));for(pe in x){var H=x[pe];if(a=T!=null?T[pe]:void 0,x.hasOwnProperty(pe)&&H!==a&&(H!=null||a!=null))if(pe==="style")if(a){for(R in a)!a.hasOwnProperty(R)||H&&H.hasOwnProperty(R)||(f||(f={}),f[R]="");for(R in H)H.hasOwnProperty(R)&&a[R]!==H[R]&&(f||(f={}),f[R]=H[R])}else f||(A||(A=[]),A.push(pe,f)),f=H;else pe==="dangerouslySetInnerHTML"?(H=H?H.__html:void 0,a=a?a.__html:void 0,H!=null&&a!==H&&(A=A||[]).push(pe,H)):pe==="children"?typeof H!="string"&&typeof H!="number"||(A=A||[]).push(pe,""+H):pe!=="suppressContentEditableWarning"&&pe!=="suppressHydrationWarning"&&(gu.hasOwnProperty(pe)?(H!=null&&pe==="onScroll"&&oi("scroll",r),A||a===H||(A=[])):typeof H=="object"&&H!==null&&H.$$typeof===Vm?H.toString():(A=A||[]).push(pe,H))}f&&(A=A||[]).push("style",f);var pe=A;(l.updateQueue=pe)&&(l.flags|=4)}};_v=function(r,l,f,x){f!==x&&(l.flags|=4)};function Qc(r,l){if(!Rr)switch(r.tailMode){case"hidden":l=r.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?r.tail=null:f.sibling=null;break;case"collapsed":f=r.tail;for(var x=null;f!==null;)f.alternate!==null&&(x=f),f=f.sibling;x===null?l||r.tail===null?r.tail=null:r.tail.sibling=null:x.sibling=null}}function b2(r,l,f){var x=l.pendingProps;switch(l.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return kn(l.type)&&kd(),null;case 3:return kl(),si(Cn),si(tn),c_(),x=l.stateNode,x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(r===null||r.child===null)&&(rd(l)?l.flags|=4:x.hydrate||(l.flags|=256)),mm(l),null;case 5:l_(l);var T=Hs(Au.current);if(f=l.type,r!==null&&l.stateNode!=null)mv(r,l,f,x,T),r.ref!==l.ref&&(l.flags|=128);else{if(!x){if(l.stateNode===null)throw Error(je(166));return null}if(r=Hs(Lr.current),rd(l)){x=l.stateNode,f=l.type;var A=l.memoizedProps;switch(x[Zo]=l,x[Cd]=A,f){case"dialog":oi("cancel",x),oi("close",x);break;case"iframe":case"object":case"embed":oi("load",x);break;case"video":case"audio":for(r=0;r<iu.length;r++)oi(iu[r],x);break;case"source":oi("error",x);break;case"img":case"image":case"link":oi("error",x),oi("load",x);break;case"details":oi("toggle",x);break;case"input":My(x,A),oi("invalid",x);break;case"select":x._wrapperState={wasMultiple:!!A.multiple},oi("invalid",x);break;case"textarea":Py(x,A),oi("invalid",x)}Hf(f,A),r=null;for(var R in A)A.hasOwnProperty(R)&&(T=A[R],R==="children"?typeof T=="string"?x.textContent!==T&&(r=["children",T]):typeof T=="number"&&x.textContent!==""+T&&(r=["children",""+T]):gu.hasOwnProperty(R)&&T!=null&&R==="onScroll"&&oi("scroll",x));switch(f){case"input":Qh(x),zy(x,A,!0);break;case"textarea":Qh(x),Dy(x);break;case"select":case"option":break;default:typeof A.onClick=="function"&&(x.onclick=Sd)}x=r,l.updateQueue=x,x!==null&&(l.flags|=4)}else{switch(R=T.nodeType===9?T:T.ownerDocument,r===Wf.html&&(r=cx(f)),r===Wf.html?f==="script"?(r=R.createElement("div"),r.innerHTML="<script><\/script>",r=r.removeChild(r.firstChild)):typeof x.is=="string"?r=R.createElement(f,{is:x.is}):(r=R.createElement(f),f==="select"&&(R=r,x.multiple?R.multiple=!0:x.size&&(R.size=x.size))):r=R.createElementNS(r,f),r[Zo]=l,r[Cd]=x,fv(r,l,!1,!1),l.stateNode=r,R=Yf(f,x),f){case"dialog":oi("cancel",r),oi("close",r),T=x;break;case"iframe":case"object":case"embed":oi("load",r),T=x;break;case"video":case"audio":for(T=0;T<iu.length;T++)oi(iu[T],r);T=x;break;case"source":oi("error",r),T=x;break;case"img":case"image":case"link":oi("error",r),oi("load",r),T=x;break;case"details":oi("toggle",r),T=x;break;case"input":My(r,x),T=jf(r,x),oi("invalid",r);break;case"option":T=Zf(r,x);break;case"select":r._wrapperState={wasMultiple:!!x.multiple},T=hi({},x,{value:void 0}),oi("invalid",r);break;case"textarea":Py(r,x),T=qf(r,x),oi("invalid",r);break;default:T=x}Hf(f,T);var a=T;for(A in a)if(a.hasOwnProperty(A)){var H=a[A];A==="style"?dx(r,H):A==="dangerouslySetInnerHTML"?(H=H?H.__html:void 0,H!=null&&ux(r,H)):A==="children"?typeof H=="string"?(f!=="textarea"||H!=="")&&yu(r,H):typeof H=="number"&&yu(r,""+H):A!=="suppressContentEditableWarning"&&A!=="suppressHydrationWarning"&&A!=="autoFocus"&&(gu.hasOwnProperty(A)?H!=null&&A==="onScroll"&&oi("scroll",r):H!=null&&Rm(r,A,H,R))}switch(f){case"input":Qh(r),zy(r,x,!1);break;case"textarea":Qh(r),Dy(r);break;case"option":x.value!=null&&r.setAttribute("value",""+ts(x.value));break;case"select":r.multiple=!!x.multiple,A=x.value,A!=null?ml(r,!!x.multiple,A,!1):x.defaultValue!=null&&ml(r,!!x.multiple,x.defaultValue,!0);break;default:typeof T.onClick=="function"&&(r.onclick=Sd)}$x(f,x)&&(l.flags|=4)}l.ref!==null&&(l.flags|=128)}return null;case 6:if(r&&l.stateNode!=null)_v(r,l,r.memoizedProps,x);else{if(typeof x!="string"&&l.stateNode===null)throw Error(je(166));f=Hs(Au.current),Hs(Lr.current),rd(l)?(x=l.stateNode,f=l.memoizedProps,x[Zo]=l,x.nodeValue!==f&&(l.flags|=4)):(x=(f.nodeType===9?f:f.ownerDocument).createTextNode(x),x[Zo]=l,l.stateNode=x)}return null;case 13:return si(mi),x=l.memoizedState,l.flags&64?(l.lanes=f,l):(x=x!==null,f=!1,r===null?l.memoizedProps.fallback!==void 0&&rd(l):f=r.memoizedState!==null,x&&!f&&l.mode&2&&(r===null&&l.memoizedProps.unstable_avoidThisFallback!==!0||mi.current&1?Gi===0&&(Gi=3):((Gi===0||Gi===3)&&(Gi=4),hn===null||!(Ru&134217727)&&!(Dl&134217727)||wl(hn,en))),(x||f)&&(l.flags|=4),null);case 4:return kl(),mm(l),r===null&&Nx(l.stateNode.containerInfo),null;case 10:return s_(l),null;case 17:return kn(l.type)&&kd(),null;case 19:if(si(mi),x=l.memoizedState,x===null)return null;if(A=(l.flags&64)!==0,R=x.rendering,R===null)if(A)Qc(x,!1);else{if(Gi!==0||r!==null&&r.flags&64)for(r=l.child;r!==null;){if(R=Dd(r),R!==null){for(l.flags|=64,Qc(x,!1),A=R.updateQueue,A!==null&&(l.updateQueue=A,l.flags|=4),x.lastEffect===null&&(l.firstEffect=null),l.lastEffect=x.lastEffect,x=f,f=l.child;f!==null;)A=f,r=x,A.flags&=2,A.nextEffect=null,A.firstEffect=null,A.lastEffect=null,R=A.alternate,R===null?(A.childLanes=0,A.lanes=r,A.child=null,A.memoizedProps=null,A.memoizedState=null,A.updateQueue=null,A.dependencies=null,A.stateNode=null):(A.childLanes=R.childLanes,A.lanes=R.lanes,A.child=R.child,A.memoizedProps=R.memoizedProps,A.memoizedState=R.memoizedState,A.updateQueue=R.updateQueue,A.type=R.type,r=R.dependencies,A.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),f=f.sibling;return _i(mi,mi.current&1|2),l.child}r=r.sibling}x.tail!==null&&Ji()>wm&&(l.flags|=64,A=!0,Qc(x,!1),l.lanes=33554432)}else{if(!A)if(r=Dd(R),r!==null){if(l.flags|=64,A=!0,f=r.updateQueue,f!==null&&(l.updateQueue=f,l.flags|=4),Qc(x,!0),x.tail===null&&x.tailMode==="hidden"&&!R.alternate&&!Rr)return l=l.lastEffect=x.lastEffect,l!==null&&(l.nextEffect=null),null}else 2*Ji()-x.renderingStartTime>wm&&f!==1073741824&&(l.flags|=64,A=!0,Qc(x,!1),l.lanes=33554432);x.isBackwards?(R.sibling=l.child,l.child=R):(f=x.last,f!==null?f.sibling=R:l.child=R,x.last=R)}return x.tail!==null?(f=x.tail,x.rendering=f,x.tail=f.sibling,x.lastEffect=l.lastEffect,x.renderingStartTime=Ji(),f.sibling=null,l=mi.current,_i(mi,A?l&1|2:l&1),f):null;case 23:case 24:return x_(),r!==null&&r.memoizedState!==null!=(l.memoizedState!==null)&&x.mode!=="unstable-defer-without-hiding"&&(l.flags|=4),null}throw Error(je(156,l.tag))}function T2(r){switch(r.tag){case 1:kn(r.type)&&kd();var l=r.flags;return l&4096?(r.flags=l&-4097|64,r):null;case 3:if(kl(),si(Cn),si(tn),c_(),l=r.flags,l&64)throw Error(je(285));return r.flags=l&-4097|64,r;case 5:return l_(r),null;case 13:return si(mi),l=r.flags,l&4096?(r.flags=l&-4097|64,r):null;case 19:return si(mi),null;case 4:return kl(),null;case 10:return s_(r),null;case 23:case 24:return x_(),null;default:return null}}function m_(r,l){try{var f="",x=l;do f+=nb(x),x=x.return;while(x);var T=f}catch(A){T=`
Error generating stack: `+A.message+`
`+A.stack}return{value:r,source:l,stack:T}}function _m(r,l){try{console.error(l.value)}catch(f){setTimeout(function(){throw f})}}var E2=typeof WeakMap=="function"?WeakMap:Map;function gv(r,l,f){f=Yo(-1,f),f.tag=3,f.payload={element:null};var x=l.value;return f.callback=function(){Nd||(Nd=!0,bm=x),_m(r,l)},f}function yv(r,l,f){f=Yo(-1,f),f.tag=3;var x=r.type.getDerivedStateFromError;if(typeof x=="function"){var T=l.value;f.payload=function(){return _m(r,l),x(T)}}var A=r.stateNode;return A!==null&&typeof A.componentDidCatch=="function"&&(f.callback=function(){typeof x!="function"&&(Dr===null?Dr=new Set([this]):Dr.add(this),_m(r,l));var R=l.stack;this.componentDidCatch(l.value,{componentStack:R!==null?R:""})}),f}var S2=typeof WeakSet=="function"?WeakSet:Set;function z0(r){var l=r.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(f){es(r,f)}else l.current=null}function C2(r,l){switch(l.tag){case 0:case 11:case 15:case 22:return;case 1:if(l.flags&256&&r!==null){var f=r.memoizedProps,x=r.memoizedState;r=l.stateNode,l=r.getSnapshotBeforeUpdate(l.elementType===l.type?f:fr(l.type,f),x),r.__reactInternalSnapshotBeforeUpdate=l}return;case 3:l.flags&256&&i_(l.stateNode.containerInfo);return;case 5:case 6:case 4:case 17:return}throw Error(je(163))}function k2(r,l,f){switch(f.tag){case 0:case 11:case 15:case 22:if(l=f.updateQueue,l=l!==null?l.lastEffect:null,l!==null){r=l=l.next;do{if((r.tag&3)===3){var x=r.create;r.destroy=x()}r=r.next}while(r!==l)}if(l=f.updateQueue,l=l!==null?l.lastEffect:null,l!==null){r=l=l.next;do{var T=r;x=T.next,T=T.tag,T&4&&T&1&&(kv(f,r),R2(f,r)),r=x}while(r!==l)}return;case 1:r=f.stateNode,f.flags&4&&(l===null?r.componentDidMount():(x=f.elementType===f.type?l.memoizedProps:fr(f.type,l.memoizedProps),r.componentDidUpdate(x,l.memoizedState,r.__reactInternalSnapshotBeforeUpdate))),l=f.updateQueue,l!==null&&d0(f,l,r);return;case 3:if(l=f.updateQueue,l!==null){if(r=null,f.child!==null)switch(f.child.tag){case 5:r=f.child.stateNode;break;case 1:r=f.child.stateNode}d0(f,l,r)}return;case 5:r=f.stateNode,l===null&&f.flags&4&&$x(f.type,f.memoizedProps)&&r.focus();return;case 6:return;case 4:return;case 12:return;case 13:f.memoizedState===null&&(f=f.alternate,f!==null&&(f=f.memoizedState,f!==null&&(f=f.dehydrated,f!==null&&bx(f))));return;case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(je(163))}function P0(r,l){for(var f=r;;){if(f.tag===5){var x=f.stateNode;if(l)x=x.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none";else{x=f.stateNode;var T=f.memoizedProps.style;T=T!=null&&T.hasOwnProperty("display")?T.display:null,x.style.display=hx("display",T)}}else if(f.tag===6)f.stateNode.nodeValue=l?"":f.memoizedProps;else if((f.tag!==23&&f.tag!==24||f.memoizedState===null||f===r)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===r)break;for(;f.sibling===null;){if(f.return===null||f.return===r)return;f=f.return}f.sibling.return=f.return,f=f.sibling}}function D0(r,l){if(Ks&&typeof Ks.onCommitFiberUnmount=="function")try{Ks.onCommitFiberUnmount(n_,l)}catch{}switch(l.tag){case 0:case 11:case 14:case 15:case 22:if(r=l.updateQueue,r!==null&&(r=r.lastEffect,r!==null)){var f=r=r.next;do{var x=f,T=x.destroy;if(x=x.tag,T!==void 0)if(x&4)kv(l,f);else{x=l;try{T()}catch(A){es(x,A)}}f=f.next}while(f!==r)}break;case 1:if(z0(l),r=l.stateNode,typeof r.componentWillUnmount=="function")try{r.props=l.memoizedProps,r.state=l.memoizedState,r.componentWillUnmount()}catch(A){es(l,A)}break;case 5:z0(l);break;case 4:xv(r,l)}}function L0(r){r.alternate=null,r.child=null,r.dependencies=null,r.firstEffect=null,r.lastEffect=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.return=null,r.updateQueue=null}function R0(r){return r.tag===5||r.tag===3||r.tag===4}function F0(r){e:{for(var l=r.return;l!==null;){if(R0(l))break e;l=l.return}throw Error(je(160))}var f=l;switch(l=f.stateNode,f.tag){case 5:var x=!1;break;case 3:l=l.containerInfo,x=!0;break;case 4:l=l.containerInfo,x=!0;break;default:throw Error(je(161))}f.flags&16&&(yu(l,""),f.flags&=-17);e:t:for(f=r;;){for(;f.sibling===null;){if(f.return===null||R0(f.return)){f=null;break e}f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.flags&2||f.child===null||f.tag===4)continue t;f.child.return=f,f=f.child}if(!(f.flags&2)){f=f.stateNode;break e}}x?gm(r,f,l):ym(r,f,l)}function gm(r,l,f){var x=r.tag,T=x===5||x===6;if(T)r=T?r.stateNode:r.stateNode.instance,l?f.nodeType===8?f.parentNode.insertBefore(r,l):f.insertBefore(r,l):(f.nodeType===8?(l=f.parentNode,l.insertBefore(r,f)):(l=f,l.appendChild(r)),f=f._reactRootContainer,f!=null||l.onclick!==null||(l.onclick=Sd));else if(x!==4&&(r=r.child,r!==null))for(gm(r,l,f),r=r.sibling;r!==null;)gm(r,l,f),r=r.sibling}function ym(r,l,f){var x=r.tag,T=x===5||x===6;if(T)r=T?r.stateNode:r.stateNode.instance,l?f.insertBefore(r,l):f.appendChild(r);else if(x!==4&&(r=r.child,r!==null))for(ym(r,l,f),r=r.sibling;r!==null;)ym(r,l,f),r=r.sibling}function xv(r,l){for(var f=l,x=!1,T,A;;){if(!x){x=f.return;e:for(;;){if(x===null)throw Error(je(160));switch(T=x.stateNode,x.tag){case 5:A=!1;break e;case 3:T=T.containerInfo,A=!0;break e;case 4:T=T.containerInfo,A=!0;break e}x=x.return}x=!0}if(f.tag===5||f.tag===6){e:for(var R=r,a=f,H=a;;)if(D0(R,H),H.child!==null&&H.tag!==4)H.child.return=H,H=H.child;else{if(H===a)break e;for(;H.sibling===null;){if(H.return===null||H.return===a)break e;H=H.return}H.sibling.return=H.return,H=H.sibling}A?(R=T,a=f.stateNode,R.nodeType===8?R.parentNode.removeChild(a):R.removeChild(a)):T.removeChild(f.stateNode)}else if(f.tag===4){if(f.child!==null){T=f.stateNode.containerInfo,A=!0,f.child.return=f,f=f.child;continue}}else if(D0(r,f),f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return;f=f.return,f.tag===4&&(x=!1)}f.sibling.return=f.return,f=f.sibling}}function Rf(r,l){switch(l.tag){case 0:case 11:case 14:case 15:case 22:var f=l.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var x=f=f.next;do(x.tag&3)===3&&(r=x.destroy,x.destroy=void 0,r!==void 0&&r()),x=x.next;while(x!==f)}return;case 1:return;case 5:if(f=l.stateNode,f!=null){x=l.memoizedProps;var T=r!==null?r.memoizedProps:x;r=l.type;var A=l.updateQueue;if(l.updateQueue=null,A!==null){for(f[Cd]=x,r==="input"&&x.type==="radio"&&x.name!=null&&ax(f,x),Yf(r,T),l=Yf(r,x),T=0;T<A.length;T+=2){var R=A[T],a=A[T+1];R==="style"?dx(f,a):R==="dangerouslySetInnerHTML"?ux(f,a):R==="children"?yu(f,a):Rm(f,R,a,l)}switch(r){case"input":$f(f,x);break;case"textarea":lx(f,x);break;case"select":r=f._wrapperState.wasMultiple,f._wrapperState.wasMultiple=!!x.multiple,A=x.value,A!=null?ml(f,!!x.multiple,A,!1):r!==!!x.multiple&&(x.defaultValue!=null?ml(f,!!x.multiple,x.defaultValue,!0):ml(f,!!x.multiple,x.multiple?[]:"",!1))}}}return;case 6:if(l.stateNode===null)throw Error(je(162));l.stateNode.nodeValue=l.memoizedProps;return;case 3:f=l.stateNode,f.hydrate&&(f.hydrate=!1,bx(f.containerInfo));return;case 12:return;case 13:l.memoizedState!==null&&(y_=Ji(),P0(l.child,!0)),B0(l);return;case 19:B0(l);return;case 17:return;case 23:case 24:P0(l,l.memoizedState!==null);return}throw Error(je(163))}function B0(r){var l=r.updateQueue;if(l!==null){r.updateQueue=null;var f=r.stateNode;f===null&&(f=r.stateNode=new S2),l.forEach(function(x){var T=O2.bind(null,r,x);f.has(x)||(f.add(x),x.then(T,T))})}}function I2(r,l){return r!==null&&(r=r.memoizedState,r===null||r.dehydrated!==null)?(l=l.memoizedState,l!==null&&l.dehydrated===null):!1}var A2=Math.ceil,Ud=ia.ReactCurrentDispatcher,__=ia.ReactCurrentOwner,gt=0,hn=null,zi=null,en=0,ea=0,xm=ss(0),Gi=0,Jd=null,Pl=0,Ru=0,Dl=0,g_=0,vm=null,y_=0,wm=1/0;function Ll(){wm=Ji()+500}var et=null,Nd=!1,bm=null,Dr=null,rs=!1,fu=null,nu=90,Tm=[],Em=[],lo=null,mu=0,Sm=null,md=-1,oo=0,_d=0,_u=null,gd=!1;function Un(){return gt&48?Ji():md!==-1?md:md=Ji()}function Qo(r){if(r=r.mode,!(r&2))return 1;if(!(r&4))return Cl()===99?1:2;if(oo===0&&(oo=Pl),_2.transition!==0){_d!==0&&(_d=vm!==null?vm.pendingLanes:0),r=oo;var l=4186112&~_d;return l&=-l,l===0&&(r=4186112&~r,l=r&-r,l===0&&(l=8192)),l}return r=Cl(),gt&4&&r===98?r=Td(12,oo):(r=xb(r),r=Td(r,oo)),r}function Jo(r,l,f){if(50<mu)throw mu=0,Sm=null,Error(je(185));if(r=ep(r,l),r===null)return null;qd(r,l,f),r===hn&&(Dl|=l,Gi===4&&wl(r,en));var x=Cl();l===1?gt&8&&!(gt&48)?Cm(r):(Qn(r,f),gt===0&&(Ll(),Fr())):(!(gt&4)||x!==98&&x!==99||(lo===null?lo=new Set([r]):lo.add(r)),Qn(r,f)),vm=r}function ep(r,l){r.lanes|=l;var f=r.alternate;for(f!==null&&(f.lanes|=l),f=r,r=r.return;r!==null;)r.childLanes|=l,f=r.alternate,f!==null&&(f.childLanes|=l),f=r,r=r.return;return f.tag===3?f.stateNode:null}function Qn(r,l){for(var f=r.callbackNode,x=r.suspendedLanes,T=r.pingedLanes,A=r.expirationTimes,R=r.pendingLanes;0<R;){var a=31-is(R),H=1<<a,pe=A[a];if(pe===-1){if(!(H&x)||H&T){pe=l,sl(H);var Fe=Jt;A[a]=10<=Fe?pe+250:6<=Fe?pe+5e3:-1}}else pe<=l&&(r.expiredLanes|=H);R&=~H}if(x=bu(r,r===hn?en:0),l=Jt,x===0)f!==null&&(f!==Mf&&am(f),r.callbackNode=null,r.callbackPriority=0);else{if(f!==null){if(r.callbackPriority===l)return;f!==Mf&&am(f)}l===15?(f=Cm.bind(null,r),ro===null?(ro=[f],fd=r_(Kd,Kx)):ro.push(f),f=Mf):l===14?f=Cu(99,Cm.bind(null,r)):(f=vb(l),f=Cu(f,vv.bind(null,r))),r.callbackPriority=l,r.callbackNode=f}}function vv(r){if(md=-1,_d=oo=0,gt&48)throw Error(je(327));var l=r.callbackNode;if(as()&&r.callbackNode!==l)return null;var f=bu(r,r===hn?en:0);if(f===0)return null;var x=f,T=gt;gt|=16;var A=Ev();(hn!==r||en!==x)&&(Ll(),bl(r,x));do try{P2();break}catch(a){Tv(r,a)}while(1);if(o_(),Ud.current=A,gt=T,zi!==null?x=0:(hn=null,en=0,x=Gi),Pl&Dl)bl(r,0);else if(x!==0){if(x===2&&(gt|=64,r.hydrate&&(r.hydrate=!1,i_(r.containerInfo)),f=Ax(r),f!==0&&(x=ru(r,f))),x===1)throw l=Jd,bl(r,0),wl(r,f),Qn(r,Ji()),l;switch(r.finishedWork=r.current.alternate,r.finishedLanes=f,x){case 0:case 1:throw Error(je(345));case 2:Zs(r);break;case 3:if(wl(r,f),(f&62914560)===f&&(x=y_+500-Ji(),10<x)){if(bu(r,0)!==0)break;if(T=r.suspendedLanes,(T&f)!==f){Un(),r.pingedLanes|=r.suspendedLanes&T;break}r.timeoutHandle=r0(Zs.bind(null,r),x);break}Zs(r);break;case 4:if(wl(r,f),(f&4186112)===f)break;for(x=r.eventTimes,T=-1;0<f;){var R=31-is(f);A=1<<R,R=x[R],R>T&&(T=R),f&=~A}if(f=T,f=Ji()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*A2(f/1960))-f,10<f){r.timeoutHandle=r0(Zs.bind(null,r),f);break}Zs(r);break;case 5:Zs(r);break;default:throw Error(je(329))}}return Qn(r,Ji()),r.callbackNode===l?vv.bind(null,r):null}function wl(r,l){for(l&=~g_,l&=~Dl,r.suspendedLanes|=l,r.pingedLanes&=~l,r=r.expirationTimes;0<l;){var f=31-is(l),x=1<<f;r[f]=-1,l&=~x}}function Cm(r){if(gt&48)throw Error(je(327));if(as(),r===hn&&r.expiredLanes&en){var l=en,f=ru(r,l);Pl&Dl&&(l=bu(r,l),f=ru(r,l))}else l=bu(r,0),f=ru(r,l);if(r.tag!==0&&f===2&&(gt|=64,r.hydrate&&(r.hydrate=!1,i_(r.containerInfo)),l=Ax(r),l!==0&&(f=ru(r,l))),f===1)throw f=Jd,bl(r,0),wl(r,l),Qn(r,Ji()),f;return r.finishedWork=r.current.alternate,r.finishedLanes=l,Zs(r),Qn(r,Ji()),null}function M2(){if(lo!==null){var r=lo;lo=null,r.forEach(function(l){l.expiredLanes|=24&l.pendingLanes,Qn(l,Ji())})}Fr()}function wv(r,l){var f=gt;gt|=1;try{return r(l)}finally{gt=f,gt===0&&(Ll(),Fr())}}function bv(r,l){var f=gt;gt&=-2,gt|=8;try{return r(l)}finally{gt=f,gt===0&&(Ll(),Fr())}}function sd(r,l){_i(xm,ea),ea|=l,Pl|=l}function x_(){ea=xm.current,si(xm)}function bl(r,l){r.finishedWork=null,r.finishedLanes=0;var f=r.timeoutHandle;if(f!==-1&&(r.timeoutHandle=-1,u2(f)),zi!==null)for(f=zi.return;f!==null;){var x=f;switch(x.tag){case 1:x=x.type.childContextTypes,x!=null&&kd();break;case 3:kl(),si(Cn),si(tn),c_();break;case 5:l_(x);break;case 4:kl();break;case 13:si(mi);break;case 19:si(mi);break;case 10:s_(x);break;case 23:case 24:x_()}f=f.return}hn=r,zi=os(r.current,null),en=ea=Pl=l,Gi=0,Jd=null,g_=Dl=Ru=0}function Tv(r,l){do{var f=zi;try{if(o_(),du.current=Od,Ld){for(var x=yi.memoizedState;x!==null;){var T=x.queue;T!==null&&(T.pending=null),x=x.next}Ld=!1}if(Mu=0,$i=Qi=yi=null,pu=!1,__.current=null,f===null||f.return===null){Gi=1,Jd=l,zi=null;break}e:{var A=r,R=f.return,a=f,H=l;if(l=en,a.flags|=2048,a.firstEffect=a.lastEffect=null,H!==null&&typeof H=="object"&&typeof H.then=="function"){var pe=H;if(!(a.mode&2)){var Fe=a.alternate;Fe?(a.updateQueue=Fe.updateQueue,a.memoizedState=Fe.memoizedState,a.lanes=Fe.lanes):(a.updateQueue=null,a.memoizedState=null)}var ye=(mi.current&1)!==0,ie=R;do{var Se;if(Se=ie.tag===13){var Ke=ie.memoizedState;if(Ke!==null)Se=Ke.dehydrated!==null;else{var Qe=ie.memoizedProps;Se=Qe.fallback===void 0?!1:Qe.unstable_avoidThisFallback!==!0?!0:!ye}}if(Se){var ue=ie.updateQueue;if(ue===null){var ne=new Set;ne.add(pe),ie.updateQueue=ne}else ue.add(pe);if(!(ie.mode&2)){if(ie.flags|=64,a.flags|=16384,a.flags&=-2981,a.tag===1)if(a.alternate===null)a.tag=17;else{var ce=Yo(-1,1);ce.tag=2,Ko(a,ce)}a.lanes|=1;break e}H=void 0,a=l;var ve=A.pingCache;if(ve===null?(ve=A.pingCache=new E2,H=new Set,ve.set(pe,H)):(H=ve.get(pe),H===void 0&&(H=new Set,ve.set(pe,H))),!H.has(a)){H.add(a);var Ee=B2.bind(null,A,pe,a);pe.then(Ee,Ee)}ie.flags|=4096,ie.lanes=l;break e}ie=ie.return}while(ie!==null);H=Error((fl(a.type)||"A React component")+` suspended while rendering, but no fallback UI was specified.

Add a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.`)}Gi!==5&&(Gi=2),H=m_(H,a),ie=R;do{switch(ie.tag){case 3:A=H,ie.flags|=4096,l&=-l,ie.lanes|=l;var nt=gv(ie,A,l);h0(ie,nt);break e;case 1:A=H;var Be=ie.type,rt=ie.stateNode;if(!(ie.flags&64)&&(typeof Be.getDerivedStateFromError=="function"||rt!==null&&typeof rt.componentDidCatch=="function"&&(Dr===null||!Dr.has(rt)))){ie.flags|=4096,l&=-l,ie.lanes|=l;var ht=yv(ie,A,l);h0(ie,ht);break e}}ie=ie.return}while(ie!==null)}Cv(f)}catch(tt){l=tt,zi===f&&f!==null&&(zi=f=f.return);continue}break}while(1)}function Ev(){var r=Ud.current;return Ud.current=Od,r===null?Od:r}function ru(r,l){var f=gt;gt|=16;var x=Ev();hn===r&&en===l||bl(r,l);do try{z2();break}catch(T){Tv(r,T)}while(1);if(o_(),gt=f,Ud.current=x,zi!==null)throw Error(je(261));return hn=null,en=0,Gi}function z2(){for(;zi!==null;)Sv(zi)}function P2(){for(;zi!==null&&!p2();)Sv(zi)}function Sv(r){var l=Iv(r.alternate,r,ea);r.memoizedProps=r.pendingProps,l===null?Cv(r):zi=l,__.current=null}function Cv(r){var l=r;do{var f=l.alternate;if(r=l.return,l.flags&2048){if(f=T2(l),f!==null){f.flags&=2047,zi=f;return}r!==null&&(r.firstEffect=r.lastEffect=null,r.flags|=2048)}else{if(f=b2(f,l,ea),f!==null){zi=f;return}if(f=l,f.tag!==24&&f.tag!==23||f.memoizedState===null||ea&1073741824||!(f.mode&4)){for(var x=0,T=f.child;T!==null;)x|=T.lanes|T.childLanes,T=T.sibling;f.childLanes=x}r!==null&&!(r.flags&2048)&&(r.firstEffect===null&&(r.firstEffect=l.firstEffect),l.lastEffect!==null&&(r.lastEffect!==null&&(r.lastEffect.nextEffect=l.firstEffect),r.lastEffect=l.lastEffect),1<l.flags&&(r.lastEffect!==null?r.lastEffect.nextEffect=l:r.firstEffect=l,r.lastEffect=l))}if(l=l.sibling,l!==null){zi=l;return}zi=l=r}while(l!==null);Gi===0&&(Gi=5)}function Zs(r){var l=Cl();return Js(99,D2.bind(null,r,l)),null}function D2(r,l){do as();while(fu!==null);if(gt&48)throw Error(je(327));var f=r.finishedWork;if(f===null)return null;if(r.finishedWork=null,r.finishedLanes=0,f===r.current)throw Error(je(177));r.callbackNode=null;var x=f.lanes|f.childLanes,T=x,A=r.pendingLanes&~T;r.pendingLanes=T,r.suspendedLanes=0,r.pingedLanes=0,r.expiredLanes&=T,r.mutableReadLanes&=T,r.entangledLanes&=T,T=r.entanglements;for(var R=r.eventTimes,a=r.expirationTimes;0<A;){var H=31-is(A),pe=1<<H;T[H]=0,R[H]=-1,a[H]=-1,A&=~pe}if(lo!==null&&!(x&24)&&lo.has(r)&&lo.delete(r),r===hn&&(zi=hn=null,en=0),1<f.flags?f.lastEffect!==null?(f.lastEffect.nextEffect=f,x=f.firstEffect):x=f:x=f.firstEffect,x!==null){if(T=gt,gt|=32,__.current=null,kf=ud,R=Ky(),im(R)){if("selectionStart"in R)a={start:R.selectionStart,end:R.selectionEnd};else e:if(a=(a=R.ownerDocument)&&a.defaultView||window,(pe=a.getSelection&&a.getSelection())&&pe.rangeCount!==0){a=pe.anchorNode,A=pe.anchorOffset,H=pe.focusNode,pe=pe.focusOffset;try{a.nodeType,H.nodeType}catch{a=null;break e}var Fe=0,ye=-1,ie=-1,Se=0,Ke=0,Qe=R,ue=null;t:for(;;){for(var ne;Qe!==a||A!==0&&Qe.nodeType!==3||(ye=Fe+A),Qe!==H||pe!==0&&Qe.nodeType!==3||(ie=Fe+pe),Qe.nodeType===3&&(Fe+=Qe.nodeValue.length),(ne=Qe.firstChild)!==null;)ue=Qe,Qe=ne;for(;;){if(Qe===R)break t;if(ue===a&&++Se===A&&(ye=Fe),ue===H&&++Ke===pe&&(ie=Fe),(ne=Qe.nextSibling)!==null)break;Qe=ue,ue=Qe.parentNode}Qe=ne}a=ye===-1||ie===-1?null:{start:ye,end:ie}}else a=null;a=a||{start:0,end:0}}else a=null;If={focusedElem:R,selectionRange:a},ud=!1,_u=null,gd=!1,et=x;do try{L2()}catch(tt){if(et===null)throw Error(je(330));es(et,tt),et=et.nextEffect}while(et!==null);_u=null,et=x;do try{for(R=r;et!==null;){var ce=et.flags;if(ce&16&&yu(et.stateNode,""),ce&128){var ve=et.alternate;if(ve!==null){var Ee=ve.ref;Ee!==null&&(typeof Ee=="function"?Ee(null):Ee.current=null)}}switch(ce&1038){case 2:F0(et),et.flags&=-3;break;case 6:F0(et),et.flags&=-3,Rf(et.alternate,et);break;case 1024:et.flags&=-1025;break;case 1028:et.flags&=-1025,Rf(et.alternate,et);break;case 4:Rf(et.alternate,et);break;case 8:a=et,xv(R,a);var nt=a.alternate;L0(a),nt!==null&&L0(nt)}et=et.nextEffect}}catch(tt){if(et===null)throw Error(je(330));es(et,tt),et=et.nextEffect}while(et!==null);if(Ee=If,ve=Ky(),ce=Ee.focusedElem,R=Ee.selectionRange,ve!==ce&&ce&&ce.ownerDocument&&Bx(ce.ownerDocument.documentElement,ce)){for(R!==null&&im(ce)&&(ve=R.start,Ee=R.end,Ee===void 0&&(Ee=ve),"selectionStart"in ce?(ce.selectionStart=ve,ce.selectionEnd=Math.min(Ee,ce.value.length)):(Ee=(ve=ce.ownerDocument||document)&&ve.defaultView||window,Ee.getSelection&&(Ee=Ee.getSelection(),a=ce.textContent.length,nt=Math.min(R.start,a),R=R.end===void 0?nt:Math.min(R.end,a),!Ee.extend&&nt>R&&(a=R,R=nt,nt=a),a=Yy(ce,nt),A=Yy(ce,R),a&&A&&(Ee.rangeCount!==1||Ee.anchorNode!==a.node||Ee.anchorOffset!==a.offset||Ee.focusNode!==A.node||Ee.focusOffset!==A.offset)&&(ve=ve.createRange(),ve.setStart(a.node,a.offset),Ee.removeAllRanges(),nt>R?(Ee.addRange(ve),Ee.extend(A.node,A.offset)):(ve.setEnd(A.node,A.offset),Ee.addRange(ve)))))),ve=[],Ee=ce;Ee=Ee.parentNode;)Ee.nodeType===1&&ve.push({element:Ee,left:Ee.scrollLeft,top:Ee.scrollTop});for(typeof ce.focus=="function"&&ce.focus(),ce=0;ce<ve.length;ce++)Ee=ve[ce],Ee.element.scrollLeft=Ee.left,Ee.element.scrollTop=Ee.top}ud=!!kf,If=kf=null,r.current=f,et=x;do try{for(ce=r;et!==null;){var Be=et.flags;if(Be&36&&k2(ce,et.alternate,et),Be&128){ve=void 0;var rt=et.ref;if(rt!==null){var ht=et.stateNode;switch(et.tag){case 5:ve=ht;break;default:ve=ht}typeof rt=="function"?rt(ve):rt.current=ve}}et=et.nextEffect}}catch(tt){if(et===null)throw Error(je(330));es(et,tt),et=et.nextEffect}while(et!==null);et=null,m2(),gt=T}else r.current=f;if(rs)rs=!1,fu=r,nu=l;else for(et=x;et!==null;)l=et.nextEffect,et.nextEffect=null,et.flags&8&&(Be=et,Be.sibling=null,Be.stateNode=null),et=l;if(x=r.pendingLanes,x===0&&(Dr=null),x===1?r===Sm?mu++:(mu=0,Sm=r):mu=0,f=f.stateNode,Ks&&typeof Ks.onCommitFiberRoot=="function")try{Ks.onCommitFiberRoot(n_,f,void 0,(f.current.flags&64)===64)}catch{}if(Qn(r,Ji()),Nd)throw Nd=!1,r=bm,bm=null,r;return gt&8||Fr(),null}function L2(){for(;et!==null;){var r=et.alternate;gd||_u===null||(et.flags&8?Fy(et,_u)&&(gd=!0):et.tag===13&&I2(r,et)&&Fy(et,_u)&&(gd=!0));var l=et.flags;l&256&&C2(r,et),!(l&512)||rs||(rs=!0,Cu(97,function(){return as(),null})),et=et.nextEffect}}function as(){if(nu!==90){var r=97<nu?97:nu;return nu=90,Js(r,F2)}return!1}function R2(r,l){Tm.push(l,r),rs||(rs=!0,Cu(97,function(){return as(),null}))}function kv(r,l){Em.push(l,r),rs||(rs=!0,Cu(97,function(){return as(),null}))}function F2(){if(fu===null)return!1;var r=fu;if(fu=null,gt&48)throw Error(je(331));var l=gt;gt|=32;var f=Em;Em=[];for(var x=0;x<f.length;x+=2){var T=f[x],A=f[x+1],R=T.destroy;if(T.destroy=void 0,typeof R=="function")try{R()}catch(H){if(A===null)throw Error(je(330));es(A,H)}}for(f=Tm,Tm=[],x=0;x<f.length;x+=2){T=f[x],A=f[x+1];try{var a=T.create;T.destroy=a()}catch(H){if(A===null)throw Error(je(330));es(A,H)}}for(a=r.current.firstEffect;a!==null;)r=a.nextEffect,a.nextEffect=null,a.flags&8&&(a.sibling=null,a.stateNode=null),a=r;return gt=l,Fr(),!0}function O0(r,l,f){l=m_(f,l),l=gv(r,l,1),Ko(r,l),l=Un(),r=ep(r,1),r!==null&&(qd(r,1,l),Qn(r,l))}function es(r,l){if(r.tag===3)O0(r,r,l);else for(var f=r.return;f!==null;){if(f.tag===3){O0(f,r,l);break}else if(f.tag===1){var x=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Dr===null||!Dr.has(x))){r=m_(l,r);var T=yv(f,r,1);if(Ko(f,T),T=Un(),f=ep(f,1),f!==null)qd(f,1,T),Qn(f,T);else if(typeof x.componentDidCatch=="function"&&(Dr===null||!Dr.has(x)))try{x.componentDidCatch(l,r)}catch{}break}}f=f.return}}function B2(r,l,f){var x=r.pingCache;x!==null&&x.delete(l),l=Un(),r.pingedLanes|=r.suspendedLanes&f,hn===r&&(en&f)===f&&(Gi===4||Gi===3&&(en&62914560)===en&&500>Ji()-y_?bl(r,0):g_|=f),Qn(r,l)}function O2(r,l){var f=r.stateNode;f!==null&&f.delete(l),l=0,l===0&&(l=r.mode,l&2?l&4?(oo===0&&(oo=Pl),l=al(62914560&~oo),l===0&&(l=4194304)):l=Cl()===99?1:2:l=1),f=Un(),r=ep(r,l),r!==null&&(qd(r,l,f),Qn(r,f))}var Iv;Iv=function(r,l,f){var x=l.lanes;if(r!==null)if(r.memoizedProps!==l.pendingProps||Cn.current)mr=!0;else if(f&x)mr=!!(r.flags&16384);else{switch(mr=!1,l.tag){case 3:E0(l),Pf();break;case 5:m0(l);break;case 1:kn(l.type)&&pd(l);break;case 4:um(l,l.stateNode.containerInfo);break;case 10:x=l.memoizedProps.value;var T=l.type._context;_i(Id,T._currentValue),T._currentValue=x;break;case 13:if(l.memoizedState!==null)return f&l.child.childLanes?S0(r,l,f):(_i(mi,mi.current&1),l=ao(r,l,f),l!==null?l.sibling:null);_i(mi,mi.current&1);break;case 19:if(x=(f&l.childLanes)!==0,r.flags&64){if(x)return M0(r,l,f);l.flags|=64}if(T=l.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),_i(mi,mi.current),x)break;return null;case 23:case 24:return l.lanes=0,Df(r,l,f)}return ao(r,l,f)}else mr=!1;switch(l.lanes=0,l.tag){case 2:if(x=l.type,r!==null&&(r.alternate=null,l.alternate=null,l.flags|=2),r=l.pendingProps,T=Sl(l,tn.current),xl(l,f),T=h_(null,l,x,r,T,f),l.flags|=1,typeof T=="object"&&T!==null&&typeof T.render=="function"&&T.$$typeof===void 0){if(l.tag=1,l.memoizedState=null,l.updateQueue=null,kn(x)){var A=!0;pd(l)}else A=!1;l.memoizedState=T.state!==null&&T.state!==void 0?T.state:null,a_(l);var R=x.getDerivedStateFromProps;typeof R=="function"&&zd(l,x,R,r),T.updater=Qd,l.stateNode=T,T._reactInternals=l,cm(l,x,r,f),l=fm(null,l,x,!0,A,f)}else l.tag=0,Sn(null,l,T,f),l=l.child;return l;case 16:T=l.elementType;e:{switch(r!==null&&(r.alternate=null,l.alternate=null,l.flags|=2),r=l.pendingProps,A=T._init,T=A(T._payload),l.type=T,A=l.tag=N2(T),r=fr(T,r),A){case 0:l=pm(null,l,T,r,f);break e;case 1:l=T0(null,l,T,r,f);break e;case 11:l=w0(null,l,T,r,f);break e;case 14:l=b0(null,l,T,fr(T.type,r),x,f);break e}throw Error(je(306,T,""))}return l;case 0:return x=l.type,T=l.pendingProps,T=l.elementType===x?T:fr(x,T),pm(r,l,x,T,f);case 1:return x=l.type,T=l.pendingProps,T=l.elementType===x?T:fr(x,T),T0(r,l,x,T,f);case 3:if(E0(l),x=l.updateQueue,r===null||x===null)throw Error(je(282));if(x=l.pendingProps,T=l.memoizedState,T=T!==null?T.element:null,Jx(r,l),ku(l,x,null,f),x=l.memoizedState.element,x===T)Pf(),l=ao(r,l,f);else{if(T=l.stateNode,(A=T.hydrate)&&(qo=yl(l.stateNode.containerInfo.firstChild),so=l,A=Rr=!0),A){if(r=T.mutableSourceEagerHydrationData,r!=null)for(T=0;T<r.length;T+=2)A=r[T],A._workInProgressVersionPrimary=r[T+1],vl.push(A);for(f=nv(l,null,x,f),l.child=f;f;)f.flags=f.flags&-3|1024,f=f.sibling}else Sn(r,l,x,f),Pf();l=l.child}return l;case 5:return m0(l),r===null&&hm(l),x=l.type,T=l.pendingProps,A=r!==null?r.memoizedProps:null,R=T.children,om(x,T)?R=null:A!==null&&om(x,A)&&(l.flags|=16),pv(r,l),Sn(r,l,R,f),l.child;case 6:return r===null&&hm(l),null;case 13:return S0(r,l,f);case 4:return um(l,l.stateNode.containerInfo),x=l.pendingProps,r===null?l.child=Pd(l,null,x,f):Sn(r,l,x,f),l.child;case 11:return x=l.type,T=l.pendingProps,T=l.elementType===x?T:fr(x,T),w0(r,l,x,T,f);case 7:return Sn(r,l,l.pendingProps,f),l.child;case 8:return Sn(r,l,l.pendingProps.children,f),l.child;case 12:return Sn(r,l,l.pendingProps.children,f),l.child;case 10:e:{x=l.type._context,T=l.pendingProps,R=l.memoizedProps,A=T.value;var a=l.type._context;if(_i(Id,a._currentValue),a._currentValue=A,R!==null)if(a=R.value,A=Xn(a,A)?0:(typeof x._calculateChangedBits=="function"?x._calculateChangedBits(a,A):1073741823)|0,A===0){if(R.children===T.children&&!Cn.current){l=ao(r,l,f);break e}}else for(a=l.child,a!==null&&(a.return=l);a!==null;){var H=a.dependencies;if(H!==null){R=a.child;for(var pe=H.firstContext;pe!==null;){if(pe.context===x&&pe.observedBits&A){a.tag===1&&(pe=Yo(-1,f&-f),pe.tag=2,Ko(a,pe)),a.lanes|=f,pe=a.alternate,pe!==null&&(pe.lanes|=f),Qx(a.return,f),H.lanes|=f;break}pe=pe.next}}else R=a.tag===10&&a.type===l.type?null:a.child;if(R!==null)R.return=a;else for(R=a;R!==null;){if(R===l){R=null;break}if(a=R.sibling,a!==null){a.return=R.return,R=a;break}R=R.return}a=R}Sn(r,l,T.children,f),l=l.child}return l;case 9:return T=l.type,A=l.pendingProps,x=A.children,xl(l,f),T=Kn(T,A.unstable_observedBits),x=x(T),l.flags|=1,Sn(r,l,x,f),l.child;case 14:return T=l.type,A=fr(T,l.pendingProps),A=fr(T.type,A),b0(r,l,T,A,x,f);case 15:return dv(r,l,l.type,l.pendingProps,x,f);case 17:return x=l.type,T=l.pendingProps,T=l.elementType===x?T:fr(x,T),r!==null&&(r.alternate=null,l.alternate=null,l.flags|=2),l.tag=1,kn(x)?(r=!0,pd(l)):r=!1,xl(l,f),tv(l,x,T),cm(l,x,T,f),fm(null,l,x,!0,r,f);case 19:return M0(r,l,f);case 23:return Df(r,l,f);case 24:return Df(r,l,f)}throw Error(je(156,l.tag))};function U2(r,l,f,x){this.tag=r,this.key=f,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Hn(r,l,f,x){return new U2(r,l,f,x)}function v_(r){return r=r.prototype,!(!r||!r.isReactComponent)}function N2(r){if(typeof r=="function")return v_(r)?1:0;if(r!=null){if(r=r.$$typeof,r===$d)return 11;if(r===Gd)return 14}return 2}function os(r,l){var f=r.alternate;return f===null?(f=Hn(r.tag,l,r.key,r.mode),f.elementType=r.elementType,f.type=r.type,f.stateNode=r.stateNode,f.alternate=r,r.alternate=f):(f.pendingProps=l,f.type=r.type,f.flags=0,f.nextEffect=null,f.firstEffect=null,f.lastEffect=null),f.childLanes=r.childLanes,f.lanes=r.lanes,f.child=r.child,f.memoizedProps=r.memoizedProps,f.memoizedState=r.memoizedState,f.updateQueue=r.updateQueue,l=r.dependencies,f.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},f.sibling=r.sibling,f.index=r.index,f.ref=r.ref,f}function yd(r,l,f,x,T,A){var R=2;if(x=r,typeof r=="function")v_(r)&&(R=1);else if(typeof r=="string")R=5;else e:switch(r){case $o:return Tl(f.children,T,A,l);case rx:R=8,T|=16;break;case Fm:R=8,T|=1;break;case ou:return r=Hn(12,f,l,T|8),r.elementType=ou,r.type=ou,r.lanes=A,r;case su:return r=Hn(13,f,l,T),r.type=su,r.elementType=su,r.lanes=A,r;case xd:return r=Hn(19,f,l,T),r.elementType=xd,r.lanes=A,r;case jm:return w_(f,T,A,l);case Vf:return r=Hn(24,f,l,T),r.elementType=Vf,r.lanes=A,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case Bm:R=10;break e;case Om:R=9;break e;case $d:R=11;break e;case Gd:R=14;break e;case Um:R=16,x=null;break e;case Nm:R=22;break e}throw Error(je(130,r==null?r:typeof r,""))}return l=Hn(R,f,l,T),l.elementType=r,l.type=x,l.lanes=A,l}function Tl(r,l,f,x){return r=Hn(7,r,x,l),r.lanes=f,r}function w_(r,l,f,x){return r=Hn(23,r,x,l),r.elementType=jm,r.lanes=f,r}function Ff(r,l,f){return r=Hn(6,r,null,l),r.lanes=f,r}function Bf(r,l,f){return l=Hn(4,r.children!==null?r.children:[],r.key,l),l.lanes=f,l.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},l}function V2(r,l,f){this.tag=l,this.containerInfo=r,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=f,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=vf(0),this.expirationTimes=vf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=vf(0),this.mutableSourceEagerHydrationData=null}function j2(r,l,f){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:qs,key:x==null?null:""+x,children:r,containerInfo:l,implementation:f}}function Vd(r,l,f,x){var T=l.current,A=Un(),R=Qo(T);e:if(f){f=f._reactInternals;t:{if(na(f)!==f||f.tag!==1)throw Error(je(170));var a=f;do{switch(a.tag){case 3:a=a.stateNode.context;break t;case 1:if(kn(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break t}}a=a.return}while(a!==null);throw Error(je(171))}if(f.tag===1){var H=f.type;if(kn(H)){f=Zx(f,H,a);break e}}f=a}else f=ns;return l.context===null?l.context=f:l.pendingContext=f,l=Yo(A,R),l.payload={element:r},x=x===void 0?null:x,x!==null&&(l.callback=x),Ko(T,l),Jo(T,R,A),R}function Of(r){if(r=r.current,!r.child)return null;switch(r.child.tag){case 5:return r.child.stateNode;default:return r.child.stateNode}}function U0(r,l){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var f=r.retryLane;r.retryLane=f!==0&&f<l?f:l}}function b_(r,l){U0(r,l),(r=r.alternate)&&U0(r,l)}function $2(){return null}function T_(r,l,f){var x=f!=null&&f.hydrationOptions!=null&&f.hydrationOptions.mutableSources||null;if(f=new V2(r,l,f!=null&&f.hydrate===!0),l=Hn(3,null,null,l===2?7:l===1?3:0),f.current=l,l.stateNode=f,a_(l),r[zl]=f.current,Nx(r.nodeType===8?r.parentNode:r),x)for(r=0;r<x.length;r++){l=x[r];var T=l._getVersion;T=T(l._source),f.mutableSourceEagerHydrationData==null?f.mutableSourceEagerHydrationData=[l,T]:f.mutableSourceEagerHydrationData.push(l,T)}this._internalRoot=f}T_.prototype.render=function(r){Vd(r,this._internalRoot,null,null)};T_.prototype.unmount=function(){var r=this._internalRoot,l=r.containerInfo;Vd(null,r,null,function(){l[zl]=null})};function Fu(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11&&(r.nodeType!==8||r.nodeValue!==" react-mount-point-unstable "))}function G2(r,l){if(l||(l=r?r.nodeType===9?r.documentElement:r.firstChild:null,l=!(!l||l.nodeType!==1||!l.hasAttribute("data-reactroot"))),!l)for(var f;f=r.lastChild;)r.removeChild(f);return new T_(r,0,l?{hydrate:!0}:void 0)}function tp(r,l,f,x,T){var A=f._reactRootContainer;if(A){var R=A._internalRoot;if(typeof T=="function"){var a=T;T=function(){var pe=Of(R);a.call(pe)}}Vd(l,R,r,T)}else{if(A=f._reactRootContainer=G2(f,x),R=A._internalRoot,typeof T=="function"){var H=T;T=function(){var pe=Of(R);H.call(pe)}}bv(function(){Vd(l,R,r,T)})}return Of(R)}xx=function(r){if(r.tag===13){var l=Un();Jo(r,4,l),b_(r,4)}};Wm=function(r){if(r.tag===13){var l=Un();Jo(r,67108864,l),b_(r,67108864)}};vx=function(r){if(r.tag===13){var l=Un(),f=Qo(r);Jo(r,f,l),b_(r,f)}};wx=function(r,l){return l()};Kf=function(r,l,f){switch(l){case"input":if($f(r,f),l=f.name,f.type==="radio"&&l!=null){for(f=r;f.parentNode;)f=f.parentNode;for(f=f.querySelectorAll("input[name="+JSON.stringify(""+l)+'][type="radio"]'),l=0;l<f.length;l++){var x=f[l];if(x!==r&&x.form===r.form){var T=Yd(x);if(!T)throw Error(je(90));sx(x),$f(x,T)}}}break;case"textarea":lx(r,f);break;case"select":l=f.value,l!=null&&ml(r,!!f.multiple,l,!1)}};Gm=wv;mx=function(r,l,f,x,T){var A=gt;gt|=4;try{return Js(98,r.bind(null,l,f,x,T))}finally{gt=A,gt===0&&(Ll(),Fr())}};Zm=function(){!(gt&49)&&(M2(),as())};_x=function(r,l){var f=gt;gt|=2;try{return r(l)}finally{gt=f,gt===0&&(Ll(),Fr())}};function Av(r,l){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fu(l))throw Error(je(200));return j2(r,l,null,f)}var Z2={Events:[Du,hl,Yd,px,fx,as,{current:!1}]},Jc={findFiberByHostInstance:Xs,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},q2={bundleType:Jc.bundleType,version:Jc.version,rendererPackageName:Jc.rendererPackageName,rendererConfig:Jc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ia.ReactCurrentDispatcher,findHostInstanceByFiber:function(r){return r=yx(r),r===null?null:r.stateNode},findFiberByHostInstance:Jc.findFiberByHostInstance||$2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ad=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ad.isDisabled&&ad.supportsFiber)try{n_=ad.inject(q2),Ks=ad}catch{}}Jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z2;Jn.createPortal=Av;Jn.findDOMNode=function(r){if(r==null)return null;if(r.nodeType===1)return r;var l=r._reactInternals;if(l===void 0)throw typeof r.render=="function"?Error(je(188)):Error(je(268,Object.keys(r)));return r=yx(l),r=r===null?null:r.stateNode,r};Jn.flushSync=function(r,l){var f=gt;if(f&48)return r(l);gt|=1;try{if(r)return Js(99,r.bind(null,l))}finally{gt=f,Fr()}};Jn.hydrate=function(r,l,f){if(!Fu(l))throw Error(je(200));return tp(null,r,l,!0,f)};Jn.render=function(r,l,f){if(!Fu(l))throw Error(je(200));return tp(null,r,l,!1,f)};Jn.unmountComponentAtNode=function(r){if(!Fu(r))throw Error(je(40));return r._reactRootContainer?(bv(function(){tp(null,null,r,!1,function(){r._reactRootContainer=null,r[zl]=null})}),!0):!1};Jn.unstable_batchedUpdates=wv;Jn.unstable_createPortal=function(r,l){return Av(r,l,2<arguments.length&&arguments[2]!==void 0?arguments[2]:null)};Jn.unstable_renderSubtreeIntoContainer=function(r,l,f,x){if(!Fu(f))throw Error(je(200));if(r==null||r._reactInternals===void 0)throw Error(je(38));return tp(r,l,f,!1,x)};Jn.version="17.0.2";(function(r){function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(f){console.error(f)}}l(),r.exports=Jn})(Kw);const W2=V0(Uf);var km={},X2={get exports(){return km},set exports(r){km=r}};(function(r,l){(function(f,x){r.exports=x()})(Nw,function(){var f,x,T;function A(a,H){if(!f)f=H;else if(!x)x=H;else{var pe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+f+")(sharedChunk); ("+x+")(sharedChunk); self.onerror = null;",Fe={};f(Fe),T=H(Fe),typeof window<"u"&&(T.workerUrl=window.URL.createObjectURL(new Blob([pe],{type:"text/javascript"})))}}A(["exports"],function(a){var H="2.5.1",pe=Fe;function Fe(i,e,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(o-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=o,this.p2x=n,this.p2y=o}Fe.prototype.sampleCurveX=function(i){return((this.ax*i+this.bx)*i+this.cx)*i},Fe.prototype.sampleCurveY=function(i){return((this.ay*i+this.by)*i+this.cy)*i},Fe.prototype.sampleCurveDerivativeX=function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},Fe.prototype.solveCurveX=function(i,e){var n,o,c,d,p;for(e===void 0&&(e=1e-6),c=i,p=0;p<8;p++){if(d=this.sampleCurveX(c)-i,Math.abs(d)<e)return c;var g=this.sampleCurveDerivativeX(c);if(Math.abs(g)<1e-6)break;c-=d/g}if((c=i)<(n=0))return n;if(c>(o=1))return o;for(;n<o;){if(d=this.sampleCurveX(c),Math.abs(d-i)<e)return c;i>d?n=c:o=c,c=.5*(o-n)+n}return c},Fe.prototype.solve=function(i,e){return this.sampleCurveY(this.solveCurveX(i,e))};var ye=ie;function ie(i,e){this.x=i,this.y=e}ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,e){return this.clone()._rotateAround(i,e)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult:function(i){var e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var e=Math.cos(i),n=Math.sin(i),o=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,e){var n=Math.cos(i),o=Math.sin(i),c=e.y+o*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-o*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(i){return i instanceof ie?i:Array.isArray(i)?new ie(i[0],i[1]):i};var Se=typeof self<"u"?self:{};const Ke=Math.pow(2,53)-1,Qe=Math.PI/180,ue=180/Math.PI;function ne(i){return i*Qe}const ce=[[0,0],[1,0],[1,1],[0,1]];function ve(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Ee(i,e,n,o){const c=new pe(i,e,n,o);return function(d){return c.solve(d)}}const nt=Ee(.25,.1,.25,1);function Be(i,e,n){return Math.min(n,Math.max(e,i))}function rt(i,e,n){const o=n-e,c=((i-e)%o+o)%o+e;return c===e?n:c}function ht(i,e,n){if(!i.length)return n(null,[]);let o=i.length;const c=new Array(i.length);let d=null;i.forEach((p,g)=>{e(p,(y,w)=>{y&&(d=y),c[g]=w,--o==0&&n(d,c)})})}function tt(i){const e=[];for(const n in i)e.push(i[n]);return e}function St(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}let Br=1;function xi(){return Br++}function ei(){return function i(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function In(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function nn(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function An(i,e){i.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function pn(i,e){return i.indexOf(e,i.length-e.length)!==-1}function Vn(i,e,n){const o={};for(const c in i)o[c]=e.call(n||this,i[c],c,i);return o}function Pi(i,e,n){const o={};for(const c in i)e.call(n||this,i[c],c,i)&&(o[c]=i[c]);return o}function Gt(i){return Array.isArray(i)?i.map(Gt):typeof i=="object"&&i?Vn(i,Gt):i}const Ge={};function Ye(i){Ge[i]||(typeof console<"u"&&console.warn(i),Ge[i]=!0)}function ut(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Zt(i){let e=0;for(let n,o,c=0,d=i.length,p=d-1;c<d;p=c++)n=i[c],o=i[p],e+=(o.x-n.x)*(n.y+o.y);return e}function Wt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Di(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,c,d)=>{const p=c||d;return e[o]=!p||p.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Li,vt,rn,ls=null;function cs(i){if(ls==null){const e=i.navigator?i.navigator.userAgent:null;ls=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ls}function us(i){try{const e=Se[i];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}const on={now:()=>rn!==void 0?rn:Se.performance.now(),setNow(i){rn=i},restoreNow(){rn=void 0},frame(i){const e=Se.requestAnimationFrame(i);return{cancel:()=>Se.cancelAnimationFrame(e)}},getImageData(i,e=0){const n=Se.document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("failed to create canvas 2d context");return n.width=i.width,n.height=i.height,o.drawImage(i,0,0,i.width,i.height),o.getImageData(-e,-e,i.width+2*e,i.height+2*e)},resolveURL:i=>(Li||(Li=Se.document.createElement("a")),Li.href=i,Li.href),get devicePixelRatio(){return Se.devicePixelRatio},get prefersReducedMotion(){return!!Se.matchMedia&&(vt==null&&(vt=Se.matchMedia("(prefers-reduced-motion: reduce)")),vt.matches)}};let er;const It={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(er==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{er={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):i}catch{er=i}}return er},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},jn={supported:!1,testSupport:function(i){!Or&&tr&&(oa?gr(i):_r=i)}};let _r,tr,Or=!1,oa=!1;function gr(i){const e=i.createTexture();i.bindTexture(i.TEXTURE_2D,e);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,tr),i.isContextLost())return;jn.supported=!0}catch{}i.deleteTexture(e),Or=!0}Se.document&&(tr=Se.document.createElement("img"),tr.onload=function(){_r&&gr(_r),_r=null,oa=!0},tr.onerror=function(){Or=!0,_r=null},tr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ho="01",Ur="NO_ACCESS_TOKEN";function Mn(i){return i.indexOf("mapbox:")===0}function yr(i){return It.API_URL_REGEX.test(i)}const hs=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function fn(i){const e=i.match(hs);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function xr(i){const e=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${e}`}function mn(i){if(!i)return null;const e=i.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(Se.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ds{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=mn(It.ACCESS_TOKEN);let o="";return o=n&&n.u?Se.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(Number("0x"+d)))):It.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${o}`:`mapbox.eventData:${o}`}fetchEventData(){const e=us("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{const c=Se.localStorage.getItem(n);c&&(this.eventData=JSON.parse(c));const d=Se.localStorage.getItem(o);d&&(this.anonId=d)}catch{Ye("Unable to read from LocalStorage")}}saveEventData(){const e=us("localStorage"),n=this.getStorageKey(),o=this.getStorageKey("uuid");if(e)try{Se.localStorage.setItem(o,this.anonId),Object.keys(this.eventData).length>=1&&Se.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Ye("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,o,c){if(!It.EVENTS_URL)return;const d=fn(It.EVENTS_URL);d.params.push(`access_token=${c||It.ACCESS_TOKEN||""}`);const p={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:H,skuId:ho,userId:this.anonId},g=n?St(p,n):p,y={url:xr(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([g])};this.pendingRequest=L(y,w=>{this.pendingRequest=null,o(w),this.saveEventData(),this.processRequests(c)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const ps=new class extends ds{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,e){It.EVENTS_URL&&It.ACCESS_TOKEN&&Array.isArray(i)&&i.some(n=>Mn(n)||yr(n))&&this.queueRequest(Date.now(),e)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=mn(It.ACCESS_TOKEN),n=e?e.u:It.ACCESS_TOKEN;let o=n!==this.eventData.tokenU;nn(this.anonId)||(this.anonId=ei(),o=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),p=new Date(c),g=(c-this.eventData.lastSuccess)/864e5;o=o||g>=1||g<-1||d.getDate()!==p.getDate()}else o=!0;if(!o)return this.processRequests();this.postEvent(c,{"enabled.telemetry":!1},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=n)},i)}},sa=ps.postTurnstileEvent.bind(ps),po=new class extends ds{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,e,n,o){this.skuToken=e,this.errorCb=o,It.EVENTS_URL&&(n||It.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(Ur)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),nn(this.anonId)||(this.anonId=ei()),this.postEvent(n,{skuToken:this.skuToken},o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},i))}},fs=po.postMapLoadEvent.bind(po),aa=new class extends ds{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,e,n,o){if(!It.API_URL||!It.SESSION_PATH)return;const c=fn(It.API_URL+It.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${o||It.ACCESS_TOKEN||""}`);const d={url:xr(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=j(d,p=>{this.pendingRequest=null,n(p),this.saveEventData(),this.processRequests(o)})}getSessionAPI(i,e,n,o){this.skuToken=e,this.errorCb=o,It.SESSION_PATH&&It.API_URL&&(n||It.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},n):this.errorCb(new Error(Ur)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,o=>{o?this.errorCb(o):e&&(this.success[e]=!0)},i)}},Rl=aa.getSessionAPI.bind(aa),Nr=new Set,fo="mapbox-tiles";let _n,vr,la=500,ms=50;function wr(){Se.caches&&!_n&&(_n=Se.caches.open(fo))}function Vr(i){const e=i.indexOf("?");return e<0?i:i.slice(0,e)}let jr=1/0;const $r={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze($r);class mo extends Error{constructor(e,n,o){n===401&&yr(o)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=o}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const $n=Wt()?()=>self.worker&&self.worker.referrer:()=>(Se.location.protocol==="blob:"?Se.parent:Se).location.href,V=function(i,e){if(!(/^file:/.test(n=i.url)||/^file:/.test($n())&&!/^\w+:/.test(n))){if(Se.fetch&&Se.Request&&Se.AbortController&&Se.Request.prototype.hasOwnProperty("signal"))return function(o,c){const d=new Se.AbortController,p=new Se.Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,referrer:$n(),signal:d.signal});let g=!1,y=!1;const w=(E=p.url).indexOf("sku=")>0&&yr(E);var E;o.type==="json"&&p.headers.set("Accept","application/json");const C=(z,O,U)=>{if(y)return;if(z&&z.message!=="SecurityError"&&Ye(z),O&&U)return k(O);const W=Date.now();Se.fetch(p).then(Q=>{if(Q.ok){const se=w?Q.clone():null;return k(Q,se,W)}return c(new mo(Q.statusText,Q.status,o.url))}).catch(Q=>{Q.code!==20&&c(new Error(Q.message))})},k=(z,O,U)=>{(o.type==="arrayBuffer"?z.arrayBuffer():o.type==="json"?z.json():z.text()).then(W=>{y||(O&&U&&function(Q,se,me){if(wr(),!_n)return;const _e={status:se.status,statusText:se.statusText,headers:new Se.Headers};se.headers.forEach((xe,Ce)=>_e.headers.set(Ce,xe));const ge=Di(se.headers.get("Cache-Control")||"");ge["no-store"]||(ge["max-age"]&&_e.headers.set("Expires",new Date(me+1e3*ge["max-age"]).toUTCString()),new Date(_e.headers.get("Expires")).getTime()-me<42e4||function(xe,Ce){if(vr===void 0)try{new Response(new ReadableStream),vr=!0}catch{vr=!1}vr?Ce(xe.body):xe.blob().then(Ce)}(se,xe=>{const Ce=new Se.Response(xe,_e);wr(),_n&&_n.then(De=>De.put(Vr(Q.url),Ce)).catch(De=>Ye(De.message))}))}(p,O,U),g=!0,c(null,W,z.headers.get("Cache-Control"),z.headers.get("Expires")))}).catch(W=>{y||c(new Error(W.message))})};return w?function(z,O){if(wr(),!_n)return O(null);const U=Vr(z.url);_n.then(W=>{W.match(U).then(Q=>{const se=function(me){if(!me)return!1;const _e=new Date(me.headers.get("Expires")||0),ge=Di(me.headers.get("Cache-Control")||"");return _e>Date.now()&&!ge["no-cache"]}(Q);W.delete(U),se&&W.put(U,Q.clone()),O(null,Q,se)}).catch(O)}).catch(O)}(p,C):C(null,null),{cancel:()=>{y=!0,g||d.abort()}}}(i,e);if(Wt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,e,void 0,!0)}var n;return function(o,c){const d=new Se.XMLHttpRequest;d.open(o.method||"GET",o.url,!0),o.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const p in o.headers)d.setRequestHeader(p,o.headers[p]);return o.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=o.credentials==="include",d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let p=d.response;if(o.type==="json")try{p=JSON.parse(d.response)}catch(g){return c(g)}c(null,p,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new mo(d.statusText,d.status,o.url))},d.send(o.body),{cancel:()=>d.abort()}}(i,e)},P=function(i,e){return V(St(i,{type:"arrayBuffer"}),e)},L=function(i,e){return V(St(i,{method:"POST"}),e)},j=function(i,e){return V(St(i,{method:"GET"}),e)};function q(i){const e=Se.document.createElement("a");return e.href=i,e.protocol===Se.document.location.protocol&&e.host===Se.document.location.host}const J="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let he,de;he=[],de=0;const re=function(i,e){if(jn.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),de>=It.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:i,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return he.push(d),d}de++;let n=!1;const o=()=>{if(!n)for(n=!0,de--;he.length&&de<It.MAX_PARALLEL_IMAGE_REQUESTS;){const d=he.shift(),{requestParameters:p,callback:g,cancelled:y}=d;y||(d.cancel=re(p,g).cancel)}},c=P(i,(d,p,g,y)=>{o(),d?e(d):p&&(Se.createImageBitmap?function(w,E){const C=new Se.Blob([new Uint8Array(w)],{type:"image/png"});Se.createImageBitmap(C).then(k=>{E(null,k)}).catch(k=>{E(new Error(`Could not load image because of ${k.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(w,E)=>e(w,E,g,y)):function(w,E){const C=new Se.Image,k=Se.URL;C.onload=()=>{E(null,C),k.revokeObjectURL(C.src),C.onload=null,Se.requestAnimationFrame(()=>{C.src=J})},C.onerror=()=>E(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Se.Blob([new Uint8Array(w)],{type:"image/png"});C.src=w.byteLength?k.createObjectURL(z):J}(p,(w,E)=>e(w,E,g,y)))});return{cancel:()=>{c.cancel(),o()}}};function fe(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function ke(i,e,n){if(n&&n[i]){const o=n[i].indexOf(e);o!==-1&&n[i].splice(o,1)}}class Ue{constructor(e,n={}){St(this,n),this.type=e}}class ze extends Ue{constructor(e,n={}){super("error",St({error:e},n))}}class Je{on(e,n){return this._listeners=this._listeners||{},fe(e,n,this._listeners),this}off(e,n){return ke(e,n,this._listeners),ke(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},fe(e,n,this._oneTimeListeners),this):new Promise(o=>this.once(e,o))}fire(e,n){typeof e=="string"&&(e=new Ue(e,n||{}));const o=e.type;if(this.listens(o)){e.target=this;const c=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const g of c)g.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const g of d)ke(o,g,this._oneTimeListeners),g.call(this,e);const p=this._eventedParent;p&&(St(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),p.fire(e))}else e instanceof ze&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class be{constructor(e,n,o,c){this.message=(e?`${e}: `:"")+o,c&&(this.identifier=c),n!=null&&n.__line__&&(this.line=n.__line__)}}function st(i){const e=i.value;return e?[new be(i.key,e,"constants have been deprecated as of v8")]:[]}function ft(i,...e){for(const n of e)for(const o in n)i[o]=n[o];return i}function dt(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function At(i){if(Array.isArray(i))return i.map(At);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=At(i[n]);return e}return dt(i)}class Tt extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class $t{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[o,c]of n)this.bindings[o]=c}concat(e){return new $t(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ir={kind:"null"},Ve={kind:"number"},yt={kind:"string"},mt={kind:"boolean"},zn={kind:"color"},Ei={kind:"object"},xt={kind:"value"},ca={kind:"collator"},_s={kind:"formatted"},_o={kind:"resolvedImage"};function sn(i,e){return{kind:"array",itemType:i,N:e}}function Yt(i){if(i.kind==="array"){const e=Yt(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Bu=[ir,Ve,yt,mt,zn,_s,Ei,sn(xt),_o];function go(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!go(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Bu)if(!go(n,e))return null}}return`Expected ${Yt(i)} but found ${Yt(e)} instead.`}function yo(i,e){return e.some(n=>n.kind===i.kind)}function gs(i,e){return e.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function nr(i){var e={exports:{}};return i(e,e.exports),e.exports}var Fl=nr(function(i,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function o(g){return(g=Math.round(g))<0?0:g>255?255:g}function c(g){return o(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function d(g){return(y=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:y>1?1:y;var y}function p(g,y,w){return w<0?w+=1:w>1&&(w-=1),6*w<1?g+(y-g)*w*6:2*w<1?y:3*w<2?g+(y-g)*(2/3-w)*6:g}try{e.parseCSSColor=function(g){var y,w=g.replace(/ /g,"").toLowerCase();if(w in n)return n[w].slice();if(w[0]==="#")return w.length===4?(y=parseInt(w.substr(1),16))>=0&&y<=4095?[(3840&y)>>4|(3840&y)>>8,240&y|(240&y)>>4,15&y|(15&y)<<4,1]:null:w.length===7&&(y=parseInt(w.substr(1),16))>=0&&y<=16777215?[(16711680&y)>>16,(65280&y)>>8,255&y,1]:null;var E=w.indexOf("("),C=w.indexOf(")");if(E!==-1&&C+1===w.length){var k=w.substr(0,E),z=w.substr(E+1,C-(E+1)).split(","),O=1;switch(k){case"rgba":if(z.length!==4)return null;O=d(z.pop());case"rgb":return z.length!==3?null:[c(z[0]),c(z[1]),c(z[2]),O];case"hsla":if(z.length!==4)return null;O=d(z.pop());case"hsl":if(z.length!==3)return null;var U=(parseFloat(z[0])%360+360)%360/360,W=d(z[1]),Q=d(z[2]),se=Q<=.5?Q*(W+1):Q+W-Q*W,me=2*Q-se;return[o(255*p(me,se,U+1/3)),o(255*p(me,se,U)),o(255*p(me,se,U-1/3)),O];default:return null}}return null}}catch{}});class _t{constructor(e,n,o,c=1){this.r=e,this.g=n,this.b=o,this.a=c}static parse(e){if(!e)return;if(e instanceof _t)return e;if(typeof e!="string")return;const n=Fl.parseCSSColor(e);return n?new _t(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,o,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(o)},${c})`}toArray(){const{r:e,g:n,b:o,a:c}=this;return c===0?[0,0,0,0]:[255*e/c,255*n/c,255*o/c,c]}}_t.black=new _t(0,0,0,1),_t.white=new _t(1,1,1,1),_t.transparent=new _t(0,0,0,0),_t.red=new _t(1,0,0,1),_t.blue=new _t(0,0,1,1);class Bl{constructor(e,n,o){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ua{constructor(e,n,o,c,d){this.text=e,this.image=n,this.scale=o,this.fontStack=c,this.textColor=d}}class vi{constructor(e){this.sections=e}static fromString(e){return new vi([new ua(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof vi?e:vi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const o={};n.fontStack&&(o["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(o["font-scale"]=n.scale),n.textColor&&(o["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(o)}return e}}class an{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new an({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ou(i,e,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,e,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,e,n,o]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ha(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof _t||i instanceof Bl||i instanceof vi||i instanceof an)return!0;if(Array.isArray(i)){for(const e of i)if(!ha(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ha(i[e]))return!1;return!0}return!1}function fi(i){if(i===null)return ir;if(typeof i=="string")return yt;if(typeof i=="boolean")return mt;if(typeof i=="number")return Ve;if(i instanceof _t)return zn;if(i instanceof Bl)return ca;if(i instanceof vi)return _s;if(i instanceof an)return _o;if(Array.isArray(i)){const e=i.length;let n;for(const o of i){const c=fi(o);if(n){if(n===c)continue;n=xt;break}n=c}return sn(n||xt,e)}return Ei}function xo(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof _t||i instanceof vi||i instanceof an?i.toString():JSON.stringify(i)}class rr{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ha(e[1]))return n.error("invalid value");const o=e[1];let c=fi(o);const d=n.expectedType;return c.kind!=="array"||c.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(c=d),new rr(c,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof _t?["rgba"].concat(this.value.toArray()):this.value instanceof vi?this.value.serialize():this.value}}class Si{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const vo={string:yt,number:Ve,boolean:mt,object:Ei};class Pn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let o,c=1;const d=e[0];if(d==="array"){let g,y;if(e.length>2){const w=e[1];if(typeof w!="string"||!(w in vo)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);g=vo[w],c++}else g=xt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],c++}o=sn(g,y)}else o=vo[d];const p=[];for(;c<e.length;c++){const g=n.parse(e[c],c,xt);if(!g)return null;p.push(g)}return new Pn(o,p)}evaluate(e){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(e);if(!go(this.type,fi(o)))return o;if(n===this.args.length-1)throw new Si(`Expected value to be of type ${Yt(this.type)}, but found ${Yt(fi(o))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const o=e.itemType;if(o.kind==="string"||o.kind==="number"||o.kind==="boolean"){n.push(o.kind);const c=e.N;(typeof c=="number"||this.args.length>1)&&n.push(c)}}return n.concat(this.args.map(o=>o.serialize()))}}class ys{constructor(e){this.type=_s,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const c=[];let d=!1;for(let p=1;p<=e.length-1;++p){const g=e[p];if(d&&typeof g=="object"&&!Array.isArray(g)){d=!1;let y=null;if(g["font-scale"]&&(y=n.parse(g["font-scale"],1,Ve),!y))return null;let w=null;if(g["text-font"]&&(w=n.parse(g["text-font"],1,sn(yt)),!w))return null;let E=null;if(g["text-color"]&&(E=n.parse(g["text-color"],1,zn),!E))return null;const C=c[c.length-1];C.scale=y,C.font=w,C.textColor=E}else{const y=n.parse(e[p],1,xt);if(!y)return null;const w=y.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:y,scale:null,font:null,textColor:null})}}return new ys(c)}evaluate(e){return new vi(this.sections.map(n=>{const o=n.content.evaluate(e);return fi(o)===_o?new ua("",o,null,null,null):new ua(xo(o),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const o={};n.scale&&(o["font-scale"]=n.scale.serialize()),n.font&&(o["text-font"]=n.font.serialize()),n.textColor&&(o["text-color"]=n.textColor.serialize()),e.push(o)}return e}}class da{constructor(e){this.type=_o,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const o=n.parse(e[1],1,yt);return o?new da(o):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),o=an.fromString(n);return o&&e.availableImages&&(o.available=e.availableImages.indexOf(n)>-1),o}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ip={"to-boolean":mt,"to-color":zn,"to-number":Ve,"to-string":yt};class br{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const o=e[0];if((o==="to-boolean"||o==="to-string")&&e.length!==2)return n.error("Expected one argument.");const c=ip[o],d=[];for(let p=1;p<e.length;p++){const g=n.parse(e[p],p,xt);if(!g)return null;d.push(g)}return new br(c,d)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let n,o;for(const c of this.args){if(n=c.evaluate(e),o=null,n instanceof _t)return n;if(typeof n=="string"){const d=e.parseColor(n);if(d)return d}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ou(n[0],n[1],n[2],n[3]),!o))return new _t(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Si(o||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const o of this.args){if(n=o.evaluate(e),n===null)return 0;const c=Number(n);if(!isNaN(c))return c}throw new Si(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?vi.fromString(xo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?an.fromString(xo(this.args[0].evaluate(e))):xo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ys([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new da(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const np=["Unknown","Point","LineString","Polygon"];class Uu{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?np[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=_t.parse(e)),n}}class ln{constructor(e,n,o,c){this.name=e,this.type=n,this._evaluate=o,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const o=e[0],c=ln.definitions[o];if(!c)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,p=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,g=p.filter(([w])=>!Array.isArray(w)||w.length===e.length-1);let y=null;for(const[w,E]of g){y=new ma(n.registry,n.path,null,n.scope);const C=[];let k=!1;for(let z=1;z<e.length;z++){const O=e[z],U=Array.isArray(w)?w[z-1]:w.type,W=y.parse(O,1+C.length,U);if(!W){k=!0;break}C.push(W)}if(!k)if(Array.isArray(w)&&w.length!==C.length)y.error(`Expected ${w.length} arguments, but found ${C.length} instead.`);else{for(let z=0;z<C.length;z++){const O=Array.isArray(w)?w[z]:w.type,U=C[z];y.concat(z+1).checkSubtype(O,U.type)}if(y.errors.length===0)return new ln(o,d,E,C)}}if(g.length===1)n.errors.push(...y.errors);else{const w=(g.length?g:p).map(([C])=>{return k=C,Array.isArray(k)?`(${k.map(Yt).join(", ")})`:`(${Yt(k.type)}...)`;var k}).join(" | "),E=[];for(let C=1;C<e.length;C++){const k=n.parse(e[C],1+E.length);if(!k)return null;E.push(Yt(k.type))}n.error(`Expected arguments of type ${w}, but found (${E.join(", ")}) instead.`)}return null}static register(e,n){ln.definitions=n;for(const o in n)e[o]=ln}}class Gr{constructor(e,n,o){this.type=ca,this.locale=o,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const o=e[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const c=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,mt);if(!c)return null;const d=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,mt);if(!d)return null;let p=null;return o.locale&&(p=n.parse(o.locale,1,yt),!p)?null:new Gr(c,d,p)}evaluate(e){return new Bl(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Tr=8192;function Ol(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function pa(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function rp(i,e){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(n*c*Tr),Math.round(o*c*Tr)]}function op(i,e,n){const o=i[0]-e[0],c=i[1]-e[1],d=i[0]-n[0],p=i[1]-n[1];return o*p-d*c==0&&o*d<=0&&c*p<=0}function Ul(i,e){let n=!1;for(let p=0,g=e.length;p<g;p++){const y=e[p];for(let w=0,E=y.length;w<E-1;w++){if(op(i,y[w],y[w+1]))return!1;(c=y[w])[1]>(o=i)[1]!=(d=y[w+1])[1]>o[1]&&o[0]<(d[0]-c[0])*(o[1]-c[1])/(d[1]-c[1])+c[0]&&(n=!n)}}var o,c,d;return n}function Nu(i,e){for(let n=0;n<e.length;n++)if(Ul(i,e[n]))return!0;return!1}function xs(i,e,n,o){const c=o[0]-n[0],d=o[1]-n[1],p=(i[0]-n[0])*d-c*(i[1]-n[1]),g=(e[0]-n[0])*d-c*(e[1]-n[1]);return p>0&&g<0||p<0&&g>0}function sp(i,e,n){for(const w of n)for(let E=0;E<w.length-1;++E)if((g=[(p=w[E+1])[0]-(d=w[E])[0],p[1]-d[1]])[0]*(y=[(c=e)[0]-(o=i)[0],c[1]-o[1]])[1]-g[1]*y[0]!=0&&xs(o,c,d,p)&&xs(d,p,o,c))return!0;var o,c,d,p,g,y;return!1}function Vu(i,e){for(let n=0;n<i.length;++n)if(!Ul(i[n],e))return!1;for(let n=0;n<i.length-1;++n)if(sp(i[n],i[n+1],e))return!1;return!0}function ap(i,e){for(let n=0;n<e.length;n++)if(Vu(i,e[n]))return!0;return!1}function Nl(i,e,n){const o=[];for(let c=0;c<i.length;c++){const d=[];for(let p=0;p<i[c].length;p++){const g=rp(i[c][p],n);Ol(e,g),d.push(g)}o.push(d)}return o}function Dn(i,e,n){const o=[];for(let c=0;c<i.length;c++){const d=Nl(i[c],e,n);o.push(d)}return o}function Vl(i,e,n,o){if(i[0]<n[0]||i[0]>n[2]){const c=.5*o;let d=i[0]-n[0]>c?-o:n[0]-i[0]>c?o:0;d===0&&(d=i[0]-n[2]>c?-o:n[2]-i[0]>c?o:0),i[0]+=d}Ol(e,i)}function jl(i,e,n,o){const c=Math.pow(2,o.z)*Tr,d=[o.x*Tr,o.y*Tr],p=[];for(const g of i)for(const y of g){const w=[y.x+d[0],y.y+d[1]];Vl(w,e,n,c),p.push(w)}return p}function vs(i,e,n,o){const c=Math.pow(2,o.z)*Tr,d=[o.x*Tr,o.y*Tr],p=[];for(const y of i){const w=[];for(const E of y){const C=[E.x+d[0],E.y+d[1]];Ol(e,C),w.push(C)}p.push(w)}if(e[2]-e[0]<=c/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const y of p)for(const w of y)Vl(w,e,n,c)}var g;return p}class Ln{constructor(e,n){this.type=mt,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ha(e[1])){const o=e[1];if(o.type==="FeatureCollection")for(let c=0;c<o.features.length;++c){const d=o.features[c].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Ln(o,o.features[c].geometry)}else if(o.type==="Feature"){const c=o.geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Ln(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ln(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(o.type==="Polygon"){const g=Nl(o.coordinates,d,p),y=jl(n.geometry(),c,d,p);if(!pa(c,d))return!1;for(const w of y)if(!Ul(w,g))return!1}if(o.type==="MultiPolygon"){const g=Dn(o.coordinates,d,p),y=jl(n.geometry(),c,d,p);if(!pa(c,d))return!1;for(const w of y)if(!Nu(w,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,o){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],p=n.canonicalID();if(o.type==="Polygon"){const g=Nl(o.coordinates,d,p),y=vs(n.geometry(),c,d,p);if(!pa(c,d))return!1;for(const w of y)if(!Vu(w,g))return!1}if(o.type==="MultiPolygon"){const g=Dn(o.coordinates,d,p),y=vs(n.geometry(),c,d,p);if(!pa(c,d))return!1;for(const w of y)if(!ap(w,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function ws(i){if(i instanceof ln&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Ln)return!1;let e=!0;return i.eachChild(n=>{e&&!ws(n)&&(e=!1)}),e}function wo(i){if(i instanceof ln&&i.name==="feature-state")return!1;let e=!0;return i.eachChild(n=>{e&&!wo(n)&&(e=!1)}),e}function fa(i,e){if(i instanceof ln&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!fa(o,e)&&(n=!1)}),n}class Ct{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=e[1];return n.scope.has(o)?new Ct(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ma{constructor(e,n=[],o,c=new $t,d=[]){this.registry=e,this.path=n,this.key=n.map(p=>`[${p}]`).join(""),this.scope=c,this.errors=d,this.expectedType=o}parse(e,n,o,c,d={}){return n?this.concat(n,o,c)._parse(e,d):this._parse(e,d)}_parse(e,n){function o(c,d,p){return p==="assert"?new Pn(d,[c]):p==="coerce"?new br(d,[c]):c}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if(typeof c!="string")return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let p=d.parse(e,this);if(!p)return null;if(this.expectedType){const g=this.expectedType,y=p.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||y.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(g,y))return null}else p=o(p,g,n.typeAnnotation||"coerce");else p=o(p,g,n.typeAnnotation||"assert")}if(!(p instanceof rr)&&p.type.kind!=="resolvedImage"&&$l(p)){const g=new Uu;try{p=new rr(p.type,p.evaluate(g))}catch(y){return this.error(y.message),null}}return p}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,o){const c=typeof e=="number"?this.path.concat(e):this.path,d=o?this.scope.concat(o):this.scope;return new ma(this.registry,c,n||null,d,this.errors)}error(e,...n){const o=`${this.key}${n.map(c=>`[${c}]`).join("")}`;this.errors.push(new Tt(o,e))}checkSubtype(e,n){const o=go(e,n);return o&&this.error(o),o}}function $l(i){if(i instanceof Ct)return $l(i.boundExpression);if(i instanceof ln&&i.name==="error"||i instanceof Gr||i instanceof Ln)return!1;const e=i instanceof br||i instanceof Pn;let n=!0;return i.eachChild(o=>{n=e?n&&$l(o):n&&o instanceof rr}),!!n&&ws(i)&&fa(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function _a(i,e){const n=i.length-1;let o,c,d=0,p=n,g=0;for(;d<=p;)if(g=Math.floor((d+p)/2),o=i[g],c=i[g+1],o<=e){if(g===n||e<c)return g;d=g+1}else{if(!(o>e))throw new Si("Input is not a number.");p=g-1}return 0}class bo{constructor(e,n,o){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[c,d]of o)this.labels.push(c),this.outputs.push(d)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(e[1],1,Ve);if(!o)return null;const c=[];let d=null;n.expectedType&&n.expectedType.kind!=="value"&&(d=n.expectedType);for(let p=1;p<e.length;p+=2){const g=p===1?-1/0:e[p],y=e[p+1],w=p,E=p+1;if(typeof g!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(c.length&&c[c.length-1][0]>=g)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);const C=n.parse(y,E,d);if(!C)return null;d=d||C.type,c.push([g,C])}return new bo(d,o,c)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const d=n.length;return c>=n[d-1]?o[d-1].evaluate(e):o[_a(n,c)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}function Mt(i,e,n){return i*(1-n)+e*n}var bs=Object.freeze({__proto__:null,number:Mt,color:function(i,e,n){return new _t(Mt(i.r,e.r,n),Mt(i.g,e.g,n),Mt(i.b,e.b,n),Mt(i.a,e.a,n))},array:function(i,e,n){return i.map((o,c)=>Mt(o,e[c],n))}});const Gl=.95047,ga=1.08883,Zl=4/29,ql=6/29,ya=3*ql*ql,ju=Math.PI/180,lp=180/Math.PI;function xa(i){return i>.008856451679035631?Math.pow(i,1/3):i/ya+Zl}function Wl(i){return i>ql?i*i*i:ya*(i-Zl)}function va(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function wa(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Xl(i){const e=wa(i.r),n=wa(i.g),o=wa(i.b),c=xa((.4124564*e+.3575761*n+.1804375*o)/Gl),d=xa((.2126729*e+.7151522*n+.072175*o)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-xa((.0193339*e+.119192*n+.9503041*o)/ga)),alpha:i.a}}function Hl(i){let e=(i.l+16)/116,n=isNaN(i.a)?e:e+i.a/500,o=isNaN(i.b)?e:e-i.b/200;return e=1*Wl(e),n=Gl*Wl(n),o=ga*Wl(o),new _t(va(3.2404542*n-1.5371385*e-.4985314*o),va(-.969266*n+1.8760108*e+.041556*o),va(.0556434*n-.2040259*e+1.0572252*o),i.alpha)}function cp(i,e,n){const o=e-i;return i+n*(o>180||o<-180?o-360*Math.round(o/360):o)}const To={forward:Xl,reverse:Hl,interpolate:function(i,e,n){return{l:Mt(i.l,e.l,n),a:Mt(i.a,e.a,n),b:Mt(i.b,e.b,n),alpha:Mt(i.alpha,e.alpha,n)}}},Eo={forward:function(i){const{l:e,a:n,b:o}=Xl(i),c=Math.atan2(o,n)*lp;return{h:c<0?c+360:c,c:Math.sqrt(n*n+o*o),l:e,alpha:i.a}},reverse:function(i){const e=i.h*ju,n=i.c;return Hl({l:i.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:i.alpha})},interpolate:function(i,e,n){return{h:cp(i.h,e.h,n),c:Mt(i.c,e.c,n),l:Mt(i.l,e.l,n),alpha:Mt(i.alpha,e.alpha,n)}}};var $u=Object.freeze({__proto__:null,lab:To,hcl:Eo});class cn{constructor(e,n,o,c,d){this.type=e,this.operator=n,this.interpolation=o,this.input=c,this.labels=[],this.outputs=[];for(const[p,g]of d)this.labels.push(p),this.outputs.push(g)}static interpolationFactor(e,n,o,c){let d=0;if(e.name==="exponential")d=Yl(n,e.base,o,c);else if(e.name==="linear")d=Yl(n,1,o,c);else if(e.name==="cubic-bezier"){const p=e.controlPoints;d=new pe(p[0],p[1],p[2],p[3]).solve(Yl(n,1,o,c))}return d}static parse(e,n){let[o,c,d,...p]=e;if(!Array.isArray(c)||c.length===0)return n.error("Expected an interpolation type expression.",1);if(c[0]==="linear")c={name:"linear"};else if(c[0]==="exponential"){const w=c[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:w}}else{if(c[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const w=c.slice(1);if(w.length!==4||w.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(d=n.parse(d,2,Ve),!d)return null;const g=[];let y=null;o==="interpolate-hcl"||o==="interpolate-lab"?y=zn:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let w=0;w<p.length;w+=2){const E=p[w],C=p[w+1],k=w+3,z=w+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(g.length&&g[g.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const O=n.parse(C,z,y);if(!O)return null;y=y||O.type,g.push([E,O])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new cn(y,o,c,d,g):n.error(`Type ${Yt(y)} is not interpolatable.`)}evaluate(e){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(e);const c=this.input.evaluate(e);if(c<=n[0])return o[0].evaluate(e);const d=n.length;if(c>=n[d-1])return o[d-1].evaluate(e);const p=_a(n,c),g=cn.interpolationFactor(this.interpolation,c,n[p],n[p+1]),y=o[p].evaluate(e),w=o[p+1].evaluate(e);return this.operator==="interpolate"?bs[this.type.kind.toLowerCase()](y,w,g):this.operator==="interpolate-hcl"?Eo.reverse(Eo.interpolate(Eo.forward(y),Eo.forward(w),g)):To.reverse(To.interpolate(To.forward(y),To.forward(w),g))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let o=0;o<this.labels.length;o++)n.push(this.labels[o],this.outputs[o].serialize());return n}}function Yl(i,e,n,o){const c=o-n,d=i-n;return c===0?0:e===1?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}class ba{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let o=null;const c=n.expectedType;c&&c.kind!=="value"&&(o=c);const d=[];for(const g of e.slice(1)){const y=n.parse(g,1+d.length,o,void 0,{typeAnnotation:"omit"});if(!y)return null;o=o||y.type,d.push(y)}const p=c&&d.some(g=>go(c,g.type));return new ba(p?xt:o,d)}evaluate(e){let n,o=null,c=0;for(const d of this.args)if(c++,o=d.evaluate(e),o&&o instanceof an&&!o.available&&(n||(n=o.name),o=null,c===this.args.length&&(o=n)),o!==null)break;return o}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Ta{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const o=[];for(let d=1;d<e.length-1;d+=2){const p=e[d];if(typeof p!="string")return n.error(`Expected string, but found ${typeof p} instead.`,d);if(/[^a-zA-Z0-9_]/.test(p))return n.error("Variable names must contain only alphanumeric characters or '_'.",d);const g=n.parse(e[d+1],d+1);if(!g)return null;o.push([p,g])}const c=n.parse(e[e.length-1],e.length-1,n.expectedType,o);return c?new Ta(o,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,o]of this.bindings)e.push(n,o.serialize());return e.push(this.result.serialize()),e}}class Ea{constructor(e,n,o){this.type=e,this.index=n,this.input=o}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,Ve),c=n.parse(e[2],2,sn(n.expectedType||xt));return o&&c?new Ea(c.type.itemType,o,c):null}evaluate(e){const n=this.index.evaluate(e),o=this.input.evaluate(e);if(n<0)throw new Si(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new Si(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new Si(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Kl{constructor(e,n){this.type=mt,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,xt),c=n.parse(e[2],2,xt);return o&&c?yo(o.type,[mt,yt,Ve,ir,xt])?new Kl(o,c):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(o.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!o)return!1;if(!gs(n,["boolean","string","number","null"]))throw new Si(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(fi(n))} instead.`);if(!gs(o,["string","array"]))throw new Si(`Expected second argument to be of type array or string, but found ${Yt(fi(o))} instead.`);return o.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Sa{constructor(e,n,o){this.type=Ve,this.needle=e,this.haystack=n,this.fromIndex=o}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,xt),c=n.parse(e[2],2,xt);if(!o||!c)return null;if(!yo(o.type,[mt,yt,Ve,ir,xt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(o.type)} instead`);if(e.length===4){const d=n.parse(e[3],3,Ve);return d?new Sa(o,c,d):null}return new Sa(o,c)}evaluate(e){const n=this.needle.evaluate(e),o=this.haystack.evaluate(e);if(!gs(n,["boolean","string","number","null"]))throw new Si(`Expected first argument to be of type boolean, string, number or null, but found ${Yt(fi(n))} instead.`);if(!gs(o,["string","array"]))throw new Si(`Expected second argument to be of type array or string, but found ${Yt(fi(o))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return o.indexOf(n,c)}return o.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ql{constructor(e,n,o,c,d,p){this.inputType=e,this.type=n,this.input=o,this.cases=c,this.outputs=d,this.otherwise=p}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let o,c;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);const d={},p=[];for(let w=2;w<e.length-1;w+=2){let E=e[w];const C=e[w+1];Array.isArray(E)||(E=[E]);const k=n.concat(w);if(E.length===0)return k.error("Expected at least one branch label.");for(const O of E){if(typeof O!="number"&&typeof O!="string")return k.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return k.error("Numeric branch labels must be integer values.");if(o){if(k.checkSubtype(o,fi(O)))return null}else o=fi(O);if(d[String(O)]!==void 0)return k.error("Branch labels must be unique.");d[String(O)]=p.length}const z=n.parse(C,w,c);if(!z)return null;c=c||z.type,p.push(z)}const g=n.parse(e[1],1,xt);if(!g)return null;const y=n.parse(e[e.length-1],e.length-1,c);return y?g.type.kind!=="value"&&n.concat(1).checkSubtype(o,g.type)?null:new Ql(o,c,g,d,p,y):null}evaluate(e){const n=this.input.evaluate(e);return(fi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),o=[],c={};for(const p of n){const g=c[this.cases[p]];g===void 0?(c[this.cases[p]]=o.length,o.push([this.cases[p],[p]])):o[g][1].push(p)}const d=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,g]of o)e.push(g.length===1?d(g[0]):g.map(d)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class Ca{constructor(e,n,o){this.type=e,this.branches=n,this.otherwise=o}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const c=[];for(let p=1;p<e.length-1;p+=2){const g=n.parse(e[p],p,mt);if(!g)return null;const y=n.parse(e[p+1],p+1,o);if(!y)return null;c.push([g,y]),o=o||y.type}const d=n.parse(e[e.length-1],e.length-1,o);return d?new Ca(o,c,d):null}evaluate(e){for(const[n,o]of this.branches)if(n.evaluate(e))return o.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,o]of this.branches)e(n),e(o);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Ts{constructor(e,n,o,c){this.type=e,this.input=n,this.beginIndex=o,this.endIndex=c}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const o=n.parse(e[1],1,xt),c=n.parse(e[2],2,Ve);if(!o||!c)return null;if(!yo(o.type,[sn(xt),yt,xt]))return n.error(`Expected first argument to be of type array or string, but found ${Yt(o.type)} instead`);if(e.length===4){const d=n.parse(e[3],3,Ve);return d?new Ts(o.type,o,c,d):null}return new Ts(o.type,o,c)}evaluate(e){const n=this.input.evaluate(e),o=this.beginIndex.evaluate(e);if(!gs(n,["string","array"]))throw new Si(`Expected first argument to be of type array or string, but found ${Yt(fi(n))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return n.slice(o,c)}return n.slice(o)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Gu(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Jl(i,e,n,o){return o.compare(e,n)===0}function So(i,e,n){const o=i!=="=="&&i!=="!=";return class Mv{constructor(d,p,g){this.type=mt,this.lhs=d,this.rhs=p,this.collator=g,this.hasUntypedArgument=d.type.kind==="value"||p.type.kind==="value"}static parse(d,p){if(d.length!==3&&d.length!==4)return p.error("Expected two or three arguments.");const g=d[0];let y=p.parse(d[1],1,xt);if(!y)return null;if(!Gu(g,y.type))return p.concat(1).error(`"${g}" comparisons are not supported for type '${Yt(y.type)}'.`);let w=p.parse(d[2],2,xt);if(!w)return null;if(!Gu(g,w.type))return p.concat(2).error(`"${g}" comparisons are not supported for type '${Yt(w.type)}'.`);if(y.type.kind!==w.type.kind&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error(`Cannot compare types '${Yt(y.type)}' and '${Yt(w.type)}'.`);o&&(y.type.kind==="value"&&w.type.kind!=="value"?y=new Pn(w.type,[y]):y.type.kind!=="value"&&w.type.kind==="value"&&(w=new Pn(y.type,[w])));let E=null;if(d.length===4){if(y.type.kind!=="string"&&w.type.kind!=="string"&&y.type.kind!=="value"&&w.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(E=p.parse(d[3],3,ca),!E)return null}return new Mv(y,w,E)}evaluate(d){const p=this.lhs.evaluate(d),g=this.rhs.evaluate(d);if(o&&this.hasUntypedArgument){const y=fi(p),w=fi(g);if(y.kind!==w.kind||y.kind!=="string"&&y.kind!=="number")throw new Si(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${y.kind}, ${w.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const y=fi(p),w=fi(g);if(y.kind!=="string"||w.kind!=="string")return e(d,p,g)}return this.collator?n(d,p,g,this.collator.evaluate(d)):e(d,p,g)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[i];return this.eachChild(p=>{d.push(p.serialize())}),d}}}const up=So("==",function(i,e,n){return e===n},Jl),Zu=So("!=",function(i,e,n){return e!==n},function(i,e,n,o){return!Jl(0,e,n,o)}),qu=So("<",function(i,e,n){return e<n},function(i,e,n,o){return o.compare(e,n)<0}),hp=So(">",function(i,e,n){return e>n},function(i,e,n,o){return o.compare(e,n)>0}),dp=So("<=",function(i,e,n){return e<=n},function(i,e,n,o){return o.compare(e,n)<=0}),pp=So(">=",function(i,e,n){return e>=n},function(i,e,n,o){return o.compare(e,n)>=0});class ec{constructor(e,n,o,c,d){this.type=yt,this.number=e,this.locale=n,this.currency=o,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const o=n.parse(e[1],1,Ve);if(!o)return null;const c=e[2];if(typeof c!="object"||Array.isArray(c))return n.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=n.parse(c.locale,1,yt),!d))return null;let p=null;if(c.currency&&(p=n.parse(c.currency,1,yt),!p))return null;let g=null;if(c["min-fraction-digits"]&&(g=n.parse(c["min-fraction-digits"],1,Ve),!g))return null;let y=null;return c["max-fraction-digits"]&&(y=n.parse(c["max-fraction-digits"],1,Ve),!y)?null:new ec(o,d,p,g,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Co{constructor(e){this.type=Ve,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const o=n.parse(e[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Yt(o.type)} instead.`):new Co(o):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new Si(`Expected value to be of type string or array, but found ${Yt(fi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Zr={"==":up,"!=":Zu,">":hp,"<":qu,">=":pp,"<=":dp,array:Pn,at:Ea,boolean:Pn,case:Ca,coalesce:ba,collator:Gr,format:ys,image:da,in:Kl,"index-of":Sa,interpolate:cn,"interpolate-hcl":cn,"interpolate-lab":cn,length:Co,let:Ta,literal:rr,match:Ql,number:Pn,"number-format":ec,object:Pn,slice:Ts,step:bo,string:Pn,"to-boolean":br,"to-color":br,"to-number":br,"to-string":br,var:Ct,within:Ln};function tc(i,[e,n,o,c]){e=e.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const d=c?c.evaluate(i):1,p=Ou(e,n,o,d);if(p)throw new Si(p);return new _t(e/255*d,n/255*d,o/255*d,d)}function Wu(i,e){return i in e}function ic(i,e){const n=e[i];return n===void 0?null:n}function qr(i){return{type:i}}function nc(i){return{result:"success",value:i}}function Wr(i){return{result:"error",value:i}}function Xr(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function ka(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function rc(i){return!!i.expression&&i.expression.interpolated}function zt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ia(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function fp(i){return i}function Xu(i,e){const n=e.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",c=o||!(o||i.property!==void 0),d=i.type||(rc(e)?"exponential":"interval");if(n&&((i=ft({},i)).stops&&(i.stops=i.stops.map(w=>[w[0],_t.parse(w[1])])),i.default=_t.parse(i.default?i.default:e.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!$u[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let p,g,y;if(d==="exponential")p=Ss;else if(d==="interval")p=Yu;else if(d==="categorical"){p=Hu,g=Object.create(null);for(const w of i.stops)g[w[0]]=w[1];y=typeof i.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);p=mp}if(o){const w={},E=[];for(let z=0;z<i.stops.length;z++){const O=i.stops[z],U=O[0].zoom;w[U]===void 0&&(w[U]={zoom:U,type:i.type,property:i.property,default:i.default,stops:[]},E.push(U)),w[U].stops.push([O[0].value,O[1]])}const C=[];for(const z of E)C.push([w[z].zoom,Xu(w[z],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:cn.interpolationFactor.bind(void 0,k),zoomStops:C.map(z=>z[0]),evaluate:({zoom:z},O)=>Ss({stops:C,base:i.base},e,z).evaluate(z,O)}}if(c){const w=d==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:cn.interpolationFactor.bind(void 0,w),zoomStops:i.stops.map(E=>E[0]),evaluate:({zoom:E})=>p(i,e,E,g,y)}}return{kind:"source",evaluate(w,E){const C=E&&E.properties?E.properties[i.property]:void 0;return C===void 0?Es(i.default,e.default):p(i,e,C,g,y)}}}function Es(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Hu(i,e,n,o,c){return Es(typeof n===c?o[n]:void 0,i.default,e.default)}function Yu(i,e,n){if(zt(n)!=="number")return Es(i.default,e.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const c=_a(i.stops.map(d=>d[0]),n);return i.stops[c][1]}function Ss(i,e,n){const o=i.base!==void 0?i.base:1;if(zt(n)!=="number")return Es(i.default,e.default);const c=i.stops.length;if(c===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[c-1][0])return i.stops[c-1][1];const d=_a(i.stops.map(E=>E[0]),n),p=function(E,C,k,z){const O=z-k,U=E-k;return O===0?0:C===1?U/O:(Math.pow(C,U)-1)/(Math.pow(C,O)-1)}(n,o,i.stops[d][0],i.stops[d+1][0]),g=i.stops[d][1],y=i.stops[d+1][1];let w=bs[e.type]||fp;if(i.colorSpace&&i.colorSpace!=="rgb"){const E=$u[i.colorSpace];w=(C,k)=>E.reverse(E.interpolate(E.forward(C),E.forward(k),p))}return typeof g.evaluate=="function"?{evaluate(...E){const C=g.evaluate.apply(void 0,E),k=y.evaluate.apply(void 0,E);if(C!==void 0&&k!==void 0)return w(C,k,p)}}:w(g,y,p)}function mp(i,e,n){return e.type==="color"?n=_t.parse(n):e.type==="formatted"?n=vi.fromString(n.toString()):e.type==="resolvedImage"?n=an.fromString(n.toString()):zt(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Es(n,i.default,e.default)}ln.register(Zr,{error:[{kind:"error"},[yt],(i,[e])=>{throw new Si(e.evaluate(i))}],typeof:[yt,[xt],(i,[e])=>Yt(fi(e.evaluate(i)))],"to-rgba":[sn(Ve,4),[zn],(i,[e])=>e.evaluate(i).toArray()],rgb:[zn,[Ve,Ve,Ve],tc],rgba:[zn,[Ve,Ve,Ve,Ve],tc],has:{type:mt,overloads:[[[yt],(i,[e])=>Wu(e.evaluate(i),i.properties())],[[yt,Ei],(i,[e,n])=>Wu(e.evaluate(i),n.evaluate(i))]]},get:{type:xt,overloads:[[[yt],(i,[e])=>ic(e.evaluate(i),i.properties())],[[yt,Ei],(i,[e,n])=>ic(e.evaluate(i),n.evaluate(i))]]},"feature-state":[xt,[yt],(i,[e])=>ic(e.evaluate(i),i.featureState||{})],properties:[Ei,[],i=>i.properties()],"geometry-type":[yt,[],i=>i.geometryType()],id:[xt,[],i=>i.id()],zoom:[Ve,[],i=>i.globals.zoom],"heatmap-density":[Ve,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ve,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[Ve,[],i=>i.globals.skyRadialProgress||0],accumulated:[xt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ve,qr(Ve),(i,e)=>{let n=0;for(const o of e)n+=o.evaluate(i);return n}],"*":[Ve,qr(Ve),(i,e)=>{let n=1;for(const o of e)n*=o.evaluate(i);return n}],"-":{type:Ve,overloads:[[[Ve,Ve],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Ve],(i,[e])=>-e.evaluate(i)]]},"/":[Ve,[Ve,Ve],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Ve,[Ve,Ve],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Ve,[],()=>Math.LN2],pi:[Ve,[],()=>Math.PI],e:[Ve,[],()=>Math.E],"^":[Ve,[Ve,Ve],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Ve,[Ve],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ve,[Ve],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ve,[Ve],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ve,[Ve],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ve,[Ve],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ve,[Ve],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ve,[Ve],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ve,[Ve],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ve,[Ve],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ve,[Ve],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ve,qr(Ve),(i,e)=>Math.min(...e.map(n=>n.evaluate(i)))],max:[Ve,qr(Ve),(i,e)=>Math.max(...e.map(n=>n.evaluate(i)))],abs:[Ve,[Ve],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ve,[Ve],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ve,[Ve],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ve,[Ve],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[mt,[yt,xt],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[mt,[xt],(i,[e])=>i.id()===e.value],"filter-type-==":[mt,[yt],(i,[e])=>i.geometryType()===e.value],"filter-<":[mt,[yt,xt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o<c}],"filter-id-<":[mt,[xt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<o}],"filter->":[mt,[yt,xt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o>c}],"filter-id->":[mt,[xt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>o}],"filter-<=":[mt,[yt,xt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o<=c}],"filter-id-<=":[mt,[xt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n<=o}],"filter->=":[mt,[yt,xt],(i,[e,n])=>{const o=i.properties()[e.value],c=n.value;return typeof o==typeof c&&o>=c}],"filter-id->=":[mt,[xt],(i,[e])=>{const n=i.id(),o=e.value;return typeof n==typeof o&&n>=o}],"filter-has":[mt,[xt],(i,[e])=>e.value in i.properties()],"filter-has-id":[mt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[mt,[sn(yt)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[mt,[sn(xt)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[mt,[yt,sn(xt)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[mt,[yt,sn(xt)],(i,[e,n])=>function(o,c,d,p){for(;d<=p;){const g=d+p>>1;if(c[g]===o)return!0;c[g]>o?p=g-1:d=g+1}return!1}(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:mt,overloads:[[[mt,mt],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[qr(mt),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:mt,overloads:[[[mt,mt],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[qr(mt),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[mt,[mt],(i,[e])=>!e.evaluate(i)],"is-supported-script":[mt,[yt],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[yt,[yt],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[yt,[yt],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[yt,qr(xt),(i,e)=>e.map(n=>xo(n.evaluate(i))).join("")],"resolved-locale":[yt,[ca],(i,[e])=>e.evaluate(i).resolvedLocale()]});class oc{constructor(e,n){this.expression=e,this._warningHistory={},this._evaluator=new Uu,this._defaultValue=n?function(o){return o.type==="color"&&Ia(o.default)?new _t(0,0,0,0):o.type==="color"?_t.parse(o.default)||null:o.default===void 0?null:o.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,o,c,d,p){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p,this.expression.evaluate(this._evaluator)}evaluate(e,n,o,c,d,p){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=p||null;try{const g=this.expression.evaluate(this._evaluator);if(g==null||typeof g=="number"&&g!=g)return this._defaultValue;if(this._enumValues&&!(g in this._enumValues))throw new Si(`Expected value to be one of ${Object.keys(this._enumValues).map(y=>JSON.stringify(y)).join(", ")}, but found ${JSON.stringify(g)} instead.`);return g}catch(g){return this._warningHistory[g.message]||(this._warningHistory[g.message]=!0,typeof console<"u"&&console.warn(g.message)),this._defaultValue}}}function Aa(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Zr}function Rn(i,e){const n=new ma(Zr,[],e?function(c){const d={color:zn,string:yt,number:Ve,enum:yt,boolean:mt,formatted:_s,resolvedImage:_o};return c.type==="array"?sn(d[c.value]||xt,c.length):d[c.type]}(e):void 0),o=n.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?nc(new oc(o,e)):Wr(n.errors)}class Ma{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!wo(n.expression)}evaluateWithoutErrorHandling(e,n,o,c,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,d,p)}evaluate(e,n,o,c,d,p){return this._styleExpression.evaluate(e,n,o,c,d,p)}}class Er{constructor(e,n,o,c){this.kind=e,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!wo(n.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,n,o,c,d,p){return this._styleExpression.evaluateWithoutErrorHandling(e,n,o,c,d,p)}evaluate(e,n,o,c,d,p){return this._styleExpression.evaluate(e,n,o,c,d,p)}interpolationFactor(e,n,o){return this.interpolationType?cn.interpolationFactor(this.interpolationType,e,n,o):0}}function sc(i,e){if((i=Rn(i,e)).result==="error")return i;const n=i.value.expression,o=ws(n);if(!o&&!Xr(e))return Wr([new Tt("","data expressions not supported")]);const c=fa(n,["zoom"]);if(!c&&!ka(e))return Wr([new Tt("","zoom expressions not supported")]);const d=ko(n);return d||c?d instanceof Tt?Wr([d]):d instanceof cn&&!rc(e)?Wr([new Tt("",'"interpolate" expressions cannot be used with this property')]):nc(d?new Er(o?"camera":"composite",i.value,d.labels,d instanceof cn?d.interpolation:void 0):new Ma(o?"constant":"source",i.value)):Wr([new Tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class za{constructor(e,n){this._parameters=e,this._specification=n,ft(this,Xu(this._parameters,this._specification))}static deserialize(e){return new za(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ko(i){let e=null;if(i instanceof Ta)e=ko(i.result);else if(i instanceof ba){for(const n of i.args)if(e=ko(n),e)break}else(i instanceof bo||i instanceof cn)&&i.input instanceof ln&&i.input.name==="zoom"&&(e=i);return e instanceof Tt||i.eachChild(n=>{const o=ko(n);o instanceof Tt?e=o:!e&&o?e=new Tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&o&&e!==o&&(e=new Tt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ui(i){const e=i.key,n=i.value,o=i.valueSpec||{},c=i.objectElementValidators||{},d=i.style,p=i.styleSpec;let g=[];const y=zt(n);if(y!=="object")return[new be(e,n,`object expected, ${y} found`)];for(const w in n){const E=w.split(".")[0],C=o[E]||o["*"];let k;if(c[E])k=c[E];else if(o[E])k=Ni;else if(c["*"])k=c["*"];else{if(!o["*"]){g.push(new be(e,n[w],`unknown property "${w}"`));continue}k=Ni}g=g.concat(k({key:(e&&`${e}.`)+w,value:n[w],valueSpec:C,style:d,styleSpec:p,object:n,objectKey:w},n))}for(const w in o)c[w]||o[w].required&&o[w].default===void 0&&n[w]===void 0&&g.push(new be(e,n,`missing required property "${w}"`));return g}function ac(i){const e=i.value,n=i.valueSpec,o=i.style,c=i.styleSpec,d=i.key,p=i.arrayElementValidator||Ni;if(zt(e)!=="array")return[new be(d,e,`array expected, ${zt(e)} found`)];if(n.length&&e.length!==n.length)return[new be(d,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new be(d,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let g={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum};c.$version<7&&(g.function=n.function),zt(n.value)==="object"&&(g=n.value);let y=[];for(let w=0;w<e.length;w++)y=y.concat(p({array:e,arrayIndex:w,value:e[w],valueSpec:g,style:o,styleSpec:c,key:`${d}[${w}]`}));return y}function Pa(i){const e=i.key,n=i.value,o=i.valueSpec;let c=zt(n);if(c==="number"&&n!=n&&(c="NaN"),c!=="number")return[new be(e,n,`number expected, ${c} found`)];if("minimum"in o){let d=o.minimum;if(zt(o.minimum)==="array"&&(d=o.minimum[i.arrayIndex]),n<d)return[new be(e,n,`${n} is less than the minimum value ${d}`)]}if("maximum"in o){let d=o.maximum;if(zt(o.maximum)==="array"&&(d=o.maximum[i.arrayIndex]),n>d)return[new be(e,n,`${n} is greater than the maximum value ${d}`)]}return[]}function lc(i){const e=i.valueSpec,n=dt(i.value.type);let o,c,d,p={};const g=n!=="categorical"&&i.value.property===void 0,y=!g,w=zt(i.value.stops)==="array"&&zt(i.value.stops[0])==="array"&&zt(i.value.stops[0][0])==="object",E=Ui({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(z){if(n==="identity")return[new be(z.key,z.value,'identity function may not have a "stops" property')];let O=[];const U=z.value;return O=O.concat(ac({key:z.key,value:U,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:C})),zt(U)==="array"&&U.length===0&&O.push(new be(z.key,U,"array must have at least one stop")),O},default:function(z){return Ni({key:z.key,value:z.value,valueSpec:e,style:z.style,styleSpec:z.styleSpec})}}});return n==="identity"&&g&&E.push(new be(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||E.push(new be(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!rc(i.valueSpec)&&E.push(new be(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(y&&!Xr(i.valueSpec)?E.push(new be(i.key,i.value,"property functions not supported")):g&&!ka(i.valueSpec)&&E.push(new be(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!w||i.value.property!==void 0||E.push(new be(i.key,i.value,'"property" property is required')),E;function C(z){let O=[];const U=z.value,W=z.key;if(zt(U)!=="array")return[new be(W,U,`array expected, ${zt(U)} found`)];if(U.length!==2)return[new be(W,U,`array length 2 expected, length ${U.length} found`)];if(w){if(zt(U[0])!=="object")return[new be(W,U,`object expected, ${zt(U[0])} found`)];if(U[0].zoom===void 0)return[new be(W,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new be(W,U,"object stop key must have value")];if(d&&d>dt(U[0].zoom))return[new be(W,U[0].zoom,"stop zoom values must appear in ascending order")];dt(U[0].zoom)!==d&&(d=dt(U[0].zoom),c=void 0,p={}),O=O.concat(Ui({key:`${W}[0]`,value:U[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Pa,value:k}}))}else O=O.concat(k({key:`${W}[0]`,value:U[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},U));return Aa(At(U[1]))?O.concat([new be(`${W}[1]`,U[1],"expressions are not allowed in function stops.")]):O.concat(Ni({key:`${W}[1]`,value:U[1],valueSpec:e,style:z.style,styleSpec:z.styleSpec}))}function k(z,O){const U=zt(z.value),W=dt(z.value),Q=z.value!==null?z.value:O;if(o){if(U!==o)return[new be(z.key,Q,`${U} stop domain type must match previous stop domain type ${o}`)]}else o=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new be(z.key,Q,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&n!=="categorical"){let se=`number expected, ${U} found`;return Xr(e)&&n===void 0&&(se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new be(z.key,Q,se)]}return n!=="categorical"||U!=="number"||isFinite(W)&&Math.floor(W)===W?n!=="categorical"&&U==="number"&&c!==void 0&&W<c?[new be(z.key,Q,"stop domain values must appear in ascending order")]:(c=W,n==="categorical"&&W in p?[new be(z.key,Q,"stop domain values must be unique")]:(p[W]=!0,[])):[new be(z.key,Q,`integer expected, found ${W}`)]}}function Sr(i){const e=(i.expressionContext==="property"?sc:Rn)(At(i.value),i.valueSpec);if(e.result==="error")return e.value.map(o=>new be(`${i.key}${o.key}`,i.value,o.message));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new be(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!wo(n))return[new be(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!wo(n))return[new be(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!fa(n,["zoom","feature-state"]))return[new be(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ws(n))return[new be(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Io(i){const e=i.key,n=i.value,o=i.valueSpec,c=[];return Array.isArray(o.values)?o.values.indexOf(dt(n))===-1&&c.push(new be(e,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(dt(n))===-1&&c.push(new be(e,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),c}function Da(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Da(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const cc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ao(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Da(i)||(i=Hr(i));const e=Rn(i,cc);if(e.result==="error")throw new Error(e.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,c)=>e.value.evaluate(n,o,{},c),needGeometry:Qu(i)}}function Ku(i,e){return i<e?-1:i>e?1:0}function Qu(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let e=1;e<i.length;e++)if(Qu(i[e]))return!0;return!1}function Hr(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?uc(i[1],i[2],"=="):e==="!="?La(uc(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?uc(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(Hr))):e==="all"?["all"].concat(i.slice(1).map(Hr)):e==="none"?["all"].concat(i.slice(1).map(Hr).map(La)):e==="in"?Ju(i[1],i.slice(2)):e==="!in"?La(Ju(i[1],i.slice(2))):e==="has"?eh(i[1]):e==="!has"?La(eh(i[1])):e!=="within"||i;var n}function uc(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Ju(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",i,["literal",e.sort(Ku)]]:["filter-in-small",i,["literal",e]]}}function eh(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function La(i){return["!",i]}function hc(i){return Da(At(i.value))?Sr(ft({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cs(i)}function Cs(i){const e=i.value,n=i.key;if(zt(e)!=="array")return[new be(n,e,`array expected, ${zt(e)} found`)];const o=i.styleSpec;let c,d=[];if(e.length<1)return[new be(n,e,"filter array must have at least 1 element")];switch(d=d.concat(Io({key:`${n}[0]`,value:e[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),dt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&dt(e[1])==="$type"&&d.push(new be(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&d.push(new be(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=zt(e[1]),c!=="string"&&d.push(new be(`${n}[1]`,e[1],`string expected, ${c} found`)));for(let p=2;p<e.length;p++)c=zt(e[p]),dt(e[1])==="$type"?d=d.concat(Io({key:`${n}[${p}]`,value:e[p],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):c!=="string"&&c!=="number"&&c!=="boolean"&&d.push(new be(`${n}[${p}]`,e[p],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let p=1;p<e.length;p++)d=d.concat(Cs({key:`${n}[${p}]`,value:e[p],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":c=zt(e[1]),e.length!==2?d.push(new be(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="string"&&d.push(new be(`${n}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=zt(e[1]),e.length!==2?d.push(new be(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):c!=="object"&&d.push(new be(`${n}[1]`,e[1],`object expected, ${c} found`))}return d}function ks(i,e){const n=i.key,o=i.style,c=i.styleSpec,d=i.value,p=i.objectKey,g=c[`${e}_${i.layerType}`];if(!g)return[];const y=p.match(/^(.*)-transition$/);if(e==="paint"&&y&&g[y[1]]&&g[y[1]].transition)return Ni({key:n,value:d,valueSpec:c.transition,style:o,styleSpec:c});const w=i.valueSpec||g[p];if(!w)return[new be(n,d,`unknown property "${p}"`)];let E;if(zt(d)==="string"&&Xr(w)&&!w.tokens&&(E=/^{([^}]+)}$/.exec(d)))return[new be(n,d,`"${p}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const C=[];return i.layerType==="symbol"&&(p==="text-field"&&o&&!o.glyphs&&C.push(new be(n,d,'use of "text-field" requires a style "glyphs" property')),p==="text-font"&&Ia(At(d))&&dt(d.type)==="identity"&&C.push(new be(n,d,'"text-font" does not support identity functions'))),C.concat(Ni({key:i.key,value:d,valueSpec:w,style:o,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:p}))}function qi(i){return ks(i,"paint")}function Is(i){return ks(i,"layout")}function th(i){let e=[];const n=i.value,o=i.key,c=i.style,d=i.styleSpec;n.type||n.ref||e.push(new be(o,n,'either "type" or "ref" is required'));let p=dt(n.type);const g=dt(n.ref);if(n.id){const y=dt(n.id);for(let w=0;w<i.arrayIndex;w++){const E=c.layers[w];dt(E.id)===y&&e.push(new be(o,n.id,`duplicate layer id "${n.id}", previously used at line ${E.id.__line__}`))}}if("ref"in n){let y;["type","source","source-layer","filter","layout"].forEach(w=>{w in n&&e.push(new be(o,n[w],`"${w}" is prohibited for ref layers`))}),c.layers.forEach(w=>{dt(w.id)===g&&(y=w)}),y?y.ref?e.push(new be(o,n.ref,"ref cannot reference another ref layer")):p=dt(y.type):e.push(new be(o,n.ref,`ref layer "${g}" not found`))}else if(p!=="background"&&p!=="sky")if(n.source){const y=c.sources&&c.sources[n.source],w=y&&dt(y.type);y?w==="vector"&&p==="raster"?e.push(new be(o,n.source,`layer "${n.id}" requires a raster source`)):w==="raster"&&p!=="raster"?e.push(new be(o,n.source,`layer "${n.id}" requires a vector source`)):w!=="vector"||n["source-layer"]?w==="raster-dem"&&p!=="hillshade"?e.push(new be(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):p!=="line"||!n.paint||!n.paint["line-gradient"]||w==="geojson"&&y.lineMetrics||e.push(new be(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new be(o,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new be(o,n.source,`source "${n.source}" not found`))}else e.push(new be(o,n,'missing required property "source"'));return e=e.concat(Ui({key:o,value:n,valueSpec:d.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ni({key:`${o}.type`,value:n.type,valueSpec:d.layer.type,style:i.style,styleSpec:i.styleSpec,object:n,objectKey:"type"}),filter:hc,layout:y=>Ui({layer:n,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":w=>Is(ft({layerType:p},w))}}),paint:y=>Ui({layer:n,key:y.key,value:y.value,style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":w=>qi(ft({layerType:p},w))}})}})),e}function Mo(i){const e=i.value,n=i.key,o=zt(e);return o!=="string"?[new be(n,e,`string expected, ${o} found`)]:[]}const ih={promoteId:function({key:i,value:e}){if(zt(e)==="string")return Mo({key:i,value:e});{const n=[];for(const o in e)n.push(...Mo({key:`${i}.${o}`,value:e[o]}));return n}}};function nh(i){const e=i.value,n=i.key,o=i.styleSpec,c=i.style;if(!e.type)return[new be(n,e,'"type" is required')];const d=dt(e.type);let p;switch(d){case"vector":case"raster":case"raster-dem":return p=Ui({key:n,value:e,valueSpec:o[`source_${d.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:ih}),p;case"geojson":if(p=Ui({key:n,value:e,valueSpec:o.source_geojson,style:c,styleSpec:o,objectElementValidators:ih}),e.cluster)for(const g in e.clusterProperties){const[y,w]=e.clusterProperties[g],E=typeof y=="string"?[y,["accumulated"],["get",g]]:y;p.push(...Sr({key:`${n}.${g}.map`,value:w,expressionContext:"cluster-map"})),p.push(...Sr({key:`${n}.${g}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return p;case"video":return Ui({key:n,value:e,valueSpec:o.source_video,style:c,styleSpec:o});case"image":return Ui({key:n,value:e,valueSpec:o.source_image,style:c,styleSpec:o});case"canvas":return[new be(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Io({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:o})}}function Ra(i){const e=i.value,n=i.styleSpec,o=n.light,c=i.style;let d=[];const p=zt(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new be("light",e,`object expected, ${p} found`)]),d;for(const g in e){const y=g.match(/^(.*)-transition$/);d=d.concat(y&&o[y[1]]&&o[y[1]].transition?Ni({key:g,value:e[g],valueSpec:n.transition,style:c,styleSpec:n}):o[g]?Ni({key:g,value:e[g],valueSpec:o[g],style:c,styleSpec:n}):[new be(g,e[g],`unknown property "${g}"`)])}return d}function rh(i){const e=i.value,n=i.key,o=i.style,c=i.styleSpec,d=c.terrain;let p=[];const g=zt(e);if(e===void 0)return p;if(g!=="object")return p=p.concat([new be("terrain",e,`object expected, ${g} found`)]),p;for(const y in e){const w=y.match(/^(.*)-transition$/);p=p.concat(w&&d[w[1]]&&d[w[1]].transition?Ni({key:y,value:e[y],valueSpec:c.transition,style:o,styleSpec:c}):d[y]?Ni({key:y,value:e[y],valueSpec:d[y],style:o,styleSpec:c}):[new be(y,e[y],`unknown property "${y}"`)])}if(e.source){const y=o.sources&&o.sources[e.source],w=y&&dt(y.type);y?w!=="raster-dem"&&p.push(new be(n,e.source,`terrain cannot be used with a source of type ${w}, it only be used with a "raster-dem" source type`)):p.push(new be(n,e.source,`source "${e.source}" not found`))}else p.push(new be(n,e,'terrain is missing required property "source"'));return p}function Fa(i){const e=i.value,n=i.style,o=i.styleSpec,c=o.fog;let d=[];const p=zt(e);if(e===void 0)return d;if(p!=="object")return d=d.concat([new be("fog",e,`object expected, ${p} found`)]),d;for(const g in e){const y=g.match(/^(.*)-transition$/);d=d.concat(y&&c[y[1]]&&c[y[1]].transition?Ni({key:g,value:e[g],valueSpec:o.transition,style:n,styleSpec:o}):c[g]?Ni({key:g,value:e[g],valueSpec:c[g],style:n,styleSpec:o}):[new be(g,e[g],`unknown property "${g}"`)])}return d}const oh={"*":()=>[],array:ac,boolean:function(i){const e=i.value,n=i.key,o=zt(e);return o!=="boolean"?[new be(n,e,`boolean expected, ${o} found`)]:[]},number:Pa,color:function(i){const e=i.key,n=i.value,o=zt(n);return o!=="string"?[new be(e,n,`color expected, ${o} found`)]:Fl.parseCSSColor(n)===null?[new be(e,n,`color expected, "${n}" found`)]:[]},constants:st,enum:Io,filter:hc,function:lc,layer:th,object:Ui,source:nh,light:Ra,terrain:rh,fog:Fa,string:Mo,formatted:function(i){return Mo(i).length===0?[]:Sr(i)},resolvedImage:function(i){return Mo(i).length===0?[]:Sr(i)}};function Ni(i){const e=i.value,n=i.valueSpec,o=i.styleSpec;return n.expression&&Ia(dt(e))?lc(i):n.expression&&Aa(At(e))?Sr(i):n.type&&oh[n.type]?oh[n.type](i):Ui(ft({},i,{valueSpec:n.type?o[n.type]:n}))}function dc(i){const e=i.value,n=i.key,o=Mo(i);return o.length||(e.indexOf("{fontstack}")===-1&&o.push(new be(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&o.push(new be(n,e,'"glyphs" url must include a "{range}" token'))),o}function or(i,e=te){let n=[];return n=n.concat(Ni({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,objectElementValidators:{glyphs:dc,"*":()=>[]}})),i.constants&&(n=n.concat(st({key:"constants",value:i.constants,style:i,styleSpec:e}))),pc(n)}function pc(i){return[].concat(i).sort((e,n)=>e.line-n.line)}function sr(i){return function(...e){return pc(i.apply(this,e))}}or.source=sr(nh),or.light=sr(Ra),or.terrain=sr(rh),or.fog=sr(Fa),or.layer=sr(th),or.filter=sr(hc),or.paintProperty=sr(qi),or.layoutProperty=sr(Is);const zo=or,fc=zo.light,Ba=zo.fog,sh=zo.paintProperty,_p=zo.layoutProperty;function mc(i,e){let n=!1;if(e&&e.length)for(const o of e)i.fire(new ze(new Error(o.message))),n=!0;return n}var As=gn;function gn(i,e,n){var o=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var c=new Int32Array(this.arrayBuffer);i=c[0],this.d=(e=c[1])+2*(n=c[2]);for(var d=0;d<this.d*this.d;d++){var p=c[3+d],g=c[3+d+1];o.push(p===g?null:c.subarray(p,g))}var y=c[3+o.length+1];this.keys=c.subarray(c[3+o.length],y),this.bboxes=c.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)o.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=i,this.padding=n,this.scale=e/i,this.uid=0;var E=n/e*i;this.min=-E,this.max=i+E}gn.prototype.insert=function(i,e,n,o,c){this._forEachCell(e,n,o,c,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c)},gn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},gn.prototype._insertCell=function(i,e,n,o,c,d){this.cells[c].push(d)},gn.prototype.query=function(i,e,n,o,c){var d=this.min,p=this.max;if(i<=d&&e<=d&&p<=n&&p<=o&&!c)return Array.prototype.slice.call(this.keys);var g=[];return this._forEachCell(i,e,n,o,this._queryCell,g,{},c),g},gn.prototype._queryCell=function(i,e,n,o,c,d,p,g){var y=this.cells[c];if(y!==null)for(var w=this.keys,E=this.bboxes,C=0;C<y.length;C++){var k=y[C];if(p[k]===void 0){var z=4*k;(g?g(E[z+0],E[z+1],E[z+2],E[z+3]):i<=E[z+2]&&e<=E[z+3]&&n>=E[z+0]&&o>=E[z+1])?(p[k]=!0,d.push(w[k])):p[k]=!1}}},gn.prototype._forEachCell=function(i,e,n,o,c,d,p,g){for(var y=this._convertToCellCoord(i),w=this._convertToCellCoord(e),E=this._convertToCellCoord(n),C=this._convertToCellCoord(o),k=y;k<=E;k++)for(var z=w;z<=C;z++){var O=this.d*z+k;if((!g||g(this._convertFromCellCoord(k),this._convertFromCellCoord(z),this._convertFromCellCoord(k+1),this._convertFromCellCoord(z+1)))&&c.call(this,i,e,n,o,O,d,p,g))return}},gn.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},gn.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},gn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,e=3+this.cells.length+1+1,n=0,o=0;o<this.cells.length;o++)n+=this.cells[o].length;var c=new Int32Array(e+n+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=e,p=0;p<i.length;p++){var g=i[p];c[3+p]=d,c.set(g,d),d+=g.length}return c[3+i.length]=d,c.set(this.keys,d),c[3+i.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};const{ImageData:ah,ImageBitmap:lh}=Se,Ms={};function Xe(i,e,n={}){Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Ms[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Xe("Object",Object),As.serialize=function(i,e){const n=i.toArrayBuffer();return e&&e.push(n),{buffer:n}},As.deserialize=function(i){return new As(i.buffer)},Xe("Grid",As),Xe("Color",_t),Xe("Error",Error),Xe("ResolvedImage",an),Xe("StylePropertyFunction",za),Xe("StyleExpression",oc,{omit:["_evaluator"]}),Xe("ZoomDependentExpression",Er),Xe("ZoomConstantExpression",Ma),Xe("CompoundExpression",ln,{omit:["_evaluate"]});for(const i in Zr)Zr[i]._classRegistryKey||Xe(`Expression_${i}`,Zr[i]);function _c(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function ch(i){return lh&&i instanceof lh}function zs(i,e){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(_c(i)||ch(i))return e&&e.push(i),i;if(ArrayBuffer.isView(i)){const n=i;return e&&e.push(n.buffer),n}if(i instanceof ah)return e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const n=[];for(const o of i)n.push(zs(o,e));return n}if(typeof i=="object"){const n=i.constructor,o=n._classRegistryKey;if(!o)throw new Error("can't serialize object of unregistered class");const c=n.serialize?n.serialize(i,e):{};if(!n.serialize){for(const d in i){if(!i.hasOwnProperty(d)||Ms[o].omit.indexOf(d)>=0)continue;const p=i[d];c[d]=Ms[o].shallow.indexOf(d)>=0?p:zs(p,e)}i instanceof Error&&(c.message=i.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return o!=="Object"&&(c.$name=o),c}throw new Error("can't serialize object of type "+typeof i)}function Ps(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||_c(i)||ch(i)||ArrayBuffer.isView(i)||i instanceof ah)return i;if(Array.isArray(i))return i.map(Ps);if(typeof i=="object"){const e=i.$name||"Object",{klass:n}=Ms[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const c of Object.keys(i)){if(c==="$name")continue;const d=i[c];o[c]=Ms[e].shallow.indexOf(c)>=0?d:Ps(d)}return o}throw new Error("can't deserialize object of type "+typeof i)}class uh{constructor(){this.first=!0}update(e,n){const o=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=o,!0))}}const hh=i=>i>=1536&&i<=1791,dh=i=>i>=1872&&i<=1919,ph=i=>i>=2208&&i<=2303,Ds=i=>i>=11904&&i<=12031,fh=i=>i>=12032&&i<=12255,mh=i=>i>=12272&&i<=12287,Yr=i=>i>=12288&&i<=12351,gc=i=>i>=12352&&i<=12447,Oa=i=>i>=12448&&i<=12543,yc=i=>i>=12544&&i<=12591,xc=i=>i>=12704&&i<=12735,vc=i=>i>=12736&&i<=12783,wc=i=>i>=12784&&i<=12799,Ua=i=>i>=12800&&i<=13055,Na=i=>i>=13056&&i<=13311,_h=i=>i>=13312&&i<=19903,bc=i=>i>=19968&&i<=40959,Ls=i=>i>=40960&&i<=42127,gh=i=>i>=42128&&i<=42191,Kr=i=>i>=44032&&i<=55215,yh=i=>i>=63744&&i<=64255,Rs=i=>i>=64336&&i<=65023,xh=i=>i>=65040&&i<=65055,Tc=i=>i>=65072&&i<=65103,vh=i=>i>=65104&&i<=65135,Cr=i=>i>=65136&&i<=65279,Po=i=>i>=65280&&i<=65519;function Qr(i){for(const e of i)if(Jr(e.charCodeAt(0)))return!0;return!1}function gp(i){for(const e of i)if(!wh(e.charCodeAt(0)))return!1;return!0}function wh(i){return!(hh(i)||dh(i)||ph(i)||Rs(i)||Cr(i))}function Jr(i){return!(i!==746&&i!==747&&(i<4352||!(xc(i)||yc(i)||Tc(i)&&!(i>=65097&&i<=65103)||yh(i)||Na(i)||Ds(i)||vc(i)||!(!Yr(i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||_h(i)||bc(i)||Ua(i)||(e=>e>=12592&&e<=12687)(i)||(e=>e>=43360&&e<=43391)(i)||(e=>e>=55216&&e<=55295)(i)||(e=>e>=4352&&e<=4607)(i)||Kr(i)||gc(i)||mh(i)||(e=>e>=12688&&e<=12703)(i)||fh(i)||wc(i)||Oa(i)&&i!==12540||!(!Po(i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!vh(i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||(e=>e>=5120&&e<=5759)(i)||(e=>e>=6320&&e<=6399)(i)||xh(i)||(e=>e>=19904&&e<=19967)(i)||Ls(i)||gh(i))))}function bh(i){return!(Jr(i)||function(e){return!!((n=>n>=128&&n<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(n=>n>=8192&&n<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&e!==9251||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Yr(e)||Oa(e)||(n=>n>=57344&&n<=63743)(e)||Tc(e)||vh(e)||Po(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(i))}function Th(i){return i>=1424&&i<=2303||Rs(i)||Cr(i)}function Va(i,e){return!(!e&&Th(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||(n=>n>=6016&&n<=6143)(i))}function u(i){for(const e of i)if(Th(e.charCodeAt(0)))return!0;return!1}const t="deferred",s="loading",h="loaded";let m=null,_="unavailable",v=null;const b=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(_="error"),m&&m(i)};function S(){I.fire(new Ue("pluginStateChange",{pluginStatus:_,pluginURL:v}))}const I=new Je,M=function(){return _},D=function(){if(_!==t||!v)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");_=s,S(),v&&P({url:v},i=>{i?b(i):(_=h,S())})},F={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>_===h||F.applyArabicShaping!=null,isLoading:()=>_===s,setState(i){_=i.pluginStatus,v=i.pluginURL},isParsed:()=>F.applyArabicShaping!=null&&F.processBidirectionalText!=null&&F.processStyledBidirectionalText!=null,getPluginURL:()=>v};class B{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new uh,this.transition={})}isSupportedScript(e){return function(n,o){for(const c of n)if(!Va(c.charCodeAt(0),o))return!1;return!0}(e,F.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),o=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class ${constructor(e,n){this.property=e,this.value=n,this.expression=function(o,c){if(Ia(o))return new za(o,c);if(Aa(o)){const d=sc(o,c);if(d.result==="error")throw new Error(d.value.map(p=>`${p.key}: ${p.message}`).join(", "));return d.value}{let d=o;return typeof o=="string"&&c.type==="color"&&(d=_t.parse(o)),{kind:"constant",evaluate:()=>d}}}(n===void 0?e.specification.default:n,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,o){return this.property.possiblyEvaluate(this,e,n,o)}}class G{constructor(e){this.property=e,this.value=new $(e,void 0)}transitioned(e,n){return new N(this.property,this.value,n,St({},e.transition,this.transition),e.now)}untransitioned(){return new N(this.property,this.value,null,{},0)}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Gt(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new G(this._values[e].property)),this._values[e].value=new $(this._values[e].property,n===null?void 0:Gt(n))}getTransition(e){return Gt(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new G(this._values[e].property)),this._values[e].transition=Gt(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o);const c=this.getTransition(n);c!==void 0&&(e[`${n}-transition`]=c)}return e}transitioned(e,n){const o=new Z(this._properties);for(const c of Object.keys(this._values))o._values[c]=this._values[c].transitioned(e,n._values[c]);return o}untransitioned(){const e=new Z(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class N{constructor(e,n,o,c,d){const p=c.delay||0,g=c.duration||0;d=d||0,this.property=e,this.value=n,this.begin=d+p,this.end=this.begin+g,e.specification.transition&&(c.delay||c.duration)&&(this.prior=o)}possiblyEvaluate(e,n,o){const c=e.now||0,d=this.value.possiblyEvaluate(e,n,o),p=this.prior;if(p){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return p.possiblyEvaluate(e,n,o);{const g=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,n,o),d,ve(g))}}return d}}class Z{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,o){const c=new oe(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,n,o);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Y{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Gt(this._values[e].value)}setValue(e,n){this._values[e]=new $(this._values[e].property,n===null?void 0:Gt(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(e[n]=o)}return e}possiblyEvaluate(e,n,o){const c=new oe(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,n,o);return c}}class ee{constructor(e,n,o){this.property=e,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,o,c){return this.property.evaluate(this.value,this.parameters,e,n,o,c)}}class oe{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class X{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,o){const c=bs[this.specification.type];return c?c(e,n,o):e}}class le{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,o,c){return new ee(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},o,c)}:e.expression,n)}interpolate(e,n,o){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new ee(this,{kind:"constant",value:void 0},e.parameters);const c=bs[this.specification.type];return c?new ee(this,{kind:"constant",value:c(e.value.value,n.value.value,o)},e.parameters):e}evaluate(e,n,o,c,d,p){return e.kind==="constant"?e.value:e.evaluate(n,o,c,d,p)}}class Te extends le{possiblyEvaluate(e,n,o,c){if(e.value===void 0)return new ee(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const d=e.expression.evaluate(n,null,{},o,c),p=e.property.specification.type==="resolvedImage"&&typeof d!="string"?d.name:d,g=this._calculate(p,p,p,n);return new ee(this,{kind:"constant",value:g},n)}if(e.expression.kind==="camera"){const d=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new ee(this,{kind:"constant",value:d},n)}return new ee(this,e.expression,n)}evaluate(e,n,o,c,d,p){if(e.kind==="source"){const g=e.evaluate(n,o,c,d,p);return this._calculate(g,g,g,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},o,c),e.evaluate({zoom:Math.floor(n.zoom)},o,c),e.evaluate({zoom:Math.floor(n.zoom)+1},o,c),n):e.value}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n,other:o}:{from:o,to:n,other:e}}interpolate(e){return e}}class Ae{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){if(e.value!==void 0){if(e.expression.kind==="constant"){const d=e.expression.evaluate(n,null,{},o,c);return this._calculate(d,d,d,n)}return this._calculate(e.expression.evaluate(new B(Math.floor(n.zoom-1),n)),e.expression.evaluate(new B(Math.floor(n.zoom),n)),e.expression.evaluate(new B(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,o,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:o,to:n}}interpolate(e){return e}}class ae{constructor(e){this.specification=e}possiblyEvaluate(e,n,o,c){return!!e.expression.evaluate(n,null,{},o,c)}interpolate(){return!1}}class we{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const o=e[n];o.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new $(o,void 0),d=this.defaultTransitionablePropertyValues[n]=new G(o);this.defaultTransitioningPropertyValues[n]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate({})}}}function $e(i,e){return 256*(i=Be(Math.floor(i),0,255))+Be(Math.floor(e),0,255)}Xe("DataDrivenProperty",le),Xe("DataConstantProperty",X),Xe("CrossFadedDataDrivenProperty",Te),Xe("CrossFadedProperty",Ae),Xe("ColorRampProperty",ae);const qe={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ze{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Re{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function He(i,e=1){let n=0,o=0;return{members:i.map(c=>{const d=qe[c.type].BYTES_PER_ELEMENT,p=n=wt(n,Math.max(e,d)),g=c.components||1;return o=Math.max(o,d),n+=d*g,{name:c.name,type:c.type,components:g,offset:p}}),size:wt(n,Math.max(o,e)),alignment:e}}function wt(i,e){return Math.ceil(i/e)*e}class ct extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.int16[c+0]=n,this.int16[c+1]=o,e}}ct.prototype.bytesPerElement=4,Xe("StructArrayLayout2i4",ct);class ti extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const p=4*e;return this.int16[p+0]=n,this.int16[p+1]=o,this.int16[p+2]=c,this.int16[p+3]=d,e}}ti.prototype.bytesPerElement=8,Xe("StructArrayLayout4i8",ti);class Xt extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,c,d,p,g)}emplace(e,n,o,c,d,p,g,y){const w=6*e,E=12*e,C=3*e;return this.int16[w+0]=n,this.int16[w+1]=o,this.uint8[E+4]=c,this.uint8[E+5]=d,this.uint8[E+6]=p,this.uint8[E+7]=g,this.float32[C+2]=y,e}}Xt.prototype.bytesPerElement=12,Xe("StructArrayLayout2i4ub1f12",Xt);class pt extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=3*e;return this.float32[d+0]=n,this.float32[d+1]=o,this.float32[d+2]=c,e}}pt.prototype.bytesPerElement=12,Xe("StructArrayLayout3f12",pt);class bt extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,p,g,y,w,E){const C=this.length;return this.resize(C+1),this.emplace(C,e,n,o,c,d,p,g,y,w,E)}emplace(e,n,o,c,d,p,g,y,w,E,C){const k=10*e;return this.uint16[k+0]=n,this.uint16[k+1]=o,this.uint16[k+2]=c,this.uint16[k+3]=d,this.uint16[k+4]=p,this.uint16[k+5]=g,this.uint16[k+6]=y,this.uint16[k+7]=w,this.uint16[k+8]=E,this.uint16[k+9]=C,e}}bt.prototype.bytesPerElement=20,Xe("StructArrayLayout10ui20",bt);class Kt extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,p,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,o,c,d,p,g,y)}emplace(e,n,o,c,d,p,g,y,w){const E=8*e;return this.uint16[E+0]=n,this.uint16[E+1]=o,this.uint16[E+2]=c,this.uint16[E+3]=d,this.uint16[E+4]=p,this.uint16[E+5]=g,this.uint16[E+6]=y,this.uint16[E+7]=w,e}}Kt.prototype.bytesPerElement=16,Xe("StructArrayLayout8ui16",Kt);class yn extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,p,g,y,w,E,C,k,z,O,U,W){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,n,o,c,d,p,g,y,w,E,C,k,z,O,U,W)}emplace(e,n,o,c,d,p,g,y,w,E,C,k,z,O,U,W,Q){const se=16*e;return this.int16[se+0]=n,this.int16[se+1]=o,this.int16[se+2]=c,this.int16[se+3]=d,this.uint16[se+4]=p,this.uint16[se+5]=g,this.uint16[se+6]=y,this.uint16[se+7]=w,this.int16[se+8]=E,this.int16[se+9]=C,this.int16[se+10]=k,this.int16[se+11]=z,this.int16[se+12]=O,this.int16[se+13]=U,this.int16[se+14]=W,this.int16[se+15]=Q,e}}yn.prototype.bytesPerElement=32,Xe("StructArrayLayout4i4ui4i4i32",yn);class Gn extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Gn.prototype.bytesPerElement=4,Xe("StructArrayLayout1ul4",Gn);class Ri extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,p,g,y,w,E,C,k,z){const O=this.length;return this.resize(O+1),this.emplace(O,e,n,o,c,d,p,g,y,w,E,C,k,z)}emplace(e,n,o,c,d,p,g,y,w,E,C,k,z,O){const U=20*e,W=10*e;return this.int16[U+0]=n,this.int16[U+1]=o,this.int16[U+2]=c,this.int16[U+3]=d,this.int16[U+4]=p,this.float32[W+3]=g,this.float32[W+4]=y,this.float32[W+5]=w,this.float32[W+6]=E,this.int16[U+14]=C,this.uint32[W+8]=k,this.uint16[U+18]=z,this.uint16[U+19]=O,e}}Ri.prototype.bytesPerElement=40,Xe("StructArrayLayout5i4f1i1ul2ui40",Ri);class Wi extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,o,c,d,p,g)}emplace(e,n,o,c,d,p,g,y){const w=8*e;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=c,this.int16[w+4]=d,this.int16[w+5]=p,this.int16[w+6]=g,this.int16[w+7]=y,e}}Wi.prototype.bytesPerElement=16,Xe("StructArrayLayout3i2i2i16",Wi);class Zn extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,c,d)}emplace(e,n,o,c,d,p){const g=4*e,y=8*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.int16[y+6]=d,this.int16[y+7]=p,e}}Zn.prototype.bytesPerElement=16,Xe("StructArrayLayout2f1f2i16",Zn);class ar extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const p=12*e,g=3*e;return this.uint8[p+0]=n,this.uint8[p+1]=o,this.float32[g+1]=c,this.float32[g+2]=d,e}}ar.prototype.bytesPerElement=12,Xe("StructArrayLayout2ub2f12",ar);class Nt extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=3*e;return this.uint16[d+0]=n,this.uint16[d+1]=o,this.uint16[d+2]=c,e}}Nt.prototype.bytesPerElement=6,Xe("StructArrayLayout3ui6",Nt);class Qt extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,p,g,y,w,E,C,k,z,O,U,W,Q,se,me,_e,ge){const xe=this.length;return this.resize(xe+1),this.emplace(xe,e,n,o,c,d,p,g,y,w,E,C,k,z,O,U,W,Q,se,me,_e,ge)}emplace(e,n,o,c,d,p,g,y,w,E,C,k,z,O,U,W,Q,se,me,_e,ge,xe){const Ce=30*e,De=15*e,Le=60*e;return this.int16[Ce+0]=n,this.int16[Ce+1]=o,this.int16[Ce+2]=c,this.float32[De+2]=d,this.float32[De+3]=p,this.uint16[Ce+8]=g,this.uint16[Ce+9]=y,this.uint32[De+5]=w,this.uint32[De+6]=E,this.uint32[De+7]=C,this.uint16[Ce+16]=k,this.uint16[Ce+17]=z,this.uint16[Ce+18]=O,this.float32[De+10]=U,this.float32[De+11]=W,this.uint8[Le+48]=Q,this.uint8[Le+49]=se,this.uint8[Le+50]=me,this.uint32[De+13]=_e,this.int16[Ce+28]=ge,this.uint8[Le+58]=xe,e}}Qt.prototype.bytesPerElement=60,Xe("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Qt);class Pt extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d,p,g,y,w,E,C,k,z,O,U,W,Q,se,me,_e,ge,xe,Ce,De,Le,Oe,Ie,Pe,Ne,Me){const ot=this.length;return this.resize(ot+1),this.emplace(ot,e,n,o,c,d,p,g,y,w,E,C,k,z,O,U,W,Q,se,me,_e,ge,xe,Ce,De,Le,Oe,Ie,Pe,Ne,Me)}emplace(e,n,o,c,d,p,g,y,w,E,C,k,z,O,U,W,Q,se,me,_e,ge,xe,Ce,De,Le,Oe,Ie,Pe,Ne,Me,ot){const We=38*e,Dt=19*e;return this.int16[We+0]=n,this.int16[We+1]=o,this.int16[We+2]=c,this.float32[Dt+2]=d,this.float32[Dt+3]=p,this.int16[We+8]=g,this.int16[We+9]=y,this.int16[We+10]=w,this.int16[We+11]=E,this.int16[We+12]=C,this.int16[We+13]=k,this.uint16[We+14]=z,this.uint16[We+15]=O,this.uint16[We+16]=U,this.uint16[We+17]=W,this.uint16[We+18]=Q,this.uint16[We+19]=se,this.uint16[We+20]=me,this.uint16[We+21]=_e,this.uint16[We+22]=ge,this.uint16[We+23]=xe,this.uint16[We+24]=Ce,this.uint16[We+25]=De,this.uint16[We+26]=Le,this.uint16[We+27]=Oe,this.uint16[We+28]=Ie,this.uint32[Dt+15]=Pe,this.float32[Dt+16]=Ne,this.float32[Dt+17]=Me,this.float32[Dt+18]=ot,e}}Pt.prototype.bytesPerElement=76,Xe("StructArrayLayout3i2f6i15ui1ul3f76",Pt);class ii extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}ii.prototype.bytesPerElement=4,Xe("StructArrayLayout1f4",ii);class Xi extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,o){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,o)}emplace(e,n,o,c){const d=3*e;return this.int16[d+0]=n,this.int16[d+1]=o,this.int16[d+2]=c,e}}Xi.prototype.bytesPerElement=6,Xe("StructArrayLayout3i6",Xi);class qt extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const p=6*e;return this.uint32[3*e+0]=n,this.uint16[p+2]=o,this.uint16[p+3]=c,this.uint16[p+4]=d,e}}qt.prototype.bytesPerElement=12,Xe("StructArrayLayout1ul3ui12",qt);class Ci extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.uint16[c+0]=n,this.uint16[c+1]=o,e}}Ci.prototype.bytesPerElement=4,Xe("StructArrayLayout2ui4",Ci);class xn extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}xn.prototype.bytesPerElement=2,Xe("StructArrayLayout1ui2",xn);class qn extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c,d){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,o,c,d)}emplace(e,n,o,c,d,p){const g=5*e;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=c,this.float32[g+3]=d,this.float32[g+4]=p,e}}qn.prototype.bytesPerElement=20,Xe("StructArrayLayout5f20",qn);class ja extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const o=this.length;return this.resize(o+1),this.emplace(o,e,n)}emplace(e,n,o){const c=2*e;return this.float32[c+0]=n,this.float32[c+1]=o,e}}ja.prototype.bytesPerElement=8,Xe("StructArrayLayout2f8",ja);class Ec extends Re{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,o,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,n,o,c)}emplace(e,n,o,c,d){const p=4*e;return this.float32[p+0]=n,this.float32[p+1]=o,this.float32[p+2]=c,this.float32[p+3]=d,e}}Ec.prototype.bytesPerElement=16,Xe("StructArrayLayout4f16",Ec);class $a extends Ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}$a.prototype.size=40;class eo extends Ri{get(e){return new $a(this,e)}}Xe("CollisionBoxArray",eo);class Eh extends Ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Eh.prototype.size=60;class Fs extends Qt{get(e){return new Eh(this,e)}}Xe("PlacedSymbolArray",Fs);class Ga extends Ze{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ga.prototype.size=76;class E_ extends Pt{get(e){return new Ga(this,e)}}Xe("SymbolInstanceArray",E_);class S_ extends ii{getoffsetX(e){return this.float32[1*e+0]}}Xe("GlyphOffsetArray",S_);class C_ extends Xi{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Xe("SymbolLineVertexArray",C_);class k_ extends Ze{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}k_.prototype.size=12;class I_ extends qt{get(e){return new k_(this,e)}}Xe("FeatureIndexArray",I_);class A_ extends Ze{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}A_.prototype.size=4;class M_ extends Ci{get(e){return new A_(this,e)}}Xe("FillExtrusionCentroidArray",M_);const Pv=He([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Dv=He([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var z_=nr(function(i){i.exports=function(e,n){var o,c,d,p,g,y,w,E;for(c=e.length-(o=3&e.length),d=n,g=3432918353,y=461845907,E=0;E<c;)w=255&e.charCodeAt(E)|(255&e.charCodeAt(++E))<<8|(255&e.charCodeAt(++E))<<16|(255&e.charCodeAt(++E))<<24,++E,d=27492+(65535&(p=5*(65535&(d=(d^=w=(65535&(w=(w=(65535&w)*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,o){case 3:w^=(255&e.charCodeAt(E+2))<<16;case 2:w^=(255&e.charCodeAt(E+1))<<8;case 1:d^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(E)))*g+(((w>>>16)*g&65535)<<16)&4294967295)<<15|w>>>17))*y+(((w>>>16)*y&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}}),Lv=nr(function(i){i.exports=function(e,n){for(var o,c=e.length,d=n^c,p=0;c>=4;)o=1540483477*(65535&(o=255&e.charCodeAt(p)|(255&e.charCodeAt(++p))<<8|(255&e.charCodeAt(++p))<<16|(255&e.charCodeAt(++p))<<24))+((1540483477*(o>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:d^=(255&e.charCodeAt(p+2))<<16;case 2:d^=(255&e.charCodeAt(p+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(p)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}}),Sc=z_,Rv=Lv;Sc.murmur3=z_,Sc.murmur2=Rv;class Sh{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,o,c){this.ids.push(P_(e)),this.positions.push(n,o,c)}getPositions(e){const n=P_(e);let o=0,c=this.ids.length-1;for(;o<c;){const p=o+c>>1;this.ids[p]>=n?c=p:o=p+1}const d=[];for(;this.ids[o]===n;)d.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return d}static serialize(e,n){const o=new Float64Array(e.ids),c=new Uint32Array(e.positions);return yp(o,c,0,o.length-1),n&&n.push(o.buffer,c.buffer),{ids:o,positions:c}}static deserialize(e){const n=new Sh;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function P_(i){const e=+i;return!isNaN(e)&&e<=Ke?e:Sc(String(i))}function yp(i,e,n,o){for(;n<o;){const c=i[n+o>>1];let d=n-1,p=o+1;for(;;){do d++;while(i[d]<c);do p--;while(i[p]>c);if(d>=p)break;Ch(i,d,p),Ch(e,3*d,3*p),Ch(e,3*d+1,3*p+1),Ch(e,3*d+2,3*p+2)}p-n<o-p?(yp(i,e,n,p),n=p+1):(yp(i,e,p+1,o),o=p)}}function Ch(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}Xe("FeaturePositionMap",Sh);class Do{constructor(e,n){this.gl=e.gl,this.location=n}}class kh extends Do{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class D_ extends Do{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class L_ extends Do{constructor(e,n){super(e,n),this.current=_t.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Fv=new Float32Array(16),Bv=new Float32Array(9);function xp(i){return[$e(255*i.r,255*i.g),$e(255*i.b,255*i.a)]}class Cc{constructor(e,n,o){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=o}setUniform(e,n,o){e.set(o.constantOr(this.value))}getBinding(e,n,o){return this.type==="color"?new L_(e,n):new kh(e,n)}}class Za{constructor(e,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tl.concat(n.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,n,o,c){const d=c==="u_pattern_to"||c==="u_dash_to"?this.patternTo:c==="u_pattern_from"||c==="u_dash_from"?this.patternFrom:c==="u_pixel_ratio_to"?this.pixelRatioTo:c==="u_pixel_ratio_from"?this.pixelRatioFrom:null;d&&e.set(d)}getBinding(e,n,o){return o==="u_pattern_from"||o==="u_pattern_to"||o==="u_dash_from"||o==="u_dash_to"?new D_(e,n):new kh(e,n)}}class to{constructor(e,n,o,c){this.expression=e,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(d=>({name:`a_${d}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,n,o,c,d){const p=this.paintVertexArray.length,g=this.expression.evaluate(new B(0),n,{},c,[],d);this.paintVertexArray.resize(e),this._setPaintValue(p,e,g)}updatePaintArray(e,n,o,c){const d=this.expression.evaluate({zoom:0},o,c);this._setPaintValue(e,n,d)}_setPaintValue(e,n,o){if(this.type==="color"){const c=xp(o);for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lr{constructor(e,n,o,c,d,p){this.expression=e,this.uniformNames=n.map(g=>`u_${g}_t`),this.type=o,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,o,c,d){const p=this.expression.evaluate(new B(this.zoom),n,{},c,[],d),g=this.expression.evaluate(new B(this.zoom+1),n,{},c,[],d),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,p,g)}updatePaintArray(e,n,o,c){const d=this.expression.evaluate({zoom:this.zoom},o,c),p=this.expression.evaluate({zoom:this.zoom+1},o,c);this._setPaintValue(e,n,d,p)}_setPaintValue(e,n,o,c){if(this.type==="color"){const d=xp(o),p=xp(c);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,d[0],d[1],p[0],p[1])}else{for(let d=e;d<n;d++)this.paintVertexArray.emplace(d,o,c);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,c=Be(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,n,o){return new kh(e,n)}}class Lo{constructor(e,n,o,c,d,p,g){this.expression=e,this.type=o,this.useIntegerZoom=c,this.zoom=d,this.layerId=g,this.paintVertexAttributes=(o==="array"?Dv:Pv).members;for(let y=0;y<n.length;++y);this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(e,n,o){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(e,n,o,c,d){this._setPaintValues(e,n,o.patterns&&o.patterns[this.layerId],d)}_setPaintValues(e,n,o,c){if(!c||!o)return;const{min:d,mid:p,max:g}=o,y=c[d],w=c[p],E=c[g];if(y&&w&&E)for(let C=e;C<n;C++)this._setPaintValue(this.zoomInPaintVertexArray,C,w,y),this._setPaintValue(this.zoomOutPaintVertexArray,C,w,E)}_setPaintValue(e,n,o,c){e.emplace(n,o.tl[0],o.tl[1],o.br[0],o.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],o.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class io{constructor(e,n,o=()=>!0){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){if(!o(d))continue;const p=e.paint.get(d);if(!(p instanceof ee&&Xr(p.property.specification)))continue;const g=Uv(d,e.type),y=p.value,w=p.property.specification.type,E=p.property.useIntegerZoom,C=p.property.specification["property-type"],k=C==="cross-faded"||C==="cross-faded-data-driven",z=String(d)==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||z)if(y.kind==="source"||z||k){const O=R_(d,w,"source");this.binders[d]=k?new Lo(y,g,w,E,n,O,e.id):new to(y,g,w,O),c.push(`/a_${d}`)}else{const O=R_(d,w,"composite");this.binders[d]=new lr(y,g,w,E,n,O),c.push(`/z_${d}`)}else this.binders[d]=k?new Za(y.value,g):new Cc(y.value,g,w),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof to||n instanceof lr?n.maxValue:0}populatePaintArrays(e,n,o,c,d){for(const p in this.binders){const g=this.binders[p];(g instanceof to||g instanceof lr||g instanceof Lo)&&g.populatePaintArray(e,n,o,c,d)}}setConstantPatternPositions(e,n){for(const o in this.binders){const c=this.binders[o];c instanceof Za&&c.setConstantPatternPositions(e,n)}}updatePaintArrays(e,n,o,c,d){let p=!1;for(const g in e){const y=n.getPositions(g);for(const w of y){const E=o.feature(w.index);for(const C in this.binders){const k=this.binders[C];if((k instanceof to||k instanceof lr||k instanceof Lo)&&k.expression.isStateDependent===!0){const z=c.paint.get(C);k.expression=z.value,k.updatePaintArray(w.start,w.end,E,e[g],d),p=!0}}}}return p}defines(){const e=[];for(const n in this.binders){const o=this.binders[n];(o instanceof Cc||o instanceof Za)&&e.push(...o.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof to||o instanceof lr||o instanceof Lo)for(let c=0;c<o.paintVertexAttributes.length;c++)e.push(o.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof Cc||o instanceof Za||o instanceof lr)for(const c of o.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const o=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Cc||d instanceof Za||d instanceof lr){for(const p of d.uniformNames)if(n[p]){const g=d.getBinding(e,n[p],p);o.push({name:p,property:c,binding:g})}}}return o}setUniforms(e,n,o,c){for(const{name:d,property:p,binding:g}of n)this.binders[p].setUniform(g,c,o.get(p),d)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(e&&o instanceof Lo){const c=e.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(o instanceof to||o instanceof lr)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(e){for(const n in this.binders){const o=this.binders[n];(o instanceof to||o instanceof lr||o instanceof Lo)&&o.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof to||n instanceof lr||n instanceof Lo)&&n.destroy()}}}class Bs{constructor(e,n,o=()=>!0){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new io(c,n,o);this.needsUpload=!1,this._featureMap=new Sh,this._bufferOffset=0}populatePaintArrays(e,n,o,c,d,p){for(const g in this.programConfigurations)this.programConfigurations[g].populatePaintArrays(e,n,c,d,p);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,o,c){for(const d of o)this.needsUpload=this.programConfigurations[d.id].updatePaintArrays(e,this._featureMap,n,d,c)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Ov={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Uv(i,e){return Ov[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}const Nv={"line-pattern":{source:bt,composite:bt},"fill-pattern":{source:bt,composite:bt},"fill-extrusion-pattern":{source:bt,composite:bt},"line-dasharray":{source:Kt,composite:Kt}},Vv={color:{source:ja,composite:Ec},number:{source:ii,composite:ja}};function R_(i,e,n){const o=Nv[i];return o&&o[n]||Vv[e][n]}Xe("ConstantBinder",Cc),Xe("CrossFadedConstantBinder",Za),Xe("SourceExpressionBinder",to),Xe("CrossFadedCompositeBinder",Lo),Xe("CompositeExpressionBinder",lr),Xe("ProgramConfiguration",io,{omit:["_buffers"]}),Xe("ProgramConfigurationSet",Bs);const Ih="-transition";class cr extends Je{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new Y(n.layout)),n.paint)){this._transitionablePaint=new K(n.paint);for(const o in e.paint)this.setPaintProperty(o,e.paint[o],{validate:!1});for(const o in e.layout)this.setLayoutProperty(o,e.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new oe(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,o={}){n!=null&&this._validate(_p,`layers.${this.id}.layout.${e}`,e,n,o)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return pn(e,Ih)?this._transitionablePaint.getTransition(e.slice(0,-Ih.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,o={}){if(n!=null&&this._validate(sh,`layers.${this.id}.paint.${e}`,e,n,o))return!1;if(pn(e,Ih))return this._transitionablePaint.setTransition(e.slice(0,-Ih.length),n||void 0),!1;{const c=this._transitionablePaint._values[e],d=c.property.specification["property-type"]==="cross-faded-data-driven",p=c.value.isDataDriven(),g=c.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const y=this._transitionablePaint._values[e].value;return y.isDataDriven()||p||d||this._handleOverridablePaintPropertyUpdate(e,g,y)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,o){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Pi(e,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(e,n,o,c,d={}){return(!d||d.validate!==!1)&&mc(this,e.call(zo,{key:n,layerType:this.type,objectKey:o,value:c,styleSpec:te,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof ee&&Xr(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const jv=He([{name:"a_pos",components:2,type:"Int16"}],4),{members:$v}=jv;class Vi{constructor(e=[]){this.segments=e}prepareSegment(e,n,o,c){let d=this.segments[this.segments.length-1];return e>Vi.MAX_VERTEX_ARRAY_LENGTH&&Ye(`Max vertices per segment is ${Vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Vi.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},c!==void 0&&(d.sortKey=c),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,o,c){return new Vi([{vertexOffset:e,primitiveOffset:n,vertexLength:o,primitiveLength:c,vaos:{},sortKey:0}])}}Vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xe("SegmentVector",Vi);var Rt=8192;const vp=Math.pow(2,14)-1,F_=-vp-1;function Os(i){const e=Rt/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const c=n[o];for(let d=0;d<c.length;d++){const p=c[d],g=Math.round(p.x*e),y=Math.round(p.y*e);p.x=Be(g,F_,vp),p.y=Be(y,F_,vp),(g<p.x||g>p.x+1||y<p.y||y>p.y+1)&&Ye("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Us(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?Os(i):[]}}function Ah(i,e,n,o,c){i.emplaceBack(2*e+(o+1)/2,2*n+(c+1)/2)}class wp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ct,this.indexArray=new Nt,this.segments=new Vi,this.programConfigurations=new Bs(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){const c=this.layers[0],d=[];let p=null;c.type==="circle"&&(p=c.layout.get("circle-sort-key"));for(const{feature:g,id:y,index:w,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,k=Us(g,C);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),k,o))continue;const z=p?p.evaluate(k,{},o):void 0,O={id:y,properties:g.properties,type:g.type,sourceLayerIndex:E,index:w,geometry:C?k.geometry:Os(g),patterns:{},sortKey:z};d.push(O)}p&&d.sort((g,y)=>g.sortKey-y.sortKey);for(const g of d){const{geometry:y,index:w,sourceLayerIndex:E}=g,C=e[w].feature;this.addFeature(g,y,w,o),n.featureIndex.insert(C,y,w,E,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$v),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c){for(const d of n)for(const p of d){const g=p.x,y=p.y;if(g<0||g>=Rt||y<0||y>=Rt)continue;const w=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),E=w.vertexLength;Ah(this.layoutVertexArray,g,y,-1,-1),Ah(this.layoutVertexArray,g,y,1,-1),Ah(this.layoutVertexArray,g,y,1,1),Ah(this.layoutVertexArray,g,y,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),w.vertexLength+=4,w.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,{},c)}}function B_(i,e){for(let n=0;n<i.length;n++)if(qa(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(qa(i,e[n]))return!0;return!!bp(i,e)}function Gv(i,e,n){return!!qa(i,e)||!!Tp(e,i,n)}function O_(i,e){if(i.length===1)return N_(e,i[0]);for(let n=0;n<e.length;n++){const o=e[n];for(let c=0;c<o.length;c++)if(qa(i,o[c]))return!0}for(let n=0;n<i.length;n++)if(N_(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(bp(i,e[n]))return!0;return!1}function Zv(i,e,n){if(i.length>1){if(bp(i,e))return!0;for(let o=0;o<e.length;o++)if(Tp(e[o],i,n))return!0}for(let o=0;o<i.length;o++)if(Tp(i[o],e,n))return!0;return!1}function bp(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],c=i[n+1];for(let d=0;d<e.length-1;d++)if(qv(o,c,e[d],e[d+1]))return!0}return!1}function qv(i,e,n,o){return ut(i,n,o)!==ut(e,n,o)&&ut(i,e,n)!==ut(i,e,o)}function Tp(i,e,n){const o=n*n;if(e.length===1)return i.distSqr(e[0])<o;for(let c=1;c<e.length;c++)if(U_(i,e[c-1],e[c])<o)return!0;return!1}function U_(i,e,n){const o=e.distSqr(n);if(o===0)return i.distSqr(e);const c=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return i.distSqr(c<0?e:c>1?n:n.sub(e)._mult(c)._add(e))}function N_(i,e){let n,o,c,d=!1;for(let p=0;p<i.length;p++){n=i[p];for(let g=0,y=n.length-1;g<n.length;y=g++)o=n[g],c=n[y],o.y>e.y!=c.y>e.y&&e.x<(c.x-o.x)*(e.y-o.y)/(c.y-o.y)+o.x&&(d=!d)}return d}function qa(i,e){let n=!1;for(let o=0,c=i.length-1;o<i.length;c=o++){const d=i[o],p=i[c];d.y>e.y!=p.y>e.y&&e.x<(p.x-d.x)*(e.y-d.y)/(p.y-d.y)+d.x&&(n=!n)}return n}function V_(i,e,n,o,c){for(const p of i)if(e<=p.x&&n<=p.y&&o>=p.x&&c>=p.y)return!0;const d=[new ye(e,n),new ye(e,c),new ye(o,c),new ye(o,n)];if(i.length>2){for(const p of d)if(qa(i,p))return!0}for(let p=0;p<i.length-1;p++)if(Wv(i[p],i[p+1],d))return!0;return!1}function Wv(i,e,n){const o=n[0],c=n[2];if(i.x<o.x&&e.x<o.x||i.x>c.x&&e.x>c.x||i.y<o.y&&e.y<o.y||i.y>c.y&&e.y>c.y)return!1;const d=ut(i,e,n[0]);return d!==ut(i,e,n[1])||d!==ut(i,e,n[2])||d!==ut(i,e,n[3])}function Wa(i,e,n){const o=e.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(e.id).getMaxValue(i)}function Mh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function j_(i,e,n,o,c){if(!e[0]&&!e[1])return i;const d=ye.convert(e)._mult(c);n==="viewport"&&d._rotate(-o);const p=[];for(let g=0;g<i.length;g++)p.push(i[g].sub(d));return p}function $_(i,e,n,o){const c=ye.convert(i)._mult(o);return e==="viewport"&&c._rotate(-n),c}Xe("CircleBucket",wp,{omit:["layers"]});const Xv=new we({"circle-sort-key":new le(te.layout_circle["circle-sort-key"])});var Hv={paint:new we({"circle-radius":new le(te.paint_circle["circle-radius"]),"circle-color":new le(te.paint_circle["circle-color"]),"circle-blur":new le(te.paint_circle["circle-blur"]),"circle-opacity":new le(te.paint_circle["circle-opacity"]),"circle-translate":new X(te.paint_circle["circle-translate"]),"circle-translate-anchor":new X(te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new X(te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new X(te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new le(te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new le(te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new le(te.paint_circle["circle-stroke-opacity"])}),layout:Xv},vn=typeof Float32Array<"u"?Float32Array:Array;function G_(){var i=new vn(9);return vn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Ep(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Z_(i,e,n){var o=e[0],c=e[1],d=e[2],p=e[3],g=e[4],y=e[5],w=e[6],E=e[7],C=e[8],k=e[9],z=e[10],O=e[11],U=e[12],W=e[13],Q=e[14],se=e[15],me=n[0],_e=n[1],ge=n[2],xe=n[3];return i[0]=me*o+_e*g+ge*C+xe*U,i[1]=me*c+_e*y+ge*k+xe*W,i[2]=me*d+_e*w+ge*z+xe*Q,i[3]=me*p+_e*E+ge*O+xe*se,i[4]=(me=n[4])*o+(_e=n[5])*g+(ge=n[6])*C+(xe=n[7])*U,i[5]=me*c+_e*y+ge*k+xe*W,i[6]=me*d+_e*w+ge*z+xe*Q,i[7]=me*p+_e*E+ge*O+xe*se,i[8]=(me=n[8])*o+(_e=n[9])*g+(ge=n[10])*C+(xe=n[11])*U,i[9]=me*c+_e*y+ge*k+xe*W,i[10]=me*d+_e*w+ge*z+xe*Q,i[11]=me*p+_e*E+ge*O+xe*se,i[12]=(me=n[12])*o+(_e=n[13])*g+(ge=n[14])*C+(xe=n[15])*U,i[13]=me*c+_e*y+ge*k+xe*W,i[14]=me*d+_e*w+ge*z+xe*Q,i[15]=me*p+_e*E+ge*O+xe*se,i}Math.hypot||(Math.hypot=function(){for(var i=0,e=arguments.length;e--;)i+=arguments[e]*arguments[e];return Math.sqrt(i)});var Yv=Z_;function zh(){var i=new vn(3);return vn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function q_(i){return Math.hypot(i[0],i[1],i[2])}function Xa(i,e,n){var o=new vn(3);return o[0]=i,o[1]=e,o[2]=n,o}function W_(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i}function X_(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i}function H_(i,e,n,o){return i[0]=e[0]+n[0]*o,i[1]=e[1]+n[1]*o,i[2]=e[2]+n[2]*o,i}function Y_(i,e){var n=e[0],o=e[1],c=e[2],d=n*n+o*o+c*c;return d>0&&(d=1/Math.sqrt(d)),i[0]=e[0]*d,i[1]=e[1]*d,i[2]=e[2]*d,i}function K_(i,e,n){var o=n[0],c=n[1],d=n[2],p=e[0],g=e[1],y=e[2],w=c*y-d*g,E=d*p-o*y,C=o*g-c*p,k=c*C-d*E,z=d*w-o*C,O=o*E-c*w,U=2*n[3];return E*=U,C*=U,z*=2,O*=2,i[0]=p+(w*=U)+(k*=2),i[1]=g+E+z,i[2]=y+C+O,i}var kc,Kv=W_,Qv=X_,Jv=q_;function Ic(i,e,n){var o=e[0],c=e[1],d=e[2],p=e[3];return i[0]=n[0]*o+n[4]*c+n[8]*d+n[12]*p,i[1]=n[1]*o+n[5]*c+n[9]*d+n[13]*p,i[2]=n[2]*o+n[6]*c+n[10]*d+n[14]*p,i[3]=n[3]*o+n[7]*c+n[11]*d+n[15]*p,i}function Sp(){var i=new vn(4);return vn!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Q_(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function J_(i,e,n){n*=.5;var o=e[0],c=e[1],d=e[2],p=e[3],g=Math.sin(n),y=Math.cos(n);return i[0]=o*y+p*g,i[1]=c*y+d*g,i[2]=d*y-c*g,i[3]=p*y-o*g,i}function eg(i,e,n,o,c,d,p,g,y){if(d&&i.queryGeometry.isAboveHorizon)return!1;d&&(y*=i.pixelToTileUnitsFactor);for(const w of e)for(const E of w){const C=E.add(g),k=c&&n.elevation?n.elevation.exaggeration()*c.getElevationAt(C.x,C.y,!0):0,z=d?C:e1(C,k,o),O=d?i.tilespaceRays.map(W=>i1(W,k)):i.queryGeometry.screenGeometry,U=Ic([],[E.x,E.y,k,1],o);if(!p&&d?y*=U[3]/n.cameraToCenterDistance:p&&!d&&(y*=n.cameraToCenterDistance/U[3]),Gv(O,z,y))return!0}return!1}function e1(i,e,n){const o=Ic([],[i.x,i.y,e,1],n);return new ye(o[0]/o[3],o[1]/o[3])}zh(),kc=new vn(4),vn!=Float32Array&&(kc[0]=0,kc[1]=0,kc[2]=0,kc[3]=0),zh(),Xa(1,0,0),Xa(0,1,0),Sp(),Sp(),G_();const tg=Xa(0,0,0),t1=Xa(0,0,1);function i1(i,e){const n=zh();return tg[2]=e,i.intersectsPlane(tg,t1,n),new ye(n[0],n[1])}class ig extends wp{}function Cp(i,{width:e,height:n},o,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*n*o)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*n*o);return i.width=e,i.height=n,i.data=c,i}function ng(i,{width:e,height:n},o){if(e===i.width&&n===i.height)return;const c=Cp({},{width:e,height:n},o);kp(i,c,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},o),i.width=e,i.height=n,i.data=c.data}function kp(i,e,n,o,c,d){if(c.width===0||c.height===0)return e;if(c.width>i.width||c.height>i.height||n.x>i.width-c.width||n.y>i.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||o.x>e.width-c.width||o.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const p=i.data,g=e.data;for(let y=0;y<c.height;y++){const w=((n.y+y)*i.width+n.x)*d,E=((o.y+y)*e.width+o.x)*d;for(let C=0;C<c.width*d;C++)g[E+C]=p[w+C]}return e}Xe("HeatmapBucket",ig,{omit:["layers"]});class Ro{constructor(e,n){Cp(this,e,1,n)}resize(e){ng(this,e,1)}clone(){return new Ro({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,d){kp(e,n,o,c,d,1)}}class Fn{constructor(e,n){Cp(this,e,4,n)}resize(e){ng(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,o,c,d){kp(e,n,o,c,d,4)}}Xe("AlphaImage",Ro),Xe("RGBAImage",Fn);var n1={paint:new we({"heatmap-radius":new le(te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new le(te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new X(te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ae(te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new X(te.paint_heatmap["heatmap-opacity"])})};function Ip(i){const e={},n=i.resolution||256,o=i.clips?i.clips.length:1,c=i.image||new Fn({width:n,height:o}),d=(p,g,y)=>{e[i.evaluationKey]=y;const w=i.expression.evaluate(e);c.data[p+g+0]=Math.floor(255*w.r/w.a),c.data[p+g+1]=Math.floor(255*w.g/w.a),c.data[p+g+2]=Math.floor(255*w.b/w.a),c.data[p+g+3]=Math.floor(255*w.a)};if(i.clips)for(let p=0,g=0;p<o;++p,g+=4*n)for(let y=0,w=0;y<n;y++,w+=4){const E=y/(n-1),{start:C,end:k}=i.clips[p];d(g,w,C*(1-E)+k*E)}else for(let p=0,g=0;p<n;p++,g+=4)d(0,g,p/(n-1));return c}var r1={paint:new we({"hillshade-illumination-direction":new X(te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new X(te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new X(te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new X(te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new X(te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new X(te.paint_hillshade["hillshade-accent-color"])})};const o1=He([{name:"a_pos",components:2,type:"Int16"}],4),{members:s1}=o1;var Ap=Ph,a1=Ph;function Ph(i,e,n){n=n||2;var o,c,d,p,g,y,w,E=e&&e.length,C=E?e[0]*n:i.length,k=rg(i,0,C,n,!0),z=[];if(!k||k.next===k.prev)return z;if(E&&(k=function(U,W,Q,se){var me,_e,ge,xe=[];for(me=0,_e=W.length;me<_e;me++)(ge=rg(U,W[me]*se,me<_e-1?W[me+1]*se:U.length,se,!1))===ge.next&&(ge.steiner=!0),xe.push(m1(ge));for(xe.sort(d1),me=0;me<xe.length;me++)p1(xe[me],Q),Q=Fo(Q,Q.next);return Q}(i,e,k,n)),i.length>80*n){o=d=i[0],c=p=i[1];for(var O=n;O<C;O+=n)(g=i[O])<o&&(o=g),(y=i[O+1])<c&&(c=y),g>d&&(d=g),y>p&&(p=y);w=(w=Math.max(d-o,p-c))!==0?1/w:0}return Ac(k,z,n,o,c,w),z}function rg(i,e,n,o,c){var d,p;if(c===Pp(i,e,n,o)>0)for(d=e;d<n;d+=o)p=ag(d,i[d],i[d+1],p);else for(d=n-o;d>=e;d-=o)p=ag(d,i[d],i[d+1],p);return p&&Dh(p,p.next)&&(zc(p),p=p.next),p}function Fo(i,e){if(!i)return i;e||(e=i);var n,o=i;do if(n=!1,o.steiner||!Dh(o,o.next)&&di(o.prev,o,o.next)!==0)o=o.next;else{if(zc(o),(o=e=o.prev)===o.next)break;n=!0}while(n||o!==e);return e}function Ac(i,e,n,o,c,d,p){if(i){!p&&d&&function(E,C,k,z){var O=E;do O.z===null&&(O.z=Mp(O.x,O.y,C,k,z)),O.prevZ=O.prev,O.nextZ=O.next,O=O.next;while(O!==E);O.prevZ.nextZ=null,O.prevZ=null,function(U){var W,Q,se,me,_e,ge,xe,Ce,De=1;do{for(Q=U,U=null,_e=null,ge=0;Q;){for(ge++,se=Q,xe=0,W=0;W<De&&(xe++,se=se.nextZ);W++);for(Ce=De;xe>0||Ce>0&&se;)xe!==0&&(Ce===0||!se||Q.z<=se.z)?(me=Q,Q=Q.nextZ,xe--):(me=se,se=se.nextZ,Ce--),_e?_e.nextZ=me:U=me,me.prevZ=_e,_e=me;Q=se}_e.nextZ=null,De*=2}while(ge>1)}(O)}(i,o,c,d);for(var g,y,w=i;i.prev!==i.next;)if(g=i.prev,y=i.next,d?c1(i,o,c,d):l1(i))e.push(g.i/n),e.push(i.i/n),e.push(y.i/n),zc(i),i=y.next,w=y.next;else if((i=y)===w){p?p===1?Ac(i=u1(Fo(i),e,n),e,n,o,c,d,2):p===2&&h1(i,e,n,o,c,d):Ac(Fo(i),e,n,o,c,d,1);break}}}function l1(i){var e=i.prev,n=i,o=i.next;if(di(e,n,o)>=0)return!1;for(var c=i.next.next;c!==i.prev;){if(Ha(e.x,e.y,n.x,n.y,o.x,o.y,c.x,c.y)&&di(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function c1(i,e,n,o){var c=i.prev,d=i,p=i.next;if(di(c,d,p)>=0)return!1;for(var g=c.x>d.x?c.x>p.x?c.x:p.x:d.x>p.x?d.x:p.x,y=c.y>d.y?c.y>p.y?c.y:p.y:d.y>p.y?d.y:p.y,w=Mp(c.x<d.x?c.x<p.x?c.x:p.x:d.x<p.x?d.x:p.x,c.y<d.y?c.y<p.y?c.y:p.y:d.y<p.y?d.y:p.y,e,n,o),E=Mp(g,y,e,n,o),C=i.prevZ,k=i.nextZ;C&&C.z>=w&&k&&k.z<=E;){if(C!==i.prev&&C!==i.next&&Ha(c.x,c.y,d.x,d.y,p.x,p.y,C.x,C.y)&&di(C.prev,C,C.next)>=0||(C=C.prevZ,k!==i.prev&&k!==i.next&&Ha(c.x,c.y,d.x,d.y,p.x,p.y,k.x,k.y)&&di(k.prev,k,k.next)>=0))return!1;k=k.nextZ}for(;C&&C.z>=w;){if(C!==i.prev&&C!==i.next&&Ha(c.x,c.y,d.x,d.y,p.x,p.y,C.x,C.y)&&di(C.prev,C,C.next)>=0)return!1;C=C.prevZ}for(;k&&k.z<=E;){if(k!==i.prev&&k!==i.next&&Ha(c.x,c.y,d.x,d.y,p.x,p.y,k.x,k.y)&&di(k.prev,k,k.next)>=0)return!1;k=k.nextZ}return!0}function u1(i,e,n){var o=i;do{var c=o.prev,d=o.next.next;!Dh(c,d)&&og(c,o,o.next,d)&&Mc(c,d)&&Mc(d,c)&&(e.push(c.i/n),e.push(o.i/n),e.push(d.i/n),zc(o),zc(o.next),o=i=d),o=o.next}while(o!==i);return Fo(o)}function h1(i,e,n,o,c,d){var p=i;do{for(var g=p.next.next;g!==p.prev;){if(p.i!==g.i&&_1(p,g)){var y=sg(p,g);return p=Fo(p,p.next),y=Fo(y,y.next),Ac(p,e,n,o,c,d),void Ac(y,e,n,o,c,d)}g=g.next}p=p.next}while(p!==i)}function d1(i,e){return i.x-e.x}function p1(i,e){if(e=function(o,c){var d,p=c,g=o.x,y=o.y,w=-1/0;do{if(y<=p.y&&y>=p.next.y&&p.next.y!==p.y){var E=p.x+(y-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(E<=g&&E>w){if(w=E,E===g){if(y===p.y)return p;if(y===p.next.y)return p.next}d=p.x<p.next.x?p:p.next}}p=p.next}while(p!==c);if(!d)return null;if(g===w)return d;var C,k=d,z=d.x,O=d.y,U=1/0;p=d;do g>=p.x&&p.x>=z&&g!==p.x&&Ha(y<O?g:w,y,z,O,y<O?w:g,y,p.x,p.y)&&(C=Math.abs(y-p.y)/(g-p.x),Mc(p,o)&&(C<U||C===U&&(p.x>d.x||p.x===d.x&&f1(d,p)))&&(d=p,U=C)),p=p.next;while(p!==k);return d}(i,e)){var n=sg(e,i);Fo(e,e.next),Fo(n,n.next)}}function f1(i,e){return di(i.prev,i,e.prev)<0&&di(e.next,i,i.next)<0}function Mp(i,e,n,o,c){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-n)*c)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-o)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function m1(i){var e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Ha(i,e,n,o,c,d,p,g){return(c-p)*(e-g)-(i-p)*(d-g)>=0&&(i-p)*(o-g)-(n-p)*(e-g)>=0&&(n-p)*(d-g)-(c-p)*(o-g)>=0}function _1(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!function(n,o){var c=n;do{if(c.i!==n.i&&c.next.i!==n.i&&c.i!==o.i&&c.next.i!==o.i&&og(c,c.next,n,o))return!0;c=c.next}while(c!==n);return!1}(i,e)&&(Mc(i,e)&&Mc(e,i)&&function(n,o){var c=n,d=!1,p=(n.x+o.x)/2,g=(n.y+o.y)/2;do c.y>g!=c.next.y>g&&c.next.y!==c.y&&p<(c.next.x-c.x)*(g-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next;while(c!==n);return d}(i,e)&&(di(i.prev,i,e.prev)||di(i,e.prev,e))||Dh(i,e)&&di(i.prev,i,i.next)>0&&di(e.prev,e,e.next)>0)}function di(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function Dh(i,e){return i.x===e.x&&i.y===e.y}function og(i,e,n,o){var c=Rh(di(i,e,n)),d=Rh(di(i,e,o)),p=Rh(di(n,o,i)),g=Rh(di(n,o,e));return c!==d&&p!==g||!(c!==0||!Lh(i,n,e))||!(d!==0||!Lh(i,o,e))||!(p!==0||!Lh(n,i,o))||!(g!==0||!Lh(n,e,o))}function Lh(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Rh(i){return i>0?1:i<0?-1:0}function Mc(i,e){return di(i.prev,i,i.next)<0?di(i,e,i.next)>=0&&di(i,i.prev,e)>=0:di(i,e,i.prev)<0||di(i,i.next,e)<0}function sg(i,e){var n=new zp(i.i,i.x,i.y),o=new zp(e.i,e.x,e.y),c=i.next,d=e.prev;return i.next=e,e.prev=i,n.next=c,c.prev=n,o.next=n,n.prev=o,d.next=o,o.prev=d,o}function ag(i,e,n,o){var c=new zp(i,e,n);return o?(c.next=o.next,c.prev=o,o.next.prev=c,o.next=c):(c.prev=c,c.next=c),c}function zc(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function zp(i,e,n){this.i=i,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pp(i,e,n,o){for(var c=0,d=e,p=n-o;d<n;d+=o)c+=(i[p]-i[d])*(i[d+1]+i[p+1]),p=d;return c}function g1(i,e,n,o,c){lg(i,e,n||0,o||i.length-1,c||y1)}function lg(i,e,n,o,c){for(;o>n;){if(o-n>600){var d=o-n+1,p=e-n+1,g=Math.log(d),y=.5*Math.exp(2*g/3),w=.5*Math.sqrt(g*y*(d-y)/d)*(p-d/2<0?-1:1);lg(i,e,Math.max(n,Math.floor(e-p*y/d+w)),Math.min(o,Math.floor(e+(d-p)*y/d+w)),c)}var E=i[e],C=n,k=o;for(Pc(i,n,e),c(i[o],E)>0&&Pc(i,n,o);C<k;){for(Pc(i,C,k),C++,k--;c(i[C],E)<0;)C++;for(;c(i[k],E)>0;)k--}c(i[n],E)===0?Pc(i,n,k):Pc(i,++k,o),k<=e&&(n=k+1),e<=k&&(o=k-1)}}function Pc(i,e,n){var o=i[e];i[e]=i[n],i[n]=o}function y1(i,e){return i<e?-1:i>e?1:0}function Dp(i,e){const n=i.length;if(n<=1)return[i];const o=[];let c,d;for(let p=0;p<n;p++){const g=Zt(i[p]);g!==0&&(i[p].area=Math.abs(g),d===void 0&&(d=g<0),d===g<0?(c&&o.push(c),c=[i[p]]):c.push(i[p]))}if(c&&o.push(c),e>1)for(let p=0;p<o.length;p++)o[p].length<=e||(g1(o[p],e,1,o[p].length-1,x1),o[p]=o[p].slice(0,e));return o}function x1(i,e){return e.area-i.area}function Lp(i,e,n){const o=n.patternDependencies;let c=!1;for(const d of e){const p=d.paint.get(`${i}-pattern`);p.isConstant()||(c=!0);const g=p.constantOr(null);g&&(c=!0,o[g.to]=!0,o[g.from]=!0)}return c}function Rp(i,e,n,o,c){const d=c.patternDependencies;for(const p of e){const g=p.paint.get(`${i}-pattern`).value;if(g.kind!=="constant"){let y=g.evaluate({zoom:o-1},n,{},c.availableImages),w=g.evaluate({zoom:o},n,{},c.availableImages),E=g.evaluate({zoom:o+1},n,{},c.availableImages);y=y&&y.name?y.name:y,w=w&&w.name?w.name:w,E=E&&E.name?E.name:E,d[y]=!0,d[w]=!0,d[E]=!0,n.patterns[p.id]={min:y,mid:w,max:E}}}return n}Ph.deviation=function(i,e,n,o){var c=e&&e.length,d=Math.abs(Pp(i,0,c?e[0]*n:i.length,n));if(c)for(var p=0,g=e.length;p<g;p++)d-=Math.abs(Pp(i,e[p]*n,p<g-1?e[p+1]*n:i.length,n));var y=0;for(p=0;p<o.length;p+=3){var w=o[p]*n,E=o[p+1]*n,C=o[p+2]*n;y+=Math.abs((i[w]-i[C])*(i[E+1]-i[w+1])-(i[w]-i[E])*(i[C+1]-i[w+1]))}return d===0&&y===0?0:Math.abs((y-d)/d)},Ph.flatten=function(i){for(var e=i[0][0].length,n={vertices:[],holes:[],dimensions:e},o=0,c=0;c<i.length;c++){for(var d=0;d<i[c].length;d++)for(var p=0;p<e;p++)n.vertices.push(i[c][d][p]);c>0&&n.holes.push(o+=i[c-1].length)}return n},Ap.default=a1;class Fp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ct,this.indexArray=new Nt,this.indexArray2=new Ci,this.programConfigurations=new Bs(e.layers,e.zoom),this.segments=new Vi,this.segments2=new Vi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=Lp("fill",this.layers,n);const c=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:p,id:g,index:y,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,C=Us(p,E);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),C,o))continue;const k=c?c.evaluate(C,{},o,n.availableImages):void 0,z={id:g,properties:p.properties,type:p.type,sourceLayerIndex:w,index:y,geometry:E?C.geometry:Os(p),patterns:{},sortKey:k};d.push(z)}c&&d.sort((p,g)=>p.sortKey-g.sortKey);for(const p of d){const{geometry:g,index:y,sourceLayerIndex:w}=p;if(this.hasPattern){const E=Rp("fill",this.layers,p,this.zoom,n);this.patternFeatures.push(E)}else this.addFeature(p,g,y,o,{});n.featureIndex.insert(e[y].feature,g,y,w,this.index)}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,s1),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,o,c,d){for(const p of Dp(n,500)){let g=0;for(const z of p)g+=z.length;const y=this.segments.prepareSegment(g,this.layoutVertexArray,this.indexArray),w=y.vertexLength,E=[],C=[];for(const z of p){if(z.length===0)continue;z!==p[0]&&C.push(E.length/2);const O=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),U=O.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(U+z.length-1,U),E.push(z[0].x),E.push(z[0].y);for(let W=1;W<z.length;W++)this.layoutVertexArray.emplaceBack(z[W].x,z[W].y),this.indexArray2.emplaceBack(U+W-1,U+W),E.push(z[W].x),E.push(z[W].y);O.vertexLength+=z.length,O.primitiveLength+=z.length}const k=Ap(E,C);for(let z=0;z<k.length;z+=3)this.indexArray.emplaceBack(w+k[z],w+k[z+1],w+k[z+2]);y.vertexLength+=g,y.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,c)}}Xe("FillBucket",Fp,{omit:["layers","patternFeatures"]});const v1=new we({"fill-sort-key":new le(te.layout_fill["fill-sort-key"])});var w1={paint:new we({"fill-antialias":new X(te.paint_fill["fill-antialias"]),"fill-opacity":new le(te.paint_fill["fill-opacity"]),"fill-color":new le(te.paint_fill["fill-color"]),"fill-outline-color":new le(te.paint_fill["fill-outline-color"]),"fill-translate":new X(te.paint_fill["fill-translate"]),"fill-translate-anchor":new X(te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Te(te.paint_fill["fill-pattern"])}),layout:v1};const b1=He([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),T1=He([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:E1}=b1;var cg=Ya;function Ya(i,e,n,o,c){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=c,i.readFields(S1,this,e)}function S1(i,e,n){i==1?e.id=n.readVarint():i==2?function(o,c){for(var d=o.readVarint()+o.pos;o.pos<d;){var p=c._keys[o.readVarint()],g=c._values[o.readVarint()];c.properties[p]=g}}(n,e):i==3?e.type=n.readVarint():i==4&&(e._geometry=n.pos)}function C1(i){for(var e,n,o=0,c=0,d=i.length,p=d-1;c<d;p=c++)o+=((n=i[p]).x-(e=i[c]).x)*(e.y+n.y);return o}Ya.types=["Unknown","Point","LineString","Polygon"],Ya.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var e,n=i.readVarint()+i.pos,o=1,c=0,d=0,p=0,g=[];i.pos<n;){if(c<=0){var y=i.readVarint();o=7&y,c=y>>3}if(c--,o===1||o===2)d+=i.readSVarint(),p+=i.readSVarint(),o===1&&(e&&g.push(e),e=[]),e.push(new ye(d,p));else{if(o!==7)throw new Error("unknown command "+o);e&&e.push(e[0].clone())}}return e&&g.push(e),g},Ya.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var e=i.readVarint()+i.pos,n=1,o=0,c=0,d=0,p=1/0,g=-1/0,y=1/0,w=-1/0;i.pos<e;){if(o<=0){var E=i.readVarint();n=7&E,o=E>>3}if(o--,n===1||n===2)(c+=i.readSVarint())<p&&(p=c),c>g&&(g=c),(d+=i.readSVarint())<y&&(y=d),d>w&&(w=d);else if(n!==7)throw new Error("unknown command "+n)}return[p,y,g,w]},Ya.prototype.toGeoJSON=function(i,e,n){var o,c,d=this.extent*Math.pow(2,n),p=this.extent*i,g=this.extent*e,y=this.loadGeometry(),w=Ya.types[this.type];function E(z){for(var O=0;O<z.length;O++){var U=z[O];z[O]=[360*(U.x+p)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+g)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(o=0;o<y.length;o++)C[o]=y[o][0];E(y=C);break;case 2:for(o=0;o<y.length;o++)E(y[o]);break;case 3:for(y=function(z){var O=z.length;if(O<=1)return[z];for(var U,W,Q=[],se=0;se<O;se++){var me=C1(z[se]);me!==0&&(W===void 0&&(W=me<0),W===me<0?(U&&Q.push(U),U=[z[se]]):U.push(z[se]))}return U&&Q.push(U),Q}(y),o=0;o<y.length;o++)for(c=0;c<y[o].length;c++)E(y[o][c])}y.length===1?y=y[0]:w="Multi"+w;var k={type:"Feature",geometry:{type:w,coordinates:y},properties:this.properties};return"id"in this&&(k.id=this.id),k};var ug=hg;function hg(i,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(k1,this,e),this.length=this._features.length}function k1(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push(function(o){for(var c=null,d=o.readVarint()+o.pos;o.pos<d;){var p=o.readVarint()>>3;c=p===1?o.readString():p===2?o.readFloat():p===3?o.readDouble():p===4?o.readVarint64():p===5?o.readVarint():p===6?o.readSVarint():p===7?o.readBoolean():null}return c}(n))}function I1(i,e,n){if(i===3){var o=new ug(n,n.readVarint()+n.pos);o.length&&(e[o.name]=o)}}hg.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var e=this._pbf.readVarint()+this._pbf.pos;return new cg(this._pbf,e,this.extent,this._keys,this._values)};var Ns={VectorTile:function(i,e){this.layers=i.readFields(I1,{},e)},VectorTileFeature:cg,VectorTileLayer:ug};const A1=Ns.VectorTileFeature.types,M1=Math.pow(2,13);function Dc(i,e,n,o,c,d,p,g){i.emplaceBack((e<<1)+p,(n<<1)+d,(Math.floor(o*M1)<<1)+c,Math.round(g))}class dg{constructor(){this.acc=new ye(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ye(e.x,e.y),this.max=new ye(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);let o=!!this.borders;const c=this.min,d=this.max;e.x<c.x?(c.x=e.x,o=!0):e.x>d.x&&(d.x=e.x,o=!0),e.y<c.y?(c.y=e.y,o=!0):e.y>d.y&&(d.y=e.y,o=!0),((e.x===0||e.x===Rt)&&e.x===n.x)!=((e.y===0||e.y===Rt)&&e.y===n.y)&&this.processBorderOverlap(e,n),o&&this.checkBorderIntersection(e,n)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Mt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Rt!=e.x>Rt&&this.addBorderIntersection(1,Mt(n.y,e.y,(Rt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Mt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Rt!=e.y>Rt&&this.addBorderIntersection(3,Mt(n.x,e.x,(Rt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const o=this.borders[e];n<o[0]&&(o[0]=n),n>o[1]&&(o[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const o=e.x===0?0:1;this.addBorderIntersection(o,n.y),this.addBorderIntersection(o,e.y)}else{const o=e.y===0?2:3;this.addBorderIntersection(o,n.x),this.addBorderIntersection(o,e.x)}}centroid(){const e=this.polyCount.reduce((n,o)=>n+o.edges,0);return e!==0?this.acc.div(e)._round():new ye(0,0)}span(){return new ye(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Bp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new ti,this.centroidVertexArray=new M_,this.indexArray=new Nt,this.programConfigurations=new Bs(e.layers,e.zoom),this.segments=new Vi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,o){this.features=[],this.hasPattern=Lp("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(c){const d=Math.exp(Math.PI*(1-c.y/(1<<c.z)*2));return 80150034*d/(d*d+1)/Rt/(1<<c.z)}(o);for(const{feature:c,id:d,index:p,sourceLayerIndex:g}of e){const y=this.layers[0]._featureFilter.needGeometry,w=Us(c,y);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),w,o))continue;const E={id:d,sourceLayerIndex:g,index:p,geometry:y?w.geometry:Os(c),properties:c.properties,type:c.type,patterns:{}},C=this.layoutVertexArray.length;this.hasPattern?this.features.push(Rp("fill-extrusion",this.layers,E,this.zoom,n)):this.addFeature(E,E.geometry,p,o,{}),n.featureIndex.insert(c,E.geometry,p,g,this.index,C)}this.sortBorders()}addFeatures(e,n,o){for(const c of this.features){const{geometry:d}=c;this.addFeature(c,d,c.index,n,o)}this.sortBorders()}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,E1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,T1.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,o,c,d){const p=this.enableTerrain?new dg:null;for(const y of Dp(n,500)){let w=0,E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(y.length===0||(g=y[0]).every(U=>U.x<=0)||g.every(U=>U.x>=Rt)||g.every(U=>U.y<=0)||g.every(U=>U.y>=Rt))continue;for(let U=0;U<y.length;U++){const W=y[U];if(W.length===0)continue;w+=W.length;let Q=0;p&&p.startRing(W[0]);for(let se=0;se<W.length;se++){const me=W[se];if(se>=1){const _e=W[se-1];if(!z1(me,_e)){p&&p.append(me,_e),E.vertexLength+4>Vi.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ge=me.sub(_e)._perp(),xe=ge.x/(Math.abs(ge.x)+Math.abs(ge.y)),Ce=ge.y>0?1:0,De=_e.dist(me);Q+De>32768&&(Q=0),Dc(this.layoutVertexArray,me.x,me.y,xe,Ce,0,0,Q),Dc(this.layoutVertexArray,me.x,me.y,xe,Ce,0,1,Q),Q+=De,Dc(this.layoutVertexArray,_e.x,_e.y,xe,Ce,0,0,Q),Dc(this.layoutVertexArray,_e.x,_e.y,xe,Ce,0,1,Q);const Le=E.vertexLength;this.indexArray.emplaceBack(Le,Le+2,Le+1),this.indexArray.emplaceBack(Le+1,Le+2,Le+3),E.vertexLength+=4,E.primitiveLength+=2}}}}if(E.vertexLength+w>Vi.MAX_VERTEX_ARRAY_LENGTH&&(E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),A1[e.type]!=="Polygon")continue;const C=[],k=[],z=E.vertexLength;for(let U=0;U<y.length;U++){const W=y[U];if(W.length!==0){W!==y[0]&&k.push(C.length/2);for(let Q=0;Q<W.length;Q++){const se=W[Q];Dc(this.layoutVertexArray,se.x,se.y,0,0,1,1,0),C.push(se.x),C.push(se.y),p&&p.currentPolyCount.top++}}}const O=Ap(C,k);for(let U=0;U<O.length;U+=3)this.indexArray.emplaceBack(z+O[U],z+O[U+2],z+O[U+1]);E.primitiveLength+=O.length/3,E.vertexLength+=w}var g;if(p&&p.polyCount.length>0){if(p.borders){p.vertexArrayOffset=this.centroidVertexArray.length;const y=p.borders,w=this.featuresOnBorder.push(p)-1;for(let E=0;E<4;E++)y[E][0]!==Number.MAX_VALUE&&this.borders[E].push(w)}this.encodeCentroid(p.borders?void 0:p.centroid(),p)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,o)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[o].borders[e][0])}encodeCentroid(e,n,o=!0){let c,d;if(e)if(e.y!==0){const g=n.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(g.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(g.y/10))}else c=Math.ceil(7*(e.x+450)),d=0;else c=0,d=+o;let p=o?this.centroidVertexArray.length:n.vertexArrayOffset;for(const g of n.polyCount){o&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*g.edges+g.top);for(let y=0;y<2*g.edges;y++)this.centroidVertexArray.emplace(p++,0,d),this.centroidVertexArray.emplace(p++,c,d);for(let y=0;y<g.top;y++)this.centroidVertexArray.emplace(p++,c,d)}}}function z1(i,e){return i.x===e.x&&(i.x<0||i.x>Rt)||i.y===e.y&&(i.y<0||i.y>Rt)}Xe("FillExtrusionBucket",Bp,{omit:["layers","features"]}),Xe("PartMetadata",dg);var P1={paint:new we({"fill-extrusion-opacity":new X(te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new le(te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new X(te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new X(te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Te(te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new le(te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new le(te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new X(te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Lc(i,e){return i.x*e.x+i.y*e.y}function pg(i,e){if(i.length===1){let n=0;const o=e[n++];let c;for(;!c||o.equals(c);)if(c=e[n++],!c)return 1/0;for(;n<e.length;n++){const d=e[n],p=i[0],g=c.sub(o),y=d.sub(o),w=p.sub(o),E=Lc(g,g),C=Lc(g,y),k=Lc(y,y),z=Lc(w,g),O=Lc(w,y),U=E*k-C*C,W=(k*z-C*O)/U,Q=(E*O-C*z)/U,se=o.z*(1-W-Q)+c.z*W+d.z*Q;if(isFinite(se))return se}return 1/0}{let n=1/0;for(const o of e)n=Math.min(n,o.z);return n}}function fg(i){const e=new ye(i[0],i[1]);return e.z=i[2],e}function D1(i,e,n,o,c,d,p,g){const y=p*c.getElevationAt(i,e,!0,!0),w=d[0]!==0,E=w?d[1]===0?p*(d[0]/7-450):p*function(C,k,z){const O=Math.floor(k[0]/8),U=Math.floor(k[1]/8),W=10*(k[0]-8*O),Q=10*(k[1]-8*U),se=C.getElevationAt(O,U,!0,!0),me=C.getMeterToDEM(z),_e=Math.floor(.5*(W*me-1)),ge=Math.floor(.5*(Q*me-1)),xe=C.tileCoordToPixel(O,U),Ce=2*_e+1,De=2*ge+1,Le=function(ot,We,Dt,at,Et){return[ot.getElevationAtPixel(We,Dt,!0),ot.getElevationAtPixel(We+Et,Dt,!0),ot.getElevationAtPixel(We,Dt+Et,!0),ot.getElevationAtPixel(We+at,Dt+Et,!0)]}(C,xe.x-_e,xe.y-ge,Ce,De),Oe=Math.abs(Le[0]-Le[1]),Ie=Math.abs(Le[2]-Le[3]),Pe=Math.abs(Le[0]-Le[2])+Math.abs(Le[1]-Le[3]),Ne=Math.min(.25,.5*me*(Oe+Ie)/Ce),Me=Math.min(.25,.5*me*Pe/De);return se+Math.max(Ne*W,Me*Q)}(c,d,g):y;return{base:y+(n===0)?-1:n,top:w?Math.max(E+o,y+n+2):y+o}}const L1=He([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:R1}=L1,F1=He([{name:"a_packed",components:3,type:"Float32"}]),{members:B1}=F1,O1=Ns.VectorTileFeature.types,U1=Math.cos(Math.PI/180*37.5);class Op{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Xt,this.layoutVertexArray2=new pt,this.indexArray=new Nt,this.programConfigurations=new Bs(e.layers,e.zoom),this.segments=new Vi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,o){this.hasPattern=Lp("line",this.layers,n);const c=this.layers[0].layout.get("line-sort-key"),d=[];for(const{feature:w,id:E,index:C,sourceLayerIndex:k}of e){const z=this.layers[0]._featureFilter.needGeometry,O=Us(w,z);if(!this.layers[0]._featureFilter.filter(new B(this.zoom),O,o))continue;const U=c?c.evaluate(O,{},o):void 0,W={id:E,properties:w.properties,type:w.type,sourceLayerIndex:k,index:C,geometry:z?O.geometry:Os(w),patterns:{},sortKey:U};d.push(W)}c&&d.sort((w,E)=>w.sortKey-E.sortKey);const{lineAtlas:p,featureIndex:g}=n,y=this.addConstantDashes(p);for(const w of d){const{geometry:E,index:C,sourceLayerIndex:k}=w;if(y&&this.addFeatureDashes(w,p),this.hasPattern){const z=Rp("line",this.layers,w,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(w,E,C,o,p.positions);g.insert(e[C].feature,E,C,k,this.index)}}addConstantDashes(e){let n=!1;for(const o of this.layers){const c=o.paint.get("line-dasharray").value,d=o.layout.get("line-cap").value;if(c.kind!=="constant"||d.kind!=="constant")n=!0;else{const p=d.value,g=c.value;if(!g)continue;e.addDash(g.from,p),e.addDash(g.to,p),g.other&&e.addDash(g.other,p)}}return n}addFeatureDashes(e,n){const o=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(d.kind==="constant"&&p.kind==="constant")continue;let g,y,w,E,C,k;if(d.kind==="constant"){const W=d.value;if(!W)continue;g=W.other||W.to,y=W.to,w=W.from}else g=d.evaluate({zoom:o-1},e),y=d.evaluate({zoom:o},e),w=d.evaluate({zoom:o+1},e);p.kind==="constant"?E=C=k=p.value:(E=p.evaluate({zoom:o-1},e),C=p.evaluate({zoom:o},e),k=p.evaluate({zoom:o+1},e)),n.addDash(g,E),n.addDash(y,C),n.addDash(w,k);const z=n.getKey(g,E),O=n.getKey(y,C),U=n.getKey(w,k);e.patterns[c.id]={min:z,mid:O,max:U}}}update(e,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,o)}addFeatures(e,n,o){for(const c of this.patternFeatures)this.addFeature(c,c.geometry,c.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,B1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,R1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,o,c,d){const p=this.layers[0].layout,g=p.get("line-join").evaluate(e,{}),y=p.get("line-cap").evaluate(e,{}),w=p.get("line-miter-limit"),E=p.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const C of n)this.addLine(C,e,g,y,w,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,o,d,c)}addLine(e,n,o,c,d,p){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const g=O1[n.type]==="Polygon";let y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let w=0;for(;w<y-1&&e[w].equals(e[w+1]);)w++;if(y<(g?3:2))return;o==="bevel"&&(d=1.05);const E=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray);let k,z,O,U,W;this.e1=this.e2=-1,g&&(k=e[y-2],W=e[w].sub(k)._unit()._perp());for(let Q=w;Q<y;Q++){if(O=Q===y-1?g?e[w+1]:void 0:e[Q+1],O&&e[Q].equals(O))continue;W&&(U=W),k&&(z=k),k=e[Q],W=O?O.sub(k)._unit()._perp():U,U=U||W;let se=U.add(W);se.x===0&&se.y===0||se._unit();const me=U.x*W.x+U.y*W.y,_e=se.x*W.x+se.y*W.y,ge=_e!==0?1/_e:1/0,xe=2*Math.sqrt(2-2*_e),Ce=_e<U1&&z&&O,De=U.x*W.y-U.y*W.x>0;if(Ce&&Q>w){const Ie=k.dist(z);if(Ie>2*E){const Pe=k.sub(k.sub(z)._mult(E/Ie)._round());this.updateDistance(z,Pe),this.addCurrentVertex(Pe,U,0,0,C),z=Pe}}const Le=z&&O;let Oe=Le?o:g?"butt":c;if(Le&&Oe==="round"&&(ge<p?Oe="miter":ge<=2&&(Oe="fakeround")),Oe==="miter"&&ge>d&&(Oe="bevel"),Oe==="bevel"&&(ge>2&&(Oe="flipbevel"),ge<d&&(Oe="miter")),z&&this.updateDistance(z,k),Oe==="miter")se._mult(ge),this.addCurrentVertex(k,se,0,0,C);else if(Oe==="flipbevel"){if(ge>100)se=W.mult(-1);else{const Ie=ge*U.add(W).mag()/U.sub(W).mag();se._perp()._mult(Ie*(De?-1:1))}this.addCurrentVertex(k,se,0,0,C),this.addCurrentVertex(k,se.mult(-1),0,0,C)}else if(Oe==="bevel"||Oe==="fakeround"){const Ie=-Math.sqrt(ge*ge-1),Pe=De?Ie:0,Ne=De?0:Ie;if(z&&this.addCurrentVertex(k,U,Pe,Ne,C),Oe==="fakeround"){const Me=Math.round(180*xe/Math.PI/20);for(let ot=1;ot<Me;ot++){let We=ot/Me;if(We!==.5){const at=We-.5;We+=We*at*(We-1)*((1.0904+me*(me*(3.55645-1.43519*me)-3.2452))*at*at+(.848013+me*(.215638*me-1.06021)))}const Dt=W.sub(U)._mult(We)._add(U)._unit()._mult(De?-1:1);this.addHalfVertex(k,Dt.x,Dt.y,!1,De,0,C)}}O&&this.addCurrentVertex(k,W,-Pe,-Ne,C)}else if(Oe==="butt")this.addCurrentVertex(k,se,0,0,C);else if(Oe==="square"){const Ie=z?1:-1;z||this.addCurrentVertex(k,se,Ie,Ie,C),this.addCurrentVertex(k,se,0,0,C),z&&this.addCurrentVertex(k,se,Ie,Ie,C)}else Oe==="round"&&(z&&(this.addCurrentVertex(k,U,0,0,C),this.addCurrentVertex(k,U,1,1,C,!0)),O&&(this.addCurrentVertex(k,W,-1,-1,C,!0),this.addCurrentVertex(k,W,0,0,C)));if(Ce&&Q<y-1){const Ie=k.dist(O);if(Ie>2*E){const Pe=k.add(O.sub(k)._mult(E/Ie)._round());this.updateDistance(k,Pe),this.addCurrentVertex(Pe,W,0,0,C),k=Pe}}}}addCurrentVertex(e,n,o,c,d,p=!1){const g=n.y*c-n.x,y=-n.y-n.x*c;this.addHalfVertex(e,n.x+n.y*o,n.y-n.x*o,p,!1,o,d),this.addHalfVertex(e,g,y,p,!0,-c,d)}addHalfVertex({x:e,y:n},o,c,d,p,g,y){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(n<<1)+(p?1:0),Math.round(63*o)+128,Math.round(63*c)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const w=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),y.primitiveLength++),p?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}Xe("LineBucket",Op,{omit:["layers","patternFeatures"]});const N1=new we({"line-cap":new le(te.layout_line["line-cap"]),"line-join":new le(te.layout_line["line-join"]),"line-miter-limit":new X(te.layout_line["line-miter-limit"]),"line-round-limit":new X(te.layout_line["line-round-limit"]),"line-sort-key":new le(te.layout_line["line-sort-key"])});var mg={paint:new we({"line-opacity":new le(te.paint_line["line-opacity"]),"line-color":new le(te.paint_line["line-color"]),"line-translate":new X(te.paint_line["line-translate"]),"line-translate-anchor":new X(te.paint_line["line-translate-anchor"]),"line-width":new le(te.paint_line["line-width"]),"line-gap-width":new le(te.paint_line["line-gap-width"]),"line-offset":new le(te.paint_line["line-offset"]),"line-blur":new le(te.paint_line["line-blur"]),"line-dasharray":new Te(te.paint_line["line-dasharray"]),"line-pattern":new Te(te.paint_line["line-pattern"]),"line-gradient":new ae(te.paint_line["line-gradient"])}),layout:N1};const _g=new class extends le{possiblyEvaluate(i,e){return e=new B(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(i,e)}evaluate(i,e,n,o){return e=St({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(i,e,n,o)}}(mg.paint.properties["line-width"].specification);function gg(i,e){return e>0?e+2*i:i}_g.useIntegerZoom=!0;const V1=He([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),j1=He([{name:"a_projected_pos",components:3,type:"Float32"}],4);He([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $1=He([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),G1=He([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yg=He([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Z1=He([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);He([{name:"triangle",components:3,type:"Uint16"}]),He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),He([{type:"Float32",name:"offsetX"}]),He([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Fi=24;const kr=128;function Up(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new B(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:c}=n;let d=0;for(;d<o.length&&o[d]<=i;)d++;d=Math.max(0,d-1);let p=d;for(;p<o.length&&o[p]<i+1;)p++;p=Math.min(o.length-1,p);const g=o[d],y=o[p];return n.kind==="composite"?{kind:"composite",minZoom:g,maxZoom:y,interpolationType:c}:{kind:"camera",minZoom:g,maxZoom:y,minSize:n.evaluate(new B(g)),maxSize:n.evaluate(new B(y)),interpolationType:c}}}function Fh(i,{uSize:e,uSizeT:n},{lowerSize:o,upperSize:c}){return i.kind==="source"?o/kr:i.kind==="composite"?Mt(o/kr,c/kr,n):e}function Ka(i,e){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:c,minZoom:d,maxZoom:p}=i,g=c?Be(cn.interpolationFactor(c,e,d,p),0,1):0;i.kind==="camera"?o=Mt(i.minSize,i.maxSize,g):n=g}return{uSizeT:n,uSize:o}}var q1=Object.freeze({__proto__:null,getSizeData:Up,evaluateSizeForFeature:Fh,evaluateSizeForZoom:Ka,SIZE_PACK_FACTOR:kr});function W1(i,e,n){return i.sections.forEach(o=>{o.text=function(c,d,p){const g=d.layout.get("text-transform").evaluate(p,{});return g==="uppercase"?c=c.toLocaleUpperCase():g==="lowercase"&&(c=c.toLocaleLowerCase()),F.applyArabicShaping&&(c=F.applyArabicShaping(c)),c}(o.text,e,n)}),i}const Rc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function X1(i){return i==="︶"||i==="﹈"||i==="︸"||i==="﹄"||i==="﹂"||i==="︾"||i==="︼"||i==="︺"||i==="︘"||i==="﹀"||i==="︐"||i==="︓"||i==="︔"||i==="｀"||i==="￣"||i==="︑"||i==="︒"}function H1(i){return i==="︵"||i==="﹇"||i==="︷"||i==="﹃"||i==="﹁"||i==="︽"||i==="︻"||i==="︹"||i==="︗"||i==="︿"}var xg=function(i,e,n,o,c){var d,p,g=8*c-o-1,y=(1<<g)-1,w=y>>1,E=-7,C=n?c-1:0,k=n?-1:1,z=i[e+C];for(C+=k,d=z&(1<<-E)-1,z>>=-E,E+=g;E>0;d=256*d+i[e+C],C+=k,E-=8);for(p=d&(1<<-E)-1,d>>=-E,E+=o;E>0;p=256*p+i[e+C],C+=k,E-=8);if(d===0)d=1-w;else{if(d===y)return p?NaN:1/0*(z?-1:1);p+=Math.pow(2,o),d-=w}return(z?-1:1)*p*Math.pow(2,d-o)},vg=function(i,e,n,o,c,d){var p,g,y,w=8*d-c-1,E=(1<<w)-1,C=E>>1,k=c===23?Math.pow(2,-24)-Math.pow(2,-77):0,z=o?0:d-1,O=o?1:-1,U=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,p=E):(p=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-p))<1&&(p--,y*=2),(e+=p+C>=1?k/y:k*Math.pow(2,1-C))*y>=2&&(p++,y/=2),p+C>=E?(g=0,p=E):p+C>=1?(g=(e*y-1)*Math.pow(2,c),p+=C):(g=e*Math.pow(2,C-1)*Math.pow(2,c),p=0));c>=8;i[n+z]=255&g,z+=O,g/=256,c-=8);for(p=p<<c|g,w+=c;w>0;i[n+z]=255&p,z+=O,p/=256,w-=8);i[n+z-O]|=128*U},Fc=Vt;function Vt(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Vt.Varint=0,Vt.Fixed64=1,Vt.Bytes=2,Vt.Fixed32=5;var Np=4294967296,wg=1/Np,bg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function no(i){return i.type===Vt.Bytes?i.readVarint()+i.pos:i.pos+1}function Qa(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Tg(i,e,n){var o=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(o);for(var c=n.pos-1;c>=i;c--)n.buf[c+o]=n.buf[c]}function Y1(i,e){for(var n=0;n<i.length;n++)e.writeVarint(i[n])}function K1(i,e){for(var n=0;n<i.length;n++)e.writeSVarint(i[n])}function Q1(i,e){for(var n=0;n<i.length;n++)e.writeFloat(i[n])}function J1(i,e){for(var n=0;n<i.length;n++)e.writeDouble(i[n])}function ew(i,e){for(var n=0;n<i.length;n++)e.writeBoolean(i[n])}function tw(i,e){for(var n=0;n<i.length;n++)e.writeFixed32(i[n])}function iw(i,e){for(var n=0;n<i.length;n++)e.writeSFixed32(i[n])}function nw(i,e){for(var n=0;n<i.length;n++)e.writeFixed64(i[n])}function rw(i,e){for(var n=0;n<i.length;n++)e.writeSFixed64(i[n])}function Bh(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+16777216*i[e+3]}function Ja(i,e,n){i[n]=e,i[n+1]=e>>>8,i[n+2]=e>>>16,i[n+3]=e>>>24}function Eg(i,e){return(i[e]|i[e+1]<<8|i[e+2]<<16)+(i[e+3]<<24)}function ow(i,e,n){e.glyphs=[],i===1&&n.readMessage(sw,e)}function sw(i,e,n){if(i===3){const{id:o,bitmap:c,width:d,height:p,left:g,top:y,advance:w}=n.readMessage(aw,{});e.glyphs.push({id:o,bitmap:new Ro({width:d+6,height:p+6},c),metrics:{width:d,height:p,left:g,top:y,advance:w}})}else i===4?e.ascender=n.readSVarint():i===5&&(e.descender=n.readSVarint())}function aw(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function Vp(i){let e=0,n=0;for(const p of i)e+=p.w*p.h,n=Math.max(n,p.w);i.sort((p,g)=>g.h-p.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let c=0,d=0;for(const p of i)for(let g=o.length-1;g>=0;g--){const y=o[g];if(!(p.w>y.w||p.h>y.h)){if(p.x=y.x,p.y=y.y,d=Math.max(d,p.y+p.h),c=Math.max(c,p.x+p.w),p.w===y.w&&p.h===y.h){const w=o.pop();g<o.length&&(o[g]=w)}else p.h===y.h?(y.x+=p.w,y.w-=p.w):p.w===y.w?(y.y+=p.h,y.h-=p.h):(o.push({x:y.x+p.w,y:y.y,w:y.w-p.w,h:p.h}),y.y+=p.h,y.h-=p.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}Vt.prototype={destroy:function(){this.buf=null},readFields:function(i,e,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),c=o>>3,d=this.pos;this.type=7&o,i(c,e,this),this.pos===d&&this.skip(o)}return e},readMessage:function(i,e){return this.readFields(i,e,this.readVarint()+this.pos)},readFixed32:function(){var i=Bh(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=Eg(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Bh(this.buf,this.pos)+Bh(this.buf,this.pos+4)*Np;return this.pos+=8,i},readSFixed64:function(){var i=Bh(this.buf,this.pos)+Eg(this.buf,this.pos+4)*Np;return this.pos+=8,i},readFloat:function(){var i=xg(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=xg(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var e,n,o=this.buf;return e=127&(n=o[this.pos++]),n<128?e:(e|=(127&(n=o[this.pos++]))<<7,n<128?e:(e|=(127&(n=o[this.pos++]))<<14,n<128?e:(e|=(127&(n=o[this.pos++]))<<21,n<128?e:function(c,d,p){var g,y,w=p.buf;if(g=(112&(y=w[p.pos++]))>>4,y<128||(g|=(127&(y=w[p.pos++]))<<3,y<128)||(g|=(127&(y=w[p.pos++]))<<10,y<128)||(g|=(127&(y=w[p.pos++]))<<17,y<128)||(g|=(127&(y=w[p.pos++]))<<24,y<128)||(g|=(1&(y=w[p.pos++]))<<31,y<128))return Qa(c,g,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var i=this.readVarint()+this.pos,e=this.pos;return this.pos=i,i-e>=12&&bg?function(n,o,c){return bg.decode(n.subarray(o,c))}(this.buf,e,i):function(n,o,c){for(var d="",p=o;p<c;){var g,y,w,E=n[p],C=null,k=E>239?4:E>223?3:E>191?2:1;if(p+k>c)break;k===1?E<128&&(C=E):k===2?(192&(g=n[p+1]))==128&&(C=(31&E)<<6|63&g)<=127&&(C=null):k===3?(y=n[p+2],(192&(g=n[p+1]))==128&&(192&y)==128&&((C=(15&E)<<12|(63&g)<<6|63&y)<=2047||C>=55296&&C<=57343)&&(C=null)):k===4&&(y=n[p+2],w=n[p+3],(192&(g=n[p+1]))==128&&(192&y)==128&&(192&w)==128&&((C=(15&E)<<18|(63&g)<<12|(63&y)<<6|63&w)<=65535||C>=1114112)&&(C=null)),C===null?(C=65533,k=1):C>65535&&(C-=65536,d+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),d+=String.fromCharCode(C),p+=k}return d}(this.buf,e,i)},readBytes:function(){var i=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,i);return this.pos=i,e},readPackedVarint:function(i,e){if(this.type!==Vt.Bytes)return i.push(this.readVarint(e));var n=no(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(e));return i},readPackedSVarint:function(i){if(this.type!==Vt.Bytes)return i.push(this.readSVarint());var e=no(this);for(i=i||[];this.pos<e;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Vt.Bytes)return i.push(this.readBoolean());var e=no(this);for(i=i||[];this.pos<e;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Vt.Bytes)return i.push(this.readFloat());var e=no(this);for(i=i||[];this.pos<e;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Vt.Bytes)return i.push(this.readDouble());var e=no(this);for(i=i||[];this.pos<e;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Vt.Bytes)return i.push(this.readFixed32());var e=no(this);for(i=i||[];this.pos<e;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Vt.Bytes)return i.push(this.readSFixed32());var e=no(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Vt.Bytes)return i.push(this.readFixed64());var e=no(this);for(i=i||[];this.pos<e;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Vt.Bytes)return i.push(this.readSFixed64());var e=no(this);for(i=i||[];this.pos<e;)i.push(this.readSFixed64());return i},skip:function(i){var e=7&i;if(e===Vt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Vt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Vt.Fixed32)this.pos+=4;else{if(e!==Vt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(i,e){this.writeVarint(i<<3|e)},realloc:function(i){for(var e=this.length||16;e<this.pos+i;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ja(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ja(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ja(this.buf,-1&i,this.pos),Ja(this.buf,Math.floor(i*wg),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ja(this.buf,-1&i,this.pos),Ja(this.buf,Math.floor(i*wg),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(e,n){var o,c;if(e>=0?(o=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(o=~(-e%4294967296))?o=o+1|0:(o=0,c=c+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(d,p,g){g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,d>>>=7,g.buf[g.pos++]=127&d|128,g.buf[g.pos]=127&(d>>>=7)}(o,0,n),function(d,p){var g=(7&d)<<4;p.buf[p.pos++]|=g|((d>>>=3)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d|((d>>>=7)?128:0),d&&(p.buf[p.pos++]=127&d)))))}(c,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(Boolean(i))},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var e=this.pos;this.pos=function(o,c,d){for(var p,g,y=0;y<c.length;y++){if((p=c.charCodeAt(y))>55295&&p<57344){if(!g){p>56319||y+1===c.length?(o[d++]=239,o[d++]=191,o[d++]=189):g=p;continue}if(p<56320){o[d++]=239,o[d++]=191,o[d++]=189,g=p;continue}p=g-55296<<10|p-56320|65536,g=null}else g&&(o[d++]=239,o[d++]=191,o[d++]=189,g=null);p<128?o[d++]=p:(p<2048?o[d++]=p>>6|192:(p<65536?o[d++]=p>>12|224:(o[d++]=p>>18|240,o[d++]=p>>12&63|128),o[d++]=p>>6&63|128),o[d++]=63&p|128)}return d}(this.buf,i,this.pos);var n=this.pos-e;n>=128&&Tg(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),vg(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),vg(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var e=i.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,e){this.pos++;var n=this.pos;i(e,this);var o=this.pos-n;o>=128&&Tg(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,e,n){this.writeTag(i,Vt.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(i,e){e.length&&this.writeMessage(i,Y1,e)},writePackedSVarint:function(i,e){e.length&&this.writeMessage(i,K1,e)},writePackedBoolean:function(i,e){e.length&&this.writeMessage(i,ew,e)},writePackedFloat:function(i,e){e.length&&this.writeMessage(i,Q1,e)},writePackedDouble:function(i,e){e.length&&this.writeMessage(i,J1,e)},writePackedFixed32:function(i,e){e.length&&this.writeMessage(i,tw,e)},writePackedSFixed32:function(i,e){e.length&&this.writeMessage(i,iw,e)},writePackedFixed64:function(i,e){e.length&&this.writeMessage(i,nw,e)},writePackedSFixed64:function(i,e){e.length&&this.writeMessage(i,rw,e)},writeBytesField:function(i,e){this.writeTag(i,Vt.Bytes),this.writeBytes(e)},writeFixed32Field:function(i,e){this.writeTag(i,Vt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(i,e){this.writeTag(i,Vt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(i,e){this.writeTag(i,Vt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(i,e){this.writeTag(i,Vt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(i,e){this.writeTag(i,Vt.Varint),this.writeVarint(e)},writeSVarintField:function(i,e){this.writeTag(i,Vt.Varint),this.writeSVarint(e)},writeStringField:function(i,e){this.writeTag(i,Vt.Bytes),this.writeString(e)},writeFloatField:function(i,e){this.writeTag(i,Vt.Fixed32),this.writeFloat(e)},writeDoubleField:function(i,e){this.writeTag(i,Vt.Fixed64),this.writeDouble(e)},writeBooleanField:function(i,e){this.writeVarintField(i,Boolean(e))}};class jp{constructor(e,{pixelRatio:n,version:o,stretchX:c,stretchY:d,content:p}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=c,this.stretchY=d,this.content=p,this.version=o}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Sg{constructor(e,n){const o={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,o,d),this.addImages(n,c,d);const{w:p,h:g}=Vp(d),y=new Fn({width:p||1,height:g||1});for(const w in e){const E=e[w],C=o[w].paddedRect;Fn.copy(E.data,y,{x:0,y:0},{x:C.x+1,y:C.y+1},E.data)}for(const w in n){const E=n[w],C=c[w].paddedRect,k=C.x+1,z=C.y+1,O=E.data.width,U=E.data.height;Fn.copy(E.data,y,{x:0,y:0},{x:k,y:z},E.data),Fn.copy(E.data,y,{x:0,y:U-1},{x:k,y:z-1},{width:O,height:1}),Fn.copy(E.data,y,{x:0,y:0},{x:k,y:z+U},{width:O,height:1}),Fn.copy(E.data,y,{x:O-1,y:0},{x:k-1,y:z},{width:1,height:U}),Fn.copy(E.data,y,{x:0,y:0},{x:k+O,y:z},{width:1,height:U})}this.image=y,this.iconPositions=o,this.patternPositions=c}addImages(e,n,o){for(const c in e){const d=e[c],p={x:0,y:0,w:d.data.width+2,h:d.data.height+2};o.push(p),n[c]=new jp(p,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in e.updatedImages)this.patchUpdatedImage(this.iconPositions[o],e.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],e.getImage(o),n)}patchUpdatedImage(e,n,o){if(!e||!n||e.version===n.version)return;e.version=n.version;const[c,d]=e.tl;o.update(n.data,void 0,{x:c,y:d})}}Xe("ImagePosition",jp),Xe("ImageAtlas",Sg);const Bn={horizontal:1,vertical:2,horizontalOnly:3};class Bc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const o=new Bc;return o.scale=e||1,o.fontStack=n,o}static forImage(e){const n=new Bc;return n.imageName=e,n}}class el{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const o=new el;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?o.addImageSection(d):o.addTextSection(d,n)}return o}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,o){let c="";for(let d=0;d<n.length;d++){const p=n.charCodeAt(d+1)||null,g=n.charCodeAt(d-1)||null;c+=!o&&(p&&bh(p)&&!Rc[n[d+1]]||g&&bh(g)&&!Rc[n[d-1]])||!Rc[n[d]]?n[d]:Rc[n[d]]}return c}(this.text,e)}trim(){let e=0;for(let o=0;o<this.text.length&&Oh[this.text.charCodeAt(o)];o++)e++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=e&&Oh[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const o=new el;return o.text=this.text.substring(e,n),o.sectionIndex=this.sectionIndex.slice(e,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Bc.forText(e.scale,e.fontStack||n));const o=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(o)}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Ye("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(Bc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Ye("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $p(i,e,n,o,c,d,p,g,y,w,E,C,k,z,O,U){const W=el.fromFeature(i,c);let Q;C===Bn.vertical&&W.verticalizePunctuation(k);const{processBidirectionalText:se,processStyledBidirectionalText:me}=F;if(se&&W.sections.length===1){Q=[];const xe=se(W.toString(),Gp(W,w,d,e,o,z,O));for(const Ce of xe){const De=new el;De.text=Ce,De.sections=W.sections;for(let Le=0;Le<Ce.length;Le++)De.sectionIndex.push(0);Q.push(De)}}else if(me){Q=[];const xe=me(W.text,W.sectionIndex,Gp(W,w,d,e,o,z,O));for(const Ce of xe){const De=new el;De.text=Ce[0],De.sectionIndex=Ce[1],De.sections=W.sections,Q.push(De)}}else Q=function(xe,Ce){const De=[],Le=xe.text;let Oe=0;for(const Ie of Ce)De.push(xe.substring(Oe,Ie)),Oe=Ie;return Oe<Le.length&&De.push(xe.substring(Oe,Le.length)),De}(W,Gp(W,w,d,e,o,z,O));const _e=[],ge={positionedLines:_e,text:W.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(xe,Ce,De,Le,Oe,Ie,Pe,Ne,Me,ot,We,Dt){let at=0,Et=0,it=0;const lt=Ne==="right"?1:Ne==="left"?0:.5;let kt=!1;for(const Ft of Oe){const Ut=Ft.getSections();for(const Ii of Ut){if(Ii.imageName)continue;const ci=Ce[Ii.fontStack];if(ci&&(kt=ci.ascender!==void 0&&ci.descender!==void 0,!kt))break}if(!kt)break}let ki=0;for(const Ft of Oe){Ft.trim();const Ut=Ft.getMaxScale(),Ii=(Ut-1)*Fi,ci={positionedGlyphs:[],lineOffset:0};xe.positionedLines[ki]=ci;const Ai=ci.positionedGlyphs;let Ti=0;if(!Ft.length()){Et+=Ie,++ki;continue}let jt=0,Hi=0;for(let Ht=0;Ht<Ft.length();Ht++){const ui=Ft.getSection(Ht),Yi=Ft.getSectionIndex(Ht),Mi=Ft.getCharCode(Ht);let pi=ui.scale,Lt=null,Ki=null,wn=null,hr=Fi,Wn=0;const dr=!(Me===Bn.horizontal||!We&&!Jr(Mi)||We&&(Oh[Mi]||(ni=Mi,hh(ni)||dh(ni)||ph(ni)||Rs(ni)||Cr(ni))));if(ui.imageName){const Ar=Le[ui.imageName];if(!Ar)continue;wn=ui.imageName,xe.iconsInText=xe.iconsInText||!0,Ki=Ar.paddedRect;const ji=Ar.displaySize;pi=pi*Fi/Dt,Lt={width:ji[0],height:ji[1],left:1,top:-3,advance:dr?ji[1]:ji[0],localGlyph:!1},Wn=kt?-Lt.height*pi:Ut*Fi-17-ji[1]*pi,hr=Lt.advance;const Mr=(dr?ji[0]:ji[1])*pi-Fi*Ut;Mr>0&&Mr>Ti&&(Ti=Mr)}else{const Ar=De[ui.fontStack];if(!Ar)continue;Ar[Mi]&&(Ki=Ar[Mi]);const ji=Ce[ui.fontStack];if(!ji)continue;const Mr=ji.glyphs[Mi];if(!Mr)continue;if(Lt=Mr.metrics,hr=Mi!==8203?Fi:0,kt){const $s=ji.ascender!==void 0?Math.abs(ji.ascender):0,On=ji.descender!==void 0?Math.abs(ji.descender):0,Nc=($s+On)*pi;jt<Nc&&(jt=Nc,Hi=($s-On)/2*pi),Wn=-$s*pi}else Wn=(Ut-pi)*Fi-17}dr?(xe.verticalizable=!0,Ai.push({glyph:Mi,imageName:wn,x:at,y:Et+Wn,vertical:dr,scale:pi,localGlyph:Lt.localGlyph,fontStack:ui.fontStack,sectionIndex:Yi,metrics:Lt,rect:Ki}),at+=hr*pi+ot):(Ai.push({glyph:Mi,imageName:wn,x:at,y:Et+Wn,vertical:dr,scale:pi,localGlyph:Lt.localGlyph,fontStack:ui.fontStack,sectionIndex:Yi,metrics:Lt,rect:Ki}),at+=Lt.advance*pi+ot)}Ai.length!==0&&(it=Math.max(at-ot,it),kt?Mg(Ai,lt,Ti,Hi,Ie*Ut/2):Mg(Ai,lt,Ti,0,Ie/2)),at=0;const ri=Ie*Ut+Ti;ci.lineOffset=Math.max(Ti,Ii),Et+=ri,++ki}var ni;const wi=Et,{horizontalAlign:bi,verticalAlign:li}=Zp(Pe);(function(Ft,Ut,Ii,ci,Ai,Ti){const jt=(Ut-Ii)*Ai,Hi=-Ti*ci;for(const ri of Ft)for(const Ht of ri.positionedGlyphs)Ht.x+=jt,Ht.y+=Hi})(xe.positionedLines,lt,bi,li,it,wi),xe.top+=-li*wi,xe.bottom=xe.top+wi,xe.left+=-bi*it,xe.right=xe.left+it,xe.hasBaseline=kt}(ge,e,n,o,Q,p,g,y,C,w,k,U),!function(xe){for(const Ce of xe)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(_e)&&ge}const Oh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Cg(i,e,n,o,c,d){if(e.imageName){const p=o[e.imageName];return p?p.displaySize[0]*e.scale*Fi/d+c:0}{const p=n[e.fontStack],g=p&&p.glyphs[i];return g?g.metrics.advance*e.scale+c:0}}function kg(i,e,n,o){const c=Math.pow(i-e,2);return o?i<e?c/2:2*c:c+Math.abs(n)*n}function cw(i,e,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),e!==41&&e!==65289||(o+=50),o}function Ig(i,e,n,o,c,d){let p=null,g=kg(e,n,c,d);for(const y of o){const w=kg(e-y.x,n,c,d)+y.badness;w<=g&&(p=y,g=w)}return{index:i,x:e,priorBreak:p,badness:g}}function Ag(i){return i?Ag(i.priorBreak).concat(i.index):[]}function Gp(i,e,n,o,c,d,p){if(d!=="point")return[];if(!i)return[];const g=[],y=function(k,z,O,U,W,Q){let se=0;for(let me=0;me<k.length();me++){const _e=k.getSection(me);se+=Cg(k.getCharCode(me),_e,U,W,z,Q)}return se/Math.max(1,Math.ceil(se/O))}(i,e,n,o,c,p),w=i.text.indexOf("​")>=0;let E=0;for(let k=0;k<i.length();k++){const z=i.getSection(k),O=i.getCharCode(k);if(Oh[O]||(E+=Cg(O,z,o,c,e,p)),k<i.length()-1){const U=!((C=O)<11904||!(xc(C)||yc(C)||Tc(C)||yh(C)||Na(C)||Ds(C)||vc(C)||Yr(C)||_h(C)||bc(C)||Ua(C)||Po(C)||gc(C)||mh(C)||fh(C)||wc(C)||Oa(C)||xh(C)||gh(C)||Ls(C)));(lw[O]||U||z.imageName)&&g.push(Ig(k+1,E,y,g,cw(O,i.getCharCode(k+1),U&&w),!1))}}var C;return Ag(Ig(i.length(),E,y,g,0,!0))}function Zp(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Mg(i,e,n,o,c){if(!(e||n||o||c))return;const d=i.length-1,p=i[d],g=(p.x+p.metrics.advance*p.scale)*e;for(let y=0;y<=d;y++)i[y].x-=g,i[y].y+=n+o+c}function uw(i,e,n){const{horizontalAlign:o,verticalAlign:c}=Zp(n),d=e[0]-i.displaySize[0]*o,p=e[1]-i.displaySize[1]*c;return{image:i,top:p,bottom:p+i.displaySize[1],left:d,right:d+i.displaySize[0]}}function zg(i,e,n,o,c,d){const p=i.image;let g;if(p.content){const W=p.content,Q=p.pixelRatio||1;g=[W[0]/Q,W[1]/Q,p.displaySize[0]-W[2]/Q,p.displaySize[1]-W[3]/Q]}const y=e.left*d,w=e.right*d;let E,C,k,z;n==="width"||n==="both"?(z=c[0]+y-o[3],C=c[0]+w+o[1]):(z=c[0]+(y+w-p.displaySize[0])/2,C=z+p.displaySize[0]);const O=e.top*d,U=e.bottom*d;return n==="height"||n==="both"?(E=c[1]+O-o[0],k=c[1]+U+o[2]):(E=c[1]+(O+U-p.displaySize[1])/2,k=E+p.displaySize[1]),{image:p,top:E,right:C,bottom:k,left:z,collisionPadding:g}}class Bo extends ye{constructor(e,n,o,c,d){super(e,n),this.angle=c,this.z=o,d!==void 0&&(this.segment=d)}clone(){return new Bo(this.x,this.y,this.z,this.angle,this.segment)}}function Pg(i,e,n,o,c){if(e.segment===void 0)return!0;let d=e,p=e.segment+1,g=0;for(;g>-n/2;){if(p--,p<0)return!1;g-=i[p].dist(d),d=i[p]}g+=i[p].dist(i[p+1]),p++;const y=[];let w=0;for(;g<n/2;){const E=i[p],C=i[p+1];if(!C)return!1;let k=i[p-1].angleTo(E)-E.angleTo(C);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:g,angleDelta:k}),w+=k;g-y[0].distance>o;)w-=y.shift().angleDelta;if(w>c)return!1;p++,g+=E.dist(C)}return!0}function Dg(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function Lg(i,e,n){return i?.6*e*n:0}function Rg(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function hw(i,e,n,o,c,d){const p=Lg(n,c,d),g=Rg(n,o)*d;let y=0;const w=Dg(i)/2;for(let E=0;E<i.length-1;E++){const C=i[E],k=i[E+1],z=C.dist(k);if(y+z>w){const O=(w-y)/z,U=Mt(C.x,k.x,O),W=Mt(C.y,k.y,O),Q=new Bo(U,W,0,k.angleTo(C),E);return!p||Pg(i,Q,g,p,e)?Q:void 0}y+=z}}function dw(i,e,n,o,c,d,p,g,y){const w=Lg(o,d,p),E=Rg(o,c),C=E*p,k=i[0].x===0||i[0].x===y||i[0].y===0||i[0].y===y;return e-C<e/4&&(e=C+e/4),Fg(i,k?e/2*g%e:(E/2+2*d)*p*g%e,e,w,n,C,k,!1,y)}function Fg(i,e,n,o,c,d,p,g,y){const w=d/2,E=Dg(i);let C=0,k=e-n,z=[];for(let O=0;O<i.length-1;O++){const U=i[O],W=i[O+1],Q=U.dist(W),se=W.angleTo(U);for(;k+n<C+Q;){k+=n;const me=(k-C)/Q,_e=Mt(U.x,W.x,me),ge=Mt(U.y,W.y,me);if(_e>=0&&_e<y&&ge>=0&&ge<y&&k-w>=0&&k+w<=E){const xe=new Bo(_e,ge,0,se,O);xe._round(),o&&!Pg(i,xe,d,o,c)||z.push(xe)}}C+=Q}return g||z.length||p||(z=Fg(i,C/2,n,o,c,d,p,!0,y)),z}function Bg(i,e,n,o,c){const d=[];for(let p=0;p<i.length;p++){const g=i[p];let y;for(let w=0;w<g.length-1;w++){let E=g[w],C=g[w+1];E.x<e&&C.x<e||(E.x<e?E=new ye(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x<e&&(C=new ye(e,E.y+(e-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y<n&&C.y<n||(E.y<n?E=new ye(E.x+(n-E.y)/(C.y-E.y)*(C.x-E.x),n)._round():C.y<n&&(C=new ye(E.x+(n-E.y)/(C.y-E.y)*(C.x-E.x),n)._round()),E.x>=o&&C.x>=o||(E.x>=o?E=new ye(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round():C.x>=o&&(C=new ye(o,E.y+(o-E.x)/(C.x-E.x)*(C.y-E.y))._round()),E.y>=c&&C.y>=c||(E.y>=c?E=new ye(E.x+(c-E.y)/(C.y-E.y)*(C.x-E.x),c)._round():C.y>=c&&(C=new ye(E.x+(c-E.y)/(C.y-E.y)*(C.x-E.x),c)._round()),y&&E.equals(y[y.length-1])||(y=[E],d.push(y)),y.push(C)))))}}return d}Xe("Anchor",Bo);const Oc=1e20;function Og(i,e,n,o,c,d,p,g,y){for(let w=e;w<e+o;w++)Ug(i,n*d+w,d,c,p,g,y);for(let w=n;w<n+c;w++)Ug(i,w*d+e,1,o,p,g,y)}function Ug(i,e,n,o,c,d,p){d[0]=0,p[0]=-Oc,p[1]=Oc,c[0]=i[e];for(let g=1,y=0,w=0;g<o;g++){c[g]=i[e+g*n];const E=g*g;do{const C=d[y];w=(c[g]-c[C]+E-C*C)/(g-C)/2}while(w<=p[y]&&--y>-1);y++,d[y]=g,p[y]=w,p[y+1]=Oc}for(let g=0,y=0;g<o;g++){for(;p[y+1]<g;)y++;const w=d[y],E=g-w;i[e+g*n]=c[w]+E*E}}const qp={none:0,ideographs:1,all:2};class tl{constructor(e,n,o){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=o,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const o=[];for(const c in e)for(const d of e[c])o.push({stack:c,id:d});ht(o,({stack:c,id:d},p)=>{let g=this.entries[c];g||(g=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let y=g.glyphs[d];if(y!==void 0)return void p(null,{stack:c,id:d,glyph:y});if(y=this._tinySDF(g,c,d),y)return g.glyphs[d]=y,void p(null,{stack:c,id:d,glyph:y});const w=Math.floor(d/256);if(256*w>65535)return void p(new Error("glyphs > 65535 not supported"));if(g.ranges[w])return void p(null,{stack:c,id:d,glyph:y});let E=g.requests[w];E||(E=g.requests[w]=[],tl.loadGlyphRange(c,w,this.url,this.requestManager,(C,k)=>{if(k){g.ascender=k.ascender,g.descender=k.descender;for(const z in k.glyphs)this._doesCharSupportLocalGlyph(+z)||(g.glyphs[+z]=k.glyphs[+z]);g.ranges[w]=!0}for(const z of E)z(C,k);delete g.requests[w]})),E.push((C,k)=>{C?p(C):k&&p(null,{stack:c,id:d,glyph:k.glyphs[d]||null})})},(c,d)=>{if(c)n(c);else if(d){const p={};for(const{stack:g,id:y,glyph:w}of d)p[g]===void 0&&(p[g]={}),p[g].glyphs===void 0&&(p[g].glyphs={}),p[g].glyphs[y]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},p[g].ascender=this.entries[g].ascender,p[g].descender=this.entries[g].descender;n(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==qp.none&&(this.localGlyphMode===qp.all?!!this.localFontFamily:!!this.localFontFamily&&(bc(e)||Kr(e)||gc(e)||Oa(e))||Yr(e))}_tinySDF(e,n,o){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(o))return;let d=e.tinySDF;if(!d){let U="400";/bold/i.test(n)?U="900":/medium/i.test(n)?U="500":/light/i.test(n)&&(U="200"),d=e.tinySDF=new tl.TinySDF({fontFamily:c,fontWeight:U,fontSize:48,buffer:6,radius:16}),d.fontWeight=U}if(this.localGlyphs[d.fontWeight][o])return this.localGlyphs[d.fontWeight][o];const p=String.fromCharCode(o),{data:g,width:y,height:w,glyphWidth:E,glyphHeight:C,glyphLeft:k,glyphTop:z,glyphAdvance:O}=d.draw(p);return this.localGlyphs[d.fontWeight][o]={id:o,bitmap:new Ro({width:y,height:w},g),metrics:{width:E/2,height:C/2,left:k/2,top:z/2-27,advance:O/2,localGlyph:!0}}}}function Ng(i,e,n,o){const c=[],d=i.image,p=d.pixelRatio,g=d.paddedRect.w-2,y=d.paddedRect.h-2,w=i.right-i.left,E=i.bottom-i.top,C=d.stretchX||[[0,g]],k=d.stretchY||[[0,y]],z=(Ie,Pe)=>Ie+Pe[1]-Pe[0],O=C.reduce(z,0),U=k.reduce(z,0),W=g-O,Q=y-U;let se=0,me=O,_e=0,ge=U,xe=0,Ce=W,De=0,Le=Q;if(d.content&&o){const Ie=d.content;se=Uh(C,0,Ie[0]),_e=Uh(k,0,Ie[1]),me=Uh(C,Ie[0],Ie[2]),ge=Uh(k,Ie[1],Ie[3]),xe=Ie[0]-se,De=Ie[1]-_e,Ce=Ie[2]-Ie[0]-me,Le=Ie[3]-Ie[1]-ge}const Oe=(Ie,Pe,Ne,Me)=>{const ot=Nh(Ie.stretch-se,me,w,i.left),We=Vh(Ie.fixed-xe,Ce,Ie.stretch,O),Dt=Nh(Pe.stretch-_e,ge,E,i.top),at=Vh(Pe.fixed-De,Le,Pe.stretch,U),Et=Nh(Ne.stretch-se,me,w,i.left),it=Vh(Ne.fixed-xe,Ce,Ne.stretch,O),lt=Nh(Me.stretch-_e,ge,E,i.top),kt=Vh(Me.fixed-De,Le,Me.stretch,U),ki=new ye(ot,Dt),ni=new ye(Et,Dt),wi=new ye(Et,lt),bi=new ye(ot,lt),li=new ye(We/p,at/p),Ft=new ye(it/p,kt/p),Ut=e*Math.PI/180;if(Ut){const Ai=Math.sin(Ut),Ti=Math.cos(Ut),jt=[Ti,-Ai,Ai,Ti];ki._matMult(jt),ni._matMult(jt),bi._matMult(jt),wi._matMult(jt)}const Ii=Ie.stretch+Ie.fixed,ci=Pe.stretch+Pe.fixed;return{tl:ki,tr:ni,bl:bi,br:wi,tex:{x:d.paddedRect.x+1+Ii,y:d.paddedRect.y+1+ci,w:Ne.stretch+Ne.fixed-Ii,h:Me.stretch+Me.fixed-ci},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:li,pixelOffsetBR:Ft,minFontScaleX:Ce/p/w,minFontScaleY:Le/p/E,isSDF:n}};if(o&&(d.stretchX||d.stretchY)){const Ie=Vg(C,W,O),Pe=Vg(k,Q,U);for(let Ne=0;Ne<Ie.length-1;Ne++){const Me=Ie[Ne],ot=Ie[Ne+1];for(let We=0;We<Pe.length-1;We++)c.push(Oe(Me,Pe[We],ot,Pe[We+1]))}}else c.push(Oe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:g+1},{fixed:0,stretch:y+1}));return c}function Uh(i,e,n){let o=0;for(const c of i)o+=Math.max(e,Math.min(n,c[1]))-Math.max(e,Math.min(n,c[0]));return o}function Vg(i,e,n){const o=[{fixed:-1,stretch:0}];for(const[c,d]of i){const p=o[o.length-1];o.push({fixed:c-p.stretch,stretch:p.stretch}),o.push({fixed:c-p.stretch,stretch:p.stretch+(d-c)})}return o.push({fixed:e+1,stretch:n}),o}function Nh(i,e,n,o){return i/e*n+o}function Vh(i,e,n,o){return i-e*n/o}function pw(i,e,n,o){const c=e+i.positionedLines[o].lineOffset;return o===0?n+c/2:n+(c+(e+i.positionedLines[o-1].lineOffset))/2}tl.loadGlyphRange=function(i,e,n,o,c){const d=256*e,p=d+255,g=o.transformRequest(o.normalizeGlyphsURL(n).replace("{fontstack}",i).replace("{range}",`${d}-${p}`),$r.Glyphs);P(g,(y,w)=>{if(y)c(y);else if(w){const E={},C=function(k){return new Fc(k).readFields(ow,{})}(w);for(const k of C.glyphs)E[k.id]=k;c(null,{glyphs:E,ascender:C.ascender,descender:C.descender})}})},tl.TinySDF=class{constructor({fontSize:i=24,buffer:e=3,radius:n=8,cutoff:o=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:p="normal"}){this.buffer=e,this.cutoff=o,this.radius=n;const g=this.size=i+4*e,y=this._createCanvas(g),w=this.ctx=y.getContext("2d",{willReadFrequently:!0});w.font=`${p} ${d} ${i}px ${c}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(i){const e=document.createElement("canvas");return e.width=e.height=i,e}draw(i){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:o,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(i),p=Math.floor(n),g=Math.min(this.size-this.buffer,Math.ceil(d-c)),y=Math.min(this.size-this.buffer,Math.ceil(n)+Math.ceil(o)),w=g+2*this.buffer,E=y+2*this.buffer,C=w*E,k=new Uint8ClampedArray(C),z={data:k,width:w,height:E,glyphWidth:g,glyphHeight:y,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(g===0||y===0)return z;const{ctx:O,buffer:U,gridInner:W,gridOuter:Q}=this;O.clearRect(U,U,g,y),O.fillText(i,U,U+p+1);const se=O.getImageData(U,U,g,y);Q.fill(Oc,0,C),W.fill(0,0,C);for(let me=0;me<y;me++)for(let _e=0;_e<g;_e++){const ge=se.data[4*(me*g+_e)+3]/255;if(ge===0)continue;const xe=(me+U)*w+_e+U;if(ge===1)Q[xe]=0,W[xe]=Oc;else{const Ce=.5-ge;Q[xe]=Ce>0?Ce*Ce:0,W[xe]=Ce<0?Ce*Ce:0}}Og(Q,0,0,w,E,w,this.f,this.v,this.z),Og(W,U,U,g,y,w,this.f,this.v,this.z);for(let me=0;me<C;me++){const _e=Math.sqrt(Q[me])-Math.sqrt(W[me]);k[me]=Math.round(255-255*(_e/this.radius+this.cutoff))}return z}};class fw{constructor(e=[],n=mw){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,c=n[e];for(;e>0;){const d=e-1>>1,p=n[d];if(o(c,p)>=0)break;n[e]=p,e=d}n[e]=c}_down(e){const{data:n,compare:o}=this,c=this.length>>1,d=n[e];for(;e<c;){let p=1+(e<<1),g=n[p];const y=p+1;if(y<this.length&&o(n[y],g)<0&&(p=y,g=n[y]),o(g,d)>=0)break;n[e]=g,e=p}n[e]=d}}function mw(i,e){return i<e?-1:i>e?1:0}function _w(i,e=1,n=!1){let o=1/0,c=1/0,d=-1/0,p=-1/0;const g=i[0];for(let z=0;z<g.length;z++){const O=g[z];(!z||O.x<o)&&(o=O.x),(!z||O.y<c)&&(c=O.y),(!z||O.x>d)&&(d=O.x),(!z||O.y>p)&&(p=O.y)}const y=Math.min(d-o,p-c);let w=y/2;const E=new fw([],gw);if(y===0)return new ye(o,c);for(let z=o;z<d;z+=y)for(let O=c;O<p;O+=y)E.push(new il(z+w,O+w,w,i));let C=function(z){let O=0,U=0,W=0;const Q=z[0];for(let se=0,me=Q.length,_e=me-1;se<me;_e=se++){const ge=Q[se],xe=Q[_e],Ce=ge.x*xe.y-xe.x*ge.y;U+=(ge.x+xe.x)*Ce,W+=(ge.y+xe.y)*Ce,O+=3*Ce}return new il(U/O,W/O,0,z)}(i),k=E.length;for(;E.length;){const z=E.pop();(z.d>C.d||!C.d)&&(C=z,n&&console.log("found best %d after %d probes",Math.round(1e4*z.d)/1e4,k)),z.max-C.d<=e||(w=z.h/2,E.push(new il(z.p.x-w,z.p.y-w,w,i)),E.push(new il(z.p.x+w,z.p.y-w,w,i)),E.push(new il(z.p.x-w,z.p.y+w,w,i)),E.push(new il(z.p.x+w,z.p.y+w,w,i)),k+=4)}return n&&(console.log(`num probes: ${k}`),console.log(`best distance: ${C.d}`)),C.p}function gw(i,e){return e.max-i.max}function il(i,e,n,o){this.p=new ye(i,e),this.h=n,this.d=function(c,d){let p=!1,g=1/0;for(let y=0;y<d.length;y++){const w=d[y];for(let E=0,C=w.length,k=C-1;E<C;k=E++){const z=w[E],O=w[k];z.y>c.y!=O.y>c.y&&c.x<(O.x-z.x)*(c.y-z.y)/(O.y-z.y)+z.x&&(p=!p),g=Math.min(g,U_(c,z,O))}}return(p?1:-1)*Math.sqrt(g)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}const Wp=Number.POSITIVE_INFINITY,yw=Math.sqrt(2);function jg(i,e){return e[1]!==Wp?function(n,o,c){let d=0,p=0;switch(o=Math.abs(o),c=Math.abs(c),n){case"top-right":case"top-left":case"top":p=c-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-c}switch(n){case"top-right":case"bottom-right":case"right":d=-o;break;case"top-left":case"bottom-left":case"left":d=o}return[d,p]}(i,e[0],e[1]):function(n,o){let c=0,d=0;o<0&&(o=0);const p=o/yw;switch(n){case"top-right":case"top-left":d=p-7;break;case"bottom-right":case"bottom-left":d=7-p;break;case"bottom":d=7-o;break;case"top":d=o-7}switch(n){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=o;break;case"right":c=-o}return[c,d]}(i,e[0])}function xw(i,e,n,o,c,d,p,g){i.createArrays(),i.tilePixelRatio=Rt/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const y=i.layers[0].layout,w=i.layers[0]._unevaluatedLayout._values,E={};if(i.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:O}=i.textSizeData;E.compositeTextSizes=[w["text-size"].possiblyEvaluate(new B(z),p),w["text-size"].possiblyEvaluate(new B(O),p)]}if(i.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:O}=i.iconSizeData;E.compositeIconSizes=[w["icon-size"].possiblyEvaluate(new B(z),p),w["icon-size"].possiblyEvaluate(new B(O),p)]}E.layoutTextSize=w["text-size"].possiblyEvaluate(new B(g+1),p),E.layoutIconSize=w["icon-size"].possiblyEvaluate(new B(g+1),p),E.textMaxSize=w["text-size"].possiblyEvaluate(new B(18),p);const C=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point",k=y.get("text-size");for(const z of i.features){const O=y.get("text-font").evaluate(z,{},p).join(","),U=k.evaluate(z,{},p),W=E.layoutTextSize.evaluate(z,{},p),Q=(E.layoutIconSize.evaluate(z,{},p),{horizontal:{},vertical:void 0}),se=z.text;let me,_e=[0,0];if(se){const Ce=se.toString(),De=y.get("text-letter-spacing").evaluate(z,{},p)*Fi,Le=y.get("text-line-height").evaluate(z,{},p)*Fi,Oe=gp(Ce)?De:0,Ie=y.get("text-anchor").evaluate(z,{},p),Pe=y.get("text-variable-anchor");if(!Pe){const at=y.get("text-radial-offset").evaluate(z,{},p);_e=at?jg(Ie,[at*Fi,Wp]):y.get("text-offset").evaluate(z,{},p).map(Et=>Et*Fi)}let Ne=C?"center":y.get("text-justify").evaluate(z,{},p);const Me=y.get("symbol-placement"),ot=Me==="point",We=Me==="point"?y.get("text-max-width").evaluate(z,{},p)*Fi:0,Dt=at=>{i.allowVerticalPlacement&&Qr(Ce)&&(Q.vertical=$p(se,e,n,c,O,We,Le,Ie,at,Oe,_e,Bn.vertical,!0,Me,W,U))};if(!C&&Pe){const at=Ne==="auto"?Pe.map(it=>Xp(it)):[Ne];let Et=!1;for(let it=0;it<at.length;it++){const lt=at[it];if(!Q.horizontal[lt])if(Et)Q.horizontal[lt]=Q.horizontal[0];else{const kt=$p(se,e,n,c,O,We,Le,"center",lt,Oe,_e,Bn.horizontal,!1,Me,W,U);kt&&(Q.horizontal[lt]=kt,Et=kt.positionedLines.length===1)}}Dt("left")}else{if(Ne==="auto"&&(Ne=Xp(Ie)),ot||y.get("text-writing-mode").indexOf("horizontal")>=0||!Qr(Ce)){const at=$p(se,e,n,c,O,We,Le,Ie,Ne,Oe,_e,Bn.horizontal,!1,Me,W,U);at&&(Q.horizontal[Ne]=at)}Dt(Me==="point"?"left":Ne)}}let ge=!1;if(z.icon&&z.icon.name){const Ce=o[z.icon.name];Ce&&(me=uw(c[z.icon.name],y.get("icon-offset").evaluate(z,{},p),y.get("icon-anchor").evaluate(z,{},p)),ge=Ce.sdf,i.sdfIcons===void 0?i.sdfIcons=Ce.sdf:i.sdfIcons!==Ce.sdf&&Ye("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ce.pixelRatio!==i.pixelRatio||y.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const xe=Gg(Q.horizontal)||Q.vertical;i.iconsInText||(i.iconsInText=!!xe&&xe.iconsInText),(xe||me)&&vw(i,z,Q,me,o,E,W,0,_e,ge,p)}d&&i.generateCollisionDebugBuffers(g,i.collisionBoxArray)}function Xp(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vw(i,e,n,o,c,d,p,g,y,w,E){let C=d.textMaxSize.evaluate(e,{},E);C===void 0&&(C=p);const k=i.layers[0].layout,z=k.get("icon-offset").evaluate(e,{},E),O=Gg(n.horizontal)||n.vertical,U=p/24,W=i.tilePixelRatio*C/24,Q=i.tilePixelRatio*k.get("symbol-spacing"),se=k.get("text-padding")*i.tilePixelRatio,me=k.get("icon-padding")*i.tilePixelRatio,_e=ne(k.get("text-max-angle")),ge=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",xe=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Ce=k.get("symbol-placement"),De=Q/2,Le=k.get("icon-text-fit");let Oe;o&&Le!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Oe=zg(o,n.vertical,Le,k.get("icon-text-fit-padding"),z,U)),O&&(o=zg(o,O,Le,k.get("icon-text-fit-padding"),z,U)));const Ie=(Pe,Ne)=>{Ne.x<0||Ne.x>=Rt||Ne.y<0||Ne.y>=Rt||function(Me,ot,We,Dt,at,Et,it,lt,kt,ki,ni,wi,bi,li,Ft,Ut,Ii,ci,Ai,Ti,jt,Hi,ri,Ht){const ui=Me.addToLineVertexArray(ot,Dt);let Yi,Mi,pi,Lt,Ki,wn,hr,Wn=0,dr=0,Ar=0,ji=0,Mr=-1,$s=-1;const On={};let Nc=Sc(""),hf=0,df=0;if(kt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[hf,df]=kt.layout.get("text-offset").evaluate(jt,{},Ht).map(bn=>bn*Fi):(hf=kt.layout.get("text-radial-offset").evaluate(jt,{},Ht)*Fi,df=Wp),Me.allowVerticalPlacement&&at.vertical){const bn=at.vertical;if(Ft)wn=Hp(bn),lt&&(hr=Hp(lt));else{const Tn=kt.layout.get("text-rotate").evaluate(jt,{},Ht)+90;pi=jh(ki,We,ot,ni,wi,bi,bn,li,Tn,Ut),lt&&(Lt=jh(ki,We,ot,ni,wi,bi,lt,ci,Tn))}}if(Et){const bn=kt.layout.get("icon-rotate").evaluate(jt,{},Ht),Tn=kt.layout.get("icon-text-fit")!=="none",Vc=Ng(Et,bn,ri,Tn),ff=lt?Ng(lt,bn,ri,Tn):void 0;Mi=jh(ki,We,ot,ni,wi,bi,Et,ci,bn),Wn=4*Vc.length;const by=Me.iconSizeData;let Gs=null;by.kind==="source"?(Gs=[kr*kt.layout.get("icon-size").evaluate(jt,{},Ht)],Gs[0]>Oo&&Ye(`${Me.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):by.kind==="composite"&&(Gs=[kr*Hi.compositeIconSizes[0].evaluate(jt,{},Ht),kr*Hi.compositeIconSizes[1].evaluate(jt,{},Ht)],(Gs[0]>Oo||Gs[1]>Oo)&&Ye(`${Me.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Me.addSymbols(Me.icon,Vc,Gs,Ti,Ai,jt,!1,We,ot,ui.lineStartIndex,ui.lineLength,-1,Ht),Mr=Me.icon.placedSymbolArray.length-1,ff&&(dr=4*ff.length,Me.addSymbols(Me.icon,ff,Gs,Ti,Ai,jt,Bn.vertical,We,ot,ui.lineStartIndex,ui.lineLength,-1,Ht),$s=Me.icon.placedSymbolArray.length-1)}for(const bn in at.horizontal){const Tn=at.horizontal[bn];Yi||(Nc=Sc(Tn.text),Ft?Ki=Hp(Tn):Yi=jh(ki,We,ot,ni,wi,bi,Tn,li,kt.layout.get("text-rotate").evaluate(jt,{},Ht),Ut));const Vc=Tn.positionedLines.length===1;if(Ar+=$g(Me,We,ot,Tn,it,kt,Ft,jt,Ut,ui,at.vertical?Bn.horizontal:Bn.horizontalOnly,Vc?Object.keys(at.horizontal):[bn],On,Mr,Hi,Ht),Vc)break}at.vertical&&(ji+=$g(Me,We,ot,at.vertical,it,kt,Ft,jt,Ut,ui,Bn.vertical,["vertical"],On,$s,Hi,Ht));let Vo=-1;const pf=(bn,Tn)=>bn?Math.max(bn,Tn):Tn;Vo=pf(Ki,Vo),Vo=pf(wn,Vo),Vo=pf(hr,Vo);const Uw=Vo>-1?1:0;Me.glyphOffsetArray.length>=Uo.MAX_GLYPHS&&Ye("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jt.sortKey!==void 0&&Me.addToSortKeyRanges(Me.symbolInstances.length,jt.sortKey),Me.symbolInstances.emplaceBack(We.x,We.y,We.z,ot.x,ot.y,On.right>=0?On.right:-1,On.center>=0?On.center:-1,On.left>=0?On.left:-1,On.vertical>=0?On.vertical:-1,Mr,$s,Nc,Yi!==void 0?Yi:Me.collisionBoxArray.length,Yi!==void 0?Yi+1:Me.collisionBoxArray.length,pi!==void 0?pi:Me.collisionBoxArray.length,pi!==void 0?pi+1:Me.collisionBoxArray.length,Mi!==void 0?Mi:Me.collisionBoxArray.length,Mi!==void 0?Mi+1:Me.collisionBoxArray.length,Lt||Me.collisionBoxArray.length,Lt?Lt+1:Me.collisionBoxArray.length,ni,Ar,ji,Wn,dr,Uw,0,hf,df,Vo)}(i,Ne,Ne,Pe,n,o,c,Oe,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,se,ge,y,0,me,xe,z,e,d,w,E)};if(Ce==="line")for(const Pe of Bg(e.geometry,0,0,Rt,Rt)){const Ne=dw(Pe,Q,_e,n.vertical||O,o,24,W,i.overscaling,Rt);for(const Me of Ne){const ot=O;ot&&ww(i,ot.text,De,Me)||Ie(Pe,Me)}}else if(Ce==="line-center"){for(const Pe of e.geometry)if(Pe.length>1){const Ne=hw(Pe,_e,n.vertical||O,o,24,W);Ne&&Ie(Pe,Ne)}}else if(e.type==="Polygon")for(const Pe of Dp(e.geometry,0)){const Ne=_w(Pe,16);Ie(Pe[0],new Bo(Ne.x,Ne.y,0,0,void 0))}else if(e.type==="LineString")for(const Pe of e.geometry)Ie(Pe,new Bo(Pe[0].x,Pe[0].y,0,0,void 0));else if(e.type==="Point")for(const Pe of e.geometry)for(const Ne of Pe)Ie([Ne],new Bo(Ne.x,Ne.y,0,0,void 0))}const Oo=32640;function $g(i,e,n,o,c,d,p,g,y,w,E,C,k,z,O,U){const W=function(me,_e,ge,xe,Ce,De,Le,Oe){const Ie=[];if(_e.positionedLines.length===0)return Ie;const Pe=xe.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,Ne=function(at){const Et=at[0],it=at[1],lt=Et*it;return lt>0?[Et,-it]:lt<0?[-Et,it]:Et===0?[it,Et]:[it,-Et]}(ge);let Me=Math.abs(_e.top-_e.bottom);for(const at of _e.positionedLines)Me-=at.lineOffset;const ot=_e.positionedLines.length,We=Me/ot;let Dt=_e.top-ge[1];for(let at=0;at<ot;++at){const Et=_e.positionedLines[at];Dt=pw(_e,We,Dt,at);for(const it of Et.positionedGlyphs){if(!it.rect)continue;const lt=it.rect||{};let kt=4,ki=!0,ni=1,wi=0;if(it.imageName){const Lt=Le[it.imageName];if(!Lt)continue;if(Lt.sdf){Ye("SDF images are not supported in formatted text and will be ignored.");continue}ki=!1,ni=Lt.pixelRatio,kt=1/ni}const bi=(Ce||Oe)&&it.vertical,li=it.metrics.advance*it.scale/2,Ft=it.metrics,Ut=it.rect;if(Ut===null)continue;Oe&&_e.verticalizable&&(wi=it.imageName?li-it.metrics.width*it.scale/2:0);const Ii=Ce?[it.x+li,it.y]:[0,0];let ci=[0,0],Ai=[0,0],Ti=!1;Ce||(bi?(Ai=[it.x+li+Ne[0],it.y+Ne[1]-wi],Ti=!0):ci=[it.x+li+ge[0],it.y+ge[1]-wi]);const jt=Ut.w*it.scale/(ni*(it.localGlyph?2:1)),Hi=Ut.h*it.scale/(ni*(it.localGlyph?2:1));let ri,Ht,ui,Yi;if(bi){const Lt=it.y-Dt,Ki=new ye(-li,li-Lt),wn=-Math.PI/2,hr=new ye(...Ai);ri=new ye(-li+ci[0],ci[1]),ri._rotateAround(wn,Ki)._add(hr),ri.x+=-Lt+li,ri.y-=(Ft.left-kt)*it.scale;const Wn=it.imageName?Ft.advance*it.scale:Fi*it.scale,dr=String.fromCharCode(it.glyph);X1(dr)?ri.x+=(1-kt)*it.scale:H1(dr)?ri.x+=Wn-Ft.height*it.scale+(-kt-1)*it.scale:ri.x+=it.imageName||Ft.width+2*kt===Ut.w&&Ft.height+2*kt===Ut.h?(Wn-Hi)/2:(Wn-(Ft.height+2*kt)*it.scale)/2,Ht=new ye(ri.x,ri.y-jt),ui=new ye(ri.x+Hi,ri.y),Yi=new ye(ri.x+Hi,ri.y-jt)}else{const Lt=(Ft.left-kt)*it.scale-li+ci[0],Ki=(-Ft.top-kt)*it.scale+ci[1],wn=Lt+jt,hr=Ki+Hi;ri=new ye(Lt,Ki),Ht=new ye(wn,Ki),ui=new ye(Lt,hr),Yi=new ye(wn,hr)}if(Pe){let Lt;Lt=Ce?new ye(0,0):Ti?new ye(Ne[0],Ne[1]):new ye(ge[0],ge[1]),ri._rotateAround(Pe,Lt),Ht._rotateAround(Pe,Lt),ui._rotateAround(Pe,Lt),Yi._rotateAround(Pe,Lt)}const Mi=new ye(0,0),pi=new ye(0,0);Ie.push({tl:ri,tr:Ht,bl:ui,br:Yi,tex:lt,writingMode:_e.writingMode,glyphOffset:Ii,sectionIndex:it.sectionIndex,isSDF:ki,pixelOffsetTL:Mi,pixelOffsetBR:pi,minFontScaleX:0,minFontScaleY:0})}}return Ie}(0,o,y,d,p,g,c,i.allowVerticalPlacement),Q=i.textSizeData;let se=null;Q.kind==="source"?(se=[kr*d.layout.get("text-size").evaluate(g,{},U)],se[0]>Oo&&Ye(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Q.kind==="composite"&&(se=[kr*O.compositeTextSizes[0].evaluate(g,{},U),kr*O.compositeTextSizes[1].evaluate(g,{},U)],(se[0]>Oo||se[1]>Oo)&&Ye(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,W,se,y,p,g,E,e,n,w.lineStartIndex,w.lineLength,z,U);for(const me of C)k[me]=i.text.placedSymbolArray.length-1;return 4*W.length}function Gg(i){for(const e in i)return i[e];return null}function jh(i,e,n,o,c,d,p,g,y,w){let E=p.top,C=p.bottom,k=p.left,z=p.right;const O=p.collisionPadding;if(O&&(k-=O[0],E-=O[1],z+=O[2],C+=O[3]),y){const U=new ye(k,E),W=new ye(z,E),Q=new ye(k,C),se=new ye(z,C),me=ne(y);let _e=new ye(0,0);w&&(_e=new ye(w[0],w[1])),U._rotateAround(me,_e),W._rotateAround(me,_e),Q._rotateAround(me,_e),se._rotateAround(me,_e),k=Math.min(U.x,W.x,Q.x,se.x),z=Math.max(U.x,W.x,Q.x,se.x),E=Math.min(U.y,W.y,Q.y,se.y),C=Math.max(U.y,W.y,Q.y,se.y)}return i.emplaceBack(e.x,e.y,e.z,n.x,n.y,k,E,z,C,g,o,c,d),i.length-1}function Hp(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const e=i.bottom-i.top;return e>0?Math.max(10,e):null}function ww(i,e,n,o){const c=i.compareText;if(e in c){const d=c[e];for(let p=d.length-1;p>=0;p--)if(o.dist(d[p])<n)return!0}else c[e]=[];return c[e].push(o),!1}const bw=Ns.VectorTileFeature.types,Tw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function $h(i,e,n,o,c,d,p,g,y,w,E,C,k,z,O,U){const W=E?Math.min(Oo,Math.round(E[0])):0,Q=E?Math.min(Oo,Math.round(E[1])):0;i.emplaceBack(e,n,Math.round(32*p),Math.round(32*g),y,w,(W<<1)+(C?1:0),Q,16*k,16*z,256*O,256*U,o,c,d,0)}function Yp(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function Ew(i){for(const e of i.sections)if(u(e.text))return!0;return!1}class Kp{constructor(e){this.layoutVertexArray=new yn,this.indexArray=new Nt,this.programConfigurations=e,this.segments=new Vi,this.dynamicLayoutVertexArray=new pt,this.opacityVertexArray=new Gn,this.placedSymbolArray=new Fs}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,o,c){this.isEmpty()||(o&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,V1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,j1.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Tw,!0),this.opacityVertexBuffer.itemSize=1),(o||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Xe("SymbolBuffers",Kp);class Qp{constructor(e,n,o){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Vi,this.collisionVertexArray=new ar,this.collisionVertexArrayExt=new pt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,$1.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,G1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xe("CollisionBuffers",Qp);class Uo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ep([]),this.placementViewportMatrix=Ep([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Up(this.zoom,n["text-size"]),this.iconSizeData=Up(this.zoom,n["icon-size"]);const o=this.layers[0].layout,c=o.get("symbol-sort-key"),d=o.get("symbol-z-order");this.canOverlap=o.get("text-allow-overlap")||o.get("icon-allow-overlap")||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&c.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=o.get("text-writing-mode").map(p=>Bn[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID}createArrays(){this.text=new Kp(new Bs(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Kp(new Bs(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new S_,this.lineVertexArray=new C_,this.symbolInstances=new E_}calculateGlyphDependencies(e,n,o,c,d){for(let p=0;p<e.length;p++)if(n[e.charCodeAt(p)]=!0,c&&d){const g=Rc[e.charAt(p)];g&&(n[g.charCodeAt(0)]=!0)}}populate(e,n,o){const c=this.layers[0],d=c.layout,p=d.get("text-font"),g=d.get("text-field"),y=d.get("icon-image"),w=(g.value.kind!=="constant"||g.value.value instanceof vi&&!g.value.value.isEmpty()||g.value.value.toString().length>0)&&(p.value.kind!=="constant"||p.value.value.length>0),E=y.value.kind!=="constant"||!!y.value.value||Object.keys(y.parameters).length>0,C=d.get("symbol-sort-key");if(this.features=[],!w&&!E)return;const k=n.iconDependencies,z=n.glyphDependencies,O=n.availableImages,U=new B(this.zoom);for(const{feature:W,id:Q,index:se,sourceLayerIndex:me}of e){const _e=c._featureFilter.needGeometry,ge=Us(W,_e);if(!c._featureFilter.filter(U,ge,o))continue;let xe,Ce;if(_e||(ge.geometry=Os(W)),w){const Le=c.getValueAndResolveTokens("text-field",ge,o,O),Oe=vi.factory(Le);Ew(Oe)&&(this.hasRTLText=!0),(!this.hasRTLText||M()==="unavailable"||this.hasRTLText&&F.isParsed())&&(xe=W1(Oe,c,ge))}if(E){const Le=c.getValueAndResolveTokens("icon-image",ge,o,O);Ce=Le instanceof an?Le:an.fromString(Le)}if(!xe&&!Ce)continue;const De=this.sortFeaturesByKey?C.evaluate(ge,{},o):void 0;if(this.features.push({id:Q,text:xe,icon:Ce,index:se,sourceLayerIndex:me,geometry:ge.geometry,properties:W.properties,type:bw[W.type],sortKey:De}),Ce&&(k[Ce.name]=!0),xe){const Le=p.evaluate(ge,{},o).join(","),Oe=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Bn.vertical)>=0;for(const Ie of xe.sections)if(Ie.image)k[Ie.image.name]=!0;else{const Pe=Qr(xe.toString()),Ne=Ie.fontStack||Le,Me=z[Ne]=z[Ne]||{};this.calculateGlyphDependencies(Ie.text,Me,Oe,this.allowVerticalPlacement,Pe)}}}d.get("symbol-placement")==="line"&&(this.features=function(W){const Q={},se={},me=[];let _e=0;function ge(Le){me.push(W[Le]),_e++}function xe(Le,Oe,Ie){const Pe=se[Le];return delete se[Le],se[Oe]=Pe,me[Pe].geometry[0].pop(),me[Pe].geometry[0]=me[Pe].geometry[0].concat(Ie[0]),Pe}function Ce(Le,Oe,Ie){const Pe=Q[Oe];return delete Q[Oe],Q[Le]=Pe,me[Pe].geometry[0].shift(),me[Pe].geometry[0]=Ie[0].concat(me[Pe].geometry[0]),Pe}function De(Le,Oe,Ie){const Pe=Ie?Oe[0][Oe[0].length-1]:Oe[0][0];return`${Le}:${Pe.x}:${Pe.y}`}for(let Le=0;Le<W.length;Le++){const Oe=W[Le],Ie=Oe.geometry,Pe=Oe.text?Oe.text.toString():null;if(!Pe){ge(Le);continue}const Ne=De(Pe,Ie),Me=De(Pe,Ie,!0);if(Ne in se&&Me in Q&&se[Ne]!==Q[Me]){const ot=Ce(Ne,Me,Ie),We=xe(Ne,Me,me[ot].geometry);delete Q[Ne],delete se[Me],se[De(Pe,me[We].geometry,!0)]=We,me[ot].geometry=null}else Ne in se?xe(Ne,Me,Ie):Me in Q?Ce(Ne,Me,Ie):(ge(Le),Q[Ne]=_e-1,se[Me]=_e-1)}return me.filter(Le=>Le.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,Q)=>W.sortKey-Q.sortKey)}update(e,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const o=this.lineVertexArray.length;if(e.segment!==void 0){let c=e.dist(n[e.segment+1]),d=e.dist(n[e.segment]);const p={};for(let g=e.segment+1;g<n.length;g++)p[g]={x:n[g].x,y:n[g].y,tileUnitDistanceFromAnchor:c},g<n.length-1&&(c+=n[g+1].dist(n[g]));for(let g=e.segment||0;g>=0;g--)p[g]={x:n[g].x,y:n[g].y,tileUnitDistanceFromAnchor:d},g>0&&(d+=n[g-1].dist(n[g]));for(let g=0;g<n.length;g++){const y=p[g];this.lineVertexArray.emplaceBack(y.x,y.y,y.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(e,n,o,c,d,p,g,y,w,E,C,k,z){const O=e.indexArray,U=e.layoutVertexArray,W=e.segments.prepareSegment(4*n.length,U,O,this.canOverlap?p.sortKey:void 0),Q=this.glyphOffsetArray.length,se=W.vertexLength,me=this.allowVerticalPlacement&&g===Bn.vertical?Math.PI/2:0,_e=p.text&&p.text.sections;for(let ge=0;ge<n.length;ge++){const{tl:xe,tr:Ce,bl:De,br:Le,tex:Oe,pixelOffsetTL:Ie,pixelOffsetBR:Pe,minFontScaleX:Ne,minFontScaleY:Me,glyphOffset:ot,isSDF:We,sectionIndex:Dt}=n[ge],at=W.vertexLength,Et=ot[1];$h(U,y.x,y.y,y.z,w.x,w.y,xe.x,Et+xe.y,Oe.x,Oe.y,o,We,Ie.x,Ie.y,Ne,Me),$h(U,y.x,y.y,y.z,w.x,w.y,Ce.x,Et+Ce.y,Oe.x+Oe.w,Oe.y,o,We,Pe.x,Ie.y,Ne,Me),$h(U,y.x,y.y,y.z,w.x,w.y,De.x,Et+De.y,Oe.x,Oe.y+Oe.h,o,We,Ie.x,Pe.y,Ne,Me),$h(U,y.x,y.y,y.z,w.x,w.y,Le.x,Et+Le.y,Oe.x+Oe.w,Oe.y+Oe.h,o,We,Pe.x,Pe.y,Ne,Me),Yp(e.dynamicLayoutVertexArray,y,me),O.emplaceBack(at,at+1,at+2),O.emplaceBack(at+1,at+2,at+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),ge!==n.length-1&&Dt===n[ge+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,p,p.index,{},z,_e&&_e[Dt])}e.placedSymbolArray.emplaceBack(y.x,y.y,y.z,w.x,w.y,Q,this.glyphOffsetArray.length-Q,se,E,C,w.segment,o?o[0]:0,o?o[1]:0,c[0],c[1],g,0,!1,0,k,0)}_commitLayoutVertex(e,n,o,c,d,p,g){e.emplaceBack(n,o,c,d,p,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,n,o,c,d,p,g){const y=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),w=y.vertexLength,E=g.tileAnchorX,C=g.tileAnchorY;for(let z=0;z<4;z++)o.collisionVertexArray.emplaceBack(0,0,0,0);o.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),o.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),o.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(o.layoutVertexArray,c,d,p,E,C,new ye(e.x1,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,d,p,E,C,new ye(e.x2,e.y1)),this._commitLayoutVertex(o.layoutVertexArray,c,d,p,E,C,new ye(e.x2,e.y2)),this._commitLayoutVertex(o.layoutVertexArray,c,d,p,E,C,new ye(e.x1,e.y2)),y.vertexLength+=4;const k=o.indexArray;k.emplaceBack(w,w+1),k.emplaceBack(w+1,w+2),k.emplaceBack(w+2,w+3),k.emplaceBack(w+3,w),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,o,c,d,p){for(let g=c;g<d;g++){const y=o.get(g),w=this.getSymbolInstanceTextSize(e,p,n,g);this._addCollisionDebugVertices(y,w,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,n,o,c,d,p){for(let g=c;g<d;g++){const y=o.get(g),w=this.getSymbolInstanceIconSize(e,n,g);this._addCollisionDebugVertices(y,w,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qp(Wi,yg.members,Ci),this.iconCollisionBox=new Qp(Wi,yg.members,Ci);const o=Ka(this.iconSizeData,e),c=Ka(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(o,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(o,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,n,o,c){const d=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:c),p=Fh(this.textSizeData,e,d)/Fi;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,n,o){const c=this.icon.placedSymbolArray.get(o),d=Fh(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,n,o){e.emplaceBack(n,-o,-o),e.emplaceBack(n,o,-o),e.emplaceBack(n,o,o),e.emplaceBack(n,-o,o)}_updateTextDebugCollisionBoxes(e,n,o,c,d,p){for(let g=c;g<d;g++){const y=o.get(g),w=this.getSymbolInstanceTextSize(e,p,n,g);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,y.padding)}}_updateIconDebugCollisionBoxes(e,n,o,c,d){for(let p=c;p<d;p++){const g=o.get(p),y=this.getSymbolInstanceIconSize(e,n,p);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,g.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const o=Ka(this.iconSizeData,e),c=Ka(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const p=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,e,n,p.textBoxStartIndex,p.textBoxEndIndex,p),this._updateTextDebugCollisionBoxes(c,e,n,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._updateIconDebugCollisionBoxes(o,e,n,p.iconBoxStartIndex,p.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(o,e,n,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,o,c,d,p,g,y,w){const E={};for(let C=n;C<o;C++){const k=e.get(C);E.textBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},E.textFeatureIndex=k.featureIndex;break}for(let C=c;C<d;C++){const k=e.get(C);E.verticalTextBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},E.verticalTextFeatureIndex=k.featureIndex;break}for(let C=p;C<g;C++){const k=e.get(C);E.iconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},E.iconFeatureIndex=k.featureIndex;break}for(let C=y;C<w;C++){const k=e.get(C);E.verticalIconBox={x1:k.x1,y1:k.y1,x2:k.x2,y2:k.y2,padding:k.padding,projectedAnchorX:k.projectedAnchorX,projectedAnchorY:k.projectedAnchorY,projectedAnchorZ:k.projectedAnchorZ,tileAnchorX:k.tileAnchorX,tileAnchorY:k.tileAnchorY},E.verticalIconFeatureIndex=k.featureIndex;break}return E}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const o=e.placedSymbolArray.get(n),c=o.vertexStartIndex+4*o.numGlyphs;for(let d=o.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),o=Math.cos(e),c=[],d=[],p=[];for(let g=0;g<this.symbolInstances.length;++g){p.push(g);const y=this.symbolInstances.get(g);c.push(0|Math.round(n*y.tileAnchorX+o*y.tileAnchorY)),d.push(y.featureIndex)}return p.sort((g,y)=>c[g]-c[y]||d[y]-d[g]),p}addToSortKeyRanges(e,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((c,d,p)=>{c>=0&&p.indexOf(c)===d&&this.addIndicesForPlacedSymbol(this.text,c)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Xe("SymbolBucket",Uo,{omit:["layers","collisionBoxArray","features","compareText"]}),Uo.MAX_GLYPHS=65535,Uo.addDynamicAttributes=Yp;const Sw=new we({"symbol-placement":new X(te.layout_symbol["symbol-placement"]),"symbol-spacing":new X(te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new X(te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new le(te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new X(te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new X(te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new X(te.layout_symbol["icon-ignore-placement"]),"icon-optional":new X(te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new X(te.layout_symbol["icon-rotation-alignment"]),"icon-size":new le(te.layout_symbol["icon-size"]),"icon-text-fit":new X(te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new X(te.layout_symbol["icon-text-fit-padding"]),"icon-image":new le(te.layout_symbol["icon-image"]),"icon-rotate":new le(te.layout_symbol["icon-rotate"]),"icon-padding":new X(te.layout_symbol["icon-padding"]),"icon-keep-upright":new X(te.layout_symbol["icon-keep-upright"]),"icon-offset":new le(te.layout_symbol["icon-offset"]),"icon-anchor":new le(te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new X(te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new X(te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new X(te.layout_symbol["text-rotation-alignment"]),"text-field":new le(te.layout_symbol["text-field"]),"text-font":new le(te.layout_symbol["text-font"]),"text-size":new le(te.layout_symbol["text-size"]),"text-max-width":new le(te.layout_symbol["text-max-width"]),"text-line-height":new le(te.layout_symbol["text-line-height"]),"text-letter-spacing":new le(te.layout_symbol["text-letter-spacing"]),"text-justify":new le(te.layout_symbol["text-justify"]),"text-radial-offset":new le(te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new X(te.layout_symbol["text-variable-anchor"]),"text-anchor":new le(te.layout_symbol["text-anchor"]),"text-max-angle":new X(te.layout_symbol["text-max-angle"]),"text-writing-mode":new X(te.layout_symbol["text-writing-mode"]),"text-rotate":new le(te.layout_symbol["text-rotate"]),"text-padding":new X(te.layout_symbol["text-padding"]),"text-keep-upright":new X(te.layout_symbol["text-keep-upright"]),"text-transform":new le(te.layout_symbol["text-transform"]),"text-offset":new le(te.layout_symbol["text-offset"]),"text-allow-overlap":new X(te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new X(te.layout_symbol["text-ignore-placement"]),"text-optional":new X(te.layout_symbol["text-optional"])});var Jp={paint:new we({"icon-opacity":new le(te.paint_symbol["icon-opacity"]),"icon-color":new le(te.paint_symbol["icon-color"]),"icon-halo-color":new le(te.paint_symbol["icon-halo-color"]),"icon-halo-width":new le(te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new le(te.paint_symbol["icon-halo-blur"]),"icon-translate":new X(te.paint_symbol["icon-translate"]),"icon-translate-anchor":new X(te.paint_symbol["icon-translate-anchor"]),"text-opacity":new le(te.paint_symbol["text-opacity"]),"text-color":new le(te.paint_symbol["text-color"],{runtimeType:zn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new le(te.paint_symbol["text-halo-color"]),"text-halo-width":new le(te.paint_symbol["text-halo-width"]),"text-halo-blur":new le(te.paint_symbol["text-halo-blur"]),"text-translate":new X(te.paint_symbol["text-translate"]),"text-translate-anchor":new X(te.paint_symbol["text-translate-anchor"])}),layout:Sw};class Zg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ir,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xe("FormatSectionOverride",Zg,{omit:["defaultValue"]});class Gh extends cr{constructor(e){super(e,Jp)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const o=this.layout.get("text-writing-mode");if(o){const c=[];for(const d of o)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,o,c){const d=this.layout.get(e).evaluate(n,{},o,c),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||Aa(p.value)||!d?d:function(g,y){return y.replace(/{([^{}]+)}/g,(w,E)=>E in g?String(g[E]):"")}(n.properties,d)}createBucket(e){return new Uo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Jp.paint.overridableProperties){if(!Gh.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),o=new Zg(n),c=new oc(o,n.property.specification);let d=null;d=n.value.kind==="constant"||n.value.kind==="source"?new Ma("source",c):new Er("composite",c,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new ee(n.property,d,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Gh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const o=e.get("text-field"),c=Jp.paint.properties[n];let d=!1;const p=g=>{for(const y of g)if(c.overrides&&c.overrides.hasOverride(y))return void(d=!0)};if(o.value.kind==="constant"&&o.value.value instanceof vi)p(o.value.value.sections);else if(o.value.kind==="source"){const g=w=>{d||(w instanceof rr&&fi(w.value)===_s?p(w.value.sections):w instanceof ys?p(w.sections):w.eachChild(g))},y=o.value;y._styleExpression&&g(y._styleExpression.expression)}return d}getProgramConfiguration(e){return new io(this,e)}}var Cw={paint:new we({"background-color":new X(te.paint_background["background-color"]),"background-pattern":new Ae(te.paint_background["background-pattern"]),"background-opacity":new X(te.paint_background["background-opacity"])})},kw={paint:new we({"raster-opacity":new X(te.paint_raster["raster-opacity"]),"raster-hue-rotate":new X(te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new X(te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new X(te.paint_raster["raster-brightness-max"]),"raster-saturation":new X(te.paint_raster["raster-saturation"]),"raster-contrast":new X(te.paint_raster["raster-contrast"]),"raster-resampling":new X(te.paint_raster["raster-resampling"]),"raster-fade-duration":new X(te.paint_raster["raster-fade-duration"])})};class Iw extends cr{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Aw={paint:new we({"sky-type":new X(te.paint_sky["sky-type"]),"sky-atmosphere-sun":new X(te.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new X(te.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new X(te.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new X(te.paint_sky["sky-gradient-radius"]),"sky-gradient":new ae(te.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new X(te.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new X(te.paint_sky["sky-atmosphere-color"]),"sky-opacity":new X(te.paint_sky["sky-opacity"])})};function ef(i,e,n){const o=Xa(0,0,1),c=Q_(Sp());return function(d,p,g){g*=.5;var y=p[0],w=p[1],E=p[2],C=p[3],k=Math.sin(g),z=Math.cos(g);d[0]=y*z-E*k,d[1]=w*z+C*k,d[2]=E*z+y*k,d[3]=C*z-w*k}(c,c,n?-ne(i)+Math.PI:ne(i)),J_(c,c,-ne(e)),K_(o,o,c),Y_(o,o)}const Mw={circle:class extends cr{constructor(i){super(i,Hv)}createBucket(i){return new wp(i)}queryRadius(i){const e=i;return Wa("circle-radius",this,e)+Wa("circle-stroke-width",this,e)+Mh(this.paint.get("circle-translate"))}queryIntersectsFeature(i,e,n,o,c,d,p,g){const y=$_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return eg(i,o,d,p,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,w)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new io(this,i)}},heatmap:class extends cr{createBucket(i){return new ig(i)}constructor(i){super(i,n1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Ip({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return Wa("heatmap-radius",this,i)}queryIntersectsFeature(i,e,n,o,c,d,p,g){const y=this.paint.get("heatmap-radius").evaluate(e,n);return eg(i,o,d,p,g,!0,!0,new ye(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new io(this,i)}},hillshade:class extends cr{constructor(i){super(i,r1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(i){return new io(this,i)}},fill:class extends cr{constructor(i){super(i,w1)}getProgramIds(){const i=this.paint.get("fill-pattern"),e=i&&i.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(i){return new io(this,i)}recalculate(i,e){super.recalculate(i,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Fp(i)}queryRadius(){return Mh(this.paint.get("fill-translate"))}queryIntersectsFeature(i,e,n,o,c,d){return!i.queryGeometry.isAboveHorizon&&O_(j_(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),o)}isTileClipped(){return!0}},"fill-extrusion":class extends cr{constructor(i){super(i,P1)}createBucket(i){return new Bp(i)}queryRadius(){return Mh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new io(this,i)}queryIntersectsFeature(i,e,n,o,c,d,p,g,y){const w=$_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),E=this.paint.get("fill-extrusion-height").evaluate(e,n),C=this.paint.get("fill-extrusion-base").evaluate(e,n),k=[0,0],z=g&&d.elevation,O=d.elevation?d.elevation.exaggeration():1;if(z){const Q=i.tile.getBucket(this).centroidVertexArray,se=y+1;if(se<Q.length){const me=Q.get(se);k[0]=me.a_centroid_pos0,k[1]=me.a_centroid_pos1}}if(k[0]===0&&k[1]===1)return!1;const U=function(Q,se,me,_e,ge,xe,Ce,De,Le){return xe?function(Oe,Ie,Pe,Ne,Me,ot,We,Dt,at){const Et=[],it=[],lt=[0,0,0,1];for(const kt of Oe){const ki=[],ni=[];for(const wi of kt){const bi=wi.x+Ne.x,li=wi.y+Ne.y,Ft=D1(bi,li,Ie,Pe,ot,We,Dt,at);lt[0]=bi,lt[1]=li,lt[2]=Ft.base,lt[3]=1,Ic(lt,lt,Me),lt[3]=Math.max(lt[3],1e-5);const Ut=fg([lt[0]/lt[3],lt[1]/lt[3],lt[2]/lt[3]]);lt[0]=bi,lt[1]=li,lt[2]=Ft.top,lt[3]=1,Ic(lt,lt,Me),lt[3]=Math.max(lt[3],1e-5);const Ii=fg([lt[0]/lt[3],lt[1]/lt[3],lt[2]/lt[3]]);ki.push(Ut),ni.push(Ii)}Et.push(ki),it.push(ni)}return[Et,it]}(Q,se,me,_e,ge,xe,Ce,De,Le):function(Oe,Ie,Pe,Ne,Me){const ot=[],We=[],Dt=Me[8]*Ie,at=Me[9]*Ie,Et=Me[10]*Ie,it=Me[11]*Ie,lt=Me[8]*Pe,kt=Me[9]*Pe,ki=Me[10]*Pe,ni=Me[11]*Pe;for(const wi of Oe){const bi=[],li=[];for(const Ft of wi){const Ut=Ft.x+Ne.x,Ii=Ft.y+Ne.y,ci=Me[0]*Ut+Me[4]*Ii+Me[12],Ai=Me[1]*Ut+Me[5]*Ii+Me[13],Ti=Me[2]*Ut+Me[6]*Ii+Me[14],jt=Me[3]*Ut+Me[7]*Ii+Me[15],Hi=ci+Dt,ri=Ai+at,Ht=Ti+Et,ui=Math.max(jt+it,1e-5),Yi=ci+lt,Mi=Ai+kt,pi=Ti+ki,Lt=Math.max(jt+ni,1e-5),Ki=new ye(Hi/ui,ri/ui);Ki.z=Ht/ui,bi.push(Ki);const wn=new ye(Yi/Lt,Mi/Lt);wn.z=pi/Lt,li.push(wn)}ot.push(bi),We.push(li)}return[ot,We]}(Q,se,me,_e,ge)}(o,C,E,w,p,z?g:null,k,O,d.center.lat),W=i.queryGeometry;return function(Q,se,me){let _e=1/0;O_(me,se)&&(_e=pg(me,se[0]));for(let ge=0;ge<se.length;ge++){const xe=se[ge],Ce=Q[ge];for(let De=0;De<xe.length-1;De++){const Le=xe[De],Oe=[Le,xe[De+1],Ce[De+1],Ce[De],Le];B_(me,Oe)&&(_e=Math.min(_e,pg(me,Oe)))}}return _e!==1/0&&_e}(U[0],U[1],W.isPointQuery()?W.screenBounds:W.screenGeometry)}},line:class extends cr{constructor(i){super(i,mg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof bo,this.gradientVersion=(this.gradientVersion+1)%Ke}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,e){super.recalculate(i,e),this.paint._values["line-floorwidth"]=_g.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Op(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new io(this,i)}queryRadius(i){const e=i,n=gg(Wa("line-width",this,e),Wa("line-gap-width",this,e)),o=Wa("line-offset",this,e);return n/2+Math.abs(o)+Mh(this.paint.get("line-translate"))}queryIntersectsFeature(i,e,n,o,c,d){if(i.queryGeometry.isAboveHorizon)return!1;const p=j_(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,i.pixelToTileUnitsFactor),g=i.pixelToTileUnitsFactor/2*gg(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(o=function(w,E){const C=[],k=new ye(0,0);for(let z=0;z<w.length;z++){const O=w[z],U=[];for(let W=0;W<O.length;W++){const Q=O[W-1],se=O[W],me=O[W+1],_e=W===0?k:se.sub(Q)._unit()._perp(),ge=W===O.length-1?k:me.sub(se)._unit()._perp(),xe=_e._add(ge)._unit();xe._mult(1/(xe.x*ge.x+xe.y*ge.y)),U.push(xe._mult(E)._add(se))}C.push(U)}return C}(o,y*i.pixelToTileUnitsFactor)),function(w,E,C){for(let k=0;k<E.length;k++){const z=E[k];if(w.length>=3){for(let O=0;O<z.length;O++)if(qa(w,z[O]))return!0}if(Zv(w,z,C))return!0}return!1}(p,o,g)}isTileClipped(){return!0}},symbol:Gh,background:class extends cr{constructor(i){super(i,Cw)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends cr{constructor(i){super(i,kw)}getProgramIds(){return["raster"]}},sky:class extends cr{constructor(i){super(i,Aw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Ip({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(i,e){const n=this.paint.get("sky-type");if(n==="atmosphere"){const o=this.paint.get("sky-atmosphere-sun"),c=!o,d=i.style.light,p=d.properties.get("position");return c&&d.properties.get("anchor")==="viewport"&&Ye("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?ef(p.azimuthal,90-p.polar,e):ef(o[0],90-o[1],e)}if(n==="gradient"){const o=this.paint.get("sky-gradient-center");return ef(o[0],90-o[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}},{HTMLImageElement:qg,HTMLCanvasElement:Wg,HTMLVideoElement:Xg,ImageData:Hg,ImageBitmap:Zh}=Se;class qh{constructor(e,n,o,c){this.context=e,this.format=o,this.texture=e.gl.createTexture(),this.update(n,c)}update(e,n,o){const{width:c,height:d}=e,p=!(this.size&&this.size[0]===c&&this.size[1]===d||o),{context:g}=this,{gl:y}=g;if(this.useMipmap=Boolean(n&&n.useMipmap),y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),p)this.size=[c,d],e instanceof qg||e instanceof Wg||e instanceof Xg||e instanceof Hg||Zh&&e instanceof Zh?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,c,d,0,this.format,y.UNSIGNED_BYTE,e.data);else{const{x:w,y:E}=o||{x:0,y:0};e instanceof qg||e instanceof Wg||e instanceof Xg||e instanceof Hg||Zh&&e instanceof Zh?y.texSubImage2D(y.TEXTURE_2D,0,w,E,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,w,E,c,d,y.RGBA,y.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&y.generateMipmap(y.TEXTURE_2D)}bind(e,n,o){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),o!==d.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=d.LINEAR),e!==this.filter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,o||e),this.filter=e),n!==this.wrap&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Vs{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ai?new ai(e.lng,e.lat):ai.convert(e),this}setSouthWest(e){return this._sw=e instanceof ai?new ai(e.lng,e.lat):ai.convert(e),this}extend(e){const n=this._sw,o=this._ne;let c,d;if(e instanceof ai)c=e,d=e;else{if(!(e instanceof Vs))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Vs.convert(e)):this.extend(ai.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return n||o?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),o.lng=Math.max(d.lng,o.lng),o.lat=Math.max(d.lat,o.lat)):(this._sw=new ai(c.lng,c.lat),this._ne=new ai(d.lng,d.lat)),this}getCenter(){return new ai((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ai(this.getWest(),this.getNorth())}getSouthEast(){return new ai(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:o}=ai.convert(e);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=o&&o<=this._ne.lat&&c}static convert(e){return!e||e instanceof Vs?e:new Vs(e)}}const Yg=63710088e-1;class ai{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ai(rt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,o=this.lat*n,c=e.lat*n,d=Math.sin(o)*Math.sin(c)+Math.cos(o)*Math.cos(c)*Math.cos((e.lng-this.lng)*n);return Yg*Math.acos(Math.min(d,1))}toBounds(e=0){const n=360*e/40075017,o=n/Math.cos(Math.PI/180*this.lat);return new Vs(new ai(this.lng-o,this.lat-n),new ai(this.lng+o,this.lat+n))}static convert(e){if(e instanceof ai)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ai(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ai(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Kg=2*Math.PI*Yg;function Qg(i){return Kg*Math.cos(i*Math.PI/180)}function Jg(i){return(180+i)/360}function ey(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function tf(i,e){return i/Qg(e)}function Wh(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function nf(i,e){return i*Qg(Wh(e))}class nl{constructor(e,n,o=0){this.x=+e,this.y=+n,this.z=+o}static fromLngLat(e,n=0){const o=ai.convert(e);return new nl(Jg(o.lng),ey(o.lat),tf(n,o.lat))}toLngLat(){return new ai(360*this.x-180,Wh(this.y))}toAltitude(){return nf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Kg*(e=Wh(this.y),1/Math.cos(e*Math.PI/180));var e}}class rf{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Ro({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const o=this.getKey(e,n);return this.positions[o]}trim(){const e=this.width,n=this.height=In(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,o){const c=[];let d=e.length%2==1?-e[e.length-1]*o:0,p=e[0]*o,g=!0;c.push({left:d,right:p,isDash:g,zeroLength:e[0]===0});let y=e[0];for(let w=1;w<e.length;w++){g=!g;const E=e[w];d=y*o,y+=E,p=y*o,c.push({left:d,right:p,isDash:g,zeroLength:E===0})}return c}addRoundDash(e,n,o){const c=n/2;for(let d=-o;d<=o;d++){const p=this.width*(this.nextRow+o+d);let g=0,y=e[g];for(let w=0;w<this.width;w++){w/y.right>1&&(y=e[++g]);const E=Math.abs(w-y.left),C=Math.abs(w-y.right),k=Math.min(E,C);let z;const O=d/o*(c+1);if(y.isDash){const U=c-Math.abs(O);z=Math.sqrt(k*k+U*U)}else z=c-Math.sqrt(k*k+O*O);this.image.data[p+w]=Math.max(0,Math.min(255,z+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){const w=e[y],E=e[y+1];w.zeroLength?e.splice(y,1):E&&E.isDash===w.isDash&&(E.left=w.left,e.splice(y,1))}const o=e[0],c=e[e.length-1];o.isDash===c.isDash&&(o.left=c.left-this.width,c.right=o.right+this.width);const d=this.width*this.nextRow;let p=0,g=e[p];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++p]);const w=Math.abs(y-g.left),E=Math.abs(y-g.right),C=Math.min(w,E);this.image.data[d+y]=Math.max(0,Math.min(255,(g.isDash?C:-C)+n+128))}}addDash(e,n){const o=this.getKey(e,n);if(this.positions[o])return this.positions[o];const c=n==="round",d=c?7:0,p=2*d+1;if(this.nextRow+p>this.height)return Ye("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let E=0;E<e.length;E++)e[E]<0&&(Ye("Negative value is found in line dasharray, replacing values with 0"),e[E]=0),g+=e[E];if(g!==0){const E=this.width/g,C=this.getDashRanges(e,this.width,E);c?this.addRoundDash(C,E,d):this.addRegularDash(C,n==="square"?.5*E:0)}const y=this.nextRow+d;this.nextRow+=p;const w={tl:[y,d],br:[g,0]};return this.positions[o]=w,w}}Xe("LineAtlas",rf);class zw{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Pw=Se.performance;function ty(i){const e=i?i.url.toString():void 0;return Pw.getEntriesByName(e)}class Dw{constructor(){this.tasks={},this.taskQueue=[],An(["process"],this),this.invoker=new zw(this.process),this.nextId=0}add(e,n){const o=this.nextId++,c=function({type:d,isSymbolTile:p,zoom:g}){return g=g||0,d==="message"?0:d!=="maybePrepare"||p?d!=="parseTile"||p?d==="parseTile"&&p?300-g:d==="maybePrepare"&&p?400-g:500:200-g:100-g}(n);if(c===0){Wt();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[o]={fn:e,metadata:n,priority:c,id:o},this.taskQueue.push(o),this.invoker.trigger(),{cancel:()=>{delete this.tasks[o]}}}process(){Wt();try{if(this.taskQueue=this.taskQueue.filter(o=>!!this.tasks[o]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<n&&(n=d.priority,e=c)}if(e===null)return null;const o=this.taskQueue[e];return this.taskQueue.splice(e,1),o}remove(){this.invoker.remove()}}function iy(i,e,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,e*o-2*Math.PI*6378137/2]}class of{constructor(e,n,o){this.z=e,this.x=n,this.y=o,this.key=Uc(0,e,e,n,o)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const o=(d=this.y,p=this.z,g=iy(256*(c=this.x),256*(d=Math.pow(2,p)-d-1),p),y=iy(256*(c+1),256*(d+1),p),g[0]+","+g[1]+","+y[0]+","+y[1]);var c,d,p,g,y;const w=function(E,C,k){let z,O="";for(let U=E;U>0;U--)z=1<<U-1,O+=(C&z?1:0)+(k&z?2:0);return O}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",w).replace("{bbox-epsg-3857}",o)}getTilePoint(e){const n=Math.pow(2,this.z);return new ye((e.x*n-this.x)*Rt,(e.y*n-this.y)*Rt)}getTileVec3(e){const n=Math.pow(2,this.z);return Xa((e.x*n-this.x)*Rt,(e.y*n-this.y)*Rt,nf(e.z,e.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class ny{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Uc(e,n.z,n.z,n.x,n.y)}}class un{constructor(e,n,o,c,d){this.overscaledZ=e,this.wrap=n,this.canonical=new of(o,+c,+d),this.key=n===0&&e===o?this.canonical.key:Uc(n,e,o,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new un(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new un(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Uc(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const o=this.canonical.z-e;return Uc(this.wrap*+n,e,e,this.canonical.x>>o,this.canonical.y>>o)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new un(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,c=2*this.canonical.y;return[new un(n,this.wrap,n,o,c),new un(n,this.wrap,n,o+1,c),new un(n,this.wrap,n,o,c+1),new un(n,this.wrap,n,o+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new un(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new un(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ny(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new nl(e.x-this.wrap,e.y))}getTileVec3(e){return this.canonical.getTileVec3(new nl(e.x-this.wrap,e.y,e.z))}}function Uc(i,e,n,o,c){const d=1<<Math.min(n,22);let p=d*(c%d)+o%d;return i&&n<22&&(p+=d*d*((i<0?-2*i-1:2*i)%(1<<2*(22-n)))),16*(32*p+n)+(e-n)}Xe("CanonicalTileID",of),Xe("OverscaledTileID",un,{omit:["projMatrix"]});class ry{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const o=e[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class oy{constructor(e,n,o,c,d){this.type="Feature",this._vectorTileFeature=e,e._z=n,e._x=o,e._y=c,this.properties=e.properties,this.id=d}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(e[n]=this[n]);return e}}var Lw=He([{name:"a_pos",type:"Int16",components:2}]);class sy{constructor(e,n,o){this.tileID=e,this.uid=xi(),this.uses=0,this.tileSize=n,this.tileZoom=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<on.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}loadVectorData(e,n,o){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const p={};if(!d)return p;for(const g of c){const y=g.layerIds.map(w=>d.getLayer(w)).filter(Boolean);if(y.length!==0){g.layers=y,g.stateDependentLayerIds&&(g.stateDependentLayers=g.stateDependentLayerIds.map(w=>y.filter(E=>E.id===w)[0]));for(const w of y)p[w.id]=g}}return p}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Uo){if(this.hasSymbolBuckets=!0,!o)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Uo&&d.hasRTLText){this.hasRTLText=!0,F.isLoading()||F.isLoaded()||M()!=="deferred"||D();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new eo}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const o in this.buckets){const c=this.buckets[o];c.uploadPending()&&c.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new qh(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new qh(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new qh(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,o,c,d,p,g,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:g,transform:p,params:d},e,n,o):{}}querySourceFeatures(e,n){const o=this.latestFeatureIndex;if(!o||!o.rawTileData)return;const c=o.loadVTLayers(),d=n?n.sourceLayer:"",p=c._geojsonTileLayer||c[d];if(!p)return;const g=Ao(n&&n.filter),{z:y,x:w,y:E}=this.tileID.canonical,C={z:y,x:w,y:E};for(let k=0;k<p.length;k++){const z=p.feature(k);if(g.needGeometry){const W=Us(z,!0);if(!g.filter(new B(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!g.filter(new B(this.tileID.overscaledZ),z))continue;const O=o.getId(z,d),U=new oy(z,y,w,E,O);U.tile=C,e.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const o=Di(e.cacheControl);o["max-age"]&&(this.expirationTime=Date.now()+1e3*o["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const o=Date.now();let c=!1;if(this.expirationTime>o)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const d=this.expirationTime-n;d?this.expirationTime=o+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const o=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!n.style.hasLayer(c))continue;const d=this.buckets[c],p=d.layers[0].sourceLayer||"_geojsonTileLayer",g=o[p],y=e[p];if(!g||!y||Object.keys(y).length===0)continue;d.update(y,g,this.imageAtlas&&this.imageAtlas.patternPositions||{});const w=n&&n.style&&n.style.getLayer(c);w&&(this.queryPadding=Math.max(this.queryPadding,w.queryRadius(d)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<on.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=on.now()+e}setDependencies(e,n){const o={};for(const c of n)o[c]=!0;this.dependencies[e]=o}hasDependency(e,n){for(const o of e){const c=this.dependencies[o];if(c){for(const d of n)if(c[d])return!0}}return!1}clearQueryDebugViz(){}}class Rw{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,o){const c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},St(this.stateChanges[e][c],o),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const d in this.state[e][c])o[d]||(this.deletedStates[e][c][d]=null)}else for(const d in o)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,n,o){if(this.deletedStates[e]===null)return;const c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},o&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][o]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(o in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][o]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){const o=String(n),c=St({},(this.state[e]||{})[o],(this.stateChanges[e]||{})[o]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][n];if(d===null)return{};for(const p in d)delete c[p]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const o={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const p in this.stateChanges[c])this.state[c][p]||(this.state[c][p]={}),St(this.state[c][p],this.stateChanges[c][p]),d[p]=this.state[c][p];o[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const p in this.state[c])d[p]={},this.state[c][p]={};else for(const p in this.deletedStates[c]){if(this.deletedStates[c][p]===null)this.state[c][p]={};else for(const g of Object.keys(this.deletedStates[c][p]))delete this.state[c][p][g];d[p]=this.state[c][p]}o[c]=o[c]||{},St(o[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(o).length!==0)for(const c in e)e[c].setFeatureState(o,n)}}class ay{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const o=this.toIdx(e,n);return{min:this.minimums[o],max:this.maximums[o]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function ly(i,e,n,o){let c=0,d=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(o[p])<1e-15){if(n[p]<i[p]||n[p]>e[p])return null}else{const g=1/o[p];let y=(i[p]-n[p])*g,w=(e[p]-n[p])*g;if(y>w){const E=y;y=w,w=E}if(y>c&&(c=y),w<d&&(d=w),c>d)return null}return c}function cy(i,e,n,o,c,d,p,g,y,w,E){const C=o-i,k=c-e,z=d-n,O=p-i,U=g-e,W=y-n,Q=E[1]*W-E[2]*U,se=E[2]*O-E[0]*W,me=E[0]*U-E[1]*O,_e=C*Q+k*se+z*me;if(Math.abs(_e)<1e-15)return null;const ge=1/_e,xe=w[0]-i,Ce=w[1]-e,De=w[2]-n,Le=(xe*Q+Ce*se+De*me)*ge;if(Le<0||Le>1)return null;const Oe=Ce*z-De*k,Ie=De*C-xe*z,Pe=xe*k-Ce*C,Ne=(E[0]*Oe+E[1]*Ie+E[2]*Pe)*ge;return Ne<0||Le+Ne>1?null:(O*Oe+U*Ie+W*Pe)*ge}function uy(i,e,n){return(i-e)/(n-e)}function hy(i,e,n,o,c,d,p,g,y){const w=1<<n,E=d-o,C=p-c,k=(i+1)/w*E+o,z=(e+0)/w*C+c,O=(e+1)/w*C+c;g[0]=(i+0)/w*E+o,g[1]=z,y[0]=k,y[1]=O}class dy{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(d){const p=Math.ceil(Math.log2(d.dim/8)),g=[];let y=Math.ceil(Math.pow(2,p));const w=1/y,E=(z,O,U,W,Q)=>{const se=W?1:0,me=(z+1)*U-se,_e=O*U,ge=(O+1)*U-se;Q[0]=z*U,Q[1]=_e,Q[2]=me,Q[3]=ge};let C=new ay(y);const k=[];for(let z=0;z<y*y;z++){E(z%y,Math.floor(z/y),w,!1,k);const O=No(k[0],k[1],d),U=No(k[2],k[1],d),W=No(k[2],k[3],d),Q=No(k[0],k[3],d);C.minimums.push(Math.min(O,U,W,Q)),C.maximums.push(Math.max(O,U,W,Q)),C.leaves.push(1)}for(g.push(C),y/=2;y>=1;y/=2){const z=g[g.length-1];C=new ay(y);for(let O=0;O<y*y;O++){E(O%y,Math.floor(O/y),2,!0,k);const U=z.getElevation(k[0],k[1]),W=z.getElevation(k[2],k[1]),Q=z.getElevation(k[2],k[3]),se=z.getElevation(k[0],k[3]),me=z.isLeaf(k[0],k[1]),_e=z.isLeaf(k[2],k[1]),ge=z.isLeaf(k[2],k[3]),xe=z.isLeaf(k[0],k[3]),Ce=Math.min(U.min,W.min,Q.min,se.min),De=Math.max(U.max,W.max,Q.max,se.max),Le=me&&_e&&ge&&xe;C.maximums.push(De),C.minimums.push(Ce),C.leaves.push(De-Ce<=5&&Le?1:0)}g.push(C)}return g}(this.dem),o=n.length-1,c=n[o];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(n,0,0,o,0)}raycastRoot(e,n,o,c,d,p,g=1){return ly([e,n,-100],[o,c,this.maximums[0]*g],d,p)}raycast(e,n,o,c,d,p,g=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,n,o,c,d,p,g);if(y==null)return null;const w=[],E=[],C=[],k=[],z=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;z.length>0;){const{idx:O,t:U,nodex:W,nodey:Q,depth:se}=z.pop();if(this.leaves[O]){hy(W,Q,se,e,n,o,c,C,k);const _e=1<<se,ge=(W+0)/_e,xe=(W+1)/_e,Ce=(Q+0)/_e,De=(Q+1)/_e,Le=No(ge,Ce,this.dem)*g,Oe=No(xe,Ce,this.dem)*g,Ie=No(xe,De,this.dem)*g,Pe=No(ge,De,this.dem)*g,Ne=cy(C[0],C[1],Le,k[0],C[1],Oe,k[0],k[1],Ie,d,p),Me=cy(k[0],k[1],Ie,C[0],k[1],Pe,C[0],C[1],Le,d,p),ot=Math.min(Ne!==null?Ne:Number.MAX_VALUE,Me!==null?Me:Number.MAX_VALUE);if(ot!==Number.MAX_VALUE)return ot;{const We=H_([],d,p,U);if(py(Le,Oe,Pe,Ie,uy(We[0],C[0],k[0]),uy(We[1],C[1],k[1]))>=We[2])return U}continue}let me=0;for(let _e=0;_e<this._siblingOffset.length;_e++){hy((W<<1)+this._siblingOffset[_e][0],(Q<<1)+this._siblingOffset[_e][1],se+1,e,n,o,c,C,k),C[2]=-100,k[2]=this.maximums[this.childOffsets[O]+_e]*g;const ge=ly(C,k,d,p);if(ge!=null){const xe=ge;w[_e]=xe;let Ce=!1;for(let De=0;De<me&&!Ce;De++)xe>=w[E[De]]&&(E.splice(De,0,_e),Ce=!0);Ce||(E[me]=_e),me++}}for(let _e=0;_e<me;_e++){const ge=E[_e];z.push({idx:this.childOffsets[O]+ge,t:w[ge],nodex:(W<<1)+this._siblingOffset[ge][0],nodey:(Q<<1)+this._siblingOffset[ge][1],depth:se+1})}}return null}_addNode(e,n,o){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(o),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,o,c,d){if(e[c].isLeaf(n,o)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const p=c-1,g=e[p];let y,w=0;for(let E=0;E<this._siblingOffset.length;E++){const C=2*n+this._siblingOffset[E][0],k=2*o+this._siblingOffset[E][1],z=g.getElevation(C,k),O=g.isLeaf(C,k),U=this._addNode(z.min,z.max,O);O&&(w|=1<<E),y||(y=U)}for(let E=0;E<this._siblingOffset.length;E++)w&1<<E||this._construct(e,2*n+this._siblingOffset[E][0],2*o+this._siblingOffset[E][1],p,y+E)}}function py(i,e,n,o,c,d){return Mt(Mt(i,n,d),Mt(e,o,d),c)}function No(i,e,n){const o=n.dim,c=Be(i*o-.5,0,o-1),d=Be(e*o-.5,0,o-1),p=Math.floor(c),g=Math.floor(d),y=Math.min(p+1,o-1),w=Math.min(g+1,o-1);return py(n.get(p,g),n.get(y,g),n.get(p,w),n.get(y,w),c-p,d-g)}const fy={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Xh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,o,c=!1,d=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&o!=="mapbox"&&o!=="terrarium")return Ye(`"${o}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const p=this.dim=n.height-2;if(this.data=new Uint32Array(n.data.buffer),this.encoding=o||"mapbox",this.borderReady=c,!c){for(let g=0;g<p;g++)this.data[this._idx(-1,g)]=this.data[this._idx(0,g)],this.data[this._idx(p,g)]=this.data[this._idx(p-1,g)],this.data[this._idx(g,-1)]=this.data[this._idx(g,0)],this.data[this._idx(g,p)]=this.data[this._idx(g,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new dy(this)}get(e,n,o=!1){const c=new Uint8Array(this.data.buffer);o&&(e=Be(e,-1,this.dim),n=Be(n,-1,this.dim));const d=4*this._idx(e,n);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[d],c[d+1],c[d+2])}static getUnpackVector(e){return fy[e]}get unpackVector(){return fy[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,o){return(256*e*256+256*n+o)/10-1e4}_unpackTerrarium(e,n,o){return 256*e+n+o/256-32768}static pack(e,n){const o=[0,0,0,0],c=Xh.getUnpackVector(n);let d=Math.floor((e+c[3])/c[2]);return o[2]=d%256,d=Math.floor(d/256),o[1]=d%256,d=Math.floor(d/256),o[0]=d,o}getPixels(){return new Fn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,o){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=n*this.dim,d=n*this.dim+this.dim,p=o*this.dim,g=o*this.dim+this.dim;switch(n){case-1:c=d-1;break;case 1:d=c+1}switch(o){case-1:p=g-1;break;case 1:g=p+1}const y=-n*this.dim,w=-o*this.dim;for(let E=p;E<g;E++)for(let C=c;C<d;C++)this.data[this._idx(C,E)]=e.data[this._idx(C+y,E+w)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}Xe("DEMData",Xh),Xe("DemMinMaxQuadTree",dy,{omit:["dem"]});class Fw{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,o){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:n,timeout:void 0};if(o!==void 0&&(d.timeout=setTimeout(()=>{this.remove(e,d)},o)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const o=e.wrapped().key,c=n===void 0?0:this.data[o].indexOf(n),d=this.data[o][c];return this.data[o].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(d.value),this.order.splice(this.order.indexOf(o),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const o in this.data)for(const c of this.data[o])e(c.value)||n.push(c);for(const o of n)this.remove(o.value.tileID,o)}}class rl{constructor(e,n,o){this.func=e,this.mask=n,this.range=o}}rl.ReadOnly=!1,rl.ReadWrite=!0,rl.disabled=new rl(519,rl.ReadOnly,[0,1]);const sf=7680;class af{constructor(e,n,o,c,d,p){this.test=e,this.ref=n,this.mask=o,this.fail=c,this.depthFail=d,this.pass=p}}af.disabled=new af({func:519,mask:0},0,0,sf,sf,sf);class Ir{constructor(e,n,o){this.blendFunction=e,this.blendColor=n,this.mask=o}}Ir.Replace=[1,0],Ir.disabled=new Ir(Ir.Replace,_t.transparent,[!1,!1,!1,!1]),Ir.unblended=new Ir(Ir.Replace,_t.transparent,[!0,!0,!0,!0]),Ir.alphaBlended=new Ir([1,771],_t.transparent,[!0,!0,!0,!0]);const lf=1029,cf=2305;class ur{constructor(e,n,o){this.enable=e,this.mode=n,this.frontFace=o}}ur.disabled=new ur(!1,lf,cf),ur.backCCW=new ur(!0,lf,cf),ur.backCW=new ur(!0,lf,2304),ur.frontCW=new ur(!0,1028,2304),ur.frontCCW=new ur(!0,1028,cf);class js extends Je{constructor(e,n,o){super(),this.id=e,this._onlySymbols=o,n.on("data",c=>{c.dataType==="source"&&c.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&c.dataType==="source"&&c.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Fw(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Rw}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const o=this._tiles[n];o.upload(e),o.prepare(this.map.style.imageManager)}}getIds(){return tt(this._tiles).map(e=>e.tileID).sort(my).map(e=>e.key)}getRenderableIds(e){const n=[];for(const o in this._tiles)this._isIdRenderable(+o,e)&&n.push(this._tiles[o]);return e?n.sort((o,c)=>{const d=o.tileID,p=c.tileID,g=new ye(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),y=new ye(p.canonical.x,p.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-p.overscaledZ||y.y-g.y||y.x-g.x}).map(o=>o.tileID.key):n.map(o=>o.tileID).sort(my).map(o=>o.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const o=this._tiles[e];o&&(o.state!=="loading"&&(o.state=n),this._loadTile(o,this._tileLoaded.bind(this,o,e,n)))}_tileLoaded(e,n,o,c){if(c)return e.state="errored",void(c.status!==404?this._source.fire(new ze(c,{tile:e})):this.update(this.transform));e.timeAdded=on.now(),o==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ue("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const d=n[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const p=this.getTileByID(d);o(e,p),o(p,e)}}function o(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let p=d.tileID.canonical.x-c.tileID.canonical.x;const g=d.tileID.canonical.y-c.tileID.canonical.y,y=Math.pow(2,c.tileID.canonical.z),w=d.tileID.key;p===0&&g===0||Math.abs(g)>1||(Math.abs(p)>1&&(Math.abs(p+y)===1?p+=y:Math.abs(p-y)===1&&(p-=y)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,p,g),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,o,c){for(const d in this._tiles){let p=this._tiles[d];if(c[d]||!p.hasData()||p.tileID.overscaledZ<=n||p.tileID.overscaledZ>o)continue;let g=p.tileID;for(;p&&p.tileID.overscaledZ>n+1;){const w=p.tileID.scaledTo(p.tileID.overscaledZ-1);p=this._tiles[w.key],p&&p.hasData()&&(g=w)}let y=g;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){c[g.key]=g;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const o=this._loadedParentTiles[e.key];return o&&o.tileID.overscaledZ>=n?o:null}for(let o=e.overscaledZ-1;o>=n;o--){const c=e.scaledTo(o),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const o=Math.ceil(e.width/n)+1,c=Math.ceil(e.height/n)+1,d=Math.floor(o*c*5),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,d):d;this._cache.setMaxSize(p)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const o={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+n),o[d.tileID.key]=d}this._tiles=o;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,n,o){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!o)return;let c;this.updateCacheSize(e,n),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(g=>new un(g.canonical.z,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y)):(c=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!o,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(g=>this._source.hasTile(g)))):c=[];const d=this._updateRetainedTiles(c);if(_y(this._source.type)&&c.length!==0){const g={},y={},w=Object.keys(d);for(const C of w){const k=d[C],z=this._tiles[C];if(!z||z.fadeEndTime&&z.fadeEndTime<=on.now())continue;const O=this.findLoadedParent(k,Math.max(k.overscaledZ-js.maxOverzooming,this._source.minzoom));O&&(this._addTile(O.tileID),g[O.tileID.key]=O.tileID),y[C]=k}const E=c[c.length-1].overscaledZ;for(const C in this._tiles){const k=this._tiles[C];if(d[C]||!k.hasData())continue;let z=k.tileID;for(;z.overscaledZ>E;){z=z.scaledTo(z.overscaledZ-1);const O=this._tiles[z.key];if(O&&O.hasData()&&y[z.key]){d[C]=k.tileID;break}}}for(const C in g)d[C]||(this._coveredTiles[C]=!0,d[C]=g[C])}for(const g in d)this._tiles[g].clearFadeHold();const p=function(g,y){const w=[];for(const E in g)E in y||w.push(E);return w}(this._tiles,d);for(const g of p){const y=this._tiles[g];y.hasSymbolBuckets&&!y.holdingForFade()?y.setHoldDuration(this.map._fadeDuration):y.hasSymbolBuckets&&!y.symbolFadeFinished()||this._removeTile(+g)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(e.length===0)return n;const o={},c=e[e.length-1].overscaledZ,d=e[0].overscaledZ,p=Math.max(d-js.maxOverzooming,this._source.minzoom),g=Math.max(d+js.maxUnderzooming,this._source.minzoom),y={};for(const w of e){const E=this._addTile(w);n[w.key]=w,E.hasData()||c<this._source.maxzoom&&(y[w.key]=w)}this._retainLoadedChildren(y,c,g,n);for(const w of e){let E=this._tiles[w.key];if(E.hasData())continue;if(w.canonical.z>=this._source.maxzoom){const k=w.children(this._source.maxzoom)[0],z=this.getTile(k);if(z&&z.hasData()){n[k.key]=k;continue}}else{const k=w.children(this._source.maxzoom);if(n[k[0].key]&&n[k[1].key]&&n[k[2].key]&&n[k[3].key])continue}let C=E.wasRequested();for(let k=w.overscaledZ-1;k>=p;--k){const z=w.scaledTo(k);if(o[z.key]||(o[z.key]=!0,E=this.getTile(z),!E&&C&&(E=this._addTile(z)),E&&(n[z.key]=z,C=E.wasRequested(),E.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let o,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){o=this._loadedParentTiles[c.key];break}n.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(o=this._getLoadedTile(d),o)break;c=d}for(const d of n)this._loadedParentTiles[d]=o}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const o=Boolean(n);return o||(n=new sy(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n?(n.uses++,this._tiles[e.key]=n,o||this._source.fire(new Ue("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const o=n.getExpiryTimeout();o&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},o))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._cache.reset()}tilesIn(e,n,o){const c=[],d=this.transform;if(!d)return c;for(const p in this._tiles){const g=this._tiles[p];if(o&&g.clearQueryDebugViz(),g.holdingForFade())continue;const y=e.containsTile(g,d,n);y&&c.push(y)}return c}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(o=>this._tiles[o].tileID);for(const o of n)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(_y(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=on.now())return!0}return!1}setFeatureState(e,n,o){this._state.updateState(e=e||"_geojsonTileLayer",n,o)}removeFeatureState(e,n,o){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,o)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,o){const c=this._tiles[e];c&&c.setDependencies(n,o)}reloadTilesForDependencies(e,n){for(const o in this._tiles)this._tiles[o].hasDependency(e,n)&&this._reloadTile(+o,"reloading");this._cache.filter(o=>!o.hasDependency(e,n))}}function my(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),o=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||o-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x}function _y(i){return i==="raster"||i==="image"||i==="video"}js.maxOverzooming=10,js.maxUnderzooming=3;class Hh{constructor(e,n,o){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=o}static create(e,n,o){const c=o||e.findDEMTileFor(n);if(!c||!c.dem)return;const d=c.dem,p=c.tileID,g=1<<n.canonical.z-p.canonical.z;return new Hh(c,c.tileSize/Rt/g,[(n.canonical.x/g-p.canonical.x)*d.dim,(n.canonical.y/g-p.canonical.y)*d.dim])}tileCoordToPixel(e,n){const o=n*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(o);return new ye(c,d)}getElevationAt(e,n,o,c){const d=e*this._scale+this._offset[0],p=n*this._scale+this._offset[1],g=Math.floor(d),y=Math.floor(p),w=this._dem;return c=!!c,o?Mt(Mt(w.get(g,y,c),w.get(g,y+1,c),p-y),Mt(w.get(g+1,y,c),w.get(g+1,y+1,c),p-y),d-g):w.get(g,y,c)}getElevationAtPixel(e,n,o){return this._dem.get(e,n,!!o)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*tf(1,e)*this._dem.stride}}class gy{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new As(Rt,16,0),this.featureIndexArray=new I_,this.promoteId=n}insert(e,n,o,c,d,p=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,c,d,p);const y=this.grid;for(let w=0;w<n.length;w++){const E=n[w],C=[1/0,1/0,-1/0,-1/0];for(let k=0;k<E.length;k++){const z=E[k];C[0]=Math.min(C[0],z.x),C[1]=Math.min(C[1],z.y),C[2]=Math.max(C[2],z.x),C[3]=Math.max(C[3],z.y)}C[0]<Rt&&C[1]<Rt&&C[2]>=0&&C[3]>=0&&y.insert(g,C[0],C[1],C[2],C[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ns.VectorTile(new Fc(this.rawTileData)).layers,this.sourceLayerCoder=new ry(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,n,o,c){this.loadVTLayers();const d=e.params||{},p=Ao(d.filter),g=e.tileResult,y=e.transform,w=g.bufferedTilespaceBounds,E=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(O,U,W,Q)=>V_(g.bufferedTilespaceGeometry,O,U,W,Q));E.sort(Bw);let C=null;y.elevation&&E.length>0&&(C=Hh.create(y.elevation,this.tileID));const k={};let z;for(let O=0;O<E.length;O++){const U=E[O];if(U===z)continue;z=U;const W=this.featureIndexArray.get(U);let Q=null;this.loadMatchingFeature(k,W,p,d.layers,d.availableImages,n,o,c,(se,me,_e,ge=0)=>(Q||(Q=Os(se)),me.queryIntersectsFeature(g,se,_e,Q,this.z,e.transform,e.pixelPosMatrix,C,ge)))}return k}loadMatchingFeature(e,n,o,c,d,p,g,y,w){const{featureIndex:E,bucketIndex:C,sourceLayerIndex:k,layoutVertexArrayOffset:z}=n,O=this.bucketLayerIDs[C];if(c&&!function(se,me){for(let _e=0;_e<se.length;_e++)if(me.indexOf(se[_e])>=0)return!0;return!1}(c,O))return;const U=this.sourceLayerCoder.decode(k),W=this.vtLayers[U].feature(E);if(o.needGeometry){const se=Us(W,!0);if(!o.filter(new B(this.tileID.overscaledZ),se,this.tileID.canonical))return}else if(!o.filter(new B(this.tileID.overscaledZ),W))return;const Q=this.getId(W,U);for(let se=0;se<O.length;se++){const me=O[se];if(c&&c.indexOf(me)<0)continue;const _e=p[me];if(!_e)continue;let ge={};Q!==void 0&&y&&(ge=y.getState(_e.sourceLayer||"_geojsonTileLayer",Q));const xe=St({},g[me]);xe.paint=yy(xe.paint,_e.paint,W,ge,d),xe.layout=yy(xe.layout,_e.layout,W,ge,d);const Ce=!w||w(W,_e,ge,z);if(!Ce)continue;const De=new oy(W,this.z,this.x,this.y,Q);De.layer=xe;let Le=e[me];Le===void 0&&(Le=e[me]=[]),Le.push({featureIndex:E,feature:De,intersectionZ:Ce})}}lookupSymbolFeatures(e,n,o,c,d,p,g,y){const w={};this.loadVTLayers();const E=Ao(d);for(const C of e)this.loadMatchingFeature(w,{bucketIndex:o,sourceLayerIndex:c,featureIndex:C,layoutVertexArrayOffset:0},E,p,g,y,n);return w}hasLayer(e){for(const n of this.bucketLayerIDs)for(const o of n)if(e===o)return!0;return!1}getId(e,n){let o=e.id;return this.promoteId&&(o=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function yy(i,e,n,o,c){return Vn(i,(d,p)=>{const g=e instanceof oe?e.get(p):null;return g&&g.evaluate?g.evaluate(n,o,c):g})}function Bw(i,e){return e-i}Xe("FeatureIndex",gy,{omit:["rawTileData","sourceLayerCoder"]});class xy{constructor(e){const n={},o=[];for(const g in e){const y=e[g],w=n[g]={};for(const E in y.glyphs){const C=y.glyphs[+E];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const k=C.metrics.localGlyph?2:1,z={x:0,y:0,w:C.bitmap.width+2*k,h:C.bitmap.height+2*k};o.push(z),w[E]=z}}const{w:c,h:d}=Vp(o),p=new Ro({width:c||1,height:d||1});for(const g in e){const y=e[g];for(const w in y.glyphs){const E=y.glyphs[+w];if(!E||E.bitmap.width===0||E.bitmap.height===0)continue;const C=n[g][w],k=E.metrics.localGlyph?2:1;Ro.copy(E.bitmap,p,{x:0,y:0},{x:C.x+k,y:C.y+k},E.bitmap)}}this.image=p,this.positions=n}}Xe("GlyphAtlas",xy);class Ow{constructor(e){this.tileID=new un(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile}parse(e,n,o,c,d){this.status="parsing",this.data=e,this.collisionBoxArray=new eo;const p=new ry(Object.keys(e.layers).sort()),g=new gy(this.tileID,this.promoteId);g.bucketLayerIDs=[];const y={},w=new rf(256,256),E={featureIndex:g,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:w,availableImages:o},C=n.familiesBySource[this.source];for(const ge in C){const xe=e.layers[ge];if(!xe)continue;let Ce=!1,De=!1;for(const Ie of C[ge])Ie[0].type==="symbol"?Ce=!0:De=!0;if(this.isSymbolTile===!0&&!Ce||this.isSymbolTile===!1&&!De)continue;xe.version===1&&Ye(`Vector tile source "${this.source}" layer "${ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Le=p.encode(ge),Oe=[];for(let Ie=0;Ie<xe.length;Ie++){const Pe=xe.feature(Ie),Ne=g.getId(Pe,ge);Oe.push({feature:Pe,id:Ne,index:Ie,sourceLayerIndex:Le})}for(const Ie of C[ge]){const Pe=Ie[0];this.isSymbolTile!==void 0&&Pe.type==="symbol"!==this.isSymbolTile||Pe.minzoom&&this.zoom<Math.floor(Pe.minzoom)||Pe.maxzoom&&this.zoom>=Pe.maxzoom||Pe.visibility!=="none"&&(uf(Ie,this.zoom,o),(y[Pe.id]=Pe.createBucket({index:g.bucketLayerIDs.length,layers:Ie,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Le,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(Oe,E,this.tileID.canonical),g.bucketLayerIDs.push(Ie.map(Ne=>Ne.id)))}}let k,z,O,U;w.trim();const W={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Q=Vn(E.glyphDependencies,ge=>Object.keys(ge).map(Number));Object.keys(Q).length?c.send("getGlyphs",{uid:this.uid,stacks:Q},(ge,xe)=>{k||(k=ge,z=xe,_e.call(this))},void 0,!1,W):z={};const se=Object.keys(E.iconDependencies);se.length?c.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"icons"},(ge,xe)=>{k||(k=ge,O=xe,_e.call(this))},void 0,!1,W):O={};const me=Object.keys(E.patternDependencies);function _e(){if(k)return d(k);if(z&&O&&U){const ge=new xy(z),xe=new Sg(O,U);for(const Ce in y){const De=y[Ce];De instanceof Uo?(uf(De.layers,this.zoom,o),xw(De,z,ge.positions,O,xe.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):De.hasPattern&&(De instanceof Op||De instanceof Fp||De instanceof Bp)&&(uf(De.layers,this.zoom,o),De.addFeatures(E,this.tileID.canonical,xe.patternPositions))}this.status="done",d(null,{buckets:tt(y).filter(Ce=>!Ce.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ge.image,lineAtlas:w,imageAtlas:xe,glyphMap:this.returnDependencies?z:null,iconMap:this.returnDependencies?O:null,glyphPositions:this.returnDependencies?ge.positions:null})}}me.length?c.send("getImages",{icons:me,source:this.source,tileID:this.tileID,type:"patterns"},(ge,xe)=>{k||(k=ge,U=xe,_e.call(this))},void 0,!1,W):U={},_e.call(this)}}function uf(i,e,n){const o=new B(e);for(const c of i)c.recalculate(o,n)}class vy{constructor(e){this.entries={},this.scheduler=e}request(e,n,o,c){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[p,g]=d.result;return this.scheduler?this.scheduler.add(()=>{c(p,g)},n):c(p,g),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=o((p,g)=>{d.result=[p,g];for(const y of d.callbacks)this.scheduler?this.scheduler.add(()=>{y(p,g)},n):y(p,g);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(p=>p!==c),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function wy(i,e,n){const o=JSON.stringify(i.request);return i.data&&(this.deduped.entries[o]={result:[null,i.data]}),this.deduped.request(o,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},c=>{const d=P(i.request,(p,g,y,w)=>{p?c(p):g&&c(null,{vectorTile:n?void 0:new Ns.VectorTile(new Fc(g)),rawData:g,cacheControl:y,expires:w})});return()=>{d.cancel(),c()}},e)}a.ARRAY_TYPE=vn,a.AUTH_ERR_MSG=Ur,a.Actor=class{constructor(i,e,n){this.target=i,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},An(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Wt()?i:Se,this.scheduler=new Dw}send(i,e,n,o,c=!1,d){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=d,this.callbacks[p]=n);const g=cs(this.globalScope)?void 0:[];return this.target.postMessage({id:p,type:i,hasCallback:!!n,targetMapId:o,mustQueue:c,sourceMapId:this.mapId,data:zs(e,g)},g),{cancel:()=>{n&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:o,sourceMapId:this.mapId})}}}receive(i){const e=i.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const o=this.cancelCallbacks[n];delete this.cancelCallbacks[n],o&&o.cancel()}else if(e.mustQueue||Wt()){const o=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),o&&o.metadata||{type:"message"})}else this.processTask(n,e)}processTask(i,e){if(e.type==="<response>"){const n=this.callbacks[i];delete this.callbacks[i],n&&(e.error?n(Ps(e.error)):n(null,Ps(e.data)))}else{const n=cs(this.globalScope)?void 0:[],o=e.hasCallback?(d,p)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:d?zs(d):null,data:zs(p,n)},n)}:d=>{},c=Ps(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,o);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],c.source)[d[1]](c,o)}else o(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=of,a.Color=_t,a.ColorMode=Ir,a.CullFaceMode=ur,a.DEMData=Xh,a.DataConstantProperty=X,a.DedupedRequest=vy,a.DepthMode=rl,a.EXTENT=Rt,a.Elevation=class{getAtPointOrZero(i,e=0){return this.getAtPoint(i,e)||0}getAtPoint(i,e,n=!0){e==null&&(e=null);const o=this._source();if(!o||i.y<0||i.y>1)return e;const c=o.getSource().maxzoom,d=1<<c,p=Math.floor(i.x),g=i.x-p,y=new un(c,p,c,Math.floor(g*d),Math.floor(i.y*d)),w=this.findDEMTileFor(y);if(!w||!w.dem)return e;const E=w.dem,C=1<<w.tileID.canonical.z,k=(g*C-w.tileID.canonical.x)*E.dim,z=(i.y*C-w.tileID.canonical.y)*E.dim,O=Math.floor(k),U=Math.floor(z);return(n?this.exaggeration():1)*Mt(Mt(E.get(O,U),E.get(O,U+1),z-U),Mt(E.get(O+1,U),E.get(O+1,U+1),z-U),k-O)}getAtTileOffset(i,e,n){const o=1<<i.canonical.z;return this.getAtPointOrZero(new nl(i.wrap+(i.canonical.x+e/Rt)/o,(i.canonical.y+n/Rt)/o))}getForTilePoints(i,e,n,o){const c=Hh.create(this,i,o);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],n)}),!0)}getMinMaxForTile(i){const e=this.findDEMTileFor(i);if(!e||!e.dem)return null;const n=e.dem.tree,o=e.tileID,c=1<<i.canonical.z-o.canonical.z;let d=i.canonical.x/c-o.canonical.x,p=i.canonical.y/c-o.canonical.y,g=0;for(let y=0;y<i.canonical.z-o.canonical.z&&!n.leaves[g];y++){d*=2,p*=2;const w=2*Math.floor(p)+Math.floor(d);g=n.childOffsets[g]+w,d%=1,p%=1}return{min:this.exaggeration()*n.minimums[g],max:this.exaggeration()*n.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=ze,a.EvaluationParameters=B,a.Event=Ue,a.Evented=Je,a.GlyphManager=tl,a.ImagePosition=jp,a.LineAtlas=rf,a.LngLat=ai,a.LngLatBounds=Vs,a.LocalGlyphMode=qp,a.MAX_SAFE_INTEGER=Ke,a.MercatorCoordinate=nl,a.ONE_EM=Fi,a.OverscaledTileID=un,a.Properties=we,a.RGBAImage=Fn,a.RequestManager=class{constructor(i,e,n){this._transformRequestFn=i,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const i=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ho,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,e){return this._transformRequestFn&&this._transformRequestFn(i,e)||{url:i}}normalizeStyleURL(i,e){if(!Mn(i))return i;const n=fn(i);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(i,e){if(!Mn(i))return i;const n=fn(i);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(i,e){if(!Mn(i))return i;const n=fn(i);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(i,e,n,o){const c=fn(i);return Mn(i)?(c.path=`/styles/v1${c.path}/sprite${e}${n}`,this._makeAPIURL(c,this._customAccessToken||o)):(c.path+=`${e}${n}`,xr(c))}normalizeTileURL(i,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!Mn(i))return i;const o=fn(i);o.path=o.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&o.authority!=="raster"&&n===512?"@2x":""}${jn.supported?".webp":"$1"}`),o.authority==="raster"?o.path=`/${It.RASTER_URL_PREFIX}${o.path}`:(o.path=o.path.replace(/^.+\/v4\//,"/"),o.path=`/${It.TILE_URL_VERSION}${o.path}`);const c=this._customAccessToken||function(d){for(const p of d){const g=p.match(/^access_token=(.*)$/);if(g)return g[1]}return null}(o.params)||It.ACCESS_TOKEN;return It.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&o.params.push(`sku=${this._skuToken}`),this._makeAPIURL(o,c)}canonicalizeTileURL(i,e){const n=fn(i);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return i;let o="mapbox://";n.path.match(/^\/raster\/v1\//)?o+=`raster/${n.path.replace(`/${It.RASTER_URL_PREFIX}/`,"")}`:o+=`tiles/${n.path.replace(`/${It.TILE_URL_VERSION}/`,"")}`;let c=n.params;return e&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(o+=`?${c.join("&")}`),o}canonicalizeTileset(i,e){const n=!!e&&Mn(e),o=[];for(const c of i.tiles||[])yr(c)?o.push(this.canonicalizeTileURL(c,n)):o.push(c);return o}_makeAPIURL(i,e){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",o=fn(It.API_URL);if(i.protocol=o.protocol,i.authority=o.authority,i.protocol==="http"){const c=i.params.indexOf("secure");c>=0&&i.params.splice(c,1)}if(o.path!=="/"&&(i.path=`${o.path}${i.path}`),!It.REQUIRE_ACCESS_TOKEN)return xr(i);if(e=e||It.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return i.params=i.params.filter(c=>c.indexOf("access_token")===-1),i.params.push(`access_token=${e||""}`),xr(i)}},a.ResourceType=$r,a.SegmentVector=Vi,a.SourceCache=js,a.StencilMode=af,a.StructArrayLayout1ui2=xn,a.StructArrayLayout2f1f2i16=Zn,a.StructArrayLayout2i4=ct,a.StructArrayLayout2ui4=Ci,a.StructArrayLayout3f12=pt,a.StructArrayLayout3ui6=Nt,a.StructArrayLayout4i8=ti,a.Texture=qh,a.Tile=sy,a.Transitionable=K,a.Uniform1f=kh,a.Uniform1i=class extends Do{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},a.Uniform2f=class extends Do{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},a.Uniform3f=class extends Do{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},a.Uniform4f=D_,a.UniformColor=L_,a.UniformMatrix3f=class extends Do{constructor(i,e){super(i,e),this.current=Bv}set(i){for(let e=0;e<9;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}},a.UniformMatrix4f=class extends Do{constructor(i,e){super(i,e),this.current=Fv}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},a.UnwrappedTileID=ny,a.ValidationError=be,a.VectorTileWorkerSource=class extends Je{constructor(i,e,n,o,c){super(),this.actor=i,this.layerIndex=e,this.availableImages=n,this.loadVectorData=c||wy,this.loading={},this.loaded={},this.deduped=new vy(i.scheduler),this.isSpriteLoaded=o,this.scheduler=i.scheduler}loadTile(i,e){const n=i.uid,o=i&&i.request,c=o&&o.collectResourceTiming,d=this.loading[n]=new Ow(i);d.abort=this.loadVectorData(i,(p,g)=>{const y=!this.loading[n];if(delete this.loading[n],y||p||!g)return d.status="done",y||(this.loaded[n]=d),e(p);const w=g.rawData,E={};g.expires&&(E.expires=g.expires),g.cacheControl&&(E.cacheControl=g.cacheControl),d.vectorTile=g.vectorTile||new Ns.VectorTile(new Fc(w));const C=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(k,z)=>{if(k||!z)return e(k);const O={};if(c){const U=ty(o);U.length>0&&(O.resourceTiming=JSON.parse(JSON.stringify(U)))}e(null,St({rawTileData:w.slice(0)},z,E,O))})};this.isSpriteLoaded?C():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(C,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):C()}),this.loaded=this.loaded||{},this.loaded[n]=d})}reloadTile(i,e){const n=this.loaded,o=i.uid,c=this;if(n&&n[o]){const d=n[o];d.showCollisionBoxes=i.showCollisionBoxes,d.enableTerrain=!!i.enableTerrain;const p=(g,y)=>{const w=d.reloadCallback;w&&(delete d.reloadCallback,d.parse(d.vectorTile,c.layerIndex,this.availableImages,c.actor,w)),e(g,y)};d.status==="parsing"?d.reloadCallback=p:d.status==="done"&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,p):p())}}abortTile(i,e){const n=i.uid,o=this.loading[n];o&&(o.abort&&o.abort(),delete this.loading[n]),e()}removeTile(i,e){const n=this.loaded,o=i.uid;n&&n[o]&&delete n[o],e()}},a.WritingMode=Bn,a.ZoomHistory=uh,a.add=function(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i},a.addDynamicAttributes=Yp,a.altitudeFromMercatorZ=nf,a.asyncAll=ht,a.bezier=Ee,a.bindAll=An,a.bufferConvexPolygon=function(i,e){const n=[];for(let o=0;o<i.length;o++){const c=rt(o-1,-1,i.length-1),d=rt(o+1,-1,i.length-1),p=i[o],g=i[d],y=i[c].sub(p).unit(),w=g.sub(p).unit(),E=w.angleWithSep(y.x,y.y),C=y.add(w).unit().mult(-1*e/Math.sin(E/2));n.push(p.add(C))}return n},a.cacheEntryPossiblyAdded=function(i){jr++,jr>ms&&(i.getActor().send("enforceCacheSizeLimit",la),jr=0)},a.clamp=Be,a.clearTileCache=function(i){const e=Se.caches.delete(fo);i&&e.catch(i).then(()=>i())},a.clipLine=Bg,a.clone=function(i){var e=new vn(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},a.clone$1=function(i){var e=new vn(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},a.clone$2=Gt,a.collisionCircleLayout=Z1,a.config=It,a.conjugate=function(i,e){return i[0]=-e[0],i[1]=-e[1],i[2]=-e[2],i[3]=e[3],i},a.copy=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i},a.create=zh,a.create$1=function(){var i=new vn(16);return vn!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.create$2=G_,a.createExpression=Rn,a.createFilter=Ao,a.createLayout=He,a.createStyleLayer=function(i){return i.type==="custom"?new Iw(i):new Mw[i.type](i)},a.cross=function(i,e,n){var o=e[0],c=e[1],d=e[2],p=n[0],g=n[1],y=n[2];return i[0]=c*y-d*g,i[1]=d*p-o*y,i[2]=o*g-c*p,i},a.degToRad=ne,a.div=function(i,e,n){return i[0]=e[0]/n[0],i[1]=e[1]/n[1],i[2]=e[2]/n[2],i},a.dot=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},a.dot$1=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]*e[3]},a.ease=nt,a.easeCubicInOut=ve,a.emitValidationErrors=mc,a.endsWith=pn,a.enforceCacheSizeLimit=function(i){wr(),_n&&_n.then(e=>{e.keys().then(n=>{for(let o=0;o<n.length-i;o++)e.delete(n[o])})})},a.evaluateSizeForFeature=Fh,a.evaluateSizeForZoom=Ka,a.evaluateVariableOffset=jg,a.evented=I,a.exactEquals=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]},a.exactEquals$1=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]},a.exported=on,a.exported$1=jn,a.extend=St,a.filterObject=Pi,a.fromMat4=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],i},a.fromQuat=function(i,e){var n=e[0],o=e[1],c=e[2],d=e[3],p=n+n,g=o+o,y=c+c,w=n*p,E=o*p,C=o*g,k=c*p,z=c*g,O=c*y,U=d*p,W=d*g,Q=d*y;return i[0]=1-C-O,i[1]=E+Q,i[2]=k-W,i[3]=0,i[4]=E-Q,i[5]=1-w-O,i[6]=z+U,i[7]=0,i[8]=k+W,i[9]=z-U,i[10]=1-w-C,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.fromRotation=function(i,e){var n=Math.sin(e),o=Math.cos(e);return i[0]=o,i[1]=n,i[2]=0,i[3]=-n,i[4]=o,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},a.fromScaling=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.furthestTileCorner=function(i){const e=Math.round((i+45+360)%360/90)%4;return ce[e]},a.getAABBPointSquareDist=function(i,e,n){let o=0;for(let c=0;c<2;++c){const d=n?n[c]:0;i[c]>d&&(o+=(i[c]-d)*(i[c]-d)),e[c]<d&&(o+=(d-e[c])*(d-e[c]))}return o},a.getAnchorAlignment=Zp,a.getAnchorJustification=Xp,a.getBounds=function(i){let e=1/0,n=1/0,o=-1/0,c=-1/0;for(const d of i)e=Math.min(e,d.x),n=Math.min(n,d.y),o=Math.max(o,d.x),c=Math.max(c,d.y);return{min:new ye(e,n),max:new ye(o,c)}},a.getImage=re,a.getJSON=function(i,e){return V(St(i,{type:"json"}),e)},a.getMapSessionAPI=Rl,a.getPerformanceMeasurement=ty,a.getRTLTextPluginStatus=M,a.getReferrer=$n,a.getVideo=function(i,e){const n=Se.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let o=0;o<i.length;o++){const c=Se.document.createElement("source");q(i[o])||(n.crossOrigin="Anonymous"),c.src=i[o],n.appendChild(c)}return{cancel:()=>{}}},a.identity=Ep,a.identity$1=Q_,a.invert=function(i,e){var n=e[0],o=e[1],c=e[2],d=e[3],p=e[4],g=e[5],y=e[6],w=e[7],E=e[8],C=e[9],k=e[10],z=e[11],O=e[12],U=e[13],W=e[14],Q=e[15],se=n*g-o*p,me=n*y-c*p,_e=n*w-d*p,ge=o*y-c*g,xe=o*w-d*g,Ce=c*w-d*y,De=E*U-C*O,Le=E*W-k*O,Oe=E*Q-z*O,Ie=C*W-k*U,Pe=C*Q-z*U,Ne=k*Q-z*W,Me=se*Ne-me*Pe+_e*Ie+ge*Oe-xe*Le+Ce*De;return Me?(i[0]=(g*Ne-y*Pe+w*Ie)*(Me=1/Me),i[1]=(c*Pe-o*Ne-d*Ie)*Me,i[2]=(U*Ce-W*xe+Q*ge)*Me,i[3]=(k*xe-C*Ce-z*ge)*Me,i[4]=(y*Oe-p*Ne-w*Le)*Me,i[5]=(n*Ne-c*Oe+d*Le)*Me,i[6]=(W*_e-O*Ce-Q*me)*Me,i[7]=(E*Ce-k*_e+z*me)*Me,i[8]=(p*Pe-g*Oe+w*De)*Me,i[9]=(o*Oe-n*Pe-d*De)*Me,i[10]=(O*xe-U*_e+Q*se)*Me,i[11]=(C*_e-E*xe-z*se)*Me,i[12]=(g*Le-p*Ie-y*De)*Me,i[13]=(n*Ie-o*Le+c*De)*Me,i[14]=(U*me-O*ge-W*se)*Me,i[15]=(E*ge-C*me+k*se)*Me,i):null},a.isMapAuthenticated=function(i){return Nr.has(i)},a.isMapboxURL=Mn,a.latFromMercatorY=Wh,a.len=Jv,a.length=q_,a.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},a.loadVectorTile=wy,a.makeRequest=V,a.mercatorXfromLng=Jg,a.mercatorYfromLat=ey,a.mercatorZfromAltitude=tf,a.mul=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},a.mul$1=Yv,a.mul$2=Qv,a.multiply=Z_,a.multiply$1=X_,a.nextPowerOfTwo=In,a.normalize=Y_,a.normalize$1=function(i,e){var n=e[0],o=e[1],c=e[2],d=e[3],p=n*n+o*o+c*c+d*d;return p>0&&(p=1/Math.sqrt(p)),i[0]=n*p,i[1]=o*p,i[2]=c*p,i[3]=d*p,i},a.number=Mt,a.ortho=function(i,e,n,o,c,d,p){var g=1/(e-n),y=1/(o-c),w=1/(d-p);return i[0]=-2*g,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*y,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*w,i[11]=0,i[12]=(e+n)*g,i[13]=(c+o)*y,i[14]=(p+d)*w,i[15]=1,i},a.pbf=Fc,a.perspective=function(i,e,n,o,c){var d,p=1/Math.tan(e/2);return i[0]=p/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=p,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,c!=null&&c!==1/0?(i[10]=(c+o)*(d=1/(o-c)),i[14]=2*c*o*d):(i[10]=-1,i[14]=-2*o),i},a.pick=function(i,e){const n={};for(let o=0;o<e.length;o++){const c=e[o];c in i&&(n[c]=i[c])}return n},a.plugin=F,a.pointGeometry=ye,a.polygonIntersectsBox=V_,a.polygonIntersectsPolygon=B_,a.polygonizeBounds=function(i,e,n=0,o=!0){const c=new ye(n,n),d=i.sub(c),p=e.add(c),g=[d,new ye(p.x,d.y),p,new ye(d.x,p.y)];return o&&g.push(d),g},a.posAttributes=Lw,a.postMapLoadEvent=fs,a.postTurnstileEvent=sa,a.potpack=Vp,a.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},a.radToDeg=function(i){return i*ue},a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(i){return i({pluginStatus:_,pluginURL:v}),I.on("pluginStateChange",i),i},a.removeAuthState=function(i){Nr.delete(i)},a.renderColorRamp=Ip,a.rotateX=function(i,e,n){var o=Math.sin(n),c=Math.cos(n),d=e[4],p=e[5],g=e[6],y=e[7],w=e[8],E=e[9],C=e[10],k=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=d*c+w*o,i[5]=p*c+E*o,i[6]=g*c+C*o,i[7]=y*c+k*o,i[8]=w*c-d*o,i[9]=E*c-p*o,i[10]=C*c-g*o,i[11]=k*c-y*o,i},a.rotateX$1=J_,a.rotateY=function(i,e,n){var o=Math.sin(n),c=Math.cos(n),d=e[0],p=e[1],g=e[2],y=e[3],w=e[8],E=e[9],C=e[10],k=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*c-w*o,i[1]=p*c-E*o,i[2]=g*c-C*o,i[3]=y*c-k*o,i[8]=d*o+w*c,i[9]=p*o+E*c,i[10]=g*o+C*c,i[11]=y*o+k*c,i},a.rotateZ=function(i,e,n){var o=Math.sin(n),c=Math.cos(n),d=e[0],p=e[1],g=e[2],y=e[3],w=e[4],E=e[5],C=e[6],k=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=d*c+w*o,i[1]=p*c+E*o,i[2]=g*c+C*o,i[3]=y*c+k*o,i[4]=w*c-d*o,i[5]=E*c-p*o,i[6]=C*c-g*o,i[7]=k*c-y*o,i},a.rotateZ$1=function(i,e,n){n*=.5;var o=e[0],c=e[1],d=e[2],p=e[3],g=Math.sin(n),y=Math.cos(n);return i[0]=o*y+c*g,i[1]=c*y-o*g,i[2]=d*y+p*g,i[3]=p*y-d*g,i},a.scale=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i},a.scale$1=function(i,e,n){var o=n[0],c=n[1],d=n[2];return i[0]=e[0]*o,i[1]=e[1]*o,i[2]=e[2]*o,i[3]=e[3]*o,i[4]=e[4]*c,i[5]=e[5]*c,i[6]=e[6]*c,i[7]=e[7]*c,i[8]=e[8]*d,i[9]=e[9]*d,i[10]=e[10]*d,i[11]=e[11]*d,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},a.scale$2=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},a.scaleAndAdd=H_,a.setCacheLimits=function(i,e){la=i,ms=e},a.setRTLTextPlugin=function(i,e,n=!1){if(_===t||_===s||_===h)throw new Error("setRTLTextPlugin cannot be called multiple times.");v=on.resolveURL(i),_=t,m=e,S(),n||D()},a.smoothstep=function(i,e,n){return(n=Be((n-i)/(e-i),0,1))*n*(3-2*n)},a.spec=te,a.storeAuthState=function(i,e){e?Nr.add(i):Nr.delete(i)},a.sub=Kv,a.subtract=W_,a.symbolSize=q1,a.transformMat3=function(i,e,n){var o=e[0],c=e[1],d=e[2];return i[0]=o*n[0]+c*n[3]+d*n[6],i[1]=o*n[1]+c*n[4]+d*n[7],i[2]=o*n[2]+c*n[5]+d*n[8],i},a.transformMat4=Ic,a.transformMat4$1=function(i,e,n){var o=e[0],c=e[1],d=e[2],p=n[3]*o+n[7]*c+n[11]*d+n[15];return i[0]=(n[0]*o+n[4]*c+n[8]*d+n[12])/(p=p||1),i[1]=(n[1]*o+n[5]*c+n[9]*d+n[13])/p,i[2]=(n[2]*o+n[6]*c+n[10]*d+n[14])/p,i},a.transformQuat=K_,a.translate=function(i,e,n){var o,c,d,p,g,y,w,E,C,k,z,O,U=n[0],W=n[1],Q=n[2];return e===i?(i[12]=e[0]*U+e[4]*W+e[8]*Q+e[12],i[13]=e[1]*U+e[5]*W+e[9]*Q+e[13],i[14]=e[2]*U+e[6]*W+e[10]*Q+e[14],i[15]=e[3]*U+e[7]*W+e[11]*Q+e[15]):(c=e[1],d=e[2],p=e[3],g=e[4],y=e[5],w=e[6],E=e[7],C=e[8],k=e[9],z=e[10],O=e[11],i[0]=o=e[0],i[1]=c,i[2]=d,i[3]=p,i[4]=g,i[5]=y,i[6]=w,i[7]=E,i[8]=C,i[9]=k,i[10]=z,i[11]=O,i[12]=o*U+g*W+C*Q+e[12],i[13]=c*U+y*W+k*Q+e[13],i[14]=d*U+w*W+z*Q+e[14],i[15]=p*U+E*W+O*Q+e[15]),i},a.triggerPluginCompletionEvent=b,a.uniqueId=xi,a.validateCustomStyleLayer=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},a.validateFog=Ba,a.validateLight=fc,a.validateStyle=zo,a.values=tt,a.vectorTile=Ns,a.version=H,a.warnOnce=Ye,a.window=Se,a.wrap=rt}),A(["./shared"],function(a){function H(V){const P=typeof V;if(P==="number"||P==="boolean"||P==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){let q="[";for(const J of V)q+=`${H(J)},`;return`${q}]`}const L=Object.keys(V).sort();let j="{";for(let q=0;q<L.length;q++)j+=`${JSON.stringify(L[q])}:${H(V[L[q]])},`;return`${j}}`}function pe(V){let P="";for(const L of a.refProperties)P+=`/${H(V[L])}`;return P}class Fe{constructor(P){this.keyCache={},P&&this.replace(P)}replace(P){this._layerConfigs={},this._layers={},this.update(P,[])}update(P,L){for(const q of P){this._layerConfigs[q.id]=q;const J=this._layers[q.id]=a.createStyleLayer(q);J._featureFilter=a.createFilter(J.filter),this.keyCache[q.id]&&delete this.keyCache[q.id]}for(const q of L)delete this.keyCache[q],delete this._layerConfigs[q],delete this._layers[q];this.familiesBySource={};const j=function(q,J){const he={};for(let re=0;re<q.length;re++){const fe=J&&J[q[re].id]||pe(q[re]);J&&(J[q[re].id]=fe);let ke=he[fe];ke||(ke=he[fe]=[]),ke.push(q[re])}const de=[];for(const re in he)de.push(he[re]);return de}(a.values(this._layerConfigs),this.keyCache);for(const q of j){const J=q.map(Ue=>this._layers[Ue.id]),he=J[0];if(he.visibility==="none")continue;const de=he.source||"";let re=this.familiesBySource[de];re||(re=this.familiesBySource[de]={});const fe=he.sourceLayer||"_geojsonTileLayer";let ke=re[fe];ke||(ke=re[fe]=[]),ke.push(J)}}}const{ImageBitmap:ye}=a.window;class ie{loadTile(P,L){const{uid:j,encoding:q,rawImageData:J,padding:he,buildQuadTree:de}=P,re=ye&&J instanceof ye?this.getImageData(J,he):J;L(null,new a.DEMData(j,re,q,he<1,de))}getImageData(P,L){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(P.width,P.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=P.width,this.offscreenCanvas.height=P.height,this.offscreenCanvasContext.drawImage(P,0,0,P.width,P.height);const j=this.offscreenCanvasContext.getImageData(-L,-L,P.width+2*L,P.height+2*L);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new a.RGBAImage({width:j.width,height:j.height},j.data)}}var Se=function V(P,L){var j,q=P&&P.type;if(q==="FeatureCollection")for(j=0;j<P.features.length;j++)V(P.features[j],L);else if(q==="GeometryCollection")for(j=0;j<P.geometries.length;j++)V(P.geometries[j],L);else if(q==="Feature")V(P.geometry,L);else if(q==="Polygon")Ke(P.coordinates,L);else if(q==="MultiPolygon")for(j=0;j<P.coordinates.length;j++)Ke(P.coordinates[j],L);return P};function Ke(V,P){if(V.length!==0){Qe(V[0],P);for(var L=1;L<V.length;L++)Qe(V[L],!P)}}function Qe(V,P){for(var L=0,j=0,q=V.length,J=q-1;j<q;J=j++)L+=(V[j][0]-V[J][0])*(V[J][1]+V[j][1]);L>=0!=!!P&&V.reverse()}const ue=a.vectorTile.VectorTileFeature.prototype.toGeoJSON;class ne{constructor(P){this._feature=P,this.extent=a.EXTENT,this.type=P.type,this.properties=P.tags,"id"in P&&!isNaN(P.id)&&(this.id=parseInt(P.id,10))}loadGeometry(){if(this._feature.type===1){const P=[];for(const L of this._feature.geometry)P.push([new a.pointGeometry(L[0],L[1])]);return P}{const P=[];for(const L of this._feature.geometry){const j=[];for(const q of L)j.push(new a.pointGeometry(q[0],q[1]));P.push(j)}return P}}toGeoJSON(P,L,j){return ue.call(this,P,L,j)}}class ce{constructor(P){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=P.length,this._features=P}feature(P){return new ne(this._features[P])}}var ve=a.vectorTile.VectorTileFeature,Ee=nt;function nt(V,P){this.options=P||{},this.features=V,this.length=V.length}function Be(V,P){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=P||4096}nt.prototype.feature=function(V){return new Be(this.features[V],this.options.extent)},Be.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var P=0;P<V.length;P++){for(var L=V[P],j=[],q=0;q<L.length;q++)j.push(new a.pointGeometry(L[q][0],L[q][1]));this.geometry.push(j)}return this.geometry},Be.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,P=1/0,L=-1/0,j=1/0,q=-1/0,J=0;J<V.length;J++)for(var he=V[J],de=0;de<he.length;de++){var re=he[de];P=Math.min(P,re.x),L=Math.max(L,re.x),j=Math.min(j,re.y),q=Math.max(q,re.y)}return[P,j,L,q]},Be.prototype.toGeoJSON=ve.prototype.toGeoJSON;var rt=tt,ht=Ee;function tt(V){var P=new a.pbf;return function(L,j){for(var q in L.layers)j.writeMessage(3,St,L.layers[q])}(V,P),P.finish()}function St(V,P){var L;P.writeVarintField(15,V.version||1),P.writeStringField(1,V.name||""),P.writeVarintField(5,V.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(L=0;L<V.length;L++)j.feature=V.feature(L),P.writeMessage(2,Br,j);var q=j.keys;for(L=0;L<q.length;L++)P.writeStringField(3,q[L]);var J=j.values;for(L=0;L<J.length;L++)P.writeMessage(4,An,J[L])}function Br(V,P){var L=V.feature;L.id!==void 0&&P.writeVarintField(1,L.id),P.writeMessage(2,xi,V),P.writeVarintField(3,L.type),P.writeMessage(4,nn,L)}function xi(V,P){var L=V.feature,j=V.keys,q=V.values,J=V.keycache,he=V.valuecache;for(var de in L.properties){var re=J[de];re===void 0&&(j.push(de),J[de]=re=j.length-1),P.writeVarint(re);var fe=L.properties[de],ke=typeof fe;ke!=="string"&&ke!=="boolean"&&ke!=="number"&&(fe=JSON.stringify(fe));var Ue=ke+":"+fe,ze=he[Ue];ze===void 0&&(q.push(fe),he[Ue]=ze=q.length-1),P.writeVarint(ze)}}function ei(V,P){return(P<<3)+(7&V)}function In(V){return V<<1^V>>31}function nn(V,P){for(var L=V.loadGeometry(),j=V.type,q=0,J=0,he=L.length,de=0;de<he;de++){var re=L[de],fe=1;j===1&&(fe=re.length),P.writeVarint(ei(1,fe));for(var ke=j===3?re.length-1:re.length,Ue=0;Ue<ke;Ue++){Ue===1&&j!==1&&P.writeVarint(ei(2,ke-1));var ze=re[Ue].x-q,Je=re[Ue].y-J;P.writeVarint(In(ze)),P.writeVarint(In(Je)),q+=ze,J+=Je}j===3&&P.writeVarint(ei(7,1))}}function An(V,P){var L=typeof V;L==="string"?P.writeStringField(1,V):L==="boolean"?P.writeBooleanField(7,V):L==="number"&&(V%1!=0?P.writeDoubleField(3,V):V<0?P.writeSVarintField(6,V):P.writeVarintField(5,V))}function pn(V,P,L,j,q,J){if(q-j<=L)return;const he=j+q>>1;Vn(V,P,he,j,q,J%2),pn(V,P,L,j,he-1,J+1),pn(V,P,L,he+1,q,J+1)}function Vn(V,P,L,j,q,J){for(;q>j;){if(q-j>600){const fe=q-j+1,ke=L-j+1,Ue=Math.log(fe),ze=.5*Math.exp(2*Ue/3),Je=.5*Math.sqrt(Ue*ze*(fe-ze)/fe)*(ke-fe/2<0?-1:1);Vn(V,P,L,Math.max(j,Math.floor(L-ke*ze/fe+Je)),Math.min(q,Math.floor(L+(fe-ke)*ze/fe+Je)),J)}const he=P[2*L+J];let de=j,re=q;for(Pi(V,P,j,L),P[2*q+J]>he&&Pi(V,P,j,q);de<re;){for(Pi(V,P,de,re),de++,re--;P[2*de+J]<he;)de++;for(;P[2*re+J]>he;)re--}P[2*j+J]===he?Pi(V,P,j,re):(re++,Pi(V,P,re,q)),re<=L&&(j=re+1),L<=re&&(q=re-1)}}function Pi(V,P,L,j){Gt(V,L,j),Gt(P,2*L,2*j),Gt(P,2*L+1,2*j+1)}function Gt(V,P,L){const j=V[P];V[P]=V[L],V[L]=j}function Ge(V,P,L,j){const q=V-L,J=P-j;return q*q+J*J}rt.fromVectorTileJs=tt,rt.fromGeojsonVt=function(V,P){P=P||{};var L={};for(var j in V)L[j]=new Ee(V[j].features,P),L[j].name=j,L[j].version=P.version,L[j].extent=P.extent;return tt({layers:L})},rt.GeoJSONWrapper=ht;const Ye=V=>V[0],ut=V=>V[1];class Zt{constructor(P,L=Ye,j=ut,q=64,J=Float64Array){this.nodeSize=q,this.points=P;const he=P.length<65536?Uint16Array:Uint32Array,de=this.ids=new he(P.length),re=this.coords=new J(2*P.length);for(let fe=0;fe<P.length;fe++)de[fe]=fe,re[2*fe]=L(P[fe]),re[2*fe+1]=j(P[fe]);pn(de,re,q,0,de.length-1,0)}range(P,L,j,q){return function(J,he,de,re,fe,ke,Ue){const ze=[0,J.length-1,0],Je=[];let te,be;for(;ze.length;){const st=ze.pop(),ft=ze.pop(),dt=ze.pop();if(ft-dt<=Ue){for(let $t=dt;$t<=ft;$t++)te=he[2*$t],be=he[2*$t+1],te>=de&&te<=fe&&be>=re&&be<=ke&&Je.push(J[$t]);continue}const At=Math.floor((dt+ft)/2);te=he[2*At],be=he[2*At+1],te>=de&&te<=fe&&be>=re&&be<=ke&&Je.push(J[At]);const Tt=(st+1)%2;(st===0?de<=te:re<=be)&&(ze.push(dt),ze.push(At-1),ze.push(Tt)),(st===0?fe>=te:ke>=be)&&(ze.push(At+1),ze.push(ft),ze.push(Tt))}return Je}(this.ids,this.coords,P,L,j,q,this.nodeSize)}within(P,L,j){return function(q,J,he,de,re,fe){const ke=[0,q.length-1,0],Ue=[],ze=re*re;for(;ke.length;){const Je=ke.pop(),te=ke.pop(),be=ke.pop();if(te-be<=fe){for(let Tt=be;Tt<=te;Tt++)Ge(J[2*Tt],J[2*Tt+1],he,de)<=ze&&Ue.push(q[Tt]);continue}const st=Math.floor((be+te)/2),ft=J[2*st],dt=J[2*st+1];Ge(ft,dt,he,de)<=ze&&Ue.push(q[st]);const At=(Je+1)%2;(Je===0?he-re<=ft:de-re<=dt)&&(ke.push(be),ke.push(st-1),ke.push(At)),(Je===0?he+re>=ft:de+re>=dt)&&(ke.push(st+1),ke.push(te),ke.push(At))}return Ue}(this.ids,this.coords,P,L,j,this.nodeSize)}}const Wt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:V=>V},Di=Math.fround||(Li=new Float32Array(1),V=>(Li[0]=+V,Li[0]));var Li;class vt{constructor(P){this.options=jn(Object.create(Wt),P),this.trees=new Array(this.options.maxZoom+1)}load(P){const{log:L,minZoom:j,maxZoom:q,nodeSize:J}=this.options;L&&console.time("total time");const he=`prepare ${P.length} points`;L&&console.time(he),this.points=P;let de=[];for(let re=0;re<P.length;re++)P[re].geometry&&de.push(ls(P[re],re));this.trees[q+1]=new Zt(de,_r,tr,J,Float32Array),L&&console.timeEnd(he);for(let re=q;re>=j;re--){const fe=+Date.now();de=this._cluster(de,re),this.trees[re]=new Zt(de,_r,tr,J,Float32Array),L&&console.log("z%d: %d clusters in %dms",re,de.length,+Date.now()-fe)}return L&&console.timeEnd("total time"),this}getClusters(P,L){let j=((P[0]+180)%360+360)%360-180;const q=Math.max(-90,Math.min(90,P[1]));let J=P[2]===180?180:((P[2]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,P[3]));if(P[2]-P[0]>=360)j=-180,J=180;else if(j>J){const ke=this.getClusters([j,q,180,he],L),Ue=this.getClusters([-180,q,J,he],L);return ke.concat(Ue)}const de=this.trees[this._limitZoom(L)],re=de.range(on(j),er(he),on(J),er(q)),fe=[];for(const ke of re){const Ue=de.points[ke];fe.push(Ue.numPoints?cs(Ue):this.points[Ue.index])}return fe}getChildren(P){const L=this._getOriginId(P),j=this._getOriginZoom(P),q="No cluster with the specified id.",J=this.trees[j];if(!J)throw new Error(q);const he=J.points[L];if(!he)throw new Error(q);const de=this.options.radius/(this.options.extent*Math.pow(2,j-1)),re=J.within(he.x,he.y,de),fe=[];for(const ke of re){const Ue=J.points[ke];Ue.parentId===P&&fe.push(Ue.numPoints?cs(Ue):this.points[Ue.index])}if(fe.length===0)throw new Error(q);return fe}getLeaves(P,L,j){const q=[];return this._appendLeaves(q,P,L=L||10,j=j||0,0),q}getTile(P,L,j){const q=this.trees[this._limitZoom(P)],J=Math.pow(2,P),{extent:he,radius:de}=this.options,re=de/he,fe=(j-re)/J,ke=(j+1+re)/J,Ue={features:[]};return this._addTileFeatures(q.range((L-re)/J,fe,(L+1+re)/J,ke),q.points,L,j,J,Ue),L===0&&this._addTileFeatures(q.range(1-re/J,fe,1,ke),q.points,J,j,J,Ue),L===J-1&&this._addTileFeatures(q.range(0,fe,re/J,ke),q.points,-1,j,J,Ue),Ue.features.length?Ue:null}getClusterExpansionZoom(P){let L=this._getOriginZoom(P)-1;for(;L<=this.options.maxZoom;){const j=this.getChildren(P);if(L++,j.length!==1)break;P=j[0].properties.cluster_id}return L}_appendLeaves(P,L,j,q,J){const he=this.getChildren(L);for(const de of he){const re=de.properties;if(re&&re.cluster?J+re.point_count<=q?J+=re.point_count:J=this._appendLeaves(P,re.cluster_id,j,q,J):J<q?J++:P.push(de),P.length===j)break}return J}_addTileFeatures(P,L,j,q,J,he){for(const de of P){const re=L[de],fe=re.numPoints;let ke,Ue,ze;if(fe)ke=us(re),Ue=re.x,ze=re.y;else{const be=this.points[re.index];ke=be.properties,Ue=on(be.geometry.coordinates[0]),ze=er(be.geometry.coordinates[1])}const Je={type:1,geometry:[[Math.round(this.options.extent*(Ue*J-j)),Math.round(this.options.extent*(ze*J-q))]],tags:ke};let te;fe?te=re.id:this.options.generateId?te=re.index:this.points[re.index].id&&(te=this.points[re.index].id),te!==void 0&&(Je.id=te),he.features.push(Je)}}_limitZoom(P){return Math.max(this.options.minZoom,Math.min(+P,this.options.maxZoom+1))}_cluster(P,L){const j=[],{radius:q,extent:J,reduce:he,minPoints:de}=this.options,re=q/(J*Math.pow(2,L));for(let fe=0;fe<P.length;fe++){const ke=P[fe];if(ke.zoom<=L)continue;ke.zoom=L;const Ue=this.trees[L+1],ze=Ue.within(ke.x,ke.y,re),Je=ke.numPoints||1;let te=Je;for(const be of ze){const st=Ue.points[be];st.zoom>L&&(te+=st.numPoints||1)}if(te>=de){let be=ke.x*Je,st=ke.y*Je,ft=he&&Je>1?this._map(ke,!0):null;const dt=(fe<<5)+(L+1)+this.points.length;for(const At of ze){const Tt=Ue.points[At];if(Tt.zoom<=L)continue;Tt.zoom=L;const $t=Tt.numPoints||1;be+=Tt.x*$t,st+=Tt.y*$t,Tt.parentId=dt,he&&(ft||(ft=this._map(ke,!0)),he(ft,this._map(Tt)))}ke.parentId=dt,j.push(rn(be/te,st/te,dt,te,ft))}else if(j.push(ke),te>1)for(const be of ze){const st=Ue.points[be];st.zoom<=L||(st.zoom=L,j.push(st))}}return j}_getOriginId(P){return P-this.points.length>>5}_getOriginZoom(P){return(P-this.points.length)%32}_map(P,L){if(P.numPoints)return L?jn({},P.properties):P.properties;const j=this.points[P.index].properties,q=this.options.map(j);return L&&q===j?jn({},q):q}}function rn(V,P,L,j,q){return{x:Di(V),y:Di(P),zoom:1/0,id:L,parentId:-1,numPoints:j,properties:q}}function ls(V,P){const[L,j]=V.geometry.coordinates;return{x:Di(on(L)),y:Di(er(j)),zoom:1/0,index:P,parentId:-1}}function cs(V){return{type:"Feature",id:V.id,properties:us(V),geometry:{type:"Point",coordinates:[(P=V.x,360*(P-.5)),It(V.y)]}};var P}function us(V){const P=V.numPoints,L=P>=1e4?`${Math.round(P/1e3)}k`:P>=1e3?Math.round(P/100)/10+"k":P;return jn(jn({},V.properties),{cluster:!0,cluster_id:V.id,point_count:P,point_count_abbreviated:L})}function on(V){return V/360+.5}function er(V){const P=Math.sin(V*Math.PI/180),L=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return L<0?0:L>1?1:L}function It(V){const P=(180-360*V)*Math.PI/180;return 360*Math.atan(Math.exp(P))/Math.PI-90}function jn(V,P){for(const L in P)V[L]=P[L];return V}function _r(V){return V.x}function tr(V){return V.y}function Or(V,P,L,j){for(var q,J=j,he=L-P>>1,de=L-P,re=V[P],fe=V[P+1],ke=V[L],Ue=V[L+1],ze=P+3;ze<L;ze+=3){var Je=oa(V[ze],V[ze+1],re,fe,ke,Ue);if(Je>J)q=ze,J=Je;else if(Je===J){var te=Math.abs(ze-he);te<de&&(q=ze,de=te)}}J>j&&(q-P>3&&Or(V,P,q,j),V[q+2]=J,L-q>3&&Or(V,q,L,j))}function oa(V,P,L,j,q,J){var he=q-L,de=J-j;if(he!==0||de!==0){var re=((V-L)*he+(P-j)*de)/(he*he+de*de);re>1?(L=q,j=J):re>0&&(L+=he*re,j+=de*re)}return(he=V-L)*he+(de=P-j)*de}function gr(V,P,L,j){var q={id:V===void 0?null:V,type:P,geometry:L,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(J){var he=J.geometry,de=J.type;if(de==="Point"||de==="MultiPoint"||de==="LineString")ho(J,he);else if(de==="Polygon"||de==="MultiLineString")for(var re=0;re<he.length;re++)ho(J,he[re]);else if(de==="MultiPolygon")for(re=0;re<he.length;re++)for(var fe=0;fe<he[re].length;fe++)ho(J,he[re][fe])}(q),q}function ho(V,P){for(var L=0;L<P.length;L+=3)V.minX=Math.min(V.minX,P[L]),V.minY=Math.min(V.minY,P[L+1]),V.maxX=Math.max(V.maxX,P[L]),V.maxY=Math.max(V.maxY,P[L+1])}function Ur(V,P,L,j){if(P.geometry){var q=P.geometry.coordinates,J=P.geometry.type,he=Math.pow(L.tolerance/((1<<L.maxZoom)*L.extent),2),de=[],re=P.id;if(L.promoteId?re=P.properties[L.promoteId]:L.generateId&&(re=j||0),J==="Point")Mn(q,de);else if(J==="MultiPoint")for(var fe=0;fe<q.length;fe++)Mn(q[fe],de);else if(J==="LineString")yr(q,de,he,!1);else if(J==="MultiLineString"){if(L.lineMetrics){for(fe=0;fe<q.length;fe++)yr(q[fe],de=[],he,!1),V.push(gr(re,"LineString",de,P.properties));return}hs(q,de,he,!1)}else if(J==="Polygon")hs(q,de,he,!0);else{if(J!=="MultiPolygon"){if(J==="GeometryCollection"){for(fe=0;fe<P.geometry.geometries.length;fe++)Ur(V,{id:re,geometry:P.geometry.geometries[fe],properties:P.properties},L,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(fe=0;fe<q.length;fe++){var ke=[];hs(q[fe],ke,he,!0),de.push(ke)}}V.push(gr(re,J,de,P.properties))}}function Mn(V,P){P.push(fn(V[0])),P.push(xr(V[1])),P.push(0)}function yr(V,P,L,j){for(var q,J,he=0,de=0;de<V.length;de++){var re=fn(V[de][0]),fe=xr(V[de][1]);P.push(re),P.push(fe),P.push(0),de>0&&(he+=j?(q*fe-re*J)/2:Math.sqrt(Math.pow(re-q,2)+Math.pow(fe-J,2))),q=re,J=fe}var ke=P.length-3;P[2]=1,Or(P,0,ke,L),P[ke+2]=1,P.size=Math.abs(he),P.start=0,P.end=P.size}function hs(V,P,L,j){for(var q=0;q<V.length;q++){var J=[];yr(V[q],J,L,j),P.push(J)}}function fn(V){return V/360+.5}function xr(V){var P=Math.sin(V*Math.PI/180),L=.5-.25*Math.log((1+P)/(1-P))/Math.PI;return L<0?0:L>1?1:L}function mn(V,P,L,j,q,J,he,de){if(j/=P,J>=(L/=P)&&he<j)return V;if(he<L||J>=j)return null;for(var re=[],fe=0;fe<V.length;fe++){var ke=V[fe],Ue=ke.geometry,ze=ke.type,Je=q===0?ke.minX:ke.minY,te=q===0?ke.maxX:ke.maxY;if(Je>=L&&te<j)re.push(ke);else if(!(te<L||Je>=j)){var be=[];if(ze==="Point"||ze==="MultiPoint")ds(Ue,be,L,j,q);else if(ze==="LineString")ps(Ue,be,L,j,q,!1,de.lineMetrics);else if(ze==="MultiLineString")po(Ue,be,L,j,q,!1);else if(ze==="Polygon")po(Ue,be,L,j,q,!0);else if(ze==="MultiPolygon")for(var st=0;st<Ue.length;st++){var ft=[];po(Ue[st],ft,L,j,q,!0),ft.length&&be.push(ft)}if(be.length){if(de.lineMetrics&&ze==="LineString"){for(st=0;st<be.length;st++)re.push(gr(ke.id,ze,be[st],ke.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(be.length===1?(ze="LineString",be=be[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=be.length===3?"Point":"MultiPoint"),re.push(gr(ke.id,ze,be,ke.tags))}}}return re.length?re:null}function ds(V,P,L,j,q){for(var J=0;J<V.length;J+=3){var he=V[J+q];he>=L&&he<=j&&(P.push(V[J]),P.push(V[J+1]),P.push(V[J+2]))}}function ps(V,P,L,j,q,J,he){for(var de,re,fe=sa(V),ke=q===0?aa:Rl,Ue=V.start,ze=0;ze<V.length-3;ze+=3){var Je=V[ze],te=V[ze+1],be=V[ze+2],st=V[ze+3],ft=V[ze+4],dt=q===0?Je:te,At=q===0?st:ft,Tt=!1;he&&(de=Math.sqrt(Math.pow(Je-st,2)+Math.pow(te-ft,2))),dt<L?At>L&&(re=ke(fe,Je,te,st,ft,L),he&&(fe.start=Ue+de*re)):dt>j?At<j&&(re=ke(fe,Je,te,st,ft,j),he&&(fe.start=Ue+de*re)):fs(fe,Je,te,be),At<L&&dt>=L&&(re=ke(fe,Je,te,st,ft,L),Tt=!0),At>j&&dt<=j&&(re=ke(fe,Je,te,st,ft,j),Tt=!0),!J&&Tt&&(he&&(fe.end=Ue+de*re),P.push(fe),fe=sa(V)),he&&(Ue+=de)}var $t=V.length-3;Je=V[$t],te=V[$t+1],be=V[$t+2],(dt=q===0?Je:te)>=L&&dt<=j&&fs(fe,Je,te,be),$t=fe.length-3,J&&$t>=3&&(fe[$t]!==fe[0]||fe[$t+1]!==fe[1])&&fs(fe,fe[0],fe[1],fe[2]),fe.length&&P.push(fe)}function sa(V){var P=[];return P.size=V.size,P.start=V.start,P.end=V.end,P}function po(V,P,L,j,q,J){for(var he=0;he<V.length;he++)ps(V[he],P,L,j,q,J,!1)}function fs(V,P,L,j){V.push(P),V.push(L),V.push(j)}function aa(V,P,L,j,q,J){var he=(J-P)/(j-P);return V.push(J),V.push(L+(q-L)*he),V.push(1),he}function Rl(V,P,L,j,q,J){var he=(J-L)/(q-L);return V.push(P+(j-P)*he),V.push(J),V.push(1),he}function Nr(V,P){for(var L=[],j=0;j<V.length;j++){var q,J=V[j],he=J.type;if(he==="Point"||he==="MultiPoint"||he==="LineString")q=fo(J.geometry,P);else if(he==="MultiLineString"||he==="Polygon"){q=[];for(var de=0;de<J.geometry.length;de++)q.push(fo(J.geometry[de],P))}else if(he==="MultiPolygon")for(q=[],de=0;de<J.geometry.length;de++){for(var re=[],fe=0;fe<J.geometry[de].length;fe++)re.push(fo(J.geometry[de][fe],P));q.push(re)}L.push(gr(J.id,he,q,J.tags))}return L}function fo(V,P){var L=[];L.size=V.size,V.start!==void 0&&(L.start=V.start,L.end=V.end);for(var j=0;j<V.length;j+=3)L.push(V[j]+P,V[j+1],V[j+2]);return L}function _n(V,P){if(V.transformed)return V;var L,j,q,J=1<<V.z,he=V.x,de=V.y;for(L=0;L<V.features.length;L++){var re=V.features[L],fe=re.geometry,ke=re.type;if(re.geometry=[],ke===1)for(j=0;j<fe.length;j+=2)re.geometry.push(vr(fe[j],fe[j+1],P,J,he,de));else for(j=0;j<fe.length;j++){var Ue=[];for(q=0;q<fe[j].length;q+=2)Ue.push(vr(fe[j][q],fe[j][q+1],P,J,he,de));re.geometry.push(Ue)}}return V.transformed=!0,V}function vr(V,P,L,j,q,J){return[Math.round(L*(V*j-q)),Math.round(L*(P*j-J))]}function la(V,P,L,j,q){for(var J=P===q.maxZoom?0:q.tolerance/((1<<P)*q.extent),he={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:L,y:j,z:P,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},de=0;de<V.length;de++){he.numFeatures++,ms(he,V[de],J,q);var re=V[de].minX,fe=V[de].minY,ke=V[de].maxX,Ue=V[de].maxY;re<he.minX&&(he.minX=re),fe<he.minY&&(he.minY=fe),ke>he.maxX&&(he.maxX=ke),Ue>he.maxY&&(he.maxY=Ue)}return he}function ms(V,P,L,j){var q=P.geometry,J=P.type,he=[];if(J==="Point"||J==="MultiPoint")for(var de=0;de<q.length;de+=3)he.push(q[de]),he.push(q[de+1]),V.numPoints++,V.numSimplified++;else if(J==="LineString")wr(he,q,V,L,!1,!1);else if(J==="MultiLineString"||J==="Polygon")for(de=0;de<q.length;de++)wr(he,q[de],V,L,J==="Polygon",de===0);else if(J==="MultiPolygon")for(var re=0;re<q.length;re++){var fe=q[re];for(de=0;de<fe.length;de++)wr(he,fe[de],V,L,!0,de===0)}if(he.length){var ke=P.tags||null;if(J==="LineString"&&j.lineMetrics){for(var Ue in ke={},P.tags)ke[Ue]=P.tags[Ue];ke.mapbox_clip_start=q.start/q.size,ke.mapbox_clip_end=q.end/q.size}var ze={geometry:he,type:J==="Polygon"||J==="MultiPolygon"?3:J==="LineString"||J==="MultiLineString"?2:1,tags:ke};P.id!==null&&(ze.id=P.id),V.features.push(ze)}}function wr(V,P,L,j,q,J){var he=j*j;if(j>0&&P.size<(q?he:j))L.numPoints+=P.length/3;else{for(var de=[],re=0;re<P.length;re+=3)(j===0||P[re+2]>he)&&(L.numSimplified++,de.push(P[re]),de.push(P[re+1])),L.numPoints++;q&&function(fe,ke){for(var Ue=0,ze=0,Je=fe.length,te=Je-2;ze<Je;te=ze,ze+=2)Ue+=(fe[ze]-fe[te])*(fe[ze+1]+fe[te+1]);if(Ue>0===ke)for(ze=0,Je=fe.length;ze<Je/2;ze+=2){var be=fe[ze],st=fe[ze+1];fe[ze]=fe[Je-2-ze],fe[ze+1]=fe[Je-1-ze],fe[Je-2-ze]=be,fe[Je-1-ze]=st}}(de,J),V.push(de)}}function Vr(V,P){var L=(P=this.options=function(q,J){for(var he in J)q[he]=J[he];return q}(Object.create(this.options),P)).debug;if(L&&console.time("preprocess data"),P.maxZoom<0||P.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(P.promoteId&&P.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(q,J){var he=[];if(q.type==="FeatureCollection")for(var de=0;de<q.features.length;de++)Ur(he,q.features[de],J,de);else Ur(he,q.type==="Feature"?q:{geometry:q},J);return he}(V,P);this.tiles={},this.tileCoords=[],L&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",P.indexMaxZoom,P.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(j=function(q,J){var he=J.buffer/J.extent,de=q,re=mn(q,1,-1-he,he,0,-1,2,J),fe=mn(q,1,1-he,2+he,0,-1,2,J);return(re||fe)&&(de=mn(q,1,-he,1+he,0,-1,2,J)||[],re&&(de=Nr(re,1).concat(de)),fe&&(de=de.concat(Nr(fe,-1)))),de}(j,P)).length&&this.splitTile(j,0,0,0),L&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function jr(V,P,L){return 32*((1<<V)*L+P)+V}function $r(V,P){const L=V.tileID.canonical;if(!this._geoJSONIndex)return P(null,null);const j=this._geoJSONIndex.getTile(L.z,L.x,L.y);if(!j)return P(null,null);const q=new ce(j.features);let J=rt(q);J.byteOffset===0&&J.byteLength===J.buffer.byteLength||(J=new Uint8Array(J)),P(null,{vectorTile:q,rawData:J.buffer})}Vr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Vr.prototype.splitTile=function(V,P,L,j,q,J,he){for(var de=[V,P,L,j],re=this.options,fe=re.debug;de.length;){j=de.pop(),L=de.pop(),P=de.pop(),V=de.pop();var ke=1<<P,Ue=jr(P,L,j),ze=this.tiles[Ue];if(!ze&&(fe>1&&console.time("creation"),ze=this.tiles[Ue]=la(V,P,L,j,re),this.tileCoords.push({z:P,x:L,y:j}),fe)){fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",P,L,j,ze.numFeatures,ze.numPoints,ze.numSimplified),console.timeEnd("creation"));var Je="z"+P;this.stats[Je]=(this.stats[Je]||0)+1,this.total++}if(ze.source=V,q){if(P===re.maxZoom||P===q)continue;var te=1<<q-P;if(L!==Math.floor(J/te)||j!==Math.floor(he/te))continue}else if(P===re.indexMaxZoom||ze.numPoints<=re.indexMaxPoints)continue;if(ze.source=null,V.length!==0){fe>1&&console.time("clipping");var be,st,ft,dt,At,Tt,$t=.5*re.buffer/re.extent,ir=.5-$t,Ve=.5+$t,yt=1+$t;be=st=ft=dt=null,At=mn(V,ke,L-$t,L+Ve,0,ze.minX,ze.maxX,re),Tt=mn(V,ke,L+ir,L+yt,0,ze.minX,ze.maxX,re),V=null,At&&(be=mn(At,ke,j-$t,j+Ve,1,ze.minY,ze.maxY,re),st=mn(At,ke,j+ir,j+yt,1,ze.minY,ze.maxY,re),At=null),Tt&&(ft=mn(Tt,ke,j-$t,j+Ve,1,ze.minY,ze.maxY,re),dt=mn(Tt,ke,j+ir,j+yt,1,ze.minY,ze.maxY,re),Tt=null),fe>1&&console.timeEnd("clipping"),de.push(be||[],P+1,2*L,2*j),de.push(st||[],P+1,2*L,2*j+1),de.push(ft||[],P+1,2*L+1,2*j),de.push(dt||[],P+1,2*L+1,2*j+1)}}},Vr.prototype.getTile=function(V,P,L){var j=this.options,q=j.extent,J=j.debug;if(V<0||V>24)return null;var he=1<<V,de=jr(V,P=(P%he+he)%he,L);if(this.tiles[de])return _n(this.tiles[de],q);J>1&&console.log("drilling down to z%d-%d-%d",V,P,L);for(var re,fe=V,ke=P,Ue=L;!re&&fe>0;)fe--,ke=Math.floor(ke/2),Ue=Math.floor(Ue/2),re=this.tiles[jr(fe,ke,Ue)];return re&&re.source?(J>1&&console.log("found parent tile z%d-%d-%d",fe,ke,Ue),J>1&&console.time("drilling down"),this.splitTile(re.source,fe,ke,Ue,V,P,L),J>1&&console.timeEnd("drilling down"),this.tiles[de]?_n(this.tiles[de],q):null):null};class mo extends a.VectorTileWorkerSource{constructor(P,L,j,q,J){super(P,L,j,q,$r),J&&(this.loadGeoJSON=J)}loadData(P,L){const j=P&&P.request,q=j&&j.collectResourceTiming;this.loadGeoJSON(P,(J,he)=>{if(J||!he)return L(J);if(typeof he!="object")return L(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));{Se(he,!0);try{if(P.filter){const re=a.createExpression(P.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(re.result==="error")throw new Error(re.value.map(ke=>`${ke.key}: ${ke.message}`).join(", "));he={type:"FeatureCollection",features:he.features.filter(ke=>re.value.evaluate({zoom:0},ke))}}this._geoJSONIndex=P.cluster?new vt(function({superclusterOptions:re,clusterProperties:fe}){if(!fe||!re)return re;const ke={},Ue={},ze={accumulated:null,zoom:0},Je={properties:null},te=Object.keys(fe);for(const be of te){const[st,ft]=fe[be],dt=a.createExpression(ft),At=a.createExpression(typeof st=="string"?[st,["accumulated"],["get",be]]:st);ke[be]=dt.value,Ue[be]=At.value}return re.map=be=>{Je.properties=be;const st={};for(const ft of te)st[ft]=ke[ft].evaluate(ze,Je);return st},re.reduce=(be,st)=>{Je.properties=st;for(const ft of te)ze.accumulated=be[ft],be[ft]=Ue[ft].evaluate(ze,Je)},re}(P)).load(he.features):function(re,fe){return new Vr(re,fe)}(he,P.geojsonVtOptions)}catch(re){return L(re)}this.loaded={};const de={};if(q){const re=a.getPerformanceMeasurement(j);re&&(de.resourceTiming={},de.resourceTiming[P.source]=JSON.parse(JSON.stringify(re)))}L(null,de)}})}reloadTile(P,L){const j=this.loaded;return j&&j[P.uid]?super.reloadTile(P,L):this.loadTile(P,L)}loadGeoJSON(P,L){if(P.request)a.getJSON(P.request,L);else{if(typeof P.data!="string")return L(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`));try{return L(null,JSON.parse(P.data))}catch{return L(new Error(`Input data given to '${P.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(P,L){try{L(null,this._geoJSONIndex.getClusterExpansionZoom(P.clusterId))}catch(j){L(j)}}getClusterChildren(P,L){try{L(null,this._geoJSONIndex.getChildren(P.clusterId))}catch(j){L(j)}}getClusterLeaves(P,L){try{L(null,this._geoJSONIndex.getLeaves(P.clusterId,P.limit,P.offset))}catch(j){L(j)}}}class $n{constructor(P){this.self=P,this.actor=new a.Actor(P,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:mo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(L,j)=>{if(this.workerSourceTypes[L])throw new Error(`Worker source with name "${L}" already registered.`);this.workerSourceTypes[L]=j},this.self.registerRTLTextPlugin=L=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=L.applyArabicShaping,a.plugin.processBidirectionalText=L.processBidirectionalText,a.plugin.processStyledBidirectionalText=L.processStyledBidirectionalText}}checkIfReady(P,L,j){j()}setReferrer(P,L){this.referrer=L}spriteLoaded(P,L){this.isSpriteLoaded=L;for(const j in this.workerSources[P]){const q=this.workerSources[P][j];for(const J in q)q[J]instanceof a.VectorTileWorkerSource&&(q[J].isSpriteLoaded=L,q[J].fire(new a.Event("isSpriteLoaded")))}}setImages(P,L,j){this.availableImages[P]=L;for(const q in this.workerSources[P]){const J=this.workerSources[P][q];for(const he in J)J[he].availableImages=L}j()}enableTerrain(P,L,j){this.terrain=L,j()}setLayers(P,L,j){this.getLayerIndex(P).replace(L),j()}updateLayers(P,L,j){this.getLayerIndex(P).update(L.layers,L.removedIds),j()}loadTile(P,L,j){const q=this.enableTerrain?a.extend({enableTerrain:this.terrain},L):L;this.getWorkerSource(P,L.type,L.source).loadTile(q,j)}loadDEMTile(P,L,j){const q=this.enableTerrain?a.extend({buildQuadTree:this.terrain},L):L;this.getDEMWorkerSource(P,L.source).loadTile(q,j)}reloadTile(P,L,j){const q=this.enableTerrain?a.extend({enableTerrain:this.terrain},L):L;this.getWorkerSource(P,L.type,L.source).reloadTile(q,j)}abortTile(P,L,j){this.getWorkerSource(P,L.type,L.source).abortTile(L,j)}removeTile(P,L,j){this.getWorkerSource(P,L.type,L.source).removeTile(L,j)}removeSource(P,L,j){if(!this.workerSources[P]||!this.workerSources[P][L.type]||!this.workerSources[P][L.type][L.source])return;const q=this.workerSources[P][L.type][L.source];delete this.workerSources[P][L.type][L.source],q.removeSource!==void 0?q.removeSource(L,j):j()}loadWorkerSource(P,L,j){try{this.self.importScripts(L.url),j()}catch(q){j(q.toString())}}syncRTLPluginState(P,L,j){try{a.plugin.setState(L);const q=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&q!=null){this.self.importScripts(q);const J=a.plugin.isParsed();j(J?void 0:new Error(`RTL Text Plugin failed to import scripts from ${q}`),J)}}catch(q){j(q.toString())}}getAvailableImages(P){let L=this.availableImages[P];return L||(L=[]),L}getLayerIndex(P){let L=this.layerIndexes[P];return L||(L=this.layerIndexes[P]=new Fe),L}getWorkerSource(P,L,j){return this.workerSources[P]||(this.workerSources[P]={}),this.workerSources[P][L]||(this.workerSources[P][L]={}),this.workerSources[P][L][j]||(this.workerSources[P][L][j]=new this.workerSourceTypes[L]({send:(q,J,he,de,re,fe)=>{this.actor.send(q,J,he,P,re,fe)},scheduler:this.actor.scheduler},this.getLayerIndex(P),this.getAvailableImages(P),this.isSpriteLoaded)),this.workerSources[P][L][j]}getDEMWorkerSource(P,L){return this.demWorkerSources[P]||(this.demWorkerSources[P]={}),this.demWorkerSources[P][L]||(this.demWorkerSources[P][L]=new ie),this.demWorkerSources[P][L]}enforceCacheSizeLimit(P,L){a.enforceCacheSizeLimit(L)}getWorkerPerformanceMetrics(P,L,j){j(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new $n(self)),$n}),A(["./shared"],function(a){var H=pe;function pe(u){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,m,_=new Blob([""],{type:"text/javascript"}),v=URL.createObjectURL(_);try{m=new Worker(v),h=!0}catch{h=!1}return m&&m.terminate(),URL.revokeObjectURL(v),h}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var h=document.createElement("canvas");h.width=h.height=1;var m=h.getContext("2d");if(!m)return!1;var _=m.getImageData(0,0,1,1);return _&&_.width===h.width}()?(Fe[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(Fe[s]=function(h){var m,_=function(v){var b=document.createElement("canvas"),S=Object.create(pe.webGLContextAttributes);return S.failIfMajorPerformanceCaveat=v,b.getContext("webgl",S)||b.getContext("experimental-webgl",S)}(h);if(!_)return!1;try{m=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!m||_.isContextLost())&&(_.shaderSource(m,"void main() {}"),_.compileShader(m),_.getShaderParameter(m,_.COMPILE_STATUS)===!0)}(s)),Fe[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(u)}var Fe={};function ye(u,t){if(Array.isArray(u)){if(!Array.isArray(t)||u.length!==t.length)return!1;for(let s=0;s<u.length;s++)if(!ye(u[s],t[s]))return!1;return!0}if(typeof u=="object"&&u!==null&&t!==null){if(typeof t!="object"||Object.keys(u).length!==Object.keys(t).length)return!1;for(const s in u)if(!ye(u[s],t[s]))return!1;return!0}return u===t}pe.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ie={create:function(u,t,s){const h=a.window.document.createElement(u);return t!==void 0&&(h.className=t),s&&s.appendChild(h),h},createNS:function(u,t){return a.window.document.createElementNS(u,t)}},Se=a.window.document&&a.window.document.documentElement.style,Ke=Se&&Se.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Qe;ie.disableDrag=function(){Se&&Ke&&(Qe=Se[Ke],Se[Ke]="none")},ie.enableDrag=function(){Se&&Ke&&(Se[Ke]=Qe)},ie.setTransform=function(u,t){u.style.transform=t};let ue=!1;try{const u=Object.defineProperty({},"passive",{get(){ue=!0}});a.window.addEventListener("test",u,u),a.window.removeEventListener("test",u,u)}catch{ue=!1}ie.addEventListener=function(u,t,s,h={}){u.addEventListener(t,s,"passive"in h&&ue?h:h.capture)},ie.removeEventListener=function(u,t,s,h={}){u.removeEventListener(t,s,"passive"in h&&ue?h:h.capture)};const ne=function(u){u.preventDefault(),u.stopPropagation(),a.window.removeEventListener("click",ne,!0)};function ce(u,t,s){const h=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new a.pointGeometry((s.clientX-t.left)*h,(s.clientY-t.top)*h)}ie.suppressClick=function(){a.window.addEventListener("click",ne,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",ne,!0)},0)},ie.mousePos=function(u,t){const s=u.getBoundingClientRect();return ce(u,s,t)},ie.touchPos=function(u,t){const s=u.getBoundingClientRect(),h=[];for(let m=0;m<t.length;m++)h.push(ce(u,s,t[m]));return h},ie.mouseButton=function(u){return a.window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button},ie.remove=function(u){u.parentNode&&u.parentNode.removeChild(u)};class ve{constructor(t,s){this.pos=t,this.dir=s}intersectsPlane(t,s,h){const m=a.dot(s,this.dir);if(Math.abs(m)<1e-6)return!1;const _=a.dot(a.sub(a.create(),t,this.pos),s)/m,v=a.scaleAndAdd(a.create(),this.pos,this.dir,_);return a.copy(h,v),!0}}class Ee{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,h){const m=Math.pow(2,h),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const S=a.transformMat4([],b,t),I=1/S[3]/s*m;return a.mul(S,S,[I,I,1/S[3],I])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const S=a.sub([],_[b[0]],_[b[1]]),I=a.sub([],_[b[2]],_[b[1]]),M=a.normalize([],a.cross([],S,I)),D=-a.dot(M,_[b[1]]);return M.concat(D)});return new Ee(_,v)}}class nt{constructor(t,s){this.min=t,this.max=s,this.center=a.scale([],a.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],h=a.clone(this.min),m=a.clone(this.max);for(let _=0;_<s.length;_++)h[_]=s[_]?this.min[_]:this.center[_],m[_]=s[_]?this.center[_]:this.max[_];return m[2]=this.max[2],new nt(h,m)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let h=!0;for(let m=0;m<t.planes.length;m++){const _=t.planes[m];let v=0;for(let b=0;b<s.length;b++)v+=a.dot$1(_,s[b])>=0;if(v===0)return 0;v!==s.length&&(h=!1)}if(h)return 2;for(let m=0;m<3;m++){let _=Number.MAX_VALUE,v=-Number.MAX_VALUE;for(let b=0;b<t.points.length;b++){const S=t.points[b][m]-this.min[m];_=Math.min(_,S),v=Math.max(v,S)}if(v<0||_>this.max[m]-this.min[m])return 0}return 1}}function Be(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class rt extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:h}of this.requestors)this._notify(s,h);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,s){this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new a.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),h=!1),h}_validateStretch(t,s){if(!t)return!0;let h=0;for(const m of t){if(m[0]<h||m[1]<m[0]||s<m[1])return!1;h=m[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){s.version=this.images[t].version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let h=!0;if(!this.isLoaded())for(const m of t)this.images[m]||(h=!1);this.isLoaded()||h?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const h={};for(const m of t){this.images[m]||this.fire(new a.Event("styleimagemissing",{id:m}));const _=this.images[m];_?h[m]={data:_.data.clone(),pixelRatio:_.pixelRatio,sdf:_.sdf,version:_.version,stretchX:_.stretchX,stretchY:_.stretchY,content:_.content,hasRenderCallback:Boolean(_.userImage&&_.userImage.render)}:a.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,h)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],h=this.getImage(t);if(!h)return null;if(s&&s.position.version===h.version)return s.position;if(s)s.position.version=h.version;else{const m={w:h.data.width+2,h:h.data.height+2,x:0,y:0},_=new a.ImagePosition(m,h);this.patterns[t]={bin:m,position:_}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const _ in this.patterns)t.push(this.patterns[_].bin);const{w:s,h}=a.potpack(t),m=this.atlasImage;m.resize({width:s||1,height:h||1});for(const _ in this.patterns){const{bin:v}=this.patterns[_],b=v.x+1,S=v.y+1,I=this.images[_].data,M=I.width,D=I.height;a.RGBAImage.copy(I,m,{x:0,y:0},{x:b,y:S},{width:M,height:D}),a.RGBAImage.copy(I,m,{x:0,y:D-1},{x:b,y:S-1},{width:M,height:1}),a.RGBAImage.copy(I,m,{x:0,y:0},{x:b,y:S+D},{width:M,height:1}),a.RGBAImage.copy(I,m,{x:M-1,y:0},{x:b-1,y:S},{width:1,height:D}),a.RGBAImage.copy(I,m,{x:0,y:0},{x:b+M,y:S},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const h=this.images[s];Be(h)&&this.updateImage(s,h)}}}const ht=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(u,t){return function([s,h,m]){const _=a.degToRad(h+90),v=a.degToRad(m);return{x:s*Math.cos(_)*Math.sin(v),y:s*Math.sin(_)*Math.sin(v),z:s*Math.cos(v),azimuthal:h,polar:m}}(u.expression.evaluate(t))}interpolate(u,t,s){return{x:a.number(u.x,t.x,s),y:a.number(u.y,t.y,s),z:a.number(u.z,t.z,s),azimuthal:a.number(u.azimuthal,t.azimuthal,s),polar:a.number(u.polar,t.polar,s)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)}),tt="-transition";class St extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(ht),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(a.validateLight,t,s))for(const h in t){const m=t[h];a.endsWith(h,tt)?this._transitionable.setTransition(h.slice(0,-tt.length),m):this._transitionable.setValue(h,m)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const Br=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)}),xi="-transition";class ei extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(Br),this.set(t),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(t){for(const s in t){const h=t[s];a.endsWith(s,xi)?this._transitionable.setTransition(s.slice(0,-xi.length),h):this._transitionable.setValue(s,h)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function In(u,t,s,h){const m=a.smoothstep(45,65,s),[_,v]=nn(u,h),b=a.length(t);let S=1-Math.min(1,Math.exp((b-_)/(v-_)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*m*u.alpha}function nn(u,t){const s=.5/Math.tan(.5*t);return[u.range[0]+s,u.range[1]+s]}const An=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"])}),pn="-transition";class Vn extends a.Evented{constructor(t){super(),this._transitionable=new a.Transitionable(An),this.set(t),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s={}){if(!this._validate(a.validateFog,t,s))for(const h in t){const m=t[h];a.endsWith(h,pn)?this._transitionable.setTransition(h.slice(0,-pn.length),m):this._transitionable.setValue(h,m)}}getOpacity(t){const s=this.properties&&this.properties.get("color")||1;return a.smoothstep(45,65,t)*s.a}getOpacityAtLatLng(t,s){return function(h,m,_){const v=a.MercatorCoordinate.fromLngLat(m),b=_.elevation?_.elevation.getAtPointOrZero(v):0,S=[v.x,v.y,b];return a.transformMat4$1(S,S,_.mercatorFogMatrix),In(h,S,_.pitch,_._fov)}(this.state,t,s)}getFovAdjustedRange(t){return nn(this.state,t)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&a.emitValidationErrors(this,t.call(a.validateStyle,a.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Pi{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const h=this.workerPool.acquire(this.id);for(let m=0;m<h.length;m++){const _=new Pi.Actor(h[m],s,this.id);_.name=`Worker ${m}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,s,h){a.asyncAll(this.actors,(m,_)=>{m.send(t,s,_)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Gt(u,t,s){return t*(a.EXTENT/(u.tileSize*Math.pow(2,s-u.tileID.overscaledZ)))}Pi.Actor=a.Actor;class Ge{constructor(t,s,h,m){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(_=>m.pointCoordinate3D(_)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(t,s){let h,m;if(t instanceof a.pointGeometry||typeof t[0]=="number"){const _=a.pointGeometry.convert(t);h=[a.pointGeometry.convert(t)],m=s.isPointAboveHorizon(_)}else{const _=a.pointGeometry.convert(t[0]),v=a.pointGeometry.convert(t[1]);h=[_,v],m=a.polygonizeBounds(_,v).every(b=>s.isPointAboveHorizon(b))}return new Ge(h,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new a.pointGeometry(1,1)):this.screenBounds[1],m=a.polygonizeBounds(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),a.bufferConvexPolygon(m,t)}containsTile(t,s,h){const m=t.queryPadding+1,_=h?this._bufferedCameraMercator(m,s).map(B=>t.tileID.getTilePoint(B)):this._bufferedScreenMercator(m,s).map(B=>t.tileID.getTilePoint(B)),v=this.screenGeometryMercator.map(B=>t.tileID.getTileVec3(B)),b=v.map(B=>new a.pointGeometry(B[0],B[1])),S=s.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),I=t.tileID.getTileVec3(S),M=v.map(B=>{const $=a.sub(B,B,I);return a.normalize($,$),new ve(I,$)}),D=Gt(t,1,s.zoom);if(a.polygonIntersectsBox(_,0,0,a.EXTENT,a.EXTENT))return{queryGeometry:this,tilespaceGeometry:b,tilespaceRays:M,bufferedTilespaceGeometry:_,bufferedTilespaceBounds:(F=a.getBounds(_),F.min.x=a.clamp(F.min.x,0,a.EXTENT),F.min.y=a.clamp(F.min.y,0,a.EXTENT),F.max.x=a.clamp(F.max.x,0,a.EXTENT),F.max.y=a.clamp(F.max.y,0,a.EXTENT),F),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:D};var F}_bufferedScreenMercator(t,s){const h=Ye(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{const m=this.bufferedScreenGeometry(t).map(_=>s.pointCoordinate3D(_));return this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(t,s){const h=Ye(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{const m=this.bufferedCameraGeometry(t).map(_=>s.pointCoordinate3D(_));return this._cameraRaycastCache[h]=m,m}}}function Ye(u){return 100*u|0}function ut(u,t,s){const h=function(m,_){if(m)return s(m);if(_){const v=a.pick(a.extend(_,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);_.vector_layers&&(v.vectorLayers=_.vector_layers,v.vectorLayerIds=v.vectorLayers.map(b=>b.id)),v.tiles=t.canonicalizeTileset(v,u.url),s(null,v)}};return u.url?a.getJSON(t.transformRequest(t.normalizeSourceURL(u.url),a.ResourceType.Source),h):a.exported.frame(()=>h(null,u))}class Zt{constructor(t,s,h){this.bounds=a.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),h=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*s),m=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*s),_=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*s),v=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=h&&t.x<_&&t.y>=m&&t.y<v}}class Wt{constructor(t,s,h){this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=Boolean(h),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Di={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Li{constructor(t,s,h,m){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),t.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let h=0;h<this.attributes.length;h++){const m=s.attributes[this.attributes[h].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,h){for(let m=0;m<this.attributes.length;m++){const _=this.attributes[m],v=s.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[Di[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class vt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class rn extends vt{getDefault(){return a.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ls extends vt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class cs extends vt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class us extends vt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class on extends vt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class er extends vt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class It extends vt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class jn extends vt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class _r extends vt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class tr extends vt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Or extends vt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class oa extends vt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class gr extends vt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class ho extends vt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class Ur extends vt{getDefault(){return a.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Mn extends vt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class yr extends vt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class hs extends vt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class fn extends vt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class xr extends vt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class mn extends vt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ds extends vt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ps extends vt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class sa extends vt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class po extends vt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class fs extends vt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class aa extends vt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Rl extends vt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Nr extends vt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class fo extends vt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class _n extends vt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class vr extends vt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class la extends vr{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class ms extends vr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wr extends ms{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Vr{constructor(t,s,h,m){this.context=t,this.width=s,this.height=h;const _=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new la(t,_),m&&(this.depthAttachment=new ms(t,_))}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const h=this.depthAttachment.get();h&&t.deleteRenderbuffer(h)}t.deleteFramebuffer(this.framebuffer)}}class jr{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new rn(this),this.clearDepth=new ls(this),this.clearStencil=new cs(this),this.colorMask=new us(this),this.depthMask=new on(this),this.stencilMask=new er(this),this.stencilFunc=new It(this),this.stencilOp=new jn(this),this.stencilTest=new _r(this),this.depthRange=new tr(this),this.depthTest=new Or(this),this.depthFunc=new oa(this),this.blend=new gr(this),this.blendFunc=new ho(this),this.blendColor=new Ur(this),this.blendEquation=new Mn(this),this.cullFace=new yr(this),this.cullFaceSide=new hs(this),this.frontFace=new fn(this),this.program=new xr(this),this.activeTexture=new mn(this),this.viewport=new ds(this),this.bindFramebuffer=new ps(this),this.bindRenderbuffer=new sa(this),this.bindTexture=new po(this),this.bindVertexBuffer=new fs(this),this.bindElementBuffer=new aa(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Rl(this),this.pixelStoreUnpack=new Nr(this),this.pixelStoreUnpackPremultiplyAlpha=new fo(this),this.pixelStoreUnpackFlipY=new _n(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Wt(this,t,s)}createVertexBuffer(t,s,h){return new Li(this,t,s,h)}createRenderbuffer(t,s,h){const m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,t,s,h),this.bindRenderbuffer.set(null),_}createFramebuffer(t,s,h){return new Vr(this,t,s,h)}clear({color:t,depth:s,stencil:h}){const m=this.gl;let _=0;t&&(_|=m.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(_|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(_|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),m.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){ye(t.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class $r extends a.Evented{constructor(t,s,h,m){super(),this.id=t,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},s),a.extend(this,a.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ut(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):s&&(a.extend(this,s),s.bounds&&(this.tileBounds=new Zt(s.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(s.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const h=a.exported.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=a.getImage(this.map._requestManager.transformRequest(m,a.ResourceType.Tile),(_,v,b,S)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(_)t.state="errored",s(_);else if(v){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:b,expires:S});const I=this.map.painter.context,M=I.gl;t.texture=this.map.painter.getTileTexture(v.width),t.texture?t.texture.update(v,{useMipmap:!0}):(t.texture=new a.Texture(I,v,M.RGBA,{useMipmap:!0}),t.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST),I.extTextureFilterAnisotropic&&M.texParameterf(M.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax)),t.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let mo;var $n=a.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class V extends a.Evented{constructor(t,s,h,m){super(),this.id=t,this.dispatcher=h,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=s}load(t,s){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(h,m)=>{this._loaded=!0,h?this.fire(new a.ErrorEvent(h)):m&&(this.image=a.exported.getImageData(m),t&&(this.coordinates=t),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const s=t.map(a.MercatorCoordinate.fromLngLat);this.tileID=function(m){let _=1/0,v=1/0,b=-1/0,S=-1/0;for(const F of m)_=Math.min(_,F.x),v=Math.min(v,F.y),b=Math.max(b,F.x),S=Math.max(S,F.y);const I=Math.max(b-_,S-v),M=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),D=Math.pow(2,M);return new a.CanonicalTileID(M,Math.floor((_+b)/2*D),Math.floor((v+S)/2*D))}(s),this.minzoom=this.maxzoom=this.tileID.z;const h=s.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.StructArrayLayout4i8,this._boundsArray.emplaceBack(h[0].x,h[0].y,0,0),this._boundsArray.emplaceBack(h[1].x,h[1].y,a.EXTENT,0),this._boundsArray.emplaceBack(h[3].x,h[3].y,0,a.EXTENT),this._boundsArray.emplaceBack(h[2].x,h[2].y,a.EXTENT,a.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,$n.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new a.Texture(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const P={vector:class extends a.Evented{constructor(u,t,s,h){if(super(),this.id=u,this.dispatcher=s,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(t,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},t),this._collectResourceTiming=t.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ut(this._options,this.map._requestManager,(u,t)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new a.ErrorEvent(u)):t&&(a.extend(this,t),t.bounds&&(this.tileBounds=new Zt(t.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(t.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}onAdd(u){this.map=u,this.load()}setSourceProperty(u){this._tileJSONRequest&&this._tileJSONRequest.cancel(),u();const t=this.map.style._getSourceCaches(this.id);for(const s of t)s.clearTiles();this.load()}setTiles(u){return this.setSourceProperty(()=>{this._options.tiles=u}),this}setUrl(u){return this.setSourceProperty(()=>{this.url=u,this._options.url=u}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return a.extend({},this._options)}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,a.ResourceType.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:u.isSymbolTile};if(h.request.collectResourceTiming=this._collectResourceTiming,u.actor&&u.state!=="expired")u.state==="loading"?u.reloadCallback=t:u.request=u.actor.send("reloadTile",h,m.bind(this));else if(u.actor=this._tileWorkers[s]=this._tileWorkers[s]||this.dispatcher.getActor(),this.dispatcher.ready)u.request=u.actor.send("loadTile",h,m.bind(this),void 0,!0);else{const _=a.loadVectorTile.call({deduped:this._deduped},h,(v,b)=>{v||!b?m.call(this,v):(h.data={cacheControl:b.cacheControl,expires:b.expires,rawData:b.rawData.slice(0)},u.actor&&u.actor.send("loadTile",h,m.bind(this),void 0,!0))},!0);u.request={cancel:_}}function m(_,v){return delete u.request,u.aborted?t(null):_&&_.status!==404?t(_):(v&&v.resourceTiming&&(u.resourceTiming=v.resourceTiming),this.map._refreshExpiredTiles&&v&&u.setExpiryData(v),u.loadVectorData(v,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),t(null),void(u.reloadCallback&&(this.loadTile(u,u.reloadCallback),u.reloadCallback=null)))}}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.actor&&u.actor.send("abortTile",{uid:u.uid,type:this.type,source:this.id})}unloadTile(u){u.unloadVectorData(),u.actor&&u.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:$r,"raster-dem":class extends $r{constructor(u,t,s,h){super(u,t,s,h),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,_){m&&(u.state="errored",t(m)),_&&(u.dem=_,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=a.getImage(this.map._requestManager.transformRequest(s,a.ResourceType.Tile),function(m,_,v,b){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(m)u.state="errored",t(m);else if(_){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:v,expires:b});const S=a.window.ImageBitmap&&_ instanceof a.window.ImageBitmap&&(mo==null&&(mo=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),mo),I=1-(_.width-a.prevPowerOfTwo(_.width))/2;I<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const M=S?_:a.exported.getImageData(_,I),D={uid:u.uid,coord:u.tileID,source:this.id,rawImageData:M,encoding:this.encoding,padding:I};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",D,h.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(u){const t=u.canonical,s=Math.pow(2,t.z),h=(t.x-1+s)%s,m=t.x===0?u.wrap-1:u.wrap,_=(t.x+1+s)%s,v=t.x+1===s?u.wrap+1:u.wrap,b={};return b[new a.OverscaledTileID(u.overscaledZ,m,t.z,h,t.y).key]={backfilled:!1},b[new a.OverscaledTileID(u.overscaledZ,v,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(b[new a.OverscaledTileID(u.overscaledZ,m,t.z,h,t.y-1).key]={backfilled:!1},b[new a.OverscaledTileID(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},b[new a.OverscaledTileID(u.overscaledZ,v,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<s&&(b[new a.OverscaledTileID(u.overscaledZ,m,t.z,h,t.y+1).key]={backfilled:!1},b[new a.OverscaledTileID(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},b[new a.OverscaledTileID(u.overscaledZ,v,t.z,_,t.y+1).key]={backfilled:!1}),b}unloadTile(u){u.demTexture&&this.map.painter.saveTileTexture(u.demTexture),u.fbo&&(u.fbo.destroy(),delete u.fbo),u.dem&&delete u.dem,delete u.neighboringTiles,u.state="unloaded"}},geojson:class extends a.Evented{constructor(u,t,s,h){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=t.data,this._options=a.extend({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:a.EXTENT,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id},t),this}getClusterLeaves(u,t,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:u,limit:t,offset:s},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const u=a.extend({},this.workerOptions),t=this._data;typeof t=="string"?(u.request=this.map._requestManager.transformRequest(a.exported.resolveURL(t),a.ResourceType.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(t),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(s,h)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new a.ErrorEvent(s));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(m.resourceTiming=h.resourceTiming[this.id]),this.fire(new a.Event("data",m)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,t){const s=u.actor?"reloadTile":"loadTile";u.actor=this.actor,u.request=this.actor.send(s,{type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(h,m)=>(delete u.request,u.unloadVectorData(),u.aborted?t(null):h?t(h):(u.loadVectorData(m,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){u.unloadVectorData(),this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends V{constructor(u,t,s,h){super(u,t,s,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,a.ResourceType.Source).url);a.getVideo(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new a.ErrorEvent(t)):s&&(this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,$n.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(u,this.video,t.RGBA),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE));for(const s in this.tiles){const h=this.tiles[s];h.state!=="loaded"&&(h.state="loaded",h.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:V,canvas:class extends V{constructor(u,t,s,h){super(u,t,s,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(_=>typeof _!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,$n.members)),this.boundsSegments||(this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(u||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(t,this.canvas,s.RGBA,{premultiply:!0});for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}}},L=function(u,t,s,h){const m=new P[t.type](u,t,s,h);if(m.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${m.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],m),m};function j(u,t){const s=a.identity([]);return a.scale$1(s,s,[.5*u.width,.5*-u.height,1]),a.translate(s,s,[1,-1,0]),a.multiply(s,s,u.calculateProjMatrix(t.toUnwrapped()))}function q(u,t,s,h,m,_,v,b=!1){const S=u.tilesIn(h,v,b);S.sort(he);const I=[];for(const D of S)I.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(t,s,u._state,D,m,_,j(u.transform,D.tile.tileID),b)});const M=function(D){const F={},B={};for(const $ of D){const G=$.queryResults,K=$.wrappedTileID,N=B[K]=B[K]||{};for(const Z in G){const Y=G[Z],ee=N[Z]=N[Z]||{},oe=F[Z]=F[Z]||[];for(const X of Y)ee[X.featureIndex]||(ee[X.featureIndex]=!0,oe.push(X))}}return F}(I);for(const D in M)M[D].forEach(F=>{const B=F.feature,$=u.getFeatureState(B.layer["source-layer"],B.id);B.source=B.layer.source,B.layer["source-layer"]&&(B.sourceLayer=B.layer["source-layer"]),B.state=$});return M}function J(u,t){const s=u.getRenderableIds().map(_=>u.getTileByID(_)),h=[],m={};for(let _=0;_<s.length;_++){const v=s[_],b=v.tileID.canonical.key;m[b]||(m[b]=!0,v.querySourceFeatures(h,t))}return h}function he(u,t){const s=u.tileID,h=t.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function de(){return Va.workerClass!=null?new Va.workerClass:new a.window.Worker(Va.workerUrl)}const re="mapboxgl_preloaded_worker_pool";class fe{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<fe.workerCount;)this.workers.push(new de);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[re]}numActive(){return Object.keys(this.active).length}}let ke;function Ue(){return ke||(ke=new fe),ke}function ze(u,t){const s={};for(const h in u)h!=="ref"&&(s[h]=u[h]);return a.refProperties.forEach(h=>{h in t&&(s[h]=t[h])}),s}function Je(u){u=u.slice();const t=Object.create(null);for(let s=0;s<u.length;s++)t[u[s].id]=u[s];for(let s=0;s<u.length;s++)"ref"in u[s]&&(u[s]=ze(u[s],t[u[s].ref]));return u}fe.workerCount=2;const te={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function be(u,t,s){s.push({command:te.addSource,args:[u,t[u]]})}function st(u,t,s){t.push({command:te.removeSource,args:[u]}),s[u]=!0}function ft(u,t,s,h){st(u,s,h),be(u,t,s)}function dt(u,t,s){let h;for(h in u[s])if(u[s].hasOwnProperty(h)&&h!=="data"&&!ye(u[s][h],t[s][h]))return!1;for(h in t[s])if(t[s].hasOwnProperty(h)&&h!=="data"&&!ye(u[s][h],t[s][h]))return!1;return!0}function At(u,t,s,h,m,_){let v;for(v in t=t||{},u=u||{})u.hasOwnProperty(v)&&(ye(u[v],t[v])||s.push({command:_,args:[h,v,t[v],m]}));for(v in t)t.hasOwnProperty(v)&&!u.hasOwnProperty(v)&&(ye(u[v],t[v])||s.push({command:_,args:[h,v,t[v],m]}))}function Tt(u){return u.id}function $t(u,t){return u[t.id]=t,u}class ir{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=a.clamp(t,0,1);let s=1,h=this._distances[s];const m=t*this.paddedLength+this.padding;for(;h<m&&s<this._distances.length;)h=this._distances[++s];const _=s-1,v=this._distances[_],b=h-v,S=b>0?(m-v)/b:0;return this.points[_].mult(1-S).add(this.points[s].mult(S))}}class Ve{constructor(t,s,h){const m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(s/h);for(let v=0;v<this.xCellCount*this.yCellCount;v++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,h,m,_){this._forEachCell(s,h,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(t,s,h,m){this._forEachCell(s-m,h-m,s+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(h),this.circles.push(m)}_insertBoxCell(t,s,h,m,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,s,h,m,_,v){this.circleCells[_].push(v)}_query(t,s,h,m,_,v){if(h<0||t>this.width||m<0||s>this.height)return!_&&[];const b=[];if(t<=0&&s<=0&&this.width<=h&&this.height<=m){if(_)return!0;for(let S=0;S<this.boxKeys.length;S++)b.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const I=this.circles[3*S],M=this.circles[3*S+1],D=this.circles[3*S+2];b.push({key:this.circleKeys[S],x1:I-D,y1:M-D,x2:I+D,y2:M+D})}return v?b.filter(v):b}return this._forEachCell(t,s,h,m,this._queryCell,b,{hitTest:_,seenUids:{box:{},circle:{}}},v),_?b.length>0:b}_queryCircle(t,s,h,m,_){const v=t-h,b=t+h,S=s-h,I=s+h;if(b<0||v>this.width||I<0||S>this.height)return!m&&[];const M=[];return this._forEachCell(v,S,b,I,this._queryCellCircle,M,{hitTest:m,circle:{x:t,y:s,radius:h},seenUids:{box:{},circle:{}}},_),m?M.length>0:M}query(t,s,h,m,_){return this._query(t,s,h,m,!1,_)}hitTest(t,s,h,m,_){return this._query(t,s,h,m,!0,_)}hitTestCircle(t,s,h,m){return this._queryCircle(t,s,h,!0,m)}_queryCell(t,s,h,m,_,v,b,S){const I=b.seenUids,M=this.boxCells[_];if(M!==null){const F=this.bboxes;for(const B of M)if(!I.box[B]){I.box[B]=!0;const $=4*B;if(t<=F[$+2]&&s<=F[$+3]&&h>=F[$+0]&&m>=F[$+1]&&(!S||S(this.boxKeys[B]))){if(b.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[B],x1:F[$],y1:F[$+1],x2:F[$+2],y2:F[$+3]})}}}const D=this.circleCells[_];if(D!==null){const F=this.circles;for(const B of D)if(!I.circle[B]){I.circle[B]=!0;const $=3*B;if(this._circleAndRectCollide(F[$],F[$+1],F[$+2],t,s,h,m)&&(!S||S(this.circleKeys[B]))){if(b.hitTest)return v.push(!0),!0;{const G=F[$],K=F[$+1],N=F[$+2];v.push({key:this.circleKeys[B],x1:G-N,y1:K-N,x2:G+N,y2:K+N})}}}}}_queryCellCircle(t,s,h,m,_,v,b,S){const I=b.circle,M=b.seenUids,D=this.boxCells[_];if(D!==null){const B=this.bboxes;for(const $ of D)if(!M.box[$]){M.box[$]=!0;const G=4*$;if(this._circleAndRectCollide(I.x,I.y,I.radius,B[G+0],B[G+1],B[G+2],B[G+3])&&(!S||S(this.boxKeys[$])))return v.push(!0),!0}}const F=this.circleCells[_];if(F!==null){const B=this.circles;for(const $ of F)if(!M.circle[$]){M.circle[$]=!0;const G=3*$;if(this._circlesCollide(B[G],B[G+1],B[G+2],I.x,I.y,I.radius)&&(!S||S(this.circleKeys[$])))return v.push(!0),!0}}}_forEachCell(t,s,h,m,_,v,b,S){const I=this._convertToXCellCoord(t),M=this._convertToYCellCoord(s),D=this._convertToXCellCoord(h),F=this._convertToYCellCoord(m);for(let B=I;B<=D;B++)for(let $=M;$<=F;$++)if(_.call(this,t,s,h,m,this.xCellCount*$+B,v,b,S))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,h,m,_,v){const b=m-t,S=_-s,I=h+v;return I*I>b*b+S*S}_circleAndRectCollide(t,s,h,m,_,v,b){const S=(v-m)/2,I=Math.abs(t-(m+S));if(I>S+h)return!1;const M=(b-_)/2,D=Math.abs(s-(_+M));if(D>M+h)return!1;if(I<=S||D<=M)return!0;const F=I-S,B=D-M;return F*F+B*B<=h*h}}const yt=Math.tan(85*Math.PI/180);function mt(u,t,s,h,m){const _=a.create$1();return t?(a.scale$1(_,_,[1/m,1/m,1]),s||a.rotateZ(_,_,h.angle)):a.multiply(_,h.labelPlaneMatrix,u),_}function zn(u,t,s,h,m){if(t){const _=a.clone$1(u);return a.scale$1(_,_,[m,m,1]),s||a.rotateZ(_,_,-h.angle),_}return h.glCoordMatrix}function Ei(u,t,s=0){const h=[u.x,u.y,s,1];s?a.transformMat4(h,h,t):Fl(h,h,t);const m=h[3];return{point:new a.pointGeometry(h[0]/m,h[1]/m),signedDistanceFromCamera:m}}function xt(u,t){return Math.min(.5+u/t*.5,1.5)}function ca(u,t){const s=u[0]/u[3],h=u[1]/u[3];return s>=-t[0]&&s<=t[0]&&h>=-t[1]&&h<=t[1]}function _s(u,t,s,h,m,_,v,b,S){const I=h?u.textSizeData:u.iconSizeData,M=a.evaluateSizeForZoom(I,s.transform.zoom),D=[256/s.width*2+1,256/s.height*2+1],F=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;F.clear();const B=u.lineVertexArray,$=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,G=s.transform.width/s.transform.height;let K=!1;for(let N=0;N<$.length;N++){const Z=$.get(N);if(Z.writingMode!==a.WritingMode.vertical||K||N!==0&&$.get(N-1).writingMode===a.WritingMode.horizontal||(K=!0),Z.hidden||Z.writingMode===a.WritingMode.vertical&&!K){nr(Z.numGlyphs,F);continue}K=!1;const Y=new a.pointGeometry(Z.tileAnchorX,Z.tileAnchorY),ee=S?S(Y):0,oe=[Y.x,Y.y,ee],X=[...oe,1];if(a.transformMat4(X,X,t),!ca(X,D)){nr(Z.numGlyphs,F);continue}const le=xt(s.transform.cameraToCenterDistance,X[3]),Te=a.evaluateSizeForFeature(I,M,Z),Ae=v?Te/le:Te*le,ae=Ei(new a.pointGeometry(oe[0],oe[1]),m,oe[2]);if(ae.signedDistanceFromCamera<=0){nr(Z.numGlyphs,F);continue}let we={};const $e=v?null:S,qe=Yt(Z,Ae,!1,b,t,m,_,u.glyphOffsetArray,B,F,ae.point,Y,we,G,$e);K=qe.useVertical,$e&&qe.needsFlipping&&(we={}),(qe.notEnoughRoom||K||qe.needsFlipping&&Yt(Z,Ae,!0,b,t,m,_,u.glyphOffsetArray,B,F,ae.point,Y,we,G,$e).notEnoughRoom)&&nr(Z.numGlyphs,F)}h?u.text.dynamicLayoutVertexBuffer.updateData(F):u.icon.dynamicLayoutVertexBuffer.updateData(F)}function _o(u,t,s,h,m,_,v,b,S,I,M,D,F){const B=b.glyphStartIndex+b.numGlyphs,$=b.lineStartIndex,G=b.lineStartIndex+b.lineLength,K=t.getoffsetX(b.glyphStartIndex),N=t.getoffsetX(B-1),Z=yo(u*K,s,h,m,_,v,b.segment,$,G,S,I,M,D,F,!0);if(!Z)return null;const Y=yo(u*N,s,h,m,_,v,b.segment,$,G,S,I,M,D,F,!0);return Y?{first:Z,last:Y}:null}function sn(u,t,s,h){return u.writingMode===a.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*h?{useVertical:!0}:u.writingMode===a.WritingMode.vertical?t.y<s.y?{needsFlipping:!0}:null:u.flipState!==0&&function(m,_,v){const b=(_.x-m.x)*v;return b===0||Math.abs((_.y-m.y)/b)>yt}(t,s,h)?u.flipState===1?{needsFlipping:!0}:null:t.x>s.x?{needsFlipping:!0}:null}function Yt(u,t,s,h,m,_,v,b,S,I,M,D,F,B,$){const G=t/24,K=u.lineOffsetX*G,N=u.lineOffsetY*G;let Z;if(u.numGlyphs>1){const Y=u.glyphStartIndex+u.numGlyphs,ee=u.lineStartIndex,oe=u.lineStartIndex+u.lineLength,X=_o(G,b,K,N,s,M,D,u,S,_,F,$,!1);if(!X)return{notEnoughRoom:!0};const le=Ei(X.first.point,v).point,Te=Ei(X.last.point,v).point;if(h&&!s){const Ae=sn(u,le,Te,B);if(u.flipState=Ae&&Ae.needsFlipping?1:2,Ae)return Ae}Z=[X.first];for(let Ae=u.glyphStartIndex+1;Ae<Y-1;Ae++)Z.push(yo(G*b.getoffsetX(Ae),K,N,s,M,D,u.segment,ee,oe,S,_,F,$,!1,!1));Z.push(X.last)}else{if(h&&!s){const ee=Ei(D,m).point,oe=u.lineStartIndex+u.segment+1,X=new a.pointGeometry(S.getx(oe),S.gety(oe)),le=Ei(X,m),Te=sn(u,ee,le.signedDistanceFromCamera>0?le.point:go(D,X,ee,1,m,void 0),B);if(u.flipState=Te&&Te.needsFlipping?1:2,Te)return Te}const Y=yo(G*b.getoffsetX(u.glyphStartIndex),K,N,s,M,D,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,S,_,F,$,!1,!1);if(!Y)return{notEnoughRoom:!0};Z=[Y]}for(const Y of Z)a.addDynamicAttributes(I,Y.point,Y.angle);return{}}function Bu(u,t,s){const h={x:u.x,y:u.y,z:0};if(!s)return Ei(h,t,h.z);const m=s(u);return Ei(new a.pointGeometry(h.x,h.y),t,h.z+m)}function go(u,t,s,h,m,_){const v=Bu(u.add(u.sub(t)._unit()),m,_).point,b=s.sub(v);return s.add(b._mult(h/b.mag()))}function yo(u,t,s,h,m,_,v,b,S,I,M,D,F,B,$){const G=h?u-t:u+t;let K=G>0?1:-1,N=0;h&&(K*=-1,N=Math.PI),K<0&&(N+=Math.PI);let Z=K>0?b+v:b+v+1,Y=m,ee=m,oe=0,X=0;const le=Math.abs(G),Te=[],Ae=[];let ae=_;const we=()=>{const wt=Z-K;return oe===0?_:new a.pointGeometry(I.getx(wt),I.gety(wt))},$e=()=>go(we(),ae,ee,le-oe+1,M,F);for(;oe+X<=le;){if(Z+=K,Z<b||Z>=S)return null;if(ee=Y,Te.push(Y),B&&Ae.push(ae||we()),Y=D[Z],Y===void 0){ae=new a.pointGeometry(I.getx(Z),I.gety(Z));const wt=Bu(ae,M,F);Y=wt.signedDistanceFromCamera>0?D[Z]=wt.point:$e()}else ae=null;oe+=X,X=ee.dist(Y)}$&&F&&(ae=ae||new a.pointGeometry(I.getx(Z),I.gety(Z)),D[Z]=Y=D[Z]===void 0?Y:$e(),X=ee.dist(Y));const qe=(le-oe)/X,Ze=Y.sub(ee),Re=Ze.mult(qe)._add(ee);s&&Re._add(Ze._unit()._perp()._mult(s*K));const He=N+Math.atan2(Y.y-ee.y,Y.x-ee.x);return Te.push(Re),B&&(ae=ae||new a.pointGeometry(I.getx(Z),I.gety(Z)),Ae.push(function(wt,ct,ti){const Xt=1-ti;return new a.pointGeometry(wt.x*Xt+ct.x*ti,wt.y*Xt+ct.y*ti)}(Ae.length>0?Ae[Ae.length-1]:ae,ae,qe))),{point:Re,angle:He,path:Te,tilePath:Ae}}const gs=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nr(u,t){for(let s=0;s<u;s++){const h=t.length;t.resize(h+4),t.float32.set(gs,3*h)}}function Fl(u,t,s){const h=t[0],m=t[1];return u[0]=s[0]*h+s[4]*m+s[12],u[1]=s[1]*h+s[5]*m+s[13],u[3]=s[3]*h+s[7]*m+s[15],u}const _t=100;class Bl{constructor(t,s,h=new Ve(t.width+200,t.height+200,25),m=new Ve(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+_t,this.screenBottomBoundary=t.height+_t,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,h,m,_,v,b){let S=s.projectedAnchorZ;s.elevation&&(S+=s.elevation);const I=this.projectAndGetPerspectiveRatio(v,s.projectedAnchorX,s.projectedAnchorY,S,s.tileID),M=_*I.perspectiveRatio,D=(s.x1*t+h.x-s.padding)*M+I.point.x,F=(s.y1*t+h.y-s.padding)*M+I.point.y,B=(s.x2*t+h.x+s.padding)*M+I.point.x,$=(s.y2*t+h.y+s.padding)*M+I.point.y,G=I.perspectiveRatio<=.55||I.aboveHorizon;return!this.isInsideGrid(D,F,B,$)||!m&&this.grid.hitTest(D,F,B,$,b)||G?{box:[],offscreen:!1}:{box:[D,F,B,$],offscreen:this.isOffscreen(D,F,B,$)}}placeCollisionCircles(t,s,h,m,_,v,b,S,I,M,D,F,B,$){const G=[],K=this.transform.elevation,N=K?$e=>K.getAtTileOffset($,$e.x,$e.y):$e=>0,Z=new a.pointGeometry(s.tileAnchorX,s.tileAnchorY),Y=N(Z),ee=this.projectAndGetPerspectiveRatio(v,Z.x,Z.y,Y,$),{perspectiveRatio:oe}=ee,X=(M?_/oe:_*oe)/a.ONE_EM,le=Ei(Z,b,Y).point,Te=ee.signedDistanceFromCamera>0?_o(X,m,s.lineOffsetX*X,s.lineOffsetY*X,!1,le,Z,s,h,b,{},K&&!M?N:null,M&&!!K):null;let Ae=!1,ae=!1,we=!0;if(Te&&!ee.aboveHorizon){const $e=.5*F*oe+B,qe=new a.pointGeometry(-100,-100),Ze=new a.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Re=new ir,He=Te.first,wt=Te.last;let ct=[];for(let pt=He.path.length-1;pt>=1;pt--)ct.push(He.path[pt]);for(let pt=1;pt<wt.path.length;pt++)ct.push(wt.path[pt]);const ti=2.5*$e;if(S){const pt=ct.map(K?(bt,Kt)=>{const yn=N(Kt<He.path.length-1?He.tilePath[He.path.length-1-Kt]:wt.tilePath[Kt-He.path.length+2]);return Ei(bt,S,yn)}:bt=>Ei(bt,S));ct=pt.some(bt=>bt.signedDistanceFromCamera<=0)?[]:pt.map(bt=>bt.point)}let Xt=[];if(ct.length>0){const pt=ct[0].clone(),bt=ct[0].clone();for(let Kt=1;Kt<ct.length;Kt++)pt.x=Math.min(pt.x,ct[Kt].x),pt.y=Math.min(pt.y,ct[Kt].y),bt.x=Math.max(bt.x,ct[Kt].x),bt.y=Math.max(bt.y,ct[Kt].y);Xt=pt.x>=qe.x&&bt.x<=Ze.x&&pt.y>=qe.y&&bt.y<=Ze.y?[ct]:bt.x<qe.x||pt.x>Ze.x||bt.y<qe.y||pt.y>Ze.y?[]:a.clipLine([ct],qe.x,qe.y,Ze.x,Ze.y)}for(const pt of Xt){Re.reset(pt,.25*$e);let bt=0;bt=Re.length<=.5*$e?1:Math.ceil(Re.paddedLength/ti)+1;for(let Kt=0;Kt<bt;Kt++){const yn=Kt/Math.max(bt-1,1),Gn=Re.lerp(yn),Ri=Gn.x+_t,Wi=Gn.y+_t;G.push(Ri,Wi,$e,0);const Zn=Ri-$e,ar=Wi-$e,Nt=Ri+$e,Qt=Wi+$e;if(we=we&&this.isOffscreen(Zn,ar,Nt,Qt),ae=ae||this.isInsideGrid(Zn,ar,Nt,Qt),!t&&this.grid.hitTestCircle(Ri,Wi,$e,D)&&(Ae=!0,!I))return{circles:[],offscreen:!1,collisionDetected:Ae}}}}return{circles:!I&&Ae||!ae?[]:G,offscreen:we,collisionDetected:Ae}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,m=1/0,_=-1/0,v=-1/0;for(const M of t){const D=new a.pointGeometry(M.x+_t,M.y+_t);h=Math.min(h,D.x),m=Math.min(m,D.y),_=Math.max(_,D.x),v=Math.max(v,D.y),s.push(D)}const b=this.grid.query(h,m,_,v).concat(this.ignoredGrid.query(h,m,_,v)),S={},I={};for(const M of b){const D=M.key;if(S[D.bucketInstanceId]===void 0&&(S[D.bucketInstanceId]={}),S[D.bucketInstanceId][D.featureIndex])continue;const F=[new a.pointGeometry(M.x1,M.y1),new a.pointGeometry(M.x2,M.y1),new a.pointGeometry(M.x2,M.y2),new a.pointGeometry(M.x1,M.y2)];a.polygonIntersectsPolygon(s,F)&&(S[D.bucketInstanceId][D.featureIndex]=!0,I[D.bucketInstanceId]===void 0&&(I[D.bucketInstanceId]=[]),I[D.bucketInstanceId].push(D.featureIndex))}return I}insertCollisionBox(t,s,h,m,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,h,m,_){const v=s?this.ignoredGrid:this.grid,b={bucketInstanceId:h,featureIndex:m,collisionGroupID:_};for(let S=0;S<t.length;S+=4)v.insertCircle(b,t[S],t[S+1],t[S+2])}projectAndGetPerspectiveRatio(t,s,h,m,_){const v=[s,h,m||0,1];let b=!1;if(m||this.transform.pitch>0){a.transformMat4(v,v,t);let S=!1;this.fogState&&_&&(S=function(I,M,D,F,B,$){const G=$.calculateFogTileMatrix(B),K=[M,D,F];return a.transformMat4$1(K,K,G),In(I,K,$.pitch,$._fov)}(this.fogState,s,h,m||0,_.toUnwrapped(),this.transform)>.9),b=v[2]>v[3]||S}else Fl(v,v,t);return{point:new a.pointGeometry((v[0]/v[3]+1)/2*this.transform.width+_t,(-v[1]/v[3]+1)/2*this.transform.height+_t),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/v[3]*.5,1.5),signedDistanceFromCamera:v[3],aboveHorizon:b}}isOffscreen(t,s,h,m){return h<_t||t>=this.screenRightBoundary||m<_t||s>this.screenBottomBoundary}isInsideGrid(t,s,h,m){return h>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=a.identity([]);return a.translate(t,t,[-100,-100,0]),t}}class ua{constructor(t,s,h,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class vi{constructor(t,s,h,m,_){this.text=new ua(t?t.text:null,s,h,_),this.icon=new ua(t?t.icon:null,s,m,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class an{constructor(t,s,h){this.text=t,this.icon=s,this.skipFade=h}}class Ou{constructor(){this.invProjMatrix=a.create$1(),this.viewportMatrix=a.create$1(),this.circles=[]}}class ha{constructor(t,s,h,m,_){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=_}}class fi{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[t]}}function xo(u,t,s,h,m){const{horizontalAlign:_,verticalAlign:v}=a.getAnchorAlignment(u),b=-(_-.5)*t,S=-(v-.5)*s,I=a.evaluateVariableOffset(u,h);return new a.pointGeometry(b+I[0]*m,S+I[1]*m)}function rr(u,t,s,h,m){const _=new a.pointGeometry(u,t);return s&&_._rotate(h?m:-m),_}class Si{constructor(t,s,h,m,_){this.transform=t.clone(),this.collisionIndex=new Bl(this.transform,_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new fi(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,h,m){const _=h.getBucket(s),v=h.latestFeatureIndex;if(!_||!v||s.id!==_.layerIds[0])return;const b=h.collisionBoxArray,S=_.layers[0].layout,I=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),M=h.tileSize/a.EXTENT,D=this.transform.calculateProjMatrix(h.tileID.toUnwrapped()),F=S.get("text-pitch-alignment")==="map",B=S.get("text-rotation-alignment")==="map",$=Gt(h,1,this.transform.zoom),G=mt(D,F,B,this.transform,$);let K=null;if(F){const Z=zn(D,F,B,this.transform,$);K=a.multiply([],this.transform.labelPlaneMatrix,Z)}this.retainedQueryData[_.bucketInstanceId]=new ha(_.bucketInstanceId,v,_.sourceLayerIndex,_.index,h.tileID);const N={bucket:_,layout:S,posMatrix:D,textLabelPlaneMatrix:G,labelToScreenMatrix:K,scale:I,textPixelRatio:M,holdingForFade:h.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(m)for(const Z of _.sortKeyRanges){const{sortKey:Y,symbolInstanceStart:ee,symbolInstanceEnd:oe}=Z;t.push({sortKey:Y,symbolInstanceStart:ee,symbolInstanceEnd:oe,parameters:N})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:N})}attemptAnchorPlacement(t,s,h,m,_,v,b,S,I,M,D,F,B,$,G,K,N,Z){const Y=[F.textOffset0,F.textOffset1],ee=xo(t,h,m,Y,_),oe=this.collisionIndex.placeCollisionBox(_,s,rr(ee.x,ee.y,v,b,this.transform.angle),D,S,I,M.predicate);if((!K||this.collisionIndex.placeCollisionBox($.getSymbolInstanceIconSize(Z,this.transform.zoom,B),K,rr(ee.x,ee.y,v,b,this.transform.angle),D,S,I,M.predicate).box.length!==0)&&oe.box.length>0){let X;return this.prevPlacement&&this.prevPlacement.variableOffsets[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID]&&this.prevPlacement.placements[F.crossTileID].text&&(X=this.prevPlacement.variableOffsets[F.crossTileID].anchor),this.variableOffsets[F.crossTileID]={textOffset:Y,width:h,height:m,anchor:t,textScale:_,prevAnchor:X},this.markUsedJustification($,t,F,G),$.allowVerticalPlacement&&(this.markUsedOrientation($,G,F),this.placedOrientations[F.crossTileID]=G),{shift:ee,placedGlyphBoxes:oe}}}placeLayerBucketPart(t,s,h,m){const{bucket:_,layout:v,posMatrix:b,textLabelPlaneMatrix:S,labelToScreenMatrix:I,textPixelRatio:M,holdingForFade:D,collisionBoxArray:F,partiallyEvaluatedTextSize:B,partiallyEvaluatedIconSize:$,collisionGroup:G}=t.parameters,K=v.get("text-optional"),N=v.get("icon-optional"),Z=v.get("text-allow-overlap"),Y=v.get("icon-allow-overlap"),ee=v.get("text-rotation-alignment")==="map",oe=v.get("text-pitch-alignment")==="map",X=v.get("icon-text-fit")!=="none",le=v.get("symbol-z-order")==="viewport-y",Te=Z&&(Y||!_.hasIconData()||N),Ae=Y&&(Z||!_.hasTextData()||K);!_.collisionArrays&&F&&_.deserializeCollisionBoxes(F),h&&m&&_.updateCollisionDebugBuffers(this.transform.zoom,F);const ae=(we,$e,qe)=>{if(s[we.crossTileID])return;if(D)return void(this.placements[we.crossTileID]=new an(!1,!1,!1));let Ze=!1,Re=!1,He=!0,wt=null,ct={box:null,offscreen:null},ti={box:null,offscreen:null},Xt=null,pt=null,bt=null,Kt=0,yn=0,Gn=0;qe.textFeatureIndex?Kt=qe.textFeatureIndex:we.useRuntimeCollisionCircles&&(Kt=we.featureIndex),qe.verticalTextFeatureIndex&&(yn=qe.verticalTextFeatureIndex);const Ri=Nt=>{Nt.tileID=this.retainedQueryData[_.bucketInstanceId].tileID,(this.transform.elevation||Nt.elevation)&&(Nt.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[_.bucketInstanceId].tileID,Nt.tileAnchorX,Nt.tileAnchorY):0)},Wi=qe.textBox;if(Wi){Ri(Wi);const Nt=Pt=>{let ii=a.WritingMode.horizontal;if(_.allowVerticalPlacement&&!Pt&&this.prevPlacement){const Xi=this.prevPlacement.placedOrientations[we.crossTileID];Xi&&(this.placedOrientations[we.crossTileID]=Xi,ii=Xi,this.markUsedOrientation(_,ii,we))}return ii},Qt=(Pt,ii)=>{if(_.allowVerticalPlacement&&we.numVerticalGlyphVertices>0&&qe.verticalTextBox){for(const Xi of _.writingModes)if(Xi===a.WritingMode.vertical?(ct=ii(),ti=ct):ct=Pt(),ct&&ct.box&&ct.box.length)break}else ct=Pt()};if(v.get("text-variable-anchor")){let Pt=v.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[we.crossTileID]){const qt=this.prevPlacement.variableOffsets[we.crossTileID];Pt.indexOf(qt.anchor)>0&&(Pt=Pt.filter(Ci=>Ci!==qt.anchor),Pt.unshift(qt.anchor))}const ii=(qt,Ci,xn)=>{const qn=_.getSymbolInstanceTextSize(B,we,this.transform.zoom,$e),ja=(qt.x2-qt.x1)*qn+2*qt.padding,Ec=(qt.y2-qt.y1)*qn+2*qt.padding,$a=X&&!Y?Ci:null;$a&&Ri($a);let eo={box:[],offscreen:!1};const Eh=Z?2*Pt.length:Pt.length;for(let Fs=0;Fs<Eh;++Fs){const Ga=this.attemptAnchorPlacement(Pt[Fs%Pt.length],qt,ja,Ec,qn,ee,oe,M,b,G,Fs>=Pt.length,we,$e,_,xn,$a,B,$);if(Ga&&(eo=Ga.placedGlyphBoxes,eo&&eo.box&&eo.box.length)){Ze=!0,wt=Ga.shift;break}}return eo};Qt(()=>ii(Wi,qe.iconBox,a.WritingMode.horizontal),()=>{const qt=qe.verticalTextBox;return qt&&Ri(qt),_.allowVerticalPlacement&&!(ct&&ct.box&&ct.box.length)&&we.numVerticalGlyphVertices>0&&qt?ii(qt,qe.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null}}),ct&&(Ze=ct.box,He=ct.offscreen);const Xi=Nt(ct&&ct.box);if(!Ze&&this.prevPlacement){const qt=this.prevPlacement.variableOffsets[we.crossTileID];qt&&(this.variableOffsets[we.crossTileID]=qt,this.markUsedJustification(_,qt.anchor,we,Xi))}}else{const Pt=(ii,Xi)=>{const qt=_.getSymbolInstanceTextSize(B,we,this.transform.zoom,$e),Ci=this.collisionIndex.placeCollisionBox(qt,ii,new a.pointGeometry(0,0),Z,M,b,G.predicate);return Ci&&Ci.box&&Ci.box.length&&(this.markUsedOrientation(_,Xi,we),this.placedOrientations[we.crossTileID]=Xi),Ci};Qt(()=>Pt(Wi,a.WritingMode.horizontal),()=>{const ii=qe.verticalTextBox;return _.allowVerticalPlacement&&we.numVerticalGlyphVertices>0&&ii?(Ri(ii),Pt(ii,a.WritingMode.vertical)):{box:null,offscreen:null}}),Nt(ct&&ct.box&&ct.box.length)}}if(Xt=ct,Ze=Xt&&Xt.box&&Xt.box.length>0,He=Xt&&Xt.offscreen,we.useRuntimeCollisionCircles){const Nt=_.text.placedSymbolArray.get(we.centerJustifiedTextSymbolIndex>=0?we.centerJustifiedTextSymbolIndex:we.verticalPlacedTextSymbolIndex),Qt=a.evaluateSizeForFeature(_.textSizeData,B,Nt),Pt=v.get("text-padding");pt=this.collisionIndex.placeCollisionCircles(Z,Nt,_.lineVertexArray,_.glyphOffsetArray,Qt,b,S,I,h,oe,G.predicate,we.collisionCircleDiameter*Qt/a.ONE_EM,Pt,this.retainedQueryData[_.bucketInstanceId].tileID),Ze=Z||pt.circles.length>0&&!pt.collisionDetected,He=He&&pt.offscreen}if(qe.iconFeatureIndex&&(Gn=qe.iconFeatureIndex),qe.iconBox){const Nt=Qt=>{Ri(Qt);const Pt=X&&wt?rr(wt.x,wt.y,ee,oe,this.transform.angle):new a.pointGeometry(0,0),ii=_.getSymbolInstanceIconSize($,this.transform.zoom,$e);return this.collisionIndex.placeCollisionBox(ii,Qt,Pt,Y,M,b,G.predicate)};ti&&ti.box&&ti.box.length&&qe.verticalIconBox?(bt=Nt(qe.verticalIconBox),Re=bt.box.length>0):(bt=Nt(qe.iconBox),Re=bt.box.length>0),He=He&&bt.offscreen}const Zn=K||we.numHorizontalGlyphVertices===0&&we.numVerticalGlyphVertices===0,ar=N||we.numIconVertices===0;if(Zn||ar?ar?Zn||(Re=Re&&Ze):Ze=Re&&Ze:Re=Ze=Re&&Ze,Ze&&Xt&&Xt.box&&this.collisionIndex.insertCollisionBox(Xt.box,v.get("text-ignore-placement"),_.bucketInstanceId,ti&&ti.box&&yn?yn:Kt,G.ID),Re&&bt&&this.collisionIndex.insertCollisionBox(bt.box,v.get("icon-ignore-placement"),_.bucketInstanceId,Gn,G.ID),pt&&(Ze&&this.collisionIndex.insertCollisionCircles(pt.circles,v.get("text-ignore-placement"),_.bucketInstanceId,Kt,G.ID),h)){const Nt=_.bucketInstanceId;let Qt=this.collisionCircleArrays[Nt];Qt===void 0&&(Qt=this.collisionCircleArrays[Nt]=new Ou);for(let Pt=0;Pt<pt.circles.length;Pt+=4)Qt.circles.push(pt.circles[Pt+0]),Qt.circles.push(pt.circles[Pt+1]),Qt.circles.push(pt.circles[Pt+2]),Qt.circles.push(pt.collisionDetected?1:0)}this.placements[we.crossTileID]=new an(Ze||Te,Re||Ae,He||_.justReloaded),s[we.crossTileID]=!0};if(le){const we=_.getSortedSymbolIndexes(this.transform.angle);for(let $e=we.length-1;$e>=0;--$e){const qe=we[$e];ae(_.symbolInstances.get(qe),qe,_.collisionArrays[qe])}}else for(let we=t.symbolInstanceStart;we<t.symbolInstanceEnd;we++)ae(_.symbolInstances.get(we),we,_.collisionArrays[we]);if(h&&_.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[_.bucketInstanceId];a.invert(we.invProjMatrix,b),we.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,s,h,m){let _;_=m===a.WritingMode.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[a.getAnchorJustification(s)];const v=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const b of v)b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=_>=0&&b!==_?0:h.crossTileID)}markUsedOrientation(t,s,h){const m=s===a.WritingMode.horizontal||s===a.WritingMode.horizontalOnly?s:0,_=s===a.WritingMode.vertical?s:0,v=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const b of v)t.text.placedSymbolArray.get(b).placedOrientation=m;h.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,_=s?s.opacities:{},v=s?s.variableOffsets:{},b=s?s.placedOrientations:{};for(const S in this.placements){const I=this.placements[S],M=_[S];M?(this.opacities[S]=new vi(M,m,I.text,I.icon),h=h||I.text!==M.text.placed||I.icon!==M.icon.placed):(this.opacities[S]=new vi(null,m,I.text,I.icon,I.skipFade),h=h||I.text||I.icon)}for(const S in _){const I=_[S];if(!this.opacities[S]){const M=new vi(I,m,!1,!1);M.isHidden()||(this.opacities[S]=M,h=h||I.text.placed||I.icon.placed)}}for(const S in v)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=v[S]);for(const S in b)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=b[S]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const h={};for(const m of s){const _=m.getBucket(t);_&&m.latestFeatureIndex&&t.id===_.layerIds[0]&&this.updateBucketOpacities(_,h,m.collisionBoxArray)}}updateBucketOpacities(t,s,h){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const m=t.layers[0].layout,_=new vi(null,0,!1,!1,!0),v=m.get("text-allow-overlap"),b=m.get("icon-allow-overlap"),S=m.get("text-variable-anchor"),I=m.get("text-rotation-alignment")==="map",M=m.get("text-pitch-alignment")==="map",D=m.get("icon-text-fit")!=="none",F=new vi(null,0,v&&(b||!t.hasIconData()||m.get("icon-optional")),b&&(v||!t.hasTextData()||m.get("text-optional")),!0);!t.collisionArrays&&h&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(h);const B=($,G,K)=>{for(let N=0;N<G/4;N++)$.opacityVertexArray.emplaceBack(K)};for(let $=0;$<t.symbolInstances.length;$++){const G=t.symbolInstances.get($),{numHorizontalGlyphVertices:K,numVerticalGlyphVertices:N,crossTileID:Z}=G;let Y=this.opacities[Z];s[Z]?Y=_:Y||(Y=F,this.opacities[Z]=Y),s[Z]=!0;const ee=G.numIconVertices>0,oe=this.placedOrientations[G.crossTileID],X=oe===a.WritingMode.vertical,le=oe===a.WritingMode.horizontal||oe===a.WritingMode.horizontalOnly;if(K>0||N>0){const Te=ln(Y.text);B(t.text,K,X?Gr:Te),B(t.text,N,le?Gr:Te);const Ae=Y.text.isHidden();[G.rightJustifiedTextSymbolIndex,G.centerJustifiedTextSymbolIndex,G.leftJustifiedTextSymbolIndex].forEach($e=>{$e>=0&&(t.text.placedSymbolArray.get($e).hidden=Ae||X?1:0)}),G.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(G.verticalPlacedTextSymbolIndex).hidden=Ae||le?1:0);const ae=this.variableOffsets[G.crossTileID];ae&&this.markUsedJustification(t,ae.anchor,G,oe);const we=this.placedOrientations[G.crossTileID];we&&(this.markUsedJustification(t,"left",G,we),this.markUsedOrientation(t,we,G))}if(ee){const Te=ln(Y.icon);G.placedIconSymbolIndex>=0&&(B(t.icon,G.numIconVertices,X?Gr:Te),t.icon.placedSymbolArray.get(G.placedIconSymbolIndex).hidden=Y.icon.isHidden()),G.verticalPlacedIconSymbolIndex>=0&&(B(t.icon,G.numVerticalIconVertices,le?Gr:Te),t.icon.placedSymbolArray.get(G.verticalPlacedIconSymbolIndex).hidden=Y.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Te=t.collisionArrays[$];if(Te){let Ae=new a.pointGeometry(0,0);if(Te.textBox||Te.verticalTextBox){let we=!0;if(S){const $e=this.variableOffsets[Z];$e?(Ae=xo($e.anchor,$e.width,$e.height,$e.textOffset,$e.textScale),I&&Ae._rotate(M?this.transform.angle:-this.transform.angle)):we=!1}Te.textBox&&vo(t.textCollisionBox.collisionVertexArray,Y.text.placed,!we||X,Ae.x,Ae.y),Te.verticalTextBox&&vo(t.textCollisionBox.collisionVertexArray,Y.text.placed,!we||le,Ae.x,Ae.y)}const ae=Boolean(!le&&Te.verticalIconBox);Te.iconBox&&vo(t.iconCollisionBox.collisionVertexArray,Y.icon.placed,ae,D?Ae.x:0,D?Ae.y:0),Te.verticalIconBox&&vo(t.iconCollisionBox.collisionVertexArray,Y.icon.placed,!ae,D?Ae.x:0,D?Ae.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=$.invProjMatrix,t.placementViewportMatrix=$.viewportMatrix,t.collisionCircleArray=$.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function vo(u,t,s,h,m){u.emplaceBack(t?1:0,s?1:0,h||0,m||0),u.emplaceBack(t?1:0,s?1:0,h||0,m||0),u.emplaceBack(t?1:0,s?1:0,h||0,m||0),u.emplaceBack(t?1:0,s?1:0,h||0,m||0)}const Pn=Math.pow(2,25),ys=Math.pow(2,24),da=Math.pow(2,17),ip=Math.pow(2,16),br=Math.pow(2,9),np=Math.pow(2,8),Uu=Math.pow(2,1);function ln(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,s=Math.floor(127*u.opacity);return s*Pn+t*ys+s*da+t*ip+s*br+t*np+s*Uu+t}const Gr=0;class Tr{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,h,m,_){const v=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(v,m,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,v.sort((b,S)=>b.sortKey-S.sortKey));this._currentPartIndex<v.length;){const b=v[this._currentPartIndex];if(s.placeLayerBucketPart(b,this._seenCrossTileIDs,h,b.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class Ol{constructor(t,s,h,m,_,v,b,S){this.placement=new Si(t,_,v,b,S),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,h){const m=a.exported.now(),_=()=>{const v=a.exported.now()-m;return!this._forceFullPlacement&&v>2};for(;this._currentPlacementIndex>=0;){const v=s[t[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(v.type==="symbol"&&(!v.minzoom||v.minzoom<=b)&&(!v.maxzoom||v.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new Tr(v)),this._inProgressLayer.continuePlacement(h[v.source],this.placement,this._showCollisionBoxes,v,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const pa=512/a.EXTENT/2;class rp{constructor(t,s,h){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=h;for(let m=0;m<s.length;m++){const _=s.get(m),v=_.key;this.indexedSymbolInstances[v]||(this.indexedSymbolInstances[v]=[]),this.indexedSymbolInstances[v].push({crossTileID:_.crossTileID,coord:this.getScaledCoordinates(_,t)})}}getScaledCoordinates(t,s){const h=pa/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*a.EXTENT+t.tileAnchorX)*h),y:Math.floor((s.canonical.y*a.EXTENT+t.tileAnchorY)*h)}}findMatches(t,s,h){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let _=0;_<t.length;_++){const v=t.get(_);if(v.crossTileID)continue;const b=this.indexedSymbolInstances[v.key];if(!b)continue;const S=this.getScaledCoordinates(v,s);for(const I of b)if(Math.abs(I.coord.x-S.x)<=m&&Math.abs(I.coord.y-S.y)<=m&&!h[I.crossTileID]){h[I.crossTileID]=!0,v.crossTileID=I.crossTileID;break}}}}class op{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ul{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const h in this.indexes){const m=this.indexes[h],_={};for(const v in m){const b=m[v];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+s),_[b.tileID.key]=b}this.indexes[h]=_}this.lng=t}addBucket(t,s,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const m=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const b in v){const S=v[b];S.tileID.isChildOf(t)&&S.findMatches(s.symbolInstances,t,m)}else{const b=v[t.scaledTo(Number(_)).key];b&&b.findMatches(s.symbolInstances,t,m)}}for(let _=0;_<s.symbolInstances.length;_++){const v=s.symbolInstances.get(_);v.crossTileID||(v.crossTileID=h.generate(),m[v.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new rp(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const h in s.indexedSymbolInstances)for(const m of s.indexedSymbolInstances[h])delete this.usedCrossTileIDs[t][m.crossTileID]}removeStaleBuckets(t){let s=!1;for(const h in this.indexes){const m=this.indexes[h];for(const _ in m)t[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[_]),delete m[_],s=!0)}return s}}class Nu{constructor(){this.layerIndexes={},this.crossTileIDs=new op,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,h){let m=this.layerIndexes[t.id];m===void 0&&(m=this.layerIndexes[t.id]=new Ul);let _=!1;const v={};m.handleWrapJump(h);for(const b of s){const S=b.getBucket(t);S&&t.id===S.layerIds[0]&&(S.bucketInstanceId||(S.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(b.tileID,S,this.crossTileIDs)&&(_=!0),v[S.bucketInstanceId]=!0)}return m.removeStaleBuckets(v)&&(_=!0),_}pruneUnusedLayers(t){const s={};t.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const xs=(u,t)=>a.emitValidationErrors(u,t&&t.filter(s=>s.identifier!=="source.canvas")),sp=a.pick(te,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),Vu=a.pick(te,["setCenter","setZoom","setBearing","setPitch"]),ap=function(){const u={},t=a.spec.$version;for(const s in a.spec.$root){const h=a.spec.$root[s];if(h.required){let m=null;m=s==="version"?t:h.type==="array"?[]:{},m!=null&&(u[s]=m)}}return u}(),Nl={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Dn extends a.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new Pi(Ue(),this),this.imageManager=new rt,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(t._requestManager,s.localFontFamily?a.LocalGlyphMode.all:s.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,s.localFontFamily||s.localIdeographFontFamily),this.lineAtlas=new a.LineAtlas(256,512),this.crossTileSymbolIndex=new Nu,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new a.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const h=this;this._rtlTextPluginCallback=Dn.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(_,v)=>{if(a.triggerPluginCompletionEvent(_),v&&v.every(b=>b))for(const b in h._sourceCaches){const S=h._sourceCaches[b],I=S.getSource().type;I!=="vector"&&I!=="geojson"||S.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const _=this.getSource(m.sourceId);if(_&&_.vectorLayerIds)for(const v in this._layers){const b=this._layers[v];b.source===_.id&&this._validateLayer(b)}})}loadURL(t,s={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!a.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,s.accessToken);const m=this.map._requestManager.transformRequest(t,a.ResourceType.Style);this._request=a.getJSON(m,(_,v)=>{this._request=null,_?this.fire(new a.ErrorEvent(_)):v&&this._load(v,h)})}loadJSON(t,s={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(ap,!1)}_updateLayerCount(t,s){const h=s?1:-1;t.is3D()&&(this._num3DLayers+=h),t.type==="circle"&&(this._numCircleLayers+=h),t.type==="symbol"&&(this._numSymbolLayers+=h)}_load(t,s){if(s&&xs(this,a.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const m in t.sources)this.addSource(m,t.sources[m],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(t.glyphs);const h=Je(this.stylesheet.layers);this._order=h.map(m=>m.id),this._layers={},this._serializedLayers={};for(let m of h)m=a.createStyleLayer(m),m.setEventedParent(this,{layer:{id:m.id}}),this._layers[m.id]=m,this._serializedLayers[m.id]=m.serialize(),this._updateLayerCount(m,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new St(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(s,h,m){let _,v,b;const S=a.exported.devicePixelRatio>1?"@2x":"";let I=a.getJSON(h.transformRequest(h.normalizeSpriteURL(s,S,".json"),a.ResourceType.SpriteJSON),(F,B)=>{I=null,b||(b=F,_=B,D())}),M=a.getImage(h.transformRequest(h.normalizeSpriteURL(s,S,".png"),a.ResourceType.SpriteImage),(F,B)=>{M=null,b||(b=F,v=B,D())});function D(){if(b)m(b);else if(_&&v){const F=a.exported.getImageData(v),B={};for(const $ in _){const{width:G,height:K,x:N,y:Z,sdf:Y,pixelRatio:ee,stretchX:oe,stretchY:X,content:le}=_[$],Te=new a.RGBAImage({width:G,height:K});a.RGBAImage.copy(F,Te,{x:N,y:Z},{x:0,y:0},{width:G,height:K}),B[$]={data:Te,pixelRatio:ee,sdf:Y,stretchX:oe,stretchY:X,content:le}}m(null,B)}}return{cancel(){I&&(I.cancel(),I=null),M&&(M.cancel(),M=null)}}}(t,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new a.ErrorEvent(s));else if(h)for(const m in h)this.imageManager.addImage(m,h[m]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.getSource(t.source);if(!s)return;const h=t.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const h of t){const m=this._layers[h];m.type!=="custom"&&s.push(m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&Nl[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(m.length||_.length)&&this._updateWorkerLayers(m,_);for(const v in this._updatedSources){const b=this._updatedSources[v];b==="reload"?this._reloadSource(v):b==="clear"&&this._clearSource(v)}this._updateTilesForChangedImages();for(const v in this._updatedPaintProps)this._layers[v].updateTransitions(t);this.light.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this._resetUpdates()}const h={};for(const m in this._sourceCaches){const _=this._sourceCaches[m];h[m]=_.used,_.used=!1}for(const m of this._order){const _=this._layers[m];if(_.recalculate(t,this._availableImages),!_.isHidden(t.zoom)){const b=this._getLayerSourceCache(_);b&&(b.used=!0)}const v=this.map.painter;if(v){const b=_.getProgramIds();if(!b)continue;const S=_.getProgramConfiguration(t.zoom);for(const I of b)v.useProgram(I,S)}}for(const m in h){const _=this._sourceCaches[m];h[m]!==_.used&&_.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:_.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),s&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(t){if(this._checkLoaded(),xs(this,a.validateStyle(t)))return!1;(t=a.clone$2(t)).layers=Je(t.layers);const s=function(m,_){if(!m)return[{command:te.setStyle,args:[_]}];let v=[];try{if(!ye(m.version,_.version))return[{command:te.setStyle,args:[_]}];ye(m.center,_.center)||v.push({command:te.setCenter,args:[_.center]}),ye(m.zoom,_.zoom)||v.push({command:te.setZoom,args:[_.zoom]}),ye(m.bearing,_.bearing)||v.push({command:te.setBearing,args:[_.bearing]}),ye(m.pitch,_.pitch)||v.push({command:te.setPitch,args:[_.pitch]}),ye(m.sprite,_.sprite)||v.push({command:te.setSprite,args:[_.sprite]}),ye(m.glyphs,_.glyphs)||v.push({command:te.setGlyphs,args:[_.glyphs]}),ye(m.transition,_.transition)||v.push({command:te.setTransition,args:[_.transition]}),ye(m.light,_.light)||v.push({command:te.setLight,args:[_.light]}),ye(m.fog,_.fog)||v.push({command:te.setFog,args:[_.fog]});const b={},S=[];(function(D,F,B,$){let G;for(G in F=F||{},D=D||{})D.hasOwnProperty(G)&&(F.hasOwnProperty(G)||st(G,B,$));for(G in F)F.hasOwnProperty(G)&&(D.hasOwnProperty(G)?ye(D[G],F[G])||(D[G].type==="geojson"&&F[G].type==="geojson"&&dt(D,F,G)?B.push({command:te.setGeoJSONSourceData,args:[G,F[G].data]}):ft(G,F,B,$)):be(G,F,B))})(m.sources,_.sources,S,b);const I=[];m.layers&&m.layers.forEach(D=>{b[D.source]?v.push({command:te.removeLayer,args:[D.id]}):I.push(D)});let M=m.terrain;M&&b[M.source]&&(v.push({command:te.setTerrain,args:[void 0]}),M=void 0),v=v.concat(S),ye(M,_.terrain)||v.push({command:te.setTerrain,args:[_.terrain]}),function(D,F,B){F=F||[];const $=(D=D||[]).map(Tt),G=F.map(Tt),K=D.reduce($t,{}),N=F.reduce($t,{}),Z=$.slice(),Y=Object.create(null);let ee,oe,X,le,Te,Ae,ae;for(ee=0,oe=0;ee<$.length;ee++)X=$[ee],N.hasOwnProperty(X)?oe++:(B.push({command:te.removeLayer,args:[X]}),Z.splice(Z.indexOf(X,oe),1));for(ee=0,oe=0;ee<G.length;ee++)X=G[G.length-1-ee],Z[Z.length-1-ee]!==X&&(K.hasOwnProperty(X)?(B.push({command:te.removeLayer,args:[X]}),Z.splice(Z.lastIndexOf(X,Z.length-oe),1)):oe++,Ae=Z[Z.length-ee],B.push({command:te.addLayer,args:[N[X],Ae]}),Z.splice(Z.length-ee,0,X),Y[X]=!0);for(ee=0;ee<G.length;ee++)if(X=G[ee],le=K[X],Te=N[X],!Y[X]&&!ye(le,Te))if(ye(le.source,Te.source)&&ye(le["source-layer"],Te["source-layer"])&&ye(le.type,Te.type)){for(ae in At(le.layout,Te.layout,B,X,null,te.setLayoutProperty),At(le.paint,Te.paint,B,X,null,te.setPaintProperty),ye(le.filter,Te.filter)||B.push({command:te.setFilter,args:[X,Te.filter]}),ye(le.minzoom,Te.minzoom)&&ye(le.maxzoom,Te.maxzoom)||B.push({command:te.setLayerZoomRange,args:[X,Te.minzoom,Te.maxzoom]}),le)le.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?At(le[ae],Te[ae],B,X,ae.slice(6),te.setPaintProperty):ye(le[ae],Te[ae])||B.push({command:te.setLayerProperty,args:[X,ae,Te[ae]]}));for(ae in Te)Te.hasOwnProperty(ae)&&!le.hasOwnProperty(ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?At(le[ae],Te[ae],B,X,ae.slice(6),te.setPaintProperty):ye(le[ae],Te[ae])||B.push({command:te.setLayerProperty,args:[X,ae,Te[ae]]}))}else B.push({command:te.removeLayer,args:[X]}),Ae=Z[Z.lastIndexOf(X)+1],B.push({command:te.addLayer,args:[Te,Ae]})}(I,_.layers,v)}catch(b){console.warn("Unable to compute style diff:",b),v=[{command:te.setStyle,args:[_]}]}return v}(this.serialize(),t).filter(m=>!(m.command in Vu));if(s.length===0)return!1;const h=s.filter(m=>!(m.command in sp));if(h.length>0)throw new Error(`Unimplemented: ${h.map(m=>m.command).join(", ")}.`);return s.forEach(m=>{m.command!=="setTransition"&&this[m.command].apply(this,m.args)}),this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new a.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new a.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,h={}){if(this._checkLoaded(),this.getSource(t)!==void 0)throw new Error("There is already a source with this ID");if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(a.validateStyle.source,`sources.${t}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=L(t,s,this.dispatcher,this);m.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:m.serialize(),sourceId:t}));const _=v=>{const b=(v?"symbol:":"other:")+t,S=this._sourceCaches[b]=new a.SourceCache(b,m,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[t]=S,S.style=this,S.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),m.onAdd&&m.onAdd(this.map),this._changed=!0}removeSource(t){this._checkLoaded();const s=this.getSource(t);if(s===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.get().source===t)return this.fire(new a.ErrorEvent(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const h=this._getSourceCaches(t);for(const m of h)delete this._sourceCaches[m.id],delete this._updatedSources[m.id],m.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles();delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getSource(t).setData(s),this._changed=!0}getSource(t){const s=this._getSourceCache(t);return s&&s.getSource()}addLayer(t,s,h={}){this._checkLoaded();const m=t.id;if(this.getLayer(m))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${m}" already exists on this map`)));let _;if(t.type==="custom"){if(xs(this,a.validateCustomStyleLayer(t)))return;_=a.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=a.clone$2(t),t=a.extend(t,{source:m})),this._validate(a.validateStyle.layer,`layers.${m}`,t,{arrayIndex:-1},h))return;_=a.createStyleLayer(t),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}}),this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0)}const v=s?this._order.indexOf(s):this._order.length;if(s&&v===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`)));this._order.splice(v,0,m),this._layerOrderChanged=!0,this._layers[m]=_;const b=this._getLayerSourceCache(_);if(this._removedLayers[m]&&_.source&&b&&_.type!=="custom"){const S=this._removedLayers[m];delete this._removedLayers[m],S.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",b.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const h=this._order.indexOf(t);this._order.splice(h,1);const m=s?this._order.indexOf(s):this._order.length;s&&m===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${s}" does not exist on this map.`))):(this._order.splice(m,0,t),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be removed.`)));s.setEventedParent(null),this._updateLayerCount(s,!1);const h=this._order.indexOf(t);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,h){this._checkLoaded();const m=this.getLayer(t);m?m.minzoom===s&&m.maxzoom===h||(s!=null&&(m.minzoom=s),h!=null&&(m.maxzoom=h),this._updateLayer(m)):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(t,s,h={}){this._checkLoaded();const m=this.getLayer(t);if(m){if(!ye(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.validateStyle.filter,`layers.${m.id}.filter`,s,null,h)||(m.filter=a.clone$2(s),this._updateLayer(m)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be filtered.`)))}getFilter(t){return a.clone$2(this.getLayer(t).filter)}setLayoutProperty(t,s,h,m={}){this._checkLoaded();const _=this.getLayer(t);_?ye(_.getLayoutProperty(s),h)||(_.setLayoutProperty(s,h,m),this._updateLayer(_)):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(t,s){const h=this.getLayer(t);if(h)return h.getLayoutProperty(s);this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style.`)))}setPaintProperty(t,s,h,m={}){this._checkLoaded();const _=this.getLayer(t);_?ye(_.getPaintProperty(s),h)||(_.setPaintProperty(s,h,m)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const h=t.source,m=t.sourceLayer,_=this.getSource(h);if(_===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const v=_.type;if(v==="geojson"&&m)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!m)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const b=this._getSourceCaches(h);for(const S of b)S.setFeatureState(m,t.id,s)}removeFeatureState(t,s){this._checkLoaded();const h=t.source,m=this.getSource(h);if(m===void 0)return void this.fire(new a.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)));const _=m.type,v=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!v)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const b=this._getSourceCaches(h);for(const S of b)S.removeFeatureState(v,t.id,s)}getFeatureState(t){this._checkLoaded();const s=t.source,h=t.sourceLayer,m=this.getSource(s);if(m!==void 0){if(m.type!=="vector"||h)return t.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(s)[0].getFeatureState(h,t.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const t={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();t[h.id]||(t[h.id]=h.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t,layers:this._serializeLayers(this._order)},s=>s!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0;const s=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&s&&s.getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",s.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=v=>this._layers[v].type==="fill-extrusion",h={},m=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(s(b)){h[b]=v;for(const S of t){const I=S[b];if(I)for(const M of I)m.push(M)}}}m.sort((v,b)=>b.intersectionZ-v.intersectionZ);const _=[];for(let v=this._order.length-1;v>=0;v--){const b=this._order[v];if(s(b))for(let S=m.length-1;S>=0;S--){const I=m[S].feature;if(h[I.layer.id]<v)break;_.push(I),m.pop()}else for(const S of t){const I=S[b];if(I)for(const M of I)_.push(M.feature)}}return _}queryRenderedFeatures(t,s,h){s&&s.filter&&this._validate(a.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const m={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const S of s.layers){const I=this._layers[S];if(!I)return this.fire(new a.ErrorEvent(new Error(`The layer '${S}' does not exist in the map's style and cannot be queried for features.`))),[];m[I.source]=!0}}const _=[];s.availableImages=this._availableImages;const v=s&&s.layers?s.layers.some(S=>{const I=this.getLayer(S);return I&&I.is3D()}):this.has3DLayers(),b=Ge.createFromScreenPoints(t,h);for(const S in this._sourceCaches){const I=this._sourceCaches[S].getSource().id;s.layers&&!m[I]||_.push(q(this._sourceCaches[S],this._layers,this._serializedLayers,b,s,h,v,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(S,I,M,D,F,B,$){const G={},K=B.queryRenderedSymbols(D),N=[];for(const Z of Object.keys(K).map(Number))N.push($[Z]);N.sort(he);for(const Z of N){const Y=Z.featureIndex.lookupSymbolFeatures(K[Z.bucketInstanceId],I,Z.bucketIndex,Z.sourceLayerIndex,F.filter,F.layers,F.availableImages,S);for(const ee in Y){const oe=G[ee]=G[ee]||[],X=Y[ee];X.sort((le,Te)=>{const Ae=Z.featureSortOrder;if(Ae){const ae=Ae.indexOf(le.featureIndex);return Ae.indexOf(Te.featureIndex)-ae}return Te.featureIndex-le.featureIndex});for(const le of X)oe.push(le)}}for(const Z in G)G[Z].forEach(Y=>{const ee=Y.feature,oe=M(S[Z]).getFeatureState(ee.layer["source-layer"],ee.id);ee.source=ee.layer.source,ee.layer["source-layer"]&&(ee.sourceLayer=ee.layer["source-layer"]),ee.state=oe});return G}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),b.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(t,s){s&&s.filter&&this._validate(a.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const h=this._getSourceCaches(t);let m=[];for(const _ of h)m=m.concat(J(_,s));return m}addSourceType(t,s,h){return Dn.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(Dn.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},h):h(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const h=this.light.getLight();let m=!1;for(const v in t)if(!ye(t[v],h[v])){m=!0;break}if(!m)return;const _={now:a.exported.now(),transition:a.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(_)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(typeof t.source=="object"){const s="terrain-dem-src";this.addSource(s,t.source),t=a.clone$2(t),t=a.extend(t,{source:s})}if(!this._validate(a.validateStyle.terrain,"terrain",t)){if(this.terrain){const s=this.terrain,h=s.get();for(const m in t)if(!ye(t[m],h[m])){s.set(t),this.stylesheet.terrain=t;const _={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(_);break}}else this._createTerrain(t);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(t){const s=this.fog=new Vn(t);this.stylesheet.fog=t;const h={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog,h=s.get();for(const m in t)if(!ye(t[m],h[m])){s.set(t),this.stylesheet.fog=t;const _={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(_);break}}else this._createFog(t);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(h=>this.isLayerDraped(this._layers[h])),s=this._order.filter(h=>!this.isLayerDraped(this._layers[h]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t){const s=this.terrain=new ei(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const h={now:a.exported.now(),transition:a.extend({duration:0},this.stylesheet.transition)};s.updateTransitions(h)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_validate(t,s,h,m,_={}){return(!_||_.validate!==!1)&&xs(this,t.call(a.validateStyle,a.extend({key:s,style:this.serialize(),value:h,styleSpec:a.spec},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const s=this._getSourceCaches(t);for(const h of s)h.clearTiles()}_reloadSource(t){const s=this._getSourceCaches(t);for(const h of s)h.resume(),h.reload()}_updateSources(t){for(const s in this._sourceCaches)this._sourceCaches[s].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,h,m,_=!1){let v=!1,b=!1;const S={};for(const I of this._order){const M=this._layers[I];if(M.type!=="symbol")continue;if(!S[M.source]){const F=this._getLayerSourceCache(M);if(!F)continue;S[M.source]=F.getRenderableIds(!0).map(B=>F.getTileByID(B)).sort((B,$)=>$.tileID.overscaledZ-B.tileID.overscaledZ||(B.tileID.isLessThan($.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(M,S[M.source],t.center.lng);v=v||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),_=_||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),t.zoom))&&(this.pauseablePlacement=new Ol(t,this._order,_,s,h,m,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,S),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),b=!0),v&&this.pauseablePlacement.placement.setStale()),b||v)for(const I of this._order){const M=this._layers[I];M.type==="symbol"&&this.placement.updateLayerOpacities(M,S[M.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,h){this.imageManager.getImages(s.icons,h),this._updateTilesForChangedImages();const m=_=>{_&&_.setDependencies(s.tileID.key,s.type,s.icons)};m(this._otherSourceCaches[s.source]),m(this._symbolSourceCaches[s.source])}getGlyphs(t,s,h){this.glyphManager.getGlyphs(s.stacks,h)}getResource(t,s,h){return a.makeRequest(s,h)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Dn.getSourceType=function(u){return P[u]},Dn.setSourceType=function(u,t){P[u]=t},Dn.registerForPluginStateChange=a.registerForPluginStateChange;var Vl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,jl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let vs={},Ln={};vs=Ct("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec3 elevationVector(vec2 pos) {vec2 uv=pos/8192.0;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif`,!0),Ln=Ct(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const ws=Ct(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),wo=Vl;var fa={background:Ct(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ct(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Ct(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ct("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ct(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ct(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ct("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ct("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ct("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:Ct(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Ct(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ct(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ct(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ct(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Ct(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Ct(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ct(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ct(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Ct(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Ct(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Ct(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}`),symbolSDF:Ct(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ct(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrainRaster:Ct(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:Ct(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Ct(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,jl),skyboxGradient:Ct(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,jl),skyboxCapture:Ct(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ct(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);}"),globeAtmosphere:Ct(`uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)
discard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:Ct(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying float v_depth;void main() {gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);v_depth=gl_Position.z/gl_Position.w;}")};function Ct(u,t,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,_=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),v=u.match(m),b=t.match(m),S=Vl.match(m);let I=b?b.concat(v):v;s||(vs.staticUniforms&&(I=vs.staticUniforms.concat(I)),Ln.staticUniforms&&(I=Ln.staticUniforms.concat(I))),I&&(I=I.concat(S));const M={};return{fragmentSource:u=u.replace(h,(D,F,B,$,G)=>(M[G]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
varying ${B} ${$} ${G};
#else
uniform ${B} ${$} u_${G};
#endif
`:`
#ifdef HAS_UNIFORM_u_${G}
    ${B} ${$} ${G} = u_${G};
#endif
`)),vertexSource:t=t.replace(h,(D,F,B,$,G)=>{const K=$==="float"?"vec2":"vec4",N=G.match(/color/)?"color":K;return M[G]?F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${B} ${K} a_${G};
varying ${B} ${$} ${G};
#else
uniform ${B} ${$} u_${G};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${B} ${$} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${N}(a_${G}, u_${G}_t);
#else
    ${B} ${$} ${G} = u_${G};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
attribute ${B} ${K} a_${G};
#else
uniform ${B} ${$} u_${G};
#endif
`:N==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${$} ${G} = a_${G};
#else
    ${B} ${$} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${B} ${$} ${G} = unpack_mix_${N}(a_${G}, u_${G}_t);
#else
    ${B} ${$} ${G} = u_${G};
#endif
`}),staticAttributes:_,staticUniforms:I}}class ma{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,h,m,_,v,b,S){this.context=t;let I=this.boundPaintVertexBuffers.length!==m.length;for(let M=0;!I&&M<m.length;M++)this.boundPaintVertexBuffers[M]!==m[M]&&(I=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===h&&!I&&this.boundIndexBuffer===_&&this.boundVertexOffset===v&&this.boundDynamicVertexBuffer===b&&this.boundDynamicVertexBuffer2===S?(t.bindVertexArrayOES.set(this.vao),b&&b.bind(),_&&_.dynamicDraw&&_.bind(),S&&S.bind()):this.freshBind(s,h,m,_,v,b,S)}freshBind(t,s,h,m,_,v,b){let S;const I=t.numAttributes,M=this.context,D=M.gl;if(M.extVertexArrayObject)this.vao&&this.destroy(),this.vao=M.extVertexArrayObject.createVertexArrayOES(),M.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=v,this.boundDynamicVertexBuffer2=b;else{S=M.currentNumAttributes||0;for(let F=I;F<S;F++)D.disableVertexAttribArray(F)}s.enableAttributes(D,t);for(const F of h)F.enableAttributes(D,t);v&&v.enableAttributes(D,t),b&&b.enableAttributes(D,t),s.bind(),s.setVertexAttribPointers(D,t,_);for(const F of h)F.bind(),F.setVertexAttribPointers(D,t,_);v&&(v.bind(),v.setVertexAttribPointers(D,t,_)),m&&m.bind(),b&&(b.bind(),b.setVertexAttribPointers(D,t,_)),M.currentNumAttributes=I}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function $l(u,t){const s=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new a.MercatorCoordinate(0,h/s).toLngLat().lat,new a.MercatorCoordinate(0,(h+1)/s).toLngLat().lat]}function _a(u,t,s,h,m,_,v){const b=u.context,S=b.gl,I=s.fbo;if(!I)return;u.prepareDrawTile(t);const M=u.useProgram("hillshade");b.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get());const D=((F,B,$,G)=>{const K=$.paint.get("hillshade-shadow-color"),N=$.paint.get("hillshade-highlight-color"),Z=$.paint.get("hillshade-accent-color");let Y=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(Y-=F.transform.angle);const ee=!F.options.moving;return{u_matrix:G||F.transform.calculateProjMatrix(B.tileID.toUnwrapped(),ee),u_image:0,u_latrange:$l(0,B.tileID),u_light:[$.paint.get("hillshade-exaggeration"),Y],u_shadow:K,u_highlight:N,u_accent:Z}})(u,s,h,u.terrain?t.projMatrix:null);u.prepareDrawProgram(b,M,t.toUnwrapped()),M.draw(b,S.TRIANGLES,m,_,v,a.CullFaceMode.disabled,D,h.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}function bo(u,t,s){if(!t.needsDEMTextureUpload)return;const h=u.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(s.stride);const _=s.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new a.Texture(h,_,m.RGBA,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Mt(u,t,s,h,m,_){const v=u.context,b=v.gl;if(!t.dem)return;const S=t.dem;if(v.activeTexture.set(b.TEXTURE1),bo(u,t,S),!t.demTexture)return;t.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE);const I=S.dim;v.activeTexture.set(b.TEXTURE0);let M=t.fbo;if(!M){const D=new a.Texture(v,{width:I,height:I,data:null},b.RGBA);D.bind(b.LINEAR,b.CLAMP_TO_EDGE),M=t.fbo=v.createFramebuffer(I,I,!0),M.colorAttachment.set(D.texture)}v.bindFramebuffer.set(M.framebuffer),v.viewport.set([0,0,I,I]),u.useProgram("hillshadePrepare").draw(v,b.TRIANGLES,h,m,_,a.CullFaceMode.disabled,((D,F)=>{const B=F.stride,$=a.create$1();return a.ortho($,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate($,$,[0,-a.EXTENT,0]),{u_matrix:$,u_image:1,u_dimension:[B,B],u_zoom:D.overscaledZ,u_unpack:F.unpackVector}})(t.tileID,S),s.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),t.needsHillshadePrepare=!1}const bs=(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image0:new a.Uniform1i(u,t.u_image0),u_skirt_height:new a.Uniform1f(u,t.u_skirt_height)}),Gl=(u,t)=>({u_matrix:u,u_image0:0,u_skirt_height:t}),ga=new class{constructor(){this.operations={}}newMorphing(u,t,s,h,m){if(u in this.operations){const _=this.operations[u];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[u]={startTime:h,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const s=this.operations[t];for(s.phase=(u-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},Zl={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ql(u,t){const s=1<<u.z;return!t&&(u.x===0||u.x===s-1)||u.y===0||u.y===s-1}const ya=u=>({u_matrix:u});function ju(u,t,s,h,m){if(m>0){const _=a.exported.now(),v=(_-u.timeAdded)/m,b=t?(_-t.timeAdded)/m:-1,S=s.getSource(),I=h.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),M=!t||Math.abs(t.tileID.overscaledZ-I)>Math.abs(u.tileID.overscaledZ-I),D=M&&u.refreshedUponExpiration?1:a.clamp(M?v:1-b,0,1);return u.refreshedUponExpiration&&v>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-D}:{opacity:D,mix:0}}return{opacity:1,mix:0}}class lp extends a.SourceCache{constructor(t){const s=L("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new Pi(Ue(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,h){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,v)=>{if(_[v.key]="",!this._tiles[v.key]){const b=new a.Tile(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom);b.state="loaded",this._tiles[v.key]=b}return _},{});for(const _ in this._tiles)_ in m||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class xa extends a.OverscaledTileID{constructor(t,s,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class Wl extends a.Elevation{constructor(t,s){super(),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,_]=function(S){const I=new a.StructArrayLayout4i8,M=new a.StructArrayLayout3ui6,D=131;I.reserve(17161),M.reserve(33800);const F=a.EXTENT/128,B=a.EXTENT+F/2,$=B+F;for(let K=-F;K<$;K+=F)for(let N=-F;N<$;N+=F){const Z=N<0||N>B||K<0||K>B?24575:0,Y=a.clamp(Math.round(N),0,a.EXTENT),ee=a.clamp(Math.round(K),0,a.EXTENT);I.emplaceBack(Y+Z,ee,Y,ee)}const G=(K,N)=>{const Z=N*D+K;M.emplaceBack(Z+1,Z,Z+D),M.emplaceBack(Z+D,Z+D+1,Z+1)};for(let K=1;K<129;K++)for(let N=1;N<129;N++)G(N,K);return[0,129].forEach(K=>{for(let N=0;N<130;N++)G(N,K),G(K,N)}),[I,M,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(h,$n.members),this.gridIndexBuffer=v.createIndexBuffer(m),this.gridSegments=a.SegmentVector.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,h.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new lp(s.map),this.orthoMatrix=a.create$1(),a.ortho(this.orthoMatrix,0,a.EXTENT,0,a.EXTENT,0,1);const b=v.gl;this._overlapStencilMode=new a.StencilMode({func:b.GEQUAL,mask:255},0,255,b.KEEP,b.KEEP,b.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(t,s,h){if(t&&t.terrain){this._style!==t&&(this.style=t),this.enabled=!0;const m=t.terrain.properties;this.sourceCache=t._getSourceCache(m.get("source")),this._exaggeration=m.get("exaggeration");const _=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const v=this.sourceCache.getSource().tileSize/128,b=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(s,v*b,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,_(),this._initializing=!0),_(),s.updateElevation(!h),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const t=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||t.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${t.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${t.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(S=>{const I=s.getTileByID(S).tileID;return I.projMatrix=h.calculateProjMatrix(I.toUnwrapped()),I});(function(S,I){const M=I.transform.pointCoordinate(I.transform.getCameraPoint()),D=new a.pointGeometry(M.x,M.y);S.sort((F,B)=>{if(B.overscaledZ-F.overscaledZ)return B.overscaledZ-F.overscaledZ;const $=new a.pointGeometry(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),G=new a.pointGeometry(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),K=D.mult(1<<F.canonical.z);return K.x-=.5,K.y-=.5,K.distSqr($)-K.distSqr(G)})})(m,this.painter),this._previousZoom=h.zoom;const _=this.proxyToSource||{};this.proxyToSource={},m.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const v=this._style._sourceCaches;for(const S in v){const I=v[S];if(!I.used||(I!==this.sourceCache&&(this._findCoveringTileCache[I.id]={}),this._setupProxiedCoordsForOrtho(I,t[S],_),I.usedForTerrain))continue;const M=t[S];I.getSource().reparseOverscaled&&this._assignTerrainTiles(M)}this.proxiedCoords[s.id]=m.map(S=>new xa(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const b={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const I=this.terrainTileForTile[S.key];if(!I)continue;const M=I.tileID.key;M in b||(this._visibleDemTiles.push(I),b[M]=M)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],_=m.dem;!_||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),bo(this.painter,m,_))}}_prepareDemTileUniforms(t,s,h,m){if(!s||s.demTexture==null)return!1;const _=t.tileID.canonical,v=Math.pow(2,s.tileID.canonical.z-_.z),b=m||"";return h[`u_dem_tl${b}`]=[_.x*v%1,_.y*v%1],h[`u_dem_scale${b}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let t=0;const s=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const _=m.dem.tree.minimums[0];return _>0&&t++,h+_},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),m={width:1,height:1,data:new Uint8Array(a.DEMData.pack(h,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(m,{premultiply:!1}):_=this._emptyDEMTexture=new a.Texture(t,m,s.RGBA,{premultiply:!1}),_}setupElevationDraw(t,s,h){const m=this.painter.context,_=m.gl,v=(b=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(b),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var b;v.u_dem_size=this.sourceCache.getSource().tileSize,v.u_exaggeration=this.exaggeration();let S=null,I=null,M=1;if(h&&h.morphing&&this._useVertexMorphing){const D=h.morphing.srcDemTile,F=h.morphing.dstDemTile;M=h.morphing.phase,D&&F&&(this._prepareDemTileUniforms(t,D,v,"_prev")&&(I=D),this._prepareDemTileUniforms(t,F,v)&&(S=F))}if(I&&S?(m.activeTexture.set(_.TEXTURE2),S.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),m.activeTexture.set(_.TEXTURE4),I.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),v.u_dem_lerp=M):(S=this.terrainTileForTile[t.tileID.key],m.activeTexture.set(_.TEXTURE2),(this._prepareDemTileUniforms(t,S,v)?S.demTexture:this.emptyDEMTexture).bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST)),h&&h.useDepthForOcclusion&&(m.activeTexture.set(_.TEXTURE3),this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE,_.NEAREST),v.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),h&&h.useMeterToDem&&S){const D=(1<<S.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=D}h&&h.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(m,v)}renderToBackBuffer(t){const s=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),this.renderingToTexture=!1,function(m,_,v,b,S){const I=m.context,M=I.gl;let D,F;const B=m.options.showTerrainWireframe?2:0,$=(Y,ee)=>{if(F===Y)return;const oe=[Zl[Y]];ee&&oe.push(Zl[B]),D=m.useProgram("terrainRaster",null,oe),F=Y},G=m.colorModeForRenderPass(),K=new a.DepthMode(M.LEQUAL,a.DepthMode.ReadWrite,m.depthRangeFor3D);ga.update(S);const N=m.transform,Z=6*Math.pow(1.5,22-N.zoom)*_.exaggeration();(B?[!1,!0]:[!1]).forEach(Y=>{F=-1;const ee=Y?M.LINES:M.TRIANGLES,[oe,X]=Y?_.getWirefameBuffer():[_.gridIndexBuffer,_.gridSegments];for(const Ae of b){const ae=v.getTile(Ae),we=a.StencilMode.disabled,$e=_.prevTerrainTileForTile[Ae.key],qe=_.terrainTileForTile[Ae.key];Te=qe,(le=$e)!=null&&Te!=null&&le.hasData()&&Te.hasData()&&le.demTexture!=null&&Te.demTexture!=null&&le.tileID.key!==Te.tileID.key&&ga.newMorphing(Ae.key,$e,qe,S,250),I.activeTexture.set(M.TEXTURE0),ae.texture.bind(M.LINEAR,M.CLAMP_TO_EDGE,M.LINEAR_MIPMAP_NEAREST);const Ze=ga.getMorphValuesForProxy(Ae.key),Re=Ze?1:0;let He;Ze&&(He={morphing:{srcDemTile:Ze.from,dstDemTile:Ze.to,phase:a.easeCubicInOut(Ze.phase)}});const wt=Gl(Ae.projMatrix,ql(Ae.canonical,N.renderWorldCopies)?Z/10:Z);$(Re,Y),_.setupElevationDraw(ae,D,He),m.prepareDrawProgram(I,D,Ae.toUnwrapped()),D.draw(I,ee,K,we,G,a.CullFaceMode.backCCW,wt,"terrain_raster",_.gridBuffer,oe,X)}var le,Te})}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,m=this.proxySourceCache,_=this.proxiedCoords[m.id],v=this._drapedRenderBatches.shift(),b=[],S=s.style.order;let I=0;for(const M of _){const D=m.getTileByID(M.proxyTileKey),F=m.proxyCachedFBO[M.key]?m.proxyCachedFBO[M.key][t]:void 0,B=F!==void 0?m.renderCache[F]:this.pool[I++],$=F!==void 0;if(D.texture=B.tex,$&&!B.dirty){b.push(D.tileID);continue}let G;h.bindFramebuffer.set(B.fb.framebuffer),this.renderedToTile=!1,B.dirty&&(h.clear({color:a.Color.transparent}),B.dirty=!1);for(let K=v.start;K<=v.end;++K){const N=s.style._layers[S[K]];if(N.isHidden(s.transform.zoom))continue;const Z=s.style._getLayerSourceCache(N),Y=Z?this.proxyToSource[M.key][Z.id]:[M];if(!Y)continue;const ee=Y;h.viewport.set([0,0,B.fb.width,B.fb.height]),G!==(Z?Z.id:null)&&(this._setupStencil(B,Y,N,Z),G=Z?Z.id:null),s.renderLayer(s,Z,N,ee)}this.renderedToTile?(B.dirty=!0,b.push(D.tileID)):$||--I,I===5&&(I=0,this.renderToBackBuffer(b))}return this.renderToBackBuffer(b),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),v.end+1}postRender(){}renderCacheEfficiency(t){const s=t.order.length;if(s===0)return{efficiency:100};let h,m=0,_=0,v=!1;for(let b=0;b<s;++b){const S=t._layers[t.order[b]];this._style.isLayerDraped(S)?(v&&++m,++_):v||(v=!0,h=S.id)}return _===0?{efficiency:100}:{efficiency:100*(1-m/_),firstUndrapedLayer:h}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const v=_.tileID,b=Math.pow(2,v.overscaledZ),{x:S,y:I}=v.canonical,M=S/b,D=(S+1)/b,F=I/b,B=(I+1)/b;return{minx:M,miny:F,maxx:D,maxy:B,t:_.dem.tree.raycastRoot(M,F,D,B,t,s,h),tile:_}});m.sort((_,v)=>(_.t!==null?_.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const _ of m){if(_.t==null)return null;const v=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,s,h);if(v!=null)return v}return null}_createFBO(){const t=this.painter.context,s=t.gl,h=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new a.Texture(t,{width:h[0],height:h[1],data:null},s.RGBA);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const _=t.createFramebuffer(h[0],h[1],!1);return _.colorAttachment.set(m.texture),_.depthAttachment=new wr(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._layers[t],h=s.isHidden(this.painter.transform.zoom),m=s.getCrossfadeParameters(),_=!!m&&m.t!==1,v=s.hasTransition();return s.type!=="custom"&&!h&&(_||v)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s]._source instanceof $r){t=!0;break}if(t)for(let s=0;s<this._style.order.length;++s){const h=this._style._layers[this._style.order[s]],m=h.isHidden(this.painter.transform.zoom),_=this._style._getLayerSourceCache(h);if(h.type!=="raster"||m||!_)continue;const v=h.paint.get("raster-fade-duration");for(const b of this.proxyCoords){const S=this.proxyToSource[b.key][_.id];if(S)for(const I of S){const M=ju(_.getTile(I),_.findLoadedParent(I,0),_,this.painter.transform,v);(M.opacity!==1||M.mix!==0)&&this._clearRenderCacheForTile(_.id,I)}}}}_setupDrapedRenderBatches(){const t=this._style.order,s=t.length;if(s===0)return;const h=[];let m,_=0,v=this._style._layers[t[_]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++_<s;)v=this._style._layers[t[_]];for(;_<s;++_){const b=this._style._layers[t[_]];b.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(b)?m===void 0&&(m=_):m!==void 0&&(h.push({start:m,end:_-1}),m=void 0))}m!==void 0&&h.push({start:m,end:_-1}),this._drapedRenderBatches=h}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const v=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let b=0;b<v.length;++b){const S=Object.values(v[b]);s.renderCachePool.push(...S)}}return}this._clearRasterFadeFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let v=h.length-1;v>=0;v--){const b=h[v];if(s.getTileByID(b.key),s.proxyCachedFBO[b.key]!==void 0){const S=t[b.key],I=this.proxyToSource[b.key];let M=0;for(const D in I){const F=I[D],B=S[D];if(!B||B.length!==F.length||F.some(($,G)=>$!==B[G]||m[D]&&m[D].hasOwnProperty($.key))){M=-1;break}++M}for(const D in s.proxyCachedFBO[b.key])s.renderCache[s.proxyCachedFBO[b.key][D]].dirty=M<0||M!==Object.values(S).length}}const _=[...this._drapedRenderBatches];_.sort((v,b)=>b.end-b.start-(v.end-v.start));for(const v of _)for(const b of h){if(s.proxyCachedFBO[b.key])continue;let S=s.renderCachePool.pop();S===void 0&&s.renderCache.length<50&&(S=s.renderCache.length,s.renderCache.push(this._createFBO())),S!==void 0&&(s.proxyCachedFBO[b.key]={},s.proxyCachedFBO[b.key][v.start]=S,s.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,v=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let b;if(h.isTileClipped())b=s.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);b=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+b>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=b,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(t,s){const h=this.painter,m=this.painter.context,_=m.gl;h._tileClippingMaskIDs={},m.setColorMode(a.ColorMode.disabled),m.setDepthMode(a.DepthMode.disabled);const v=h.useProgram("clippingMask");for(const b of t){const S=h._tileClippingMaskIDs[b.key]=--s;v.draw(m,_.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:_.ALWAYS,mask:0},S,255,_.KEEP,_.KEEP,_.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,ya(b.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const h=[t.x,t.y,1,1];a.transformMat4(h,h,s.pixelMatrixInverse),a.scale$2(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const m=s._camera.position,_=a.mercatorZfromAltitude(1,s.center.lat),v=[m[0],m[1],m[2]/_,0],b=a.subtract([],h.slice(0,3),v);a.normalize(b,b);const S=this.raycast(v,b,this._exaggeration);return S!==null&&S?(a.scaleAndAdd(v,v,b,S),v[3]=v[2],v[2]*=_,v):null}drawDepth(){const t=this.painter,s=t.context,h=this.proxySourceCache,m=Math.ceil(t.width),_=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===m&&this._depthFBO.height===_||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const v=s.gl,b=s.createFramebuffer(m,_,!0);s.activeTexture.set(v.TEXTURE0);const S=new a.Texture(s,{width:m,height:_,data:null},v.RGBA);S.bind(v.NEAREST,v.CLAMP_TO_EDGE),b.colorAttachment.set(S.texture);const I=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,m,_);b.depthAttachment.set(I),this._depthFBO=b,this._depthTexture=S}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,m,_]),function(v,b,S,I){const M=v.context,D=M.gl;M.clear({depth:1});const F=v.useProgram("terrainDepth"),B=new a.DepthMode(D.LESS,a.DepthMode.ReadWrite,v.depthRangeFor3D);for(const $ of I){const G=S.getTile($),K=Gl($.projMatrix,0);b.setupElevationDraw(G,F),F.draw(M,D.TRIANGLES,B,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,K,"terrain_depth",b.gridBuffer,b.gridIndexBuffer,b.gridNoSkirtSegments)}}(t,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,s,h){if(t.getSource()instanceof V)return this._setupProxiedCoordsForImageSource(t,s,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let b=0;b<_.length;b++){const S=_[b],I=this._findTileCoveringTileID(S,t);if(I){const M=this._createProxiedId(S,I,h[S.key]&&h[S.key][t.id]);m.push(M),this.proxyToSource[S.key][t.id]=[M]}}let v=!1;for(let b=0;b<s.length;b++){const S=t.getTile(s[b]);if(!S||!S.hasData())continue;const I=this._findTileCoveringTileID(S.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==S.tileID.canonical.z){const M=this.proxyToSource[I.tileID.key][t.id],D=this._createProxiedId(I.tileID,S,h[I.tileID.key]&&h[I.tileID.key][t.id]);M?M.splice(M.length-1,0,D):this.proxyToSource[I.tileID.key][t.id]=[D],m.push(D),v=!0}}this._sourceTilesOverlap[t.id]=v}_setupProxiedCoordsForImageSource(t,s,h){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],_=this.proxyCoords,v=t.getSource(),b=new a.pointGeometry(v.tileID.x,v.tileID.y)._div(1<<v.tileID.z),S=v.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((M,D)=>(M.min.x=Math.min(M.min.x,D.x-b.x),M.min.y=Math.min(M.min.y,D.y-b.y),M.max.x=Math.max(M.max.x,D.x-b.x),M.max.y=Math.max(M.max.y,D.y-b.y),M),{min:new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(M,D)=>{const F=M.wrap+M.canonical.x/(1<<M.canonical.z),B=M.canonical.y/(1<<M.canonical.z),$=a.EXTENT/(1<<M.canonical.z),G=D.wrap+D.canonical.x/(1<<D.canonical.z),K=D.canonical.y/(1<<D.canonical.z);return F+$<G+S.min.x||F>G+S.max.x||B+$<K+S.min.y||B>K+S.max.y};for(let M=0;M<_.length;M++){const D=_[M];for(let F=0;F<s.length;F++){const B=t.getTile(s[F]);if(!B||!B.hasData()||I(D,B.tileID))continue;const $=this._createProxiedId(D,B,h[D.key]&&h[D.key][t.id]),G=this.proxyToSource[D.key][t.id];G?G.push($):this.proxyToSource[D.key][t.id]=[$],m.push($)}}}_createProxiedId(t,s,h){let m=this.orthoMatrix;if(h){const _=h.find(v=>v.key===s.tileID.key);if(_)return _}if(s.tileID.key!==t.key){const _=t.canonical.z-s.tileID.canonical.z;let v,b,S;m=a.create$1();const I=s.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(v=a.EXTENT>>_,b=v*((s.tileID.canonical.x<<_)-t.canonical.x+I),S=v*((s.tileID.canonical.y<<_)-t.canonical.y)):(v=a.EXTENT<<-_,b=a.EXTENT*(s.tileID.canonical.x-(t.canonical.x+I<<-_)),S=a.EXTENT*(s.tileID.canonical.y-(t.canonical.y<<-_))),a.ortho(m,0,v,0,v,0,1),a.translate(m,m,[b,S,0])}return new xa(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let h=s.getTile(t);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[s.id],_=m[t.key];if(h=_?s.getTileByID(_):null,h&&h.hasData()||_===null)return h;let v=h?h.tileID:t,b=v.overscaledZ;const S=s.getSource().minzoom,I=[];if(!_){const D=s.getSource().maxzoom;if(t.canonical.z>=D){const F=t.canonical.z-D;s.getSource().reparseOverscaled?(b=Math.max(t.canonical.z+2,s.transform.tileZoom),v=new a.OverscaledTileID(b,t.wrap,D,t.canonical.x>>F,t.canonical.y>>F)):F!==0&&(b=D,v=new a.OverscaledTileID(b,t.wrap,D,t.canonical.x>>F,t.canonical.y>>F))}v.key!==t.key&&(I.push(v.key),h=s.getTile(v))}const M=D=>{I.forEach(F=>{m[F]=D}),I.length=0};for(b-=1;b>=S&&(!h||!h.hasData());b--){h&&M(h.tileID.key);const D=v.calculateScaledKey(b);if(h=s.getTileByID(D),h&&h.hasData())break;const F=m[D];if(F===null)break;F===void 0?I.push(D):h=s.getTileByID(F)}return M(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(t){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[s.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const t=function(s){let h,m,_;const v=new a.StructArrayLayout2ui4,b=131;for(m=1;m<129;m++){for(h=1;h<129;h++)_=m*b+h,v.emplaceBack(_,_+1),v.emplaceBack(_,_+b),v.emplaceBack(_+1,_+b),m===128&&v.emplaceBack(_+b,_+b+1);v.emplaceBack(_+1,_+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(t),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,t.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function va(u){const t=[];for(let s=0;s<u.length;s++){if(u[s]===null)continue;const h=u[s].split(" ");t.push(h.pop())}return t}class wa{static cacheKey(t,s,h){let m=`${t}${h?h.cacheKey:""}`;for(const _ of s)m+=`/${_}`;return m}constructor(t,s,h,m,_,v){const b=t.gl;this.program=b.createProgram();const S=va(h.staticAttributes),I=m?m.getBinderAttributes():[],M=S.concat(I),D=h.staticUniforms?va(h.staticUniforms):[],F=m?m.getBinderUniforms():[],B=D.concat(F),$=[];for(const oe of B)$.indexOf(oe)<0&&$.push(oe);let G=m?m.defines():[];G=G.concat(v.map(oe=>`#define ${oe}`));const K=G.concat(ws.fragmentSource,wo,Ln.fragmentSource,h.fragmentSource).join(`
`),N=G.concat(ws.vertexSource,wo,Ln.vertexSource,vs.vertexSource,h.vertexSource).join(`
`),Z=b.createShader(b.FRAGMENT_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(Z,K),b.compileShader(Z),b.attachShader(this.program,Z);const Y=b.createShader(b.VERTEX_SHADER);if(b.isContextLost())return void(this.failedToCreate=!0);b.shaderSource(Y,N),b.compileShader(Y),b.attachShader(this.program,Y),this.attributes={};const ee={};this.numAttributes=M.length;for(let oe=0;oe<this.numAttributes;oe++)M[oe]&&(b.bindAttribLocation(this.program,oe,M[oe]),this.attributes[M[oe]]=oe);b.linkProgram(this.program),b.deleteShader(Y),b.deleteShader(Z);for(let oe=0;oe<$.length;oe++){const X=$[oe];if(X&&!ee[X]){const le=b.getUniformLocation(this.program,X);le&&(ee[X]=le)}}this.fixedUniforms=_(t,ee),this.binderUniforms=m?m.getUniforms(t,ee):[],v.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((oe,X)=>({u_dem:new a.Uniform1i(oe,X.u_dem),u_dem_prev:new a.Uniform1i(oe,X.u_dem_prev),u_dem_unpack:new a.Uniform4f(oe,X.u_dem_unpack),u_dem_tl:new a.Uniform2f(oe,X.u_dem_tl),u_dem_scale:new a.Uniform1f(oe,X.u_dem_scale),u_dem_tl_prev:new a.Uniform2f(oe,X.u_dem_tl_prev),u_dem_scale_prev:new a.Uniform1f(oe,X.u_dem_scale_prev),u_dem_size:new a.Uniform1f(oe,X.u_dem_size),u_dem_lerp:new a.Uniform1f(oe,X.u_dem_lerp),u_exaggeration:new a.Uniform1f(oe,X.u_exaggeration),u_depth:new a.Uniform1i(oe,X.u_depth),u_depth_size_inv:new a.Uniform2f(oe,X.u_depth_size_inv),u_meter_to_dem:new a.Uniform1f(oe,X.u_meter_to_dem),u_label_plane_matrix_inv:new a.UniformMatrix4f(oe,X.u_label_plane_matrix_inv),u_tile_tl_up:new a.Uniform3f(oe,X.u_tile_tl_up),u_tile_tr_up:new a.Uniform3f(oe,X.u_tile_tr_up),u_tile_br_up:new a.Uniform3f(oe,X.u_tile_br_up),u_tile_bl_up:new a.Uniform3f(oe,X.u_tile_bl_up),u_tile_up_scale:new a.Uniform1f(oe,X.u_tile_up_scale)}))(t,ee)),v.indexOf("FOG")!==-1&&(this.fogUniforms=((oe,X)=>({u_fog_matrix:new a.UniformMatrix4f(oe,X.u_fog_matrix),u_fog_range:new a.Uniform2f(oe,X.u_fog_range),u_fog_color:new a.Uniform4f(oe,X.u_fog_color),u_fog_horizon_blend:new a.Uniform1f(oe,X.u_fog_horizon_blend),u_fog_temporal_offset:new a.Uniform1f(oe,X.u_fog_temporal_offset)}))(t,ee))}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].location&&h[m].set(s[m])}}draw(t,s,h,m,_,v,b,S,I,M,D,F,B,$,G,K){const N=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(h),t.setStencilMode(m),t.setColorMode(_),t.setCullFace(v);for(const Y in this.fixedUniforms)this.fixedUniforms[Y].set(b[Y]);$&&$.setUniforms(t,this.binderUniforms,F,{zoom:B});const Z={[N.LINES]:2,[N.TRIANGLES]:3,[N.LINE_STRIP]:1}[s];for(const Y of D.get()){const ee=Y.vaos||(Y.vaos={});(ee[S]||(ee[S]=new ma)).bind(t,this,I,$?$.getPaintVertexBuffers():[],M,Y.vertexOffset,G,K),N.drawElements(s,Y.primitiveLength*Z,N.UNSIGNED_SHORT,Y.primitiveOffset*Z*2)}}}function Xl(u,t,s){const h=1/Gt(s,1,t.transform.tileZoom),m=Math.pow(2,s.tileID.overscaledZ),_=s.tileSize*Math.pow(2,t.transform.tileZoom)/m,v=_*(s.tileID.canonical.x+s.tileID.wrap*m),b=_*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[h,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}const Hl=(u,t,s,h)=>{const m=t.style.light,_=m.properties.get("position"),v=[_.x,_.y,_.z],b=a.create$2();m.properties.get("anchor")==="viewport"&&(a.fromRotation(b,-t.transform.angle),a.transformMat3(v,v,b));const S=m.properties.get("color");return{u_matrix:u,u_lightpos:v,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+s,u_opacity:h}},cp=(u,t,s,h,m,_,v)=>a.extend(Hl(u,t,s,h),Xl(_,t,v),{u_height_factor:-Math.pow(2,m.overscaledZ)/v.tileSize/8}),To=u=>({u_matrix:u}),Eo=(u,t,s,h)=>a.extend(To(u),Xl(s,t,h)),$u=(u,t)=>({u_matrix:u,u_world:t}),cn=(u,t,s,h,m)=>a.extend(Eo(u,t,s,h),{u_world:m}),Yl=(u,t,s,h)=>{const m=u.transform;let _;if(h.paint.get("circle-pitch-alignment")==="map"){const v=Gt(s,1,m.zoom);_=[v,v]}else _=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_matrix:u.translatePosMatrix(t.projMatrix,s,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:_}},ba=u=>{const t=[];return u.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),u.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t},Ta=(u,t,s)=>{const h=a.EXTENT/s.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.cameraToCenterDistance,u_extrude_scale:[t.pixelsToGLUnits[0]/h,t.pixelsToGLUnits[1]/h]}},Ea=(u,t,s=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:s}),Kl=(u,t,s,h)=>({u_matrix:u,u_extrude_scale:Gt(t,1,s),u_intensity:h}),Sa=(u,t,s,h,m,_)=>{const v=u.transform,b={u_matrix:Ts(u,t,s,m),u_ratio:1/Gt(t,1,v.zoom),u_device_pixel_ratio:a.exported.devicePixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:_,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(Jl(s)){const S=Ca(t,u.transform);b.u_texsize=t.lineAtlasTexture.size,b.u_scale=[S,h.fromScale,h.toScale],b.u_mix=h.t}return b},Ql=(u,t,s,h,m)=>{const _=u.transform,v=Ca(t,_);return{u_matrix:Ts(u,t,s,m),u_texsize:t.imageAtlasTexture.size,u_ratio:1/Gt(t,1,_.zoom),u_device_pixel_ratio:a.exported.devicePixelRatio,u_image:0,u_scale:[v,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}};function Ca(u,t){return 1/Gt(u,1,t.tileZoom)}function Ts(u,t,s,h){return u.translatePosMatrix(h||t.tileID.projMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Gu=u=>{const t=[];return Jl(u)&&t.push("RENDER_LINE_DASH"),u.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT"),t};function Jl(u){const t=u.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}const So=(u,t,s,h,m)=>{return{u_matrix:u,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(v=m.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(_=m.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:up(m.paint.get("raster-hue-rotate"))};var _,v};function up(u){u*=Math.PI/180;const t=Math.sin(u),s=Math.cos(u);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Zu=(u,t,s,h,m,_,v,b,S,I)=>{const M=m.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:M.cameraToCenterDistance,u_pitch:M.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:M.width/M.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:v,u_coord_matrix:b,u_is_text:+S,u_pitch_with_map:+h,u_texsize:I,u_texture:0}},qu=(u,t,s,h,m,_,v,b,S,I,M)=>{const{cameraToCenterDistance:D,_pitch:F}=m.transform;return a.extend(Zu(u,t,s,h,m,_,v,b,S,I),{u_gamma_scale:h?D*Math.cos(m.terrain?0:F):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+M})},hp=(u,t,s,h,m,_,v,b,S,I)=>a.extend(qu(u,t,s,h,m,_,v,b,!0,S,!0),{u_texsize_icon:I,u_texture_icon:1}),dp=(u,t,s)=>({u_matrix:u,u_opacity:t,u_color:s}),pp=(u,t,s,h,m,_)=>a.extend(function(v,b,S,I){const M=S.imageManager.getPattern(v.from.toString()),D=S.imageManager.getPattern(v.to.toString()),{width:F,height:B}=S.imageManager.getPixelSize(),$=Math.pow(2,I.tileID.overscaledZ),G=I.tileSize*Math.pow(2,S.transform.tileZoom)/$,K=G*(I.tileID.canonical.x+I.tileID.wrap*$),N=G*I.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:M.tl,u_pattern_br_a:M.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[F,B],u_mix:b.t,u_pattern_size_a:M.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:b.fromScale,u_scale_b:b.toScale,u_tile_units_to_pixels:1/Gt(I,1,S.transform.tileZoom),u_pixel_coord_upper:[K>>16,N>>16],u_pixel_coord_lower:[65535&K,65535&N]}}(h,_,s,m),{u_matrix:u,u_opacity:t}),ec={fillExtrusion:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_lightpos:new a.Uniform3f(u,t.u_lightpos),u_lightintensity:new a.Uniform1f(u,t.u_lightintensity),u_lightcolor:new a.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(u,t.u_vertical_gradient),u_opacity:new a.Uniform1f(u,t.u_opacity)}),fillExtrusionPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_lightpos:new a.Uniform3f(u,t.u_lightpos),u_lightintensity:new a.Uniform1f(u,t.u_lightintensity),u_lightcolor:new a.Uniform3f(u,t.u_lightcolor),u_vertical_gradient:new a.Uniform1f(u,t.u_vertical_gradient),u_height_factor:new a.Uniform1f(u,t.u_height_factor),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade),u_opacity:new a.Uniform1f(u,t.u_opacity)}),fill:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),fillPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),fillOutline:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_world:new a.Uniform2f(u,t.u_world)}),fillOutlinePattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_world:new a.Uniform2f(u,t.u_world),u_image:new a.Uniform1i(u,t.u_image),u_texsize:new a.Uniform2f(u,t.u_texsize),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),circle:(u,t)=>({u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_extrude_scale:new a.Uniform2f(u,t.u_extrude_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),collisionBox:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_extrude_scale:new a.Uniform2f(u,t.u_extrude_scale)}),collisionCircle:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_inv_matrix:new a.UniformMatrix4f(u,t.u_inv_matrix),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_viewport_size:new a.Uniform2f(u,t.u_viewport_size)}),debug:(u,t)=>({u_color:new a.UniformColor(u,t.u_color),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_overlay:new a.Uniform1i(u,t.u_overlay),u_overlay_scale:new a.Uniform1f(u,t.u_overlay_scale)}),clippingMask:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),heatmap:(u,t)=>({u_extrude_scale:new a.Uniform1f(u,t.u_extrude_scale),u_intensity:new a.Uniform1f(u,t.u_intensity),u_matrix:new a.UniformMatrix4f(u,t.u_matrix)}),heatmapTexture:(u,t)=>({u_image:new a.Uniform1i(u,t.u_image),u_color_ramp:new a.Uniform1i(u,t.u_color_ramp),u_opacity:new a.Uniform1f(u,t.u_opacity)}),hillshade:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_latrange:new a.Uniform2f(u,t.u_latrange),u_light:new a.Uniform2f(u,t.u_light),u_shadow:new a.UniformColor(u,t.u_shadow),u_highlight:new a.UniformColor(u,t.u_highlight),u_accent:new a.UniformColor(u,t.u_accent)}),hillshadePrepare:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_image:new a.Uniform1i(u,t.u_image),u_dimension:new a.Uniform2f(u,t.u_dimension),u_zoom:new a.Uniform1f(u,t.u_zoom),u_unpack:new a.Uniform4f(u,t.u_unpack)}),line:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_ratio:new a.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels),u_dash_image:new a.Uniform1i(u,t.u_dash_image),u_gradient_image:new a.Uniform1i(u,t.u_gradient_image),u_image_height:new a.Uniform1f(u,t.u_image_height),u_texsize:new a.Uniform2f(u,t.u_texsize),u_scale:new a.Uniform3f(u,t.u_scale),u_mix:new a.Uniform1f(u,t.u_mix)}),linePattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_texsize:new a.Uniform2f(u,t.u_texsize),u_ratio:new a.Uniform1f(u,t.u_ratio),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_image:new a.Uniform1i(u,t.u_image),u_units_to_pixels:new a.Uniform2f(u,t.u_units_to_pixels),u_scale:new a.Uniform3f(u,t.u_scale),u_fade:new a.Uniform1f(u,t.u_fade)}),raster:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_tl_parent:new a.Uniform2f(u,t.u_tl_parent),u_scale_parent:new a.Uniform1f(u,t.u_scale_parent),u_buffer_scale:new a.Uniform1f(u,t.u_buffer_scale),u_fade_t:new a.Uniform1f(u,t.u_fade_t),u_opacity:new a.Uniform1f(u,t.u_opacity),u_image0:new a.Uniform1i(u,t.u_image0),u_image1:new a.Uniform1i(u,t.u_image1),u_brightness_low:new a.Uniform1f(u,t.u_brightness_low),u_brightness_high:new a.Uniform1f(u,t.u_brightness_high),u_saturation_factor:new a.Uniform1f(u,t.u_saturation_factor),u_contrast_factor:new a.Uniform1f(u,t.u_contrast_factor),u_spin_weights:new a.Uniform3f(u,t.u_spin_weights)}),symbolIcon:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texture:new a.Uniform1i(u,t.u_texture)}),symbolSDF:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texture:new a.Uniform1i(u,t.u_texture),u_gamma_scale:new a.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(u,t.u_is_halo)}),symbolTextAndIcon:(u,t)=>({u_is_size_zoom_constant:new a.Uniform1i(u,t.u_is_size_zoom_constant),u_is_size_feature_constant:new a.Uniform1i(u,t.u_is_size_feature_constant),u_size_t:new a.Uniform1f(u,t.u_size_t),u_size:new a.Uniform1f(u,t.u_size),u_camera_to_center_distance:new a.Uniform1f(u,t.u_camera_to_center_distance),u_pitch:new a.Uniform1f(u,t.u_pitch),u_rotate_symbol:new a.Uniform1i(u,t.u_rotate_symbol),u_aspect_ratio:new a.Uniform1f(u,t.u_aspect_ratio),u_fade_change:new a.Uniform1f(u,t.u_fade_change),u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_label_plane_matrix:new a.UniformMatrix4f(u,t.u_label_plane_matrix),u_coord_matrix:new a.UniformMatrix4f(u,t.u_coord_matrix),u_is_text:new a.Uniform1i(u,t.u_is_text),u_pitch_with_map:new a.Uniform1i(u,t.u_pitch_with_map),u_texsize:new a.Uniform2f(u,t.u_texsize),u_texsize_icon:new a.Uniform2f(u,t.u_texsize_icon),u_texture:new a.Uniform1i(u,t.u_texture),u_texture_icon:new a.Uniform1i(u,t.u_texture_icon),u_gamma_scale:new a.Uniform1f(u,t.u_gamma_scale),u_device_pixel_ratio:new a.Uniform1f(u,t.u_device_pixel_ratio),u_is_halo:new a.Uniform1i(u,t.u_is_halo)}),background:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_opacity:new a.Uniform1f(u,t.u_opacity),u_color:new a.UniformColor(u,t.u_color)}),backgroundPattern:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_opacity:new a.Uniform1f(u,t.u_opacity),u_image:new a.Uniform1i(u,t.u_image),u_pattern_tl_a:new a.Uniform2f(u,t.u_pattern_tl_a),u_pattern_br_a:new a.Uniform2f(u,t.u_pattern_br_a),u_pattern_tl_b:new a.Uniform2f(u,t.u_pattern_tl_b),u_pattern_br_b:new a.Uniform2f(u,t.u_pattern_br_b),u_texsize:new a.Uniform2f(u,t.u_texsize),u_mix:new a.Uniform1f(u,t.u_mix),u_pattern_size_a:new a.Uniform2f(u,t.u_pattern_size_a),u_pattern_size_b:new a.Uniform2f(u,t.u_pattern_size_b),u_scale_a:new a.Uniform1f(u,t.u_scale_a),u_scale_b:new a.Uniform1f(u,t.u_scale_b),u_pixel_coord_upper:new a.Uniform2f(u,t.u_pixel_coord_upper),u_pixel_coord_lower:new a.Uniform2f(u,t.u_pixel_coord_lower),u_tile_units_to_pixels:new a.Uniform1f(u,t.u_tile_units_to_pixels)}),terrainRaster:bs,terrainDepth:bs,skybox:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_sun_direction:new a.Uniform3f(u,t.u_sun_direction),u_cubemap:new a.Uniform1i(u,t.u_cubemap),u_opacity:new a.Uniform1f(u,t.u_opacity),u_temporal_offset:new a.Uniform1f(u,t.u_temporal_offset)}),skyboxGradient:(u,t)=>({u_matrix:new a.UniformMatrix4f(u,t.u_matrix),u_color_ramp:new a.Uniform1i(u,t.u_color_ramp),u_center_direction:new a.Uniform3f(u,t.u_center_direction),u_radius:new a.Uniform1f(u,t.u_radius),u_opacity:new a.Uniform1f(u,t.u_opacity),u_temporal_offset:new a.Uniform1f(u,t.u_temporal_offset)}),skyboxCapture:(u,t)=>({u_matrix_3f:new a.UniformMatrix3f(u,t.u_matrix_3f),u_sun_direction:new a.Uniform3f(u,t.u_sun_direction),u_sun_intensity:new a.Uniform1f(u,t.u_sun_intensity),u_color_tint_r:new a.Uniform4f(u,t.u_color_tint_r),u_color_tint_m:new a.Uniform4f(u,t.u_color_tint_m),u_luminance:new a.Uniform1f(u,t.u_luminance)})};let Co;function Zr(u,t,s,h,m,_,v){const b=u.context,S=b.gl,I=u.useProgram("collisionBox"),M=[];let D=0,F=0;for(let Y=0;Y<h.length;Y++){const ee=h[Y],oe=t.getTile(ee),X=oe.getBucket(s);if(!X)continue;let le=ee.projMatrix;m[0]===0&&m[1]===0||(le=u.translatePosMatrix(ee.projMatrix,oe,m,_));const Te=v?X.textCollisionBox:X.iconCollisionBox,Ae=X.collisionCircleArray;if(Ae.length>0){const ae=a.create$1(),we=le;a.mul$1(ae,X.placementInvProjMatrix,u.transform.glCoordMatrix),a.mul$1(ae,ae,X.placementViewportMatrix),M.push({circleArray:Ae,circleOffset:F,transform:we,invTransform:ae}),D+=Ae.length/4,F=D}Te&&(u.terrain&&u.terrain.setupElevationDraw(oe,I),I.draw(b,S.LINES,a.DepthMode.disabled,a.StencilMode.disabled,u.colorModeForRenderPass(),a.CullFaceMode.disabled,Ta(le,u.transform,oe),s.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,u.transform.zoom,null,Te.collisionVertexBuffer,Te.collisionVertexBufferExt))}if(!v||!M.length)return;const B=u.useProgram("collisionCircle"),$=new a.StructArrayLayout2f1f2i16;$.resize(4*D),$._trim();let G=0;for(const Y of M)for(let ee=0;ee<Y.circleArray.length/4;ee++){const oe=4*ee,X=Y.circleArray[oe+0],le=Y.circleArray[oe+1],Te=Y.circleArray[oe+2],Ae=Y.circleArray[oe+3];$.emplace(G++,X,le,Te,Ae,0),$.emplace(G++,X,le,Te,Ae,1),$.emplace(G++,X,le,Te,Ae,2),$.emplace(G++,X,le,Te,Ae,3)}(!Co||Co.length<2*D)&&(Co=function(Y){const ee=2*Y,oe=new a.StructArrayLayout3ui6;oe.resize(ee),oe._trim();for(let X=0;X<ee;X++){const le=6*X;oe.uint16[le+0]=4*X+0,oe.uint16[le+1]=4*X+1,oe.uint16[le+2]=4*X+2,oe.uint16[le+3]=4*X+2,oe.uint16[le+4]=4*X+3,oe.uint16[le+5]=4*X+0}return oe}(D));const K=b.createIndexBuffer(Co,!0),N=b.createVertexBuffer($,a.collisionCircleLayout.members,!0);for(const Y of M){const ee={u_matrix:Y.transform,u_inv_matrix:Y.invTransform,u_camera_to_center_distance:(Z=u.transform).cameraToCenterDistance,u_viewport_size:[Z.width,Z.height]};B.draw(b,S.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,u.colorModeForRenderPass(),a.CullFaceMode.disabled,ee,s.id,N,K,a.SegmentVector.simpleSegment(0,2*Y.circleOffset,Y.circleArray.length,Y.circleArray.length/2),null,u.transform.zoom,null,null,null)}var Z;N.destroy(),K.destroy()}const tc=a.identity(new Float32Array(16));function Wu(u,t,s,h,m,_){const{horizontalAlign:v,verticalAlign:b}=a.getAnchorAlignment(u),S=-(v-.5)*t,I=-(b-.5)*s,M=a.evaluateVariableOffset(u,h);return new a.pointGeometry((S/m+M[0])*_,(I/m+M[1])*_)}function ic(u,t,s,h,m,_,v,b,S,I,M,D){const F=u.text.placedSymbolArray,B=u.text.dynamicLayoutVertexArray,$=u.icon.dynamicLayoutVertexArray,G={};B.clear();for(let K=0;K<F.length;K++){const N=F.get(K),Z=u.allowVerticalPlacement&&!N.placedOrientation,Y=N.hidden||!N.crossTileID||Z?null:h[N.crossTileID];if(Y){const ee=new a.pointGeometry(N.tileAnchorX,N.tileAnchorY),oe=D(ee),X=Ei(ee,s?b:v,oe),le=xt(_.cameraToCenterDistance,X.signedDistanceFromCamera);let Te=m.evaluateSizeForFeature(u.textSizeData,I,N)*le/a.ONE_EM;s&&(Te*=u.tilePixelRatio/S);const{width:Ae,height:ae,anchor:we,textOffset:$e,textScale:qe}=Y,Ze=Wu(we,Ae,ae,$e,qe,Te),Re=s?Ei(ee.add(Ze),v,oe).point:X.point.add(t?Ze.rotate(-_.angle):Ze),He=u.allowVerticalPlacement&&N.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let wt=0;wt<N.numGlyphs;wt++)a.addDynamicAttributes(B,Re,He);M&&N.associatedIconIndex>=0&&(G[N.associatedIconIndex]={shiftedAnchor:Re,angle:He})}else nr(N.numGlyphs,B)}if(M){$.clear();const K=u.icon.placedSymbolArray;for(let N=0;N<K.length;N++){const Z=K.get(N);if(Z.hidden)nr(Z.numGlyphs,$);else{const Y=G[N];if(Y)for(let ee=0;ee<Z.numGlyphs;ee++)a.addDynamicAttributes($,Y.shiftedAnchor,Y.angle);else nr(Z.numGlyphs,$)}}u.icon.dynamicLayoutVertexBuffer.updateData($)}u.text.dynamicLayoutVertexBuffer.updateData(B)}function qr(u,t,s){return s.iconsInText&&t?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function nc(u,t,s,h,m,_,v,b,S,I,M,D){const F=u.context,B=F.gl,$=u.transform,G=b==="map",K=S==="map",N=G&&s.layout.get("symbol-placement")!=="point",Z=G&&!K&&!N,Y=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ee=!1;const oe=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),X=s.layout.get("text-variable-anchor"),le=[],Te=u.terrain&&K?["PITCH_WITH_MAP_TERRAIN"]:null;for(const Ae of h){const ae=t.getTile(Ae),we=ae.getBucket(s);if(!we)continue;const $e=m?we.text:we.icon;if(!$e||!$e.segments.get().length)continue;const qe=$e.programConfigurations.get(s.id),Ze=m||we.sdfIcons,Re=m?we.textSizeData:we.iconSizeData,He=K||$.pitch!==0,wt=u.useProgram(qr(Ze,m,we),qe,Te),ct=a.evaluateSizeForZoom(Re,$.zoom);let ti,Xt,pt,bt,Kt=[0,0],yn=null;if(m){if(Xt=ae.glyphAtlasTexture,pt=B.LINEAR,ti=ae.glyphAtlasTexture.size,we.iconsInText){Kt=ae.imageAtlasTexture.size,yn=ae.imageAtlasTexture;const xn=Re.kind==="composite"||Re.kind==="camera";bt=He||u.options.rotating||u.options.zooming||xn?B.LINEAR:B.NEAREST}}else{const xn=s.layout.get("icon-size").constantOr(0)!==1||we.iconsNeedLinear;Xt=ae.imageAtlasTexture,pt=Ze||u.options.rotating||u.options.zooming||xn||He?B.LINEAR:B.NEAREST,ti=ae.imageAtlasTexture.size}const Gn=Gt(ae,1,u.transform.zoom),Ri=mt(Ae.projMatrix,K,G,u.transform,Gn),Wi=u.terrain&&K&&N?a.invert(new Float32Array(16),Ri):tc,Zn=zn(Ae.projMatrix,K,G,u.transform,Gn),ar=X&&we.hasTextData(),Nt=s.layout.get("icon-text-fit")!=="none"&&ar&&we.hasIconData();if(N){const xn=$.elevation;_s(we,Ae.projMatrix,u,m,Ri,Zn,K,I,xn?qn=>xn.getAtTileOffset(Ae,qn.x,qn.y):null)}const Qt=u.translatePosMatrix(Ae.projMatrix,ae,_,v),Pt=N||m&&X||Nt?tc:Ri,ii=u.translatePosMatrix(Zn,ae,_,v,!0),Xi=Ze&&s.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qt;qt=Ze?we.iconsInText?hp(Re.kind,ct,Z,K,u,Qt,Pt,ii,ti,Kt):qu(Re.kind,ct,Z,K,u,Qt,Pt,ii,m,ti,!0):Zu(Re.kind,ct,Z,K,u,Qt,Pt,ii,m,ti);const Ci={program:wt,buffers:$e,uniformValues:qt,atlasTexture:Xt,atlasTextureIcon:yn,atlasInterpolation:pt,atlasInterpolationIcon:bt,isSDF:Ze,hasHalo:Xi,tile:ae,labelPlaneMatrixInv:Wi};if(Y&&we.canOverlap){ee=!0;const xn=$e.segments.get();for(const qn of xn)le.push({segments:new a.SegmentVector([qn]),sortKey:qn.sortKey,state:Ci})}else le.push({segments:$e.segments,sortKey:0,state:Ci})}ee&&le.sort((Ae,ae)=>Ae.sortKey-ae.sortKey);for(const Ae of le){const ae=Ae.state;if(u.terrain&&u.terrain.setupElevationDraw(ae.tile,ae.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:ae.labelPlaneMatrixInv}),F.activeTexture.set(B.TEXTURE0),ae.atlasTexture.bind(ae.atlasInterpolation,B.CLAMP_TO_EDGE),ae.atlasTextureIcon&&(F.activeTexture.set(B.TEXTURE1),ae.atlasTextureIcon&&ae.atlasTextureIcon.bind(ae.atlasInterpolationIcon,B.CLAMP_TO_EDGE)),ae.isSDF){const we=ae.uniformValues;ae.hasHalo&&(we.u_is_halo=1,Wr(ae.buffers,Ae.segments,s,u,ae.program,oe,M,D,we)),we.u_is_halo=0}Wr(ae.buffers,Ae.segments,s,u,ae.program,oe,M,D,ae.uniformValues)}}function Wr(u,t,s,h,m,_,v,b,S){const I=h.context;m.draw(I,I.gl.TRIANGLES,_,v,b,a.CullFaceMode.disabled,S,s.id,u.layoutVertexBuffer,u.indexBuffer,t,s.paint,h.transform.zoom,u.programConfigurations.get(s.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function Xr(u,t,s,h,m,_,v){const b=u.context.gl,S=s.paint.get("fill-pattern"),I=S&&S.constantOr(1),M=s.getCrossfadeParameters();let D,F,B,$,G;v?(F=I&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=b.LINES):(F=I?"fillPattern":"fill",D=b.TRIANGLES);for(const K of h){const N=t.getTile(K);if(I&&!N.patternsLoaded())continue;const Z=N.getBucket(s);if(!Z)continue;u.prepareDrawTile(K);const Y=Z.programConfigurations.get(s.id),ee=u.useProgram(F,Y);I&&(u.context.activeTexture.set(b.TEXTURE0),N.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),Y.updatePaintBuffers(M));const oe=S.constantOr(null);if(oe&&N.imageAtlas){const le=N.imageAtlas,Te=le.patternPositions[oe.to.toString()],Ae=le.patternPositions[oe.from.toString()];Te&&Ae&&Y.setConstantPatternPositions(Te,Ae)}const X=u.translatePosMatrix(K.projMatrix,N,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(v){$=Z.indexBuffer2,G=Z.segments2;const le=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[b.drawingBufferWidth,b.drawingBufferHeight];B=F==="fillOutlinePattern"&&I?cn(X,u,M,N,le):$u(X,le)}else $=Z.indexBuffer,G=Z.segments,B=I?Eo(X,u,M,N):To(X);u.prepareDrawProgram(u.context,ee,K.toUnwrapped()),ee.draw(u.context,D,m,u.stencilModeForClipping(K),_,a.CullFaceMode.disabled,B,s.id,Z.layoutVertexBuffer,$,G,s.paint,u.transform.zoom,Y)}}function ka(u,t,s,h,m,_,v){const b=u.context,S=b.gl,I=s.paint.get("fill-extrusion-pattern"),M=I.constantOr(1),D=s.getCrossfadeParameters(),F=s.paint.get("fill-extrusion-opacity");for(const B of h){const $=t.getTile(B),G=$.getBucket(s);if(!G)continue;const K=G.programConfigurations.get(s.id),N=u.useProgram(M?"fillExtrusionPattern":"fillExtrusion",K);if(u.terrain){const X=u.terrain;if(!G.enableTerrain)continue;if(X.setupElevationDraw($,N,{useMeterToDem:!0}),rc(b,t,B,G,s,X),!G.centroidVertexBuffer){const le=N.attributes.a_centroid_pos;le!==void 0&&S.vertexAttrib2f(le,0,0)}}M&&(u.context.activeTexture.set(S.TEXTURE0),$.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),K.updatePaintBuffers(D));const Z=I.constantOr(null);if(Z&&$.imageAtlas){const X=$.imageAtlas,le=X.patternPositions[Z.to.toString()],Te=X.patternPositions[Z.from.toString()];le&&Te&&K.setConstantPatternPositions(le,Te)}const Y=u.translatePosMatrix(B.projMatrix,$,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),ee=s.paint.get("fill-extrusion-vertical-gradient"),oe=M?cp(Y,u,ee,F,B,D,$):Hl(Y,u,ee,F);u.prepareDrawProgram(b,N,B.toUnwrapped()),N.draw(b,b.gl.TRIANGLES,m,_,v,a.CullFaceMode.backCCW,oe,s.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,s.paint,u.transform.zoom,K,u.terrain?G.centroidVertexBuffer:null)}}function rc(u,t,s,h,m,_){const v=[N=>{let Z=N.canonical.x-1,Y=N.wrap;return Z<0&&(Z=(1<<N.canonical.z)-1,Y--),new a.OverscaledTileID(N.overscaledZ,Y,N.canonical.z,Z,N.canonical.y)},N=>{let Z=N.canonical.x+1,Y=N.wrap;return Z===1<<N.canonical.z&&(Z=0,Y++),new a.OverscaledTileID(N.overscaledZ,Y,N.canonical.z,Z,N.canonical.y)},N=>new a.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,(N.canonical.y===0?1<<N.canonical.z:N.canonical.y)-1),N=>new a.OverscaledTileID(N.overscaledZ,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y===(1<<N.canonical.z)-1?0:N.canonical.y+1)],b=N=>{const Z=t.getSource().maxzoom,Y=le=>{const Te=t.getTileByID(le);if(Te&&Te.hasData())return Te.getBucket(m)};let ee,oe,X;return(N.overscaledZ===N.canonical.z||N.overscaledZ>=Z)&&(ee=Y(N.key)),N.overscaledZ>=Z&&(oe=Y(N.calculateScaledKey(N.overscaledZ+1))),N.overscaledZ>Z&&(X=Y(N.calculateScaledKey(N.overscaledZ-1))),ee||oe||X},S=[0,0,0],I=(N,Z)=>(S[0]=Math.min(N.min.y,Z.min.y),S[1]=Math.max(N.max.y,Z.max.y),S[2]=a.EXTENT-Z.min.x>N.max.x?Z.min.x-a.EXTENT:N.max.x,S),M=(N,Z)=>(S[0]=Math.min(N.min.x,Z.min.x),S[1]=Math.max(N.max.x,Z.max.x),S[2]=a.EXTENT-Z.min.y>N.max.y?Z.min.y-a.EXTENT:N.max.y,S),D=[(N,Z)=>I(N,Z),(N,Z)=>I(Z,N),(N,Z)=>M(N,Z),(N,Z)=>M(Z,N)],F=new a.pointGeometry(0,0);let B,$,G;const K=(N,Z,Y,ee,oe)=>{const X=[[ee?Y:N,ee?N:Y,0],[ee?Y:Z,ee?Z:Y,0]],le=oe<0?a.EXTENT+oe:oe,Te=[ee?le:(N+Z)/2,ee?(N+Z)/2:le,0];return Y===0&&oe<0||Y!==0&&oe>0?_.getForTilePoints(G,[Te],!0,$):X.push(Te),_.getForTilePoints(s,X,!0,B),Math.max(X[0][2],X[1][2],Te[2])/_.exaggeration()};for(let N=0;N<4;N++){const Z=h.borders[N];if(Z.length===0&&(h.borderDone[N]=!0),h.borderDone[N])continue;const Y=G=v[N](s),ee=b(Y);if(!ee||!ee.enableTerrain||($=_.findDEMTileFor(Y),!$||!$.dem))continue;if(!B){const Te=_.findDEMTileFor(s);if(!Te||!Te.dem)return;B=Te}const oe=(N<2?1:5)-N,X=ee.borders[oe];let le=0;for(let Te=0;Te<Z.length;Te++){const Ae=h.featuresOnBorder[Z[Te]],ae=Ae.borders[N];let we;for(;le<X.length&&(we=ee.featuresOnBorder[X[le]],!(we.borders[oe][1]>ae[0]+3));)ee.borderDone[oe]||ee.encodeCentroid(void 0,we,!1),le++;if(we&&le<X.length){const $e=le;let qe=0;for(;!(we.borders[oe][0]>ae[1]-3)&&(qe++,++le!==X.length);)we=ee.featuresOnBorder[X[le]];if(we=ee.featuresOnBorder[X[$e]],Ae.intersectsCount()>1||we.intersectsCount()>1||qe!==1){qe!==1&&(le=$e),h.encodeCentroid(void 0,Ae,!1),ee.borderDone[oe]||ee.encodeCentroid(void 0,we,!1);continue}const Ze=D[N](Ae,we),Re=N%2?a.EXTENT-1:0;F.x=K(Ze[0],Math.min(a.EXTENT-1,Ze[1]),Re,N<2,Ze[2]),F.y=0,h.encodeCentroid(F,Ae,!1),ee.borderDone[oe]||ee.encodeCentroid(F,we,!1)}else h.encodeCentroid(void 0,Ae,!1)}h.borderDone[N]=h.needsCentroidUpdate=!0,ee.borderDone[oe]||(ee.borderDone[oe]=ee.needsCentroidUpdate=!0)}(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(u)}const zt=new a.Color(1,0,0,1),Ia=new a.Color(0,1,0,1),fp=new a.Color(0,0,1,1),Xu=new a.Color(1,0,1,1),Es=new a.Color(0,1,1,1);function Hu(u,t,s,h){Ss(u,0,t+s/2,u.transform.width,s,h)}function Yu(u,t,s,h){Ss(u,t-s/2,0,s,u.transform.height,h)}function Ss(u,t,s,h,m,_){const v=u.context,b=v.gl;b.enable(b.SCISSOR_TEST),b.scissor(t*a.exported.devicePixelRatio,s*a.exported.devicePixelRatio,h*a.exported.devicePixelRatio,m*a.exported.devicePixelRatio),v.clear({color:_}),b.disable(b.SCISSOR_TEST)}function mp(u,t,s){const h=u.context,m=h.gl,_=s.projMatrix,v=u.useProgram("debug"),b=t.getTileByID(s.key);u.terrain&&u.terrain.setupElevationDraw(b,v);const S=a.DepthMode.disabled,I=a.StencilMode.disabled,M=u.colorModeForRenderPass(),D="$debug";h.activeTexture.set(m.TEXTURE0),u.emptyTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),v.draw(h,m.LINE_STRIP,S,I,M,a.CullFaceMode.disabled,Ea(_,a.Color.red),D,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments);const F=b.latestRawTileData,B=Math.floor((F&&F.byteLength||0)/1024),$=t.getTile(s).tileSize,G=512/Math.min($,512)*(s.overscaledZ/u.transform.zoom)*.5;let K=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(K+=` => ${s.overscaledZ}`),function(N,Z){N.initDebugOverlayCanvas();const Y=N.debugOverlayCanvas,ee=N.context.gl,oe=N.debugOverlayCanvas.getContext("2d");oe.clearRect(0,0,Y.width,Y.height),oe.shadowColor="white",oe.shadowBlur=2,oe.lineWidth=1.5,oe.strokeStyle="white",oe.textBaseline="top",oe.font="bold 36px Open Sans, sans-serif",oe.fillText(Z,5,5),oe.strokeText(Z,5,5),N.debugOverlayTexture.update(Y),N.debugOverlayTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}(u,`${K} ${B}kb`),v.draw(h,m.TRIANGLES,S,I,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,Ea(_,a.Color.transparent,G),D,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments)}const oc=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Aa}=oc;function Rn(u,t,s,h){u.emplaceBack(t,s,h)}class Ma{constructor(t){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,Rn(this.vertexArray,-1,-1,1),Rn(this.vertexArray,1,-1,1),Rn(this.vertexArray,-1,1,1),Rn(this.vertexArray,1,1,1),Rn(this.vertexArray,-1,-1,-1),Rn(this.vertexArray,1,-1,-1),Rn(this.vertexArray,-1,1,-1),Rn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Aa),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function Er(u,t,s,h,m,_){const v=u.gl,b=t.paint.get("sky-atmosphere-color"),S=t.paint.get("sky-atmosphere-halo-color"),I=t.paint.get("sky-atmosphere-sun-intensity"),M=((D,F,B,$,G)=>({u_matrix_3f:D,u_sun_direction:F,u_sun_intensity:B,u_color_tint_r:[$.r,$.g,$.b,$.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(a.fromMat4([],h),m,I,b,S);v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),s.draw(u,v.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,M,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const sc={symbol:function(u,t,s,h,m){if(u.renderPass!=="translucent")return;const _=a.StencilMode.disabled,v=u.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(b,S,I,M,D,F,B){const $=S.transform,G=D==="map",K=F==="map";for(const N of b){const Z=M.getTile(N),Y=Z.getBucket(I);if(!Y||!Y.text||!Y.text.segments.get().length)continue;const ee=a.evaluateSizeForZoom(Y.textSizeData,$.zoom),oe=Gt(Z,1,S.transform.zoom),X=mt(N.projMatrix,K,G,S.transform,oe),le=I.layout.get("icon-text-fit")!=="none"&&Y.hasIconData();if(ee){const Te=Math.pow(2,$.zoom-Z.tileID.overscaledZ),Ae=$.elevation;ic(Y,G,K,B,a.symbolSize,$,X,N.projMatrix,Te,ee,le,Ae?ae=>Ae.getAtTileOffset(N,ae.x,ae.y):ae=>0)}}}(h,u,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m),s.paint.get("icon-opacity").constantOr(1)!==0&&nc(u,t,s,h,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),_,v),s.paint.get("text-opacity").constantOr(1)!==0&&nc(u,t,s,h,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),_,v),t.map.showCollisionBoxes&&(Zr(u,t,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Zr(u,t,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,s,h){if(u.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),v=s.paint.get("circle-stroke-opacity"),b=s.layout.get("circle-sort-key").constantOr(1)!==void 0;if(m.constantOr(1)===0&&(_.constantOr(1)===0||v.constantOr(1)===0))return;const S=u.context,I=S.gl,M=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),D=a.StencilMode.disabled,F=u.colorModeForRenderPass(),B=[];for(let $=0;$<h.length;$++){const G=h[$],K=t.getTile(G),N=K.getBucket(s);if(!N)continue;const Z=N.programConfigurations.get(s.id),Y=ba(s),ee={programConfiguration:Z,program:u.useProgram("circle",Z,Y),layoutVertexBuffer:N.layoutVertexBuffer,indexBuffer:N.indexBuffer,uniformValues:Yl(u,G,K,s),tile:K};if(b){const oe=N.segments.get();for(const X of oe)B.push({segments:new a.SegmentVector([X]),sortKey:X.sortKey,state:ee})}else B.push({segments:N.segments,sortKey:0,state:ee})}b&&B.sort(($,G)=>$.sortKey-G.sortKey);for(const $ of B){const{programConfiguration:G,program:K,layoutVertexBuffer:N,indexBuffer:Z,uniformValues:Y,tile:ee}=$.state,oe=$.segments;u.terrain&&u.terrain.setupElevationDraw(ee,K,{useDepthForOcclusion:!0}),u.prepareDrawProgram(S,K,ee.tileID.toUnwrapped()),K.draw(S,I.TRIANGLES,M,D,F,a.CullFaceMode.disabled,Y,s.id,N,Z,oe,s.paint,u.transform.zoom,G)}},heatmap:function(u,t,s,h){if(s.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const m=u.context,_=m.gl,v=a.StencilMode.disabled,b=new a.ColorMode([_.ONE,_.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(S,I,M){const D=S.gl;S.activeTexture.set(D.TEXTURE1),S.viewport.set([0,0,I.width/4,I.height/4]);let F=M.heatmapFbo;if(F)D.bindTexture(D.TEXTURE_2D,F.colorAttachment.get()),S.bindFramebuffer.set(F.framebuffer);else{const B=D.createTexture();D.bindTexture(D.TEXTURE_2D,B),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),F=M.heatmapFbo=S.createFramebuffer(I.width/4,I.height/4,!1),function($,G,K,N){const Z=$.gl;Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,G.width/4,G.height/4,0,Z.RGBA,$.extRenderToTextureHalfFloat?$.extTextureHalfFloat.HALF_FLOAT_OES:Z.UNSIGNED_BYTE,null),N.colorAttachment.set(K)}(S,I,B,F)}})(m,u,s),m.clear({color:a.Color.transparent});for(let S=0;S<h.length;S++){const I=h[S];if(t.hasRenderableParent(I))continue;const M=t.getTile(I),D=M.getBucket(s);if(!D)continue;const F=D.programConfigurations.get(s.id),B=u.useProgram("heatmap",F),{zoom:$}=u.transform;u.terrain&&u.terrain.setupElevationDraw(M,B),u.prepareDrawProgram(m,B,I.toUnwrapped()),B.draw(m,_.TRIANGLES,a.DepthMode.disabled,v,b,a.CullFaceMode.disabled,Kl(I.projMatrix,M,$,s.paint.get("heatmap-intensity")),s.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,s.paint,u.transform.zoom,F)}m.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(m,_){const v=m.context,b=v.gl,S=_.heatmapFbo;if(!S)return;v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,S.colorAttachment.get()),v.activeTexture.set(b.TEXTURE1);let I=_.colorRampTexture;I||(I=_.colorRampTexture=new a.Texture(v,_.colorRamp,b.RGBA)),I.bind(b.LINEAR,b.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(v,b.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,m.colorModeForRenderPass(),a.CullFaceMode.disabled,((M,D,F,B)=>({u_image:0,u_color_ramp:1,u_opacity:D.paint.get("heatmap-opacity")}))(0,_),_.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,_.paint,m.transform.zoom)}(u,s))},line:function(u,t,s,h){if(u.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(m.constantOr(1)===0||_.constantOr(1)===0)return;const v=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),b=u.colorModeForRenderPass(),S=s.paint.get("line-dasharray"),I=S.constantOr(1),M=s.layout.get("line-cap"),D=s.paint.get("line-pattern"),F=D.constantOr(1),B=s.paint.get("line-gradient"),$=s.getCrossfadeParameters(),G=F?"linePattern":"line",K=u.context,N=K.gl;for(const Z of h){const Y=t.getTile(Z);if(F&&!Y.patternsLoaded())continue;const ee=Y.getBucket(s);if(!ee)continue;u.prepareDrawTile(Z);const oe=ee.programConfigurations.get(s.id),X=Gu(s),le=u.useProgram(G,oe,X),Te=D.constantOr(null);if(Te&&Y.imageAtlas){const qe=Y.imageAtlas,Ze=qe.patternPositions[Te.to.toString()],Re=qe.patternPositions[Te.from.toString()];Ze&&Re&&oe.setConstantPatternPositions(Ze,Re)}const Ae=S.constantOr(null),ae=M.constantOr(null);if(!F&&Ae&&ae&&Y.lineAtlas){const qe=Y.lineAtlas,Ze=qe.getDash(Ae.to,ae),Re=qe.getDash(Ae.from,ae);Ze&&Re&&oe.setConstantPatternPositions(Ze,Re)}const we=u.terrain?Z.projMatrix:null,$e=F?Ql(u,Y,s,$,we):Sa(u,Y,s,$,we,ee.lineClipsArray.length);if(B){const qe=ee.gradients[s.id];let Ze=qe.texture;if(s.gradientVersion!==qe.version){let Re=256;if(s.stepInterpolant){const He=t.getSource().maxzoom,wt=Z.canonical.z===He?Math.ceil(1<<u.transform.maxZoom-Z.canonical.z):1;Re=a.clamp(a.nextPowerOfTwo(ee.maxLineLength/a.EXTENT*1024*wt),256,K.maxTextureSize)}qe.gradient=a.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:Re,image:qe.gradient||void 0,clips:ee.lineClipsArray}),qe.texture?qe.texture.update(qe.gradient):qe.texture=new a.Texture(K,qe.gradient,N.RGBA),qe.version=s.gradientVersion,Ze=qe.texture}K.activeTexture.set(N.TEXTURE1),Ze.bind(s.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}I&&(K.activeTexture.set(N.TEXTURE0),Y.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),oe.updatePaintBuffers($)),F&&(K.activeTexture.set(N.TEXTURE0),Y.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),oe.updatePaintBuffers($)),u.prepareDrawProgram(K,le,Z.toUnwrapped()),le.draw(K,N.TRIANGLES,v,u.stencilModeForClipping(Z),b,a.CullFaceMode.disabled,$e,s.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,s.paint,u.transform.zoom,oe,ee.layoutVertexBuffer2)}},fill:function(u,t,s,h){const m=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const v=u.colorModeForRenderPass(),b=s.paint.get("fill-pattern"),S=u.opaquePassEnabledForLayer()&&!b.constantOr(1)&&m.constantOr(a.Color.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===S){const I=u.depthModeForSublayer(1,u.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Xr(u,t,s,h,I,v,!1)}if(u.renderPass==="translucent"&&s.paint.get("fill-antialias")){const I=u.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Xr(u,t,s,h,I,v,!0)}},"fill-extrusion":function(u,t,s,h){const m=s.paint.get("fill-extrusion-opacity");if(m!==0&&u.renderPass==="translucent"){const _=new a.DepthMode(u.context.gl.LEQUAL,a.DepthMode.ReadWrite,u.depthRangeFor3D);if(m!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))ka(u,t,s,h,_,a.StencilMode.disabled,a.ColorMode.disabled),ka(u,t,s,h,_,u.stencilModeFor3D(),u.colorModeForRenderPass());else{const v=u.colorModeForRenderPass();ka(u,t,s,h,_,a.StencilMode.disabled,v)}}},hillshade:function(u,t,s,h){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent")return;const m=u.context,_=u.depthModeForSublayer(0,a.DepthMode.ReadOnly),v=u.colorModeForRenderPass(),b=u.terrain&&u.terrain.renderingToTexture,[S,I]=u.renderPass!=="translucent"||b?[{},h]:u.stencilConfigForOverlap(h);for(const M of I){const D=t.getTile(M);if(D.needsHillshadePrepare&&u.renderPass==="offscreen")Mt(u,D,s,_,a.StencilMode.disabled,v);else if(u.renderPass==="translucent"){const F=b&&u.terrain?u.terrain.stencilModeForRTTOverlap(M):S[M.overscaledZ];_a(u,M,D,s,_,F,v)}}m.viewport.set([0,0,u.width,u.height])},raster:function(u,t,s,h,m,_){if(u.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!h.length)return;const v=u.context,b=v.gl,S=t.getSource(),I=u.useProgram("raster"),M=u.colorModeForRenderPass(),D=u.terrain&&u.terrain.renderingToTexture,[F,B]=S instanceof V||D?[{},h]:u.stencilConfigForOverlap(h),$=B[B.length-1].overscaledZ,G=!u.options.moving;for(const K of B){const N=D?a.DepthMode.disabled:u.depthModeForSublayer(K.overscaledZ-$,s.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,b.LESS),Z=K.toUnwrapped(),Y=t.getTile(K);if(D&&(!Y||!Y.hasData()))continue;const ee=D?K.projMatrix:u.transform.calculateProjMatrix(Z,G),oe=u.terrain&&D?u.terrain.stencilModeForRTTOverlap(K):F[K.overscaledZ],X=_?0:s.paint.get("raster-fade-duration");Y.registerFadeDuration(X);const le=t.findLoadedParent(K,0),Te=ju(Y,le,t,u.transform,X);let Ae,ae;u.terrain&&u.terrain.prepareDrawTile(K);const we=s.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;v.activeTexture.set(b.TEXTURE0),Y.texture.bind(we,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),v.activeTexture.set(b.TEXTURE1),le?(le.texture.bind(we,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),Ae=Math.pow(2,le.tileID.overscaledZ-Y.tileID.overscaledZ),ae=[Y.tileID.canonical.x*Ae%1,Y.tileID.canonical.y*Ae%1]):Y.texture.bind(we,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);const $e=So(ee,ae||[0,0],Ae||1,Te,s);u.prepareDrawProgram(v,I,Z),S instanceof V?I.draw(v,b.TRIANGLES,N,a.StencilMode.disabled,M,a.CullFaceMode.disabled,$e,s.id,S.boundsBuffer,u.quadTriangleIndexBuffer,S.boundsSegments):I.draw(v,b.TRIANGLES,N,oe,M,a.CullFaceMode.disabled,$e,s.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}},background:function(u,t,s,h){const m=s.paint.get("background-color"),_=s.paint.get("background-opacity");if(_===0)return;const v=u.context,b=v.gl,S=u.transform,I=S.tileSize,M=s.paint.get("background-pattern");if(u.isPatternMissing(M))return;const D=!M&&m.a===1&&_===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==D)return;const F=a.StencilMode.disabled,B=u.depthModeForSublayer(0,D==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),$=u.colorModeForRenderPass(),G=u.useProgram(M?"backgroundPattern":"background"),K=h||S.coveringTiles({tileSize:I});M&&(v.activeTexture.set(b.TEXTURE0),u.imageManager.bind(u.context));const N=s.getCrossfadeParameters();for(const Z of K){const Y=Z.toUnwrapped(),ee=h?Z.projMatrix:u.transform.calculateProjMatrix(Y);u.prepareDrawTile(Z);const oe=M?pp(ee,_,u,M,{tileID:Z,tileSize:I},N):dp(ee,_,m);u.prepareDrawProgram(v,G,Y),G.draw(v,b.TRIANGLES,B,F,$,a.CullFaceMode.disabled,oe,s.id,u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}},sky:function(u,t,s){const h=s.paint.get("sky-opacity");if(h===0)return;const m=u.context,_=s.paint.get("sky-type"),v=new a.DepthMode(m.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),b=u.frameCounter/1e3%1;_==="atmosphere"?u.renderPass==="offscreen"?s.needsSkyboxCapture(u)&&(function(S,I,M,D){const F=S.context,B=F.gl;let $=I.skyboxFbo;if(!$){$=I.skyboxFbo=F.createFramebuffer(32,32,!1),I.skyboxGeometry=new Ma(F),I.skyboxTexture=F.gl.createTexture(),B.bindTexture(B.TEXTURE_CUBE_MAP,I.skyboxTexture),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAG_FILTER,B.LINEAR);for(let Z=0;Z<6;++Z)B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,B.RGBA,32,32,0,B.RGBA,B.UNSIGNED_BYTE,null)}F.bindFramebuffer.set($.framebuffer),F.viewport.set([0,0,32,32]);const G=I.getCenter(S,!0),K=S.useProgram("skyboxCapture"),N=new Float64Array(16);a.identity(N),a.rotateY(N,N,.5*-Math.PI),Er(F,I,K,N,G,0),a.identity(N),a.rotateY(N,N,.5*Math.PI),Er(F,I,K,N,G,1),a.identity(N),a.rotateX(N,N,.5*-Math.PI),Er(F,I,K,N,G,2),a.identity(N),a.rotateX(N,N,.5*Math.PI),Er(F,I,K,N,G,3),a.identity(N),Er(F,I,K,N,G,4),a.identity(N),a.rotateY(N,N,Math.PI),Er(F,I,K,N,G,5),F.viewport.set([0,0,S.width,S.height])}(u,s),s.markSkyboxValid(u)):u.renderPass==="sky"&&function(S,I,M,D,F){const B=S.context,$=B.gl,G=S.transform,K=S.useProgram("skybox");B.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_CUBE_MAP,I.skyboxTexture);const N=((Z,Y,ee,oe,X)=>({u_matrix:Z,u_sun_direction:Y,u_cubemap:0,u_opacity:oe,u_temporal_offset:X}))(G.skyboxMatrix,I.getCenter(S,!1),0,D,F);S.prepareDrawProgram(B,K),K.draw(B,$.TRIANGLES,M,a.StencilMode.disabled,S.colorModeForRenderPass(),a.CullFaceMode.backCW,N,"skybox",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)}(u,s,v,h,b):_==="gradient"&&u.renderPass==="sky"&&function(S,I,M,D,F){const B=S.context,$=B.gl,G=S.transform,K=S.useProgram("skyboxGradient");I.skyboxGeometry||(I.skyboxGeometry=new Ma(B)),B.activeTexture.set($.TEXTURE0);let N=I.colorRampTexture;N||(N=I.colorRampTexture=new a.Texture(B,I.colorRamp,$.RGBA)),N.bind($.LINEAR,$.CLAMP_TO_EDGE);const Z=((Y,ee,oe,X,le)=>({u_matrix:Y,u_color_ramp:0,u_center_direction:ee,u_radius:a.degToRad(oe),u_opacity:X,u_temporal_offset:le}))(G.skyboxMatrix,I.getCenter(S,!1),I.paint.get("sky-gradient-radius"),D,F);S.prepareDrawProgram(B,K),K.draw(B,$.TRIANGLES,M,a.StencilMode.disabled,S.colorModeForRenderPass(),a.CullFaceMode.backCW,Z,"skyboxGradient",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)}(u,s,v,h,b)},debug:function(u,t,s){for(let h=0;h<s.length;h++)mp(u,t,s[h])},custom:function(u,t,s){const h=u.context,m=s.implementation;if(u.renderPass==="offscreen"){const _=m.prerender;_&&(u.setCustomLayerDefaults(),h.setColorMode(u.colorModeForRenderPass()),_.call(m,h.gl,u.transform.customLayerMatrix()),h.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),h.setColorMode(u.colorModeForRenderPass()),h.setStencilMode(a.StencilMode.disabled);const _=m.renderingMode==="3d"?new a.DepthMode(u.context.gl.LEQUAL,a.DepthMode.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,a.DepthMode.ReadOnly);h.setDepthMode(_),m.render(h.gl,u.transform.customLayerMatrix()),h.setDirty(),u.setBaseState(),h.bindFramebuffer.set(null)}}};class za{constructor(t,s){this.context=new jr(t),this.transform=s,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Nu,this.gpuTimers={},this.frameCounter=0}updateTerrain(t,s){const h=!!t&&!!t.terrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Wl(this,t));const m=this._terrain;this.transform.elevation=h?m:null,m.update(t,this.transform,s)}_updateFog(t){const s=t.fog;if(!s||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=s.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const _=h+.78*(m-h);this.transform.fogCullDistSq=_*_}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(t,s){if(this.width=t*a.exported.devicePixelRatio,this.height=s*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._layers[h].resize()}setup(){const t=this.context,s=new a.StructArrayLayout2i4;s.emplaceBack(0,0),s.emplaceBack(a.EXTENT,0),s.emplaceBack(0,a.EXTENT),s.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const h=new a.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(a.EXTENT,0),h.emplaceBack(0,a.EXTENT),h.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=t.createVertexBuffer(h,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const m=new a.StructArrayLayout4i8;m.emplaceBack(0,0,0,0),m.emplaceBack(a.EXTENT,0,a.EXTENT,0),m.emplaceBack(0,a.EXTENT,0,a.EXTENT),m.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(m,$n.members),this.rasterBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const _=new a.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const v=new a.StructArrayLayout1ui2;v.emplaceBack(0),v.emplaceBack(1),v.emplaceBack(3),v.emplaceBack(2),v.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(v);const b=new a.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(b),this.emptyTexture=new a.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA),this.identityMat=a.create$1();const S=this.context.gl;this.stencilClearMode=new a.StencilMode({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(a.window.performance.now())}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(t,s.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,ya(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s,h){if(!(s&&this.currentStencilSource!==s.id&&t.isTileClipped()&&h&&h.length))return;this.currentStencilSource=s.id;const m=this.context,_=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(a.ColorMode.disabled),m.setDepthMode(a.DepthMode.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of h){const S=this._tileClippingMaskIDs[b.key]=this.nextStencilID++;v.draw(m,_.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:_.ALWAYS,mask:0},S,255,_.KEEP,_.KEEP,_.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,ya(b.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new a.StencilMode({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new a.StencilMode({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,h=t.sort((v,b)=>b.overscaledZ-v.overscaledZ),m=h[h.length-1].overscaledZ,_=h[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let b=0;b<_;b++)v[b+m]=new a.StencilMode({func:s.GEQUAL,mask:255},b+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[v,h]}return[{[m]:a.StencilMode.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([t.CONSTANT_COLOR,t.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(t,s,h){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new a.DepthMode(h||this.context.gl.LEQUAL,s,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const h=this.style.order,m=this.style._sourceCaches;for(const I in m){const M=m[I];M.used&&M.prepare(this.context)}const _={},v={},b={};for(const I in m){const M=m[I];_[I]=M.getVisibleCoordinates(),v[I]=_[I].slice().reverse(),b[I]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<h.length;I++)if(this.style._layers[h[I]].is3D()){this.opaquePassCutoff=I;break}if(this.terrain&&(this.terrain.updateTileBinding(b),this.opaquePassCutoff=0),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const I of h){const M=this.style._layers[I],D=t._getLayerSourceCache(M);if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const F=D?v[D.id]:void 0;(M.type==="custom"||M.isSky()||F&&F.length)&&this.renderLayer(this,D,M,F)}this.depthRangeFor3D=[0,1-(t.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let S=a.Color.transparent;if(this.style.fog&&(S=this.style.fog.properties.get("color")),this.context.clear({color:s.showOverdrawInspector?a.Color.black:S,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[h[this.currentLayer]],M=t._getLayerSourceCache(I);if(I.isSky())continue;const D=M?v[M.id]:void 0;this._renderTileClippingMasks(I,M,D),this.renderLayer(this,M,I,D)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){const I=this.style._layers[h[this.currentLayer]],M=t._getLayerSourceCache(I);I.isSky()&&this.renderLayer(this,M,I,M?v[M.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;){const I=this.style._layers[h[this.currentLayer]],M=t._getLayerSourceCache(I);if(I.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(I)){if(I.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const D=M?(I.type==="symbol"?b:v)[M.id]:void 0;this._renderTileClippingMasks(I,M,M?_[M.id]:void 0),this.renderLayer(this,M,I,D),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let I=null;a.values(this.style._layers).forEach(M=>{const D=t._getLayerSourceCache(M);D&&!M.isHidden(this.transform.zoom)&&(!I||I.getSource().maxzoom<D.getSource().maxzoom)&&(I=D)}),I&&this.options.showTileBoundaries&&sc.debug(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const M=I.transform.padding;Hu(I,I.transform.height-(M.top||0),3,zt),Hu(I,M.bottom||0,3,Ia),Yu(I,M.left||0,3,fp),Yu(I,I.transform.width-(M.right||0),3,Xu);const D=I.transform.centerPoint;(function(F,B,$,G){Ss(F,B-1,$-10,2,20,G),Ss(F,B-10,$-1,20,2,G)})(I,D.x,I.transform.height-D.y,Es)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%a.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,s,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),sc[h.type](t,s,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let h=this.gpuTimers[t.id];h||(h=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),h.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,h.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const h in t){const m=t[h],_=this.context.extTimerQuery,v=_.getQueryObjectEXT(m.query,_.QUERY_RESULT_EXT)/1e6;_.deleteQueryEXT(m.query),s[h]=v}return s}translatePosMatrix(t,s,h,m,_){if(!h[0]&&!h[1])return t;const v=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(v){const I=Math.sin(v),M=Math.cos(v);h=[h[0]*M-h[1]*I,h[0]*I+h[1]*M]}const b=[_?h[0]:Gt(s,h[0],this.transform.zoom),_?h[1]:Gt(s,h[1],this.transform.zoom),0],S=new Float32Array(16);return a.translate(S,t,b),S}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),h=this.imageManager.getPattern(t.to.toString());return!s||!h}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,s=this.style&&this.style.fog,h=[];return this.terrain&&!this.terrain.renderingToTexture&&h.push("TERRAIN"),s&&!t&&s.getOpacity(this.transform.pitch)!==0&&h.push("FOG"),t&&h.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&h.push("OVERDRAW_INSPECTOR"),h}useProgram(t,s,h){this.cache=this.cache||{};const m=h||[],_=this.currentGlobalDefines().concat(m),v=wa.cacheKey(t,_,s);return this.cache[v]||(this.cache[v]=new wa(this.context,t,fa[t],s,ec[t],_)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(t){this.terrain&&this.terrain.prepareDrawTile(t)}prepareDrawProgram(t,s,h){if(this.terrain&&this.terrain.renderingToTexture)return;const m=this.style.fog;if(m){const _=m.getOpacity(this.transform.pitch);_!==0&&s.setFogUniformValues(t,((v,b,S,I)=>{const M=b.properties.get("color"),D=v.frameCounter/1e3%1,F=[M.r/M.a,M.g/M.a,M.b/M.a,I];return{u_fog_matrix:S?v.transform.calculateFogTileMatrix(S):v.identityMat,u_fog_range:b.getFovAdjustedRange(v.transform._fov),u_fog_color:F,u_fog_horizon_blend:b.properties.get("horizon-blend"),u_fog_temporal_offset:D}})(this,m,h,_))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}}class ko{constructor(t=0,s=0,h=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=h,this.right=m}interpolate(t,s,h){return s.top!=null&&t.top!=null&&(this.top=a.number(t.top,s.top,h)),s.bottom!=null&&t.bottom!=null&&(this.bottom=a.number(t.bottom,s.bottom,h)),s.left!=null&&t.left!=null&&(this.left=a.number(t.left,s.left,h)),s.right!=null&&t.right!=null&&(this.right=a.number(t.right,s.right,h)),this}getCenter(t,s){const h=a.clamp((this.left+t-this.right)/2,0,t),m=a.clamp((this.top+s-this.bottom)/2,0,s);return new a.pointGeometry(h,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ko(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ui(u,t){return[u[4*t],u[4*t+1],u[4*t+2],u[4*t+3]]}function ac(u,t,s){u[4*t+0]=s[0],u[4*t+1]=s[1],u[4*t+2]=s[2],u[4*t+3]=s[3]}function Pa(u,t){const s=Ui(u,3);a.fromQuat(u,t),ac(u,3,s)}function lc(u,t){ac(u,3,[t[0],t[1],t[2],1])}function Sr(u,t){const s=a.identity$1([]);return a.rotateZ$1(s,s,-t),a.rotateX$1(s,s,-u),s}function Io(u,t){const s=[u[0],u[1],0],h=[t[0],t[1],0];if(a.length(s)>=1e-15){const v=a.normalize([],s);a.scale(h,v,a.dot(h,v)),t[0]=h[0],t[1]=h[1]}const m=a.cross([],t,u);if(a.len(m)<1e-15)return null;const _=Math.atan2(-m[1],m[0]);return Sr(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),_)}class Da{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){this._position=this._renderWorldCopies?function(s){if(!s)return;const h=Array.isArray(s)?new a.MercatorCoordinate(s[0],s[1],s[2]):s;return h.x=a.wrap(h.x,0,1),h}(t):t}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const h=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(t)):0,m=this.position,_=a.MercatorCoordinate.fromLngLat(t,h),v=[_.x-m.x,_.y-m.y,_.z-m.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Io(v,s)}setPitchBearing(t,s){this.orientation=Sr(a.degToRad(t),a.degToRad(-s))}}class cc{constructor(t,s){this._transform=a.identity([]),this._orientation=a.identity$1([]),s&&(this._orientation=s,Pa(this._transform,this._orientation)),t&&lc(this._transform,t)}get mercatorPosition(){const t=this.position;return new a.MercatorCoordinate(t[0],t[1],t[2])}get position(){const t=Ui(this._transform,3);return[t[0],t[1],t[2]]}set position(t){lc(this._transform,t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,Pa(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=Sr(t,s),Pa(this._transform,this._orientation)}forward(){const t=Ui(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=Ui(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=Ui(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const h=new Float64Array(16);return a.invert(h,this.getWorldToCamera(t,s)),h}getWorldToCameraPosition(t,s,h){const m=this.position;a.scale(m,m,-t);const _=new Float64Array(16);return a.fromScaling(_,[h,h,h]),a.translate(_,_,m),_[10]*=s,_}getWorldToCamera(t,s){const h=new Float64Array(16),m=new Float64Array(4),_=this.position;return a.conjugate(m,this._orientation),a.scale(_,_,-t),a.fromQuat(h,m),a.translate(h,h,_),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(t,s,h,m){const _=new Float64Array(16);return a.perspective(_,t,s,h,m),_}getDistanceToElevation(t){const s=t===0?0:a.mercatorZfromAltitude(t,this.position[1]),h=this.forward();return(s-this.position[2])/h[2]}clone(){return new cc([...this.position],[...this.orientation])}}class Ao{constructor(t,s,h,m,_){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=h??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ko,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new cc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const t=new Ao(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._cameraZoom=this._cameraZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,t?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(t){this._terrainEnabled()&&this._cameraZoom==null&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),t&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return a.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-a.wrap(t,-180,180)*Math.PI/180;var h;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(h=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h),function(m,_,v){var b=_[0],S=_[1],I=_[2],M=_[3],D=Math.sin(v),F=Math.cos(v);m[0]=b*F+I*D,m[1]=S*F+M*D,m[2]=b*-D+I*F,m[3]=S*-D+M*F}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=a.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const t=this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(this.center),-1);return t===-1?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}_updateCameraOnTerrain(){const t=this.cameraToCenterDistance/this.worldSize,s=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(s+t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,_=0;for(let v=0;v<s.length;v++){const b=new a.pointGeometry(s[v][0]*this.width,h+s[v][1]*(this.height-h)),S=t.pointCoordinate(b);if(!S)continue;const I=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);m+=S[3]*I,_+=I}return _===0?NaN:m/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._cameraZoom==null||!this._elevation)return;const t=this._cameraZoom,s=this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(this.center)),h=a.mercatorZfromAltitude(s,this.center.lat),m=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),v=Math.max(m-h,_);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=a.length(a.sub([],this._camera.position,h));return a.clamp(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!a.exactEquals(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];a.exactEquals$1(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new Da;return s.position=new a.MercatorCoordinate(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this._renderWorldCopies,s}_setCameraOrientation(t){if(!a.length$1(t))return!1;a.normalize$1(t,t);const s=a.transformQuat([],[0,0,-1],t),h=a.transformQuat([],[0,-1,0],t);if(h[2]<0)return!1;const m=Io(s,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=a.clamp(t[2],m/h,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,h){this._unmodified=!1,this._edgeInsets.interpolate(t,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new a.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const h=this.pointCoordinate(new a.pointGeometry(0,0)),m=this.pointCoordinate(new a.pointGeometry(this.width,0)),_=this.pointCoordinate(new a.pointGeometry(this.width,this.height)),v=this.pointCoordinate(new a.pointGeometry(0,this.height)),b=Math.floor(Math.min(h.x,m.x,_.x,v.x)),S=Math.floor(Math.max(h.x,m.x,_.x,v.x)),I=1;for(let M=b-I;M<=S+I;M++)M!==0&&s.push(new a.UnwrappedTileID(M,t))}return s}coveringTiles(t){let s=this.coveringZoomLevel(t);const h=s,m=this.elevation&&!t.isTerrainDEM;if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const _=a.MercatorCoordinate.fromLngLat(this.center),v=1<<s,b=[v*_.x,v*_.y,0],S=Ee.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s),I=this.pointCoordinate(this.getCameraPoint()),M=v*a.mercatorZfromAltitude(1,this.center.lat),D=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),F=[v*I.x,v*I.y,D],B=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),$=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?s:0,G=t.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,K=t.isTerrainDEM?-G:this._elevation?this._elevation.getMinElevationBelowMSL():0,N=ae=>({aabb:new nt([ae*v,0,K],[(ae+1)*v,v,G]),zoom:0,x:0,y:0,wrap:ae,fullyVisible:!1}),Z=[];let Y=[];const ee=s,oe=t.reparseOverscaled?h:s,X=ae=>{if(!this._elevation||!ae.tileID)return;const we=this._elevation.getMinMaxForTile(ae.tileID),$e=ae.aabb;we?($e.min[2]=we.min,$e.max[2]=we.max,$e.center[2]=($e.min[2]+$e.max[2])/2):(ae.shouldSplit=Ae(ae),ae.shouldSplit||($e.min[2]=$e.max[2]=$e.center[2]=this._centerAltitude))},le=ae=>ae*ae,Te=le((D-this._centerAltitude)*M),Ae=ae=>{if(ae.zoom<$)return!0;if(ae.zoom===ee)return!1;if(ae.shouldSplit!=null)return ae.shouldSplit;const we=ae.aabb.distanceX(F),$e=ae.aabb.distanceY(F);let qe=Te;m&&(qe=le(ae.aabb.distanceZ(F)*M));const Ze=we*we+$e*$e+qe;return Ze<le((1<<ee-ae.zoom)*B*((Re,He)=>{if(He*le(.707)<Re)return 1;const wt=Math.sqrt(He/Re);return wt/(1.4144271570014144+(Math.pow(1.1,wt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(qe,Te),Ze))};if(this._renderWorldCopies)for(let ae=1;ae<=3;ae++)Z.push(N(-ae)),Z.push(N(ae));for(Z.push(N(0));Z.length>0;){const ae=Z.pop(),we=ae.x,$e=ae.y;let qe=ae.fullyVisible;if(!qe){const Ze=ae.aabb.intersects(S);if(Ze===0)continue;qe=Ze===2}if(ae.zoom!==ee&&Ae(ae))for(let Ze=0;Ze<4;Ze++){const Re=(we<<1)+Ze%2,He=($e<<1)+(Ze>>1),wt={aabb:ae.aabb.quadrant(Ze),zoom:ae.zoom+1,x:Re,y:He,wrap:ae.wrap,fullyVisible:qe,tileID:void 0,shouldSplit:void 0};m&&(wt.tileID=new a.OverscaledTileID(ae.zoom+1===ee?oe:ae.zoom+1,ae.wrap,ae.zoom+1,Re,He),X(wt)),Z.push(wt)}else{const Ze=ae.zoom===ee?oe:ae.zoom;if(t.minzoom&&t.minzoom>Ze)continue;const Re=b[0]-(.5+we+(ae.wrap<<ae.zoom))*(1<<s-ae.zoom),He=b[1]-.5-$e,wt=ae.tileID?ae.tileID:new a.OverscaledTileID(Ze,ae.wrap,ae.zoom,we,$e);Y.push({tileID:wt,distanceSq:Re*Re+He*He})}}if(this.fogCullDistSq){const ae=this.fogCullDistSq,we=this.horizonLineFromTop();Y=Y.filter($e=>{const qe=[0,0,0,1],Ze=[a.EXTENT,a.EXTENT,0,1],Re=this.calculateFogTileMatrix($e.tileID.toUnwrapped());a.transformMat4(qe,qe,Re),a.transformMat4(Ze,Ze,Re);const He=a.getAABBPointSquareDist(qe,Ze);if(He===0)return!0;let wt=!1;const ct=this._elevation;if(ct&&He>ae&&we!==0){const ti=this.calculateProjMatrix($e.tileID.toUnwrapped());let Xt;t.isTerrainDEM||(Xt=ct.getMinMaxForTile($e.tileID)),Xt||(Xt={min:K,max:G});const pt=a.furthestTileCorner(this.bearing),bt=[pt[0]*a.EXTENT,pt[1]*a.EXTENT,Xt.max];a.transformMat4$1(bt,bt,ti),wt=(1-bt[1])*this.height*.5<we}return He<ae||wt})}return Y.sort((ae,we)=>ae.distanceSq-we.distanceSq).map(ae=>ae.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=a.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new a.pointGeometry(a.mercatorXfromLng(t.lng)*this.worldSize,a.mercatorYfromLat(s)*this.worldSize)}unproject(t){return new a.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(t,s){const h=this.pointCoordinate(s),m=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(t),v=new a.MercatorCoordinate(_.x-(h.x-m.x),_.y-(h.y-m.y));this.center=this.coordinateLocation(v),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(t){this.center=this.coordinateLocation(t),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t){return this._coordinatePoint(this.locationCoordinate(t),!1)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(t){return a.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t.toLngLat()}pointRayIntersection(t,s){const h=s??this._centerAltitude,m=[t.x,t.y,0,1],_=[t.x,t.y,1,1];a.transformMat4(m,m,this.pixelMatrixInverse),a.transformMat4(_,_,this.pixelMatrixInverse);const v=_[3];a.scale$2(m,m,1/m[3]),a.scale$2(_,_,1/v);const b=m[2],S=_[2];return{p0:m,p1:_,t:b===S?0:(h-b)/(S-b)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return a.transformMat4(s,s,this.pixelMatrixInverse),a.transformMat4(h,h,this.pixelMatrixInverse),a.scale$2(s,s,1/s[3]),a.scale$2(h,h,1/h[3]),s[2]=a.mercatorZfromAltitude(s[2],this._center.lat)*this.worldSize,h[2]=a.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,a.scale$2(s,s,1/this.worldSize),a.scale$2(h,h,1/this.worldSize),new ve([s[0],s[1],s[2]],a.normalize([],a.sub([],h,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:h,t:m}=t,_=a.mercatorZfromAltitude(s[2],this._center.lat),v=a.mercatorZfromAltitude(h[2],this._center.lat);return new a.MercatorCoordinate(a.number(s[0],h[0],m)/this.worldSize,a.number(s[1],h[1],m)/this.worldSize,a.number(_,v,m))}pointCoordinate(t,s=this._centerAltitude){const h=this.horizonLineFromTop(!1),m=new a.pointGeometry(t.x,Math.max(h,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(m,s))}pointCoordinate3D(t){if(!this.elevation)return this.pointCoordinate(t);const s=this.elevation;let h=this.elevation.pointCoordinate(t);if(h)return new a.MercatorCoordinate(h[0],h[1],h[2]);let m=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t);const v=.02*_,b=t.clone();for(let S=0;S<10&&_-m>v;S++){b.y=a.number(m,_,.66);const I=s.pointCoordinate(b);I?(_=b.y,h=I):m=b.y}return h?new a.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const s=this.horizonLineFromTop();return t.y<s}}_coordinatePoint(t,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return a.transformMat4(m,m,this.pixelMatrix),m[3]>0?new a.pointGeometry(m[0]/m[3],m[1]/m[3]):new a.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(t,s){const h=new a.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),m=new a.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),_=new a.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),v=new a.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let b=this.pointCoordinate(h,t),S=this.pointCoordinate(m,t);const I=this.pointCoordinate(_,s),M=this.pointCoordinate(v,s),D=(F,B)=>(B.y-F.y)/(B.x-F.x);return b.y>1&&S.y>=0?b=new a.MercatorCoordinate((1-M.y)/D(M,b)+M.x,1):b.y<0&&S.y<=1&&(b=new a.MercatorCoordinate(-M.y/D(M,b)+M.x,0)),S.y>1&&b.y>=0?S=new a.MercatorCoordinate((1-I.y)/D(I,S)+I.x,1):S.y<0&&b.y<=1&&(S=new a.MercatorCoordinate(-I.y/D(I,S)+I.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(b)).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(I))}_getBounds3D(){const t=this.elevation,s=t.visibleDemTiles.reduce((h,m)=>{if(m.dem){const _=m.dem.tree;h.min=Math.min(h.min,_.minimums[0]),h.max=Math.max(h.max,_.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBounds(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new a.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(t){if(t){const s=t.getEast(),h=t.getWest();this.lngRange=[h,s>h?s:s+360],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()}else this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude]}calculatePosMatrix(t,s){const h=t.canonical,m=s/this.zoomScale(h.z),_=h.x+Math.pow(2,h.z)*t.wrap,v=a.identity(new Float64Array(16));return a.translate(v,v,[_*m,h.y*m,0]),a.scale$1(v,v,[m/a.EXTENT,m/a.EXTENT,1]),v}calculateFogTileMatrix(t){const s=t.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const m=this.calculatePosMatrix(t,this.cameraWorldSize);return a.multiply(m,this.worldToFogMatrix,m),h[s]=new Float32Array(m),h[s]}calculateProjMatrix(t,s=!1){const h=t.key,m=s?this._alignedProjMatrixCache:this._projMatrixCache;if(m[h])return m[h];const _=this.calculatePosMatrix(t,this.worldSize);return a.multiply(_,s?this.alignedProjMatrix:this.projMatrix,_),m[h]=new Float32Array(_),m[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const s=this._camera.position,h=this._camera.forward();if(s[2]<=0||h[2]>=0)return;const m=a.mercatorZfromAltitude(1,this._center.lat);s[2]/=m,h[2]/=m,a.normalize(h,h);const _=t.raycast(s,h,t.exaggeration());if(_){const v=a.scaleAndAdd([],s,h,_),b=new a.MercatorCoordinate(v[0],v[1],a.mercatorZfromAltitude(v[2],a.latFromMercatorY(v[1]))),S=this._camera.position,I=b.z+a.length([b.x-S[0],b.y-S[1],b.z-S[2]]);this._cameraZoom=this._zoomFromMercatorZ(I),this._centerAltitude=b.toAltitude(),this._center=b.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const t=this._elevation;this._updateCameraState();const s=t.getAtPointOrZero(this._camera.mercatorPosition),h=this._minimumHeightOverTerrain()*Math.cos(a.degToRad(this._maxPitch)),m=a.mercatorZfromAltitude(s,this._center.lat),_=this._camera.position[2]-m;if(_<h){const v=a.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),b=this._camera.mercatorPosition,S=[v.x-b.x,v.y-b.y,v.z-b.z],I=a.length(S);S[2]-=h-_;const M=a.length(S);if(M===0)return;a.scale(S,S,I/M),this._camera.position=[v.x-S[0],v.y-S[1],v.z-S[2]],this._camera.orientation=Io(S,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,h,m,_,v=1/0,b=-1/0;const S=this.size,I=this._unmodified;if(this.latRange){const B=this.latRange;v=a.mercatorYfromLat(B[1])*this.worldSize,b=a.mercatorYfromLat(B[0])*this.worldSize,h=b-v<S.y?S.y/(b-v):0}if(this.lngRange){const B=this.lngRange;t=a.mercatorXfromLng(B[0])*this.worldSize,s=a.mercatorXfromLng(B[1])*this.worldSize,m=s-t<S.x?S.x/(s-t):0}const M=this.point,D=Math.max(m||0,h||0);if(D)return this.center=this.unproject(new a.pointGeometry(m?(s+t)/2:M.x,h?(b+v)/2:M.y)),this.zoom+=this.scaleZoom(D),this._unmodified=I,void(this._constraining=!1);if(this.latRange){const B=M.y,$=S.y/2;B-$<v&&(_=v+$),B+$>b&&(_=b-$)}let F=M.x;if(this.lngRange){const B=this.worldSize/2-(t+s)/2;F=(F+B+this.worldSize)%this.worldSize,t+=B,s+=B;const $=S.x/2;F-$<t&&(F=t+$),F+$>s&&(F=s-$),F-=B}F===M.x&&_===void 0||(this.center=this.unproject(new a.pointGeometry(F,_!==void 0?_:M.y))),this._constrainCameraAltitude(),this._unmodified=I,this._constraining=!1}_minZoomForBounds(){const t=(m,_)=>Math.log2(m/(this.tileSize*Math.abs(_[1]-_[0])));let s=0;if(this.latRange){const m=this.latRange;s=t(this.height,[a.mercatorYfromLat(m[0]),a.mercatorYfromLat(m[1])])}let h=0;if(this.lngRange){const m=this.lngRange;h=t(this.width,[a.mercatorXfromLng(m[0]),a.mercatorXfromLng(m[1])])}return Math.max(s,h)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const s=this.pixelsPerMeter;this._updateCameraState();const h=Math.PI/2+this._pitch,m=this.fovAboveCenter,_=this.elevation?this.elevation.getMinElevationBelowMSL()*s:0,v=(this._camera.position[2]*this.worldSize-_)/Math.cos(this._pitch),b=Math.sin(m)*v/Math.sin(a.clamp(Math.PI-h-m,.01,Math.PI-.01)),S=this.point,I=S.x,M=S.y,D=Math.cos(Math.PI/2-this._pitch)*b+v,F=Math.min(1.01*D,v*(1/this._horizonShift)),B=this.height/50,$=this._camera.getWorldToCamera(this.worldSize,s),G=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,B,F);G[8]=2*-t.x/this.width,G[9]=2*t.y/this.height;let K=a.mul$1([],G,$);this.mercatorMatrix=a.scale$1([],K,[this.worldSize,this.worldSize,this.worldSize/s]),this.projMatrix=K,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const N=new Float32Array(16);a.identity(N),a.scale$1(N,N,[1,-1,1]),a.rotateX(N,N,this._pitch),a.rotateZ(N,N,this.angle);const Z=a.perspective(new Float32Array(16),this._fov,this.width/this.height,B,F),Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Z[8]=2*-t.x/this.width,Z[9]=2*(t.y+Y)/this.height,this.skyboxMatrix=a.multiply(N,Z,N);const ee=this.width%2/2,oe=this.height%2/2,X=Math.cos(this.angle),le=Math.sin(this.angle),Te=I-Math.round(I)+X*ee+le*oe,Ae=M-Math.round(M)+X*oe+le*ee,ae=new Float64Array(K);if(a.translate(ae,ae,[Te>.5?Te-1:Te,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=ae,K=a.create$1(),a.scale$1(K,K,[this.width/2,-this.height/2,1]),a.translate(K,K,[1,-1,0]),this.labelPlaneMatrix=K,K=a.create$1(),a.scale$1(K,K,[1,-1,1]),a.translate(K,K,[-1,-1,0]),a.scale$1(K,K,[2/this.width,2/this.height,1]),this.glCoordMatrix=K,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),K=a.invert(new Float64Array(16),this.pixelMatrix),!K)throw new Error("failed to invert matrix");this.pixelMatrixInverse=K,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSize,s=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height,_=[t,t,s];a.scale(_,_,m),a.scale(h,h,-1),a.multiply$1(h,h,_);const v=a.create$1();a.translate(v,v,h),a.scale$1(v,v,_),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const t=this._camera.forward(),s=this.cameraToCenterDistance,h=this.point,m=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-a.mercatorZfromAltitude(this._centerAltitude,this.center.lat),_=this.cameraToCenterDistance/m;this._camera.position=[h.x/this.worldSize-t[0]*s/_,h.y/this.worldSize-t[1]*s/_,a.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*s/_]}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=t[2];let m=1;h>0&&(m=Math.min((s-this._camera.position[2])/h,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,t,m),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),_=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat),v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),b=Math.max((t[2]-_)/Math.cos(h),v),S=this._zoomFromMercatorZ(b);a.scaleAndAdd(t,t,s,b),this._pitch=a.clamp(h,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(m,-Math.PI,Math.PI),this._setZoom(a.clamp(S,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new a.MercatorCoordinate(t[0],t[1],t[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((this._cameraZoom!=null?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!!this._elevation}isCornerOffEdge(t,s){const h=Math.min(t.x,s.x),m=Math.max(t.x,s.x),_=Math.min(t.y,s.y),v=Math.max(t.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;const b=[new a.pointGeometry(h,_),new a.pointGeometry(m,v),new a.pointGeometry(h,v),new a.pointGeometry(m,_)],S=this._renderWorldCopies?-3:0,I=this._renderWorldCopies?4:1;for(const M of b){const D=this.pointRayIntersection(M);if(D.t<0)return!0;const F=this.rayIntersectionCoordinate(D);if(F.x<S||F.y<0||F.x>I||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.isCornerOffEdge(new a.pointGeometry(0,0),new a.pointGeometry(this.width,this.height))}zoomDeltaToMovement(t,s){const h=a.length(a.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(m)}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.pointGeometry(0,t))}}function Ku(u,t){let s=!1,h=null;const m=()=>{h=null,s&&(u(),h=setTimeout(m,t),s=!1)};return()=>(s=!0,h||m(),h)}class Qu{constructor(t){this._hashName=t&&encodeURIComponent(t),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ku(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,a.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return a.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),v=Math.round(s.lng*_)/_,b=Math.round(s.lat*_)/_,S=this._map.getBearing(),I=this._map.getPitch();let M="";if(M+=t?`/${v}/${b}/${h}`:`${h}/${b}/${v}`,(S||I)&&(M+="/"+Math.round(10*S)/10),I&&(M+=`/${Math.round(I)}`),this._hashName){const D=this._hashName;let F=!1;const B=a.window.location.hash.slice(1).split("&").map($=>{const G=$.split("=")[0];return G===D?(F=!0,`${G}=${M}`):$}).filter($=>$);return F||B.push(`${D}=${M}`),`#${B.join("&")}`}return`#${M}`}_getCurrentHash(){const t=a.window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:s,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,t)}}const Hr={linearity:.3,easing:a.bezier(0,0,.3,1)},uc=a.extend({deceleration:2500,maxSpeed:1400},Hr),Ju=a.extend({deceleration:20,maxSpeed:1400},Hr),eh=a.extend({deceleration:1e3,maxSpeed:360},Hr),La=a.extend({deceleration:1e3,maxSpeed:90},Hr);class hc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=a.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new a.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const _=ks(s.pan.mag(),h,a.extend({},uc,t||{}));m.offset=s.pan.mult(_.amount/s.pan.mag()),m.center=this._map.transform.center,Cs(m,_)}if(s.zoom){const _=ks(s.zoom,h,Ju);m.zoom=this._map.transform.zoom+_.amount,Cs(m,_)}if(s.bearing){const _=ks(s.bearing,h,eh);m.bearing=this._map.transform.bearing+a.clamp(_.amount,-179,179),Cs(m,_)}if(s.pitch){const _=ks(s.pitch,h,La);m.pitch=this._map.transform.pitch+_.amount,Cs(m,_)}if(m.zoom||m.bearing){const _=s.pinchAround===void 0?s.around:s.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),a.extend(m,{noMoveStart:!0})}}function Cs(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function ks(u,t,s){const{maxSpeed:h,linearity:m,deceleration:_}=s,v=a.clamp(u*m/(t/1e3),-h,h),b=Math.abs(v)/(_*m);return{easing:s.easing,duration:1e3*b,amount:v*(b/2)}}class qi extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h,m={}){const _=ie.mousePos(s.getCanvasContainer(),h),v=s.unproject(_);super(t,a.extend({point:_,lngLat:v,originalEvent:h},m)),this._defaultPrevented=!1,this.target=s}}class Is extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){const m=t==="touchend"?h.changedTouches:h.touches,_=ie.touchPos(s.getCanvasContainer(),m),v=_.map(S=>s.unproject(S)),b=_.reduce((S,I,M,D)=>S.add(I.div(D.length)),new a.pointGeometry(0,0));super(t,{points:_,point:b,lngLats:v,lngLat:s.unproject(b),originalEvent:h}),this._defaultPrevented=!1}}class th extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){super(t,{originalEvent:h}),this._defaultPrevented=!1}}class Mo{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new th(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new qi(t.type,this._map,t))}mouseup(t){this._map.fire(new qi(t.type,this._map,t))}preclick(t){const s=a.extend({},t);s.type="preclick",this._map.fire(new qi(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new qi(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new qi(t.type,this._map,t))}mouseover(t){this._map.fire(new qi(t.type,this._map,t))}mouseout(t){this._map.fire(new qi(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Is(t.type,this._map,t))}touchmove(t){this._map.fire(new Is(t.type,this._map,t))}touchend(t){this._map.fire(new Is(t.type,this._map,t))}touchcancel(t){this._map.fire(new Is(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ih{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(t){this._map.fire(new qi(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new qi(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(ie.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const h=s;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=h,this._box||(this._box=ie.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(m.x,h.x),v=Math.max(m.x,h.x),b=Math.min(m.y,h.y),S=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(ie.setTransform(this._box,`translate(${_}px,${b}px)`),this._box.style.width=v-_+"px",this._box.style.height=S-b+"px")})}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const h=this._startPos,m=s;if(this.reset(),ie.suppressClick(),h.x!==m.x||h.y!==m.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ie.remove(this._box),this._box=null),ie.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new a.Event(t,{originalEvent:s}))}}function Ra(u,t){const s={};for(let h=0;h<u.length;h++)s[u[h].identifier]=t[h];return s}class rh{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const _=new a.pointGeometry(0,0);for(const v of m)_._add(v);return _.div(m.length)}(s),this.touches=Ra(h,s)))}touchmove(t,s,h){if(this.aborted||!this.centroid)return;const m=Ra(h,s);for(const _ in this.touches){const v=this.touches[_],b=m[_];(!b||b.dist(v)>30)&&(this.aborted=!0)}}touchend(t,s,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Fa{constructor(t){this.singleTap=new rh(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,h){this.singleTap.touchstart(t,s,h)}touchmove(t,s,h){this.singleTap.touchmove(t,s,h)}touchend(t,s,h){const m=this.singleTap.touchend(t,s,h);if(m){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(m)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class oh{constructor(){this._zoomIn=new Fa({numTouches:1,numTaps:2}),this._zoomOut=new Fa({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,h){this._zoomIn.touchstart(t,s,h),this._zoomOut.touchstart(t,s,h)}touchmove(t,s,h){this._zoomIn.touchmove(t,s,h),this._zoomOut.touchmove(t,s,h)}touchend(t,s,h){const m=this._zoomIn.touchend(t,s,h),_=this._zoomOut.touchend(t,s,h);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(m)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ni={0:1,2:2};class dc{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const h=ie.mouseButton(t);this._correctButton(t,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(t,s){const h=this._lastPoint;if(h){if(t.preventDefault(),function(m,_){const v=Ni[_];return m.buttons===void 0||(m.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(t){this._lastPoint&&ie.mouseButton(t)===this._eventButton&&(this._moved&&ie.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class or extends dc{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class pc extends dc{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const h=.8*(s.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){t.preventDefault()}}class sr extends dc{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const h=-.5*(s.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){t.preventDefault()}}class zo{constructor(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.pointGeometry(0,0)}touchstart(t,s,h){return this._calculateTransform(t,s,h)}touchmove(t,s,h){if(this._active&&!(h.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,h)}touchend(t,s,h){this._calculateTransform(t,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,h){h.length>0&&(this._active=!0);const m=Ra(h,s),_=new a.pointGeometry(0,0),v=new a.pointGeometry(0,0);let b=0;for(const I in m){const M=m[I],D=this._touches[I];D&&(_._add(M),v._add(M.sub(D)),b++,m[I]=M)}if(this._touches=m,b<this._minTouches||!v.mag())return;const S=v.div(b);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(b),panDelta:S}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,s,h){return{}}touchstart(t,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,h){if(!this._firstTwoTouches)return;t.preventDefault();const[m,_]=this._firstTwoTouches,v=Ba(h,s,m),b=Ba(h,s,_);if(!v||!b)return;const S=this._aroundCenter?null:v.add(b).div(2);return this._move([v,b],S,t)}touchend(t,s,h){if(!this._firstTwoTouches)return;const[m,_]=this._firstTwoTouches,v=Ba(h,s,m),b=Ba(h,s,_);v&&b||(this._active&&ie.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ba(u,t,s){for(let h=0;h<u.length;h++)if(u[h].identifier===s)return t[h]}function sh(u,t){return Math.log(u/t)/Math.LN2}class _p extends fc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(sh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sh(this._distance,h),pinchAround:s}}}function mc(u,t){return 180*u.angleWith(t)/Math.PI}class As extends fc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const h=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:mc(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,h=mc(t,this._startVector);return Math.abs(h)<s}}function gn(u){return Math.abs(u.y)>Math.abs(u.x)}class ah extends fc{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(t){this._lastPoints=t,gn(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,h){const m=t[0].sub(this._lastPoints[0]),_=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(m,_,h.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+_.y)/2*-.5}}gestureBeginsVertically(t,s,h){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,_=s.mag()>=2;if(!m&&!_)return;if(!m||!_)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const v=t.y>0==s.y>0;return gn(t)&&gn(s)&&v}}const lh={panStep:100,bearingStep:15,pitchStep:10};class Ms{constructor(){const t=lh;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,h=0,m=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:b=>{const S=b.getZoom();b.easeTo({duration:300,easeId:"keyboardHandler",easing:Xe,zoom:s?Math.round(S)+s*(t.shiftKey?2:1):S,bearing:b.getBearing()+h*this._bearingStep,pitch:b.getPitch()+m*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:b.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xe(u){return u*(2-u)}const _c=4.000244140625;class ch{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;let s=t.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=a.exported.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%_c==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=ie.mousePos(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform,s=()=>t._terrainEnabled()?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>_c?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&I!==0&&(I=1/I);const M=s(),D=Math.pow(2,M),F=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):D;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(F*I))),this._type==="wheel"&&(this._startZoom=s(),this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,_=this._easing;let v,b=!1;if(this._type==="wheel"&&m&&_){const S=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),I=_(S);v=a.number(m,h,I),S<1?this._frameId||(this._frameId=!0):b=!0}else v=h,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:v-s(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=a.ease;if(this._prevEase){const h=this._prevEase,m=(a.exported.now()-h.start)/h.duration,_=h.easing(m+.01)-h.easing(m),v=.27/Math.sqrt(_*_+1e-4)*.01,b=Math.sqrt(.0729-v*v);s=a.bezier(v,b,.25,1)}return this._prevEase={start:a.exported.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}}class zs{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ps{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class uh{constructor(){this._tap=new Fa({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,s,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,s,h))}touchmove(t,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=s[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,s,h)}touchend(t,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,s,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hh{constructor(t,s,h){this._el=t,this._mousePan=s,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class dh{constructor(t,s,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ph{constructor(t,s,h,m){this._el=t,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ds=u=>u.zoom||u.drag||u.pitch||u.rotate;class fh extends a.Event{}class mh{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const h=a.sub([],s,t);this.radius=a.length(h[2]<0?a.div([],h,this.constants):[h[0],h[1],0])}projectRay(t){a.div(t,t,this.constants),a.normalize(t,t),a.mul$2(t,t,this.constants);const s=a.scale([],t,this.radius);if(s[2]>0){const h=a.scale([],[0,0,1],a.dot(s,[0,0,1])),m=a.scale([],a.normalize([],[s[0],s[1],0]),this.radius),_=a.add([],s,a.scale([],a.sub([],a.add([],m,h),s),2));s[0]=_[0],s[1]=_[1]}return s}}function Yr(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class gc{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new hc(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new mh,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),a.bindAll(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[m,_,v]of this._listeners)ie.addEventListener(m,_,m===a.window.document?this.handleWindowEvent:this.handleEvent,v)}destroy(){for(const[t,s,h]of this._listeners)ie.removeEventListener(t,s,t===a.window.document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(t){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Mo(s,t));const m=s.boxZoom=new nh(s,t);this._add("boxZoom",m);const _=new oh,v=new Ps;s.doubleClickZoom=new zs(v,_),this._add("tapZoom",_),this._add("clickZoom",v);const b=new uh;this._add("tapDragZoom",b);const S=s.touchPitch=new ah;this._add("touchPitch",S);const I=new pc(t),M=new sr(t);s.dragRotate=new dh(t,I,M),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",M,["mouseRotate"]);const D=new or(t),F=new zo(t);s.dragPan=new hh(h,D,F),this._add("mousePan",D),this._add("touchPan",F,["touchZoom","touchRotate"]);const B=new As,$=new _p;s.touchZoomRotate=new ph(h,$,B,b),this._add("touchRotate",B,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ih(s));const G=s.scrollZoom=new ch(s,this);this._add("scrollZoom",G,["mousePan"]);const K=s.keyboard=new Ms;this._add("keyboard",K);for(const N of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[N]&&s[N].enable(t[N])}_add(t,s,h){this._handlers.push({handlerName:t,handler:s,allowed:h}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(Ds(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,s,h){for(const m in t)if(m!==h&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const h of t)this._el.contains(h.target)&&s.push(h);return s}handleEvent(t,s){this._updatingCamera=!0;const h=t.type==="renderFrame",m=h?void 0:t,_={needsRenderFrame:!1},v={},b={},S=t.touches?this._getMapTouches(t.touches):void 0,I=S?ie.touchPos(this._el,S):h?void 0:ie.mousePos(this._el,t);for(const{handlerName:F,handler:B,allowed:$}of this._handlers){if(!B.isEnabled())continue;let G;this._blockedByActive(b,$,F)?B.reset():B[s||t.type]&&(G=B[s||t.type](t,I,S),this.mergeHandlerResult(_,v,G,F,m),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||B.isActive())&&(b[F]=B)}const M={};for(const F in this._previousActiveHandlers)b[F]||(M[F]=m);this._previousActiveHandlers=b,(Object.keys(M).length||Yr(_))&&(this._changes.push([_,v,M]),this._triggerRenderFrame()),(Object.keys(b).length||Yr(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:D}=_;D&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],D(this._map))}mergeHandlerResult(t,s,h,m,_){if(!h)return;a.extend(t,h);const v={handlerName:m,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(s.zoom=v),h.panDelta!==void 0&&(s.drag=v),h.pitchDelta!==void 0&&(s.pitch=v),h.bearingDelta!==void 0&&(s.rotate=v)}_applyChanges(){const t={},s={},h={};for(const[m,_,v]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new a.pointGeometry(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),a.extend(s,_),a.extend(h,v);this._updateMapTransform(t,s,h),this._changes=[]}_updateMapTransform(t,s,h){const m=this._map,_=m.transform,v=Z=>[Z.x,Z.y,Z.z];if((Z=>{const Y=this._eventsInProgress.drag;return Y&&!this._handlersById[Y.handlerName].isActive()})()&&!Yr(t)){const Z=_.zoom;_.cameraElevationReference="sea",_.recenterOnTerrain(),_.cameraElevationReference="ground",Z!==_.zoom&&this._map._update(!0)}if(!Yr(t))return this._fireEvents(s,h,!0);let{panDelta:b,zoomDelta:S,bearingDelta:I,pitchDelta:M,around:D,aroundCoord:F,pinchAround:B}=t;B!==void 0&&(D=B),(Z=>s.drag&&!this._eventsInProgress.drag)()&&D&&(this._dragOrigin=v(_.pointCoordinate3D(D)),this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",m._stop(!0),D=D||m.transform.centerPoint,I&&(_.bearing+=I),M&&(_.pitch+=M),_._updateCameraState();const $=[0,0,0];if(b){const Z=_.screenPointToMercatorRay(D),Y=_.screenPointToMercatorRay(D.sub(b)),ee=this._trackingEllipsoid.projectRay(Z.dir),oe=this._trackingEllipsoid.projectRay(Y.dir);$[0]=oe[0]-ee[0],$[1]=oe[1]-ee[1]}const G=_.zoom,K=[0,0,0];if(S){const Z=v(F||_.pointCoordinate3D(D)),Y={dir:a.normalize([],a.sub([],Z,_._camera.position))},ee=_.screenPointToMercatorRay(_.centerPoint);if(Y.dir[2]<0){const oe=a.altitudeFromMercatorZ(Z[2],Z[1]),X=_.rayIntersectionCoordinate(_.pointRayIntersection(_.centerPoint,oe)),le=_.zoomDeltaToMovement(v(X),S)*(ee.dir[2]/Y.dir[2]);a.scale(K,Y.dir,le)}else if(_._terrainEnabled()){const oe=_.zoomDeltaToMovement(Z,S);a.scale(K,Y.dir,oe)}}const N=a.add($,$,K);_._translateCameraConstrained(N),S&&Math.abs(_.zoom-G)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,h,!0)}_fireEvents(t,s,h){const m=Ds(this._eventsInProgress),_=Ds(t),v={};for(const M in t){const{originalEvent:D}=t[M];this._eventsInProgress[M]||(v[`${M}start`]=D),this._eventsInProgress[M]=t[M]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(const M in v)this._fireEvent(M,v[M]);_&&this._fireEvent("move",_.originalEvent);for(const M in t){const{originalEvent:D}=t[M];this._fireEvent(M,D)}const b={};let S;for(const M in this._eventsInProgress){const{handlerName:D,originalEvent:F}=this._eventsInProgress[M];this._handlersById[D].isActive()||(delete this._eventsInProgress[M],S=s[D]||F,b[`${M}end`]=S)}for(const M in b)this._fireEvent(M,b[M]);const I=Ds(this._eventsInProgress);if(h&&(m||_)&&!I){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=F=>F!==0&&-this._bearingSnap<F&&F<this._bearingSnap;M?(D(M.bearing||this._map.getBearing())&&(M.bearing=0),this._map.easeTo(M,{originalEvent:S})):(this._map.fire(new a.Event("moveend",{originalEvent:S})),D(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new a.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new fh("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Oa extends a.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,h){return t=a.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,a.extend({offset:t},s),h)}panTo(t,s,h){return this.easeTo(a.extend({center:t},s),h)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,h){return this.easeTo(a.extend({zoom:t},s),h)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,h){return this.easeTo(a.extend({bearing:t},s),h)}resetNorth(t,s){return this.rotateTo(0,a.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=a.LngLatBounds.convert(t);const h=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),h,s)}_extendCameraOptions(t){const s={top:0,bottom:0,right:0,left:0};if(typeof(t=a.extend({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=="number"){const h=t.padding;t.padding={top:h,bottom:h,right:h,left:h}}return t.padding=a.extend(s,t.padding),t}_cameraForBoxAndBearing(t,s,h,m){const _=this._extendCameraOptions(m),v=this.transform,b=v.padding,S=v.project(a.LngLat.convert(t)),I=v.project(a.LngLat.convert(s)),M=S.rotate(-a.degToRad(h)),D=I.rotate(-a.degToRad(h)),F=new a.pointGeometry(Math.max(M.x,D.x),Math.max(M.y,D.y)),B=new a.pointGeometry(Math.min(M.x,D.x),Math.min(M.y,D.y)),$=F.sub(B),G=(v.width-(b.left+b.right+_.padding.left+_.padding.right))/$.x,K=(v.height-(b.top+b.bottom+_.padding.top+_.padding.bottom))/$.y;if(K<0||G<0)return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const N=Math.min(v.scaleZoom(v.scale*Math.min(G,K)),_.maxZoom),Z=typeof _.offset.x=="number"?new a.pointGeometry(_.offset.x,_.offset.y):a.pointGeometry.convert(_.offset),Y=new a.pointGeometry((_.padding.left-_.padding.right)/2,(_.padding.top-_.padding.bottom)/2).rotate(h*Math.PI/180),ee=Z.add(Y).mult(v.scale/v.zoomScale(N));return{center:v.unproject(S.add(I).div(2).sub(ee)),zoom:N,bearing:h}}_cameraForBox(t,s,h,m,_){const v=this._extendCameraOptions(_);h=h||0,m=m||0,t=a.LngLat.convert(t),s=a.LngLat.convert(s);const b=this.transform.clone();b.padding=v.padding;const S=this.getFreeCameraOptions(),I=new a.LngLat(.5*(t.lng+s.lng),.5*(t.lat+s.lat)),M=.5*(h+m);if(b._camera.position[2]<a.mercatorZfromAltitude(M,I.lat))return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");S.lookAtPoint(I),b.setFreeCameraOptions(S);const D=a.MercatorCoordinate.fromLngLat(t),F=a.MercatorCoordinate.fromLngLat(s),B=b.pointRayIntersection(b.centerPoint,M),$=[(G=b.rayIntersectionCoordinate(B)).x,G.y,G.z];var G;const K=b.screenPointToMercatorRay(b.centerPoint);let N,Z=0;do{const Y=Math.floor(b.zoom),ee=1<<Y,oe=Math.min(ee*D.x,ee*F.x),X=Math.min(ee*D.y,ee*F.y),le=Math.max(ee*D.x,ee*F.x),Te=Math.max(ee*D.y,ee*F.y),Ae=new nt([oe,X,h],[le,Te,m]),ae=Ee.fromInvProjectionMatrix(b.invProjMatrix,b.worldSize,Y);if(Ae.intersects(ae)!==2){N&&(b._camera.position=a.scaleAndAdd([],b._camera.position,K.dir,-N),b._updateStateFromCamera());break}const we=a.sub([],b._camera.position,$);N=.5*a.length(we),b._camera.position=a.scaleAndAdd([],b._camera.position,K.dir,N);try{b._updateStateFromCamera()}catch{return void a.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Z<10);return{center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch}}fitBounds(t,s,h){return this._fitInternal(this.cameraForBounds(t,s),s,h)}_raycastElevationBox(t,s){const h=this.transform.elevation;if(!h)return;const m=new a.pointGeometry(t.x,s.y),_=new a.pointGeometry(s.x,t.y),v=h.pointCoordinate(t);if(!v)return;const b=h.pointCoordinate(s);if(!b)return;const S=h.pointCoordinate(m);if(!S)return;const I=h.pointCoordinate(_);if(!I)return;const M=new a.MercatorCoordinate(v[0],v[1]).toLngLat(),D=new a.MercatorCoordinate(b[0],b[1]).toLngLat(),F=new a.MercatorCoordinate(S[0],S[1]).toLngLat(),B=new a.MercatorCoordinate(I[0],I[1]).toLngLat(),$=Math.min(M.lng,Math.min(D.lng,Math.min(F.lng,B.lng))),G=Math.min(M.lat,Math.min(D.lat,Math.min(F.lat,B.lat))),K=Math.max(M.lng,Math.max(D.lng,Math.max(F.lng,B.lng))),N=Math.max(M.lat,Math.max(D.lat,Math.max(F.lat,B.lat))),Z=Math.min(v[3],Math.min(b[3],Math.min(S[3],I[3]))),Y=Math.max(v[3],Math.max(b[3],Math.max(S[3],I[3])));return{minLngLat:new a.LngLat($,G),maxLngLat:new a.LngLat(K,N),minAltitude:Z,maxAltitude:Y}}fitScreenCoordinates(t,s,h,m,_){let v,b,S,I;const M=a.pointGeometry.convert(t),D=a.pointGeometry.convert(s),F=this._raycastElevationBox(M,D);if(F)v=F.minLngLat,b=F.maxLngLat,S=F.minAltitude,I=F.maxAltitude;else{if(this.transform.isCornerOffEdge(M,D))return this;v=this.transform.pointLocation(M),b=this.transform.pointLocation(D)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(a.pointGeometry.convert(t)),this.transform.pointLocation(a.pointGeometry.convert(s)),h,m):this._cameraForBox(v,b,S,I,m),m,_)}_fitInternal(t,s,h){return t?(delete(s=a.extend(t,s)).padding,s.linear?this.easeTo(s,h):this.flyTo(s,h)):this}jumpTo(t,s){this.stop();const h=this.transform;let m=!1,_=!1,v=!1;return"zoom"in t&&h.zoom!==+t.zoom&&(m=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=a.LngLat.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(_=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(v=!0,h.pitch=+t.pitch),t.padding==null||h.isPaddingEqual(t.padding)||(h.padding=t.padding),this.fire(new a.Event("movestart",s)).fire(new a.Event("move",s)),m&&this.fire(new a.Event("zoomstart",s)).fire(new a.Event("zoom",s)).fire(new a.Event("zoomend",s)),_&&this.fire(new a.Event("rotatestart",s)).fire(new a.Event("rotate",s)).fire(new a.Event("rotateend",s)),v&&this.fire(new a.Event("pitchstart",s)).fire(new a.Event("pitch",s)).fire(new a.Event("pitchend",s)),this.fire(new a.Event("moveend",s))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){this.stop();const h=this.transform,m=h.zoom,_=h.pitch,v=h.bearing;h.setFreeCameraOptions(t);const b=m!==h.zoom,S=_!==h.pitch,I=v!==h.bearing;return this.fire(new a.Event("movestart",s)).fire(new a.Event("move",s)),b&&this.fire(new a.Event("zoomstart",s)).fire(new a.Event("zoom",s)).fire(new a.Event("zoomend",s)),I&&this.fire(new a.Event("rotatestart",s)).fire(new a.Event("rotate",s)).fire(new a.Event("rotateend",s)),S&&this.fire(new a.Event("pitchstart",s)).fire(new a.Event("pitch",s)).fire(new a.Event("pitchend",s)),this.fire(new a.Event("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=a.extend({offset:[0,0],duration:500,easing:a.ease},t)).animate===!1||!t.essential&&a.exported.prefersReducedMotion)&&(t.duration=0);const h=this.transform,m=this.getZoom(),_=this.getBearing(),v=this.getPitch(),b=this.getPadding(),S="zoom"in t?+t.zoom:m,I="bearing"in t?this._normalizeBearing(t.bearing,_):_,M="pitch"in t?+t.pitch:v,D="padding"in t?t.padding:h.padding,F=a.pointGeometry.convert(t.offset);let B=h.centerPoint.add(F);const $=h.pointLocation(B),G=a.LngLat.convert(t.center||$);this._normalizeCenter(G);const K=h.project($),N=h.project(G).sub(K),Z=h.zoomScale(S-m);let Y,ee;t.around&&(Y=a.LngLat.convert(t.around),ee=h.locationPoint(Y));const oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||S!==m,this._rotating=this._rotating||_!==I,this._pitching=this._pitching||M!==v,this._padding=!h.isPaddingEqual(D),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,oe),this._ease(X=>{if(this._zooming&&(h.zoom=a.number(m,S,X)),this._rotating&&(h.bearing=a.number(_,I,X)),this._pitching&&(h.pitch=a.number(v,M,X)),this._padding&&(h.interpolatePadding(b,D,X),B=h.centerPoint.add(F)),Y)h.setLocationAtPoint(Y,ee);else{const le=h.zoomScale(h.zoom-m),Te=S>m?Math.min(2,Z):Math.max(.5,Z),Ae=Math.pow(Te,1-X),ae=h.unproject(K.add(N.mult(X*Ae)).mult(le));h.setLocationAtPoint(h.renderWorldCopies?ae.wrap():ae,B)}this._fireMoveEvents(s)},X=>{h.recenterOnTerrain(),this._afterEase(s,X)},t),this}_prepareEase(t,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",s||h.moving||this.fire(new a.Event("movestart",t)),this._zooming&&!h.zooming&&this.fire(new a.Event("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new a.Event("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new a.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new a.Event("move",t)),this._zooming&&this.fire(new a.Event("zoom",t)),this._rotating&&this.fire(new a.Event("rotate",t)),this._pitching&&this.fire(new a.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new a.Event("zoomend",t)),m&&this.fire(new a.Event("rotateend",t)),_&&this.fire(new a.Event("pitchend",t)),this.fire(new a.Event("moveend",t))}flyTo(t,s){if(!t.essential&&a.exported.prefersReducedMotion){const Re=a.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Re,s)}this.stop(),t=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},t);const h=this.transform,m=this.getZoom(),_=this.getBearing(),v=this.getPitch(),b=this.getPadding(),S="zoom"in t?a.clamp(+t.zoom,h.minZoom,h.maxZoom):m,I="bearing"in t?this._normalizeBearing(t.bearing,_):_,M="pitch"in t?+t.pitch:v,D="padding"in t?t.padding:h.padding,F=h.zoomScale(S-m),B=a.pointGeometry.convert(t.offset);let $=h.centerPoint.add(B);const G=h.pointLocation($),K=a.LngLat.convert(t.center||G);this._normalizeCenter(K);const N=h.project(G),Z=h.project(K).sub(N);let Y=t.curve;const ee=Math.max(h.width,h.height),oe=ee/F,X=Z.mag();if("minZoom"in t){const Re=a.clamp(Math.min(t.minZoom,m,S),h.minZoom,h.maxZoom),He=ee/h.zoomScale(Re-m);Y=Math.sqrt(He/X*2)}const le=Y*Y;function Te(Re){const He=(oe*oe-ee*ee+(Re?-1:1)*le*le*X*X)/(2*(Re?oe:ee)*le*X);return Math.log(Math.sqrt(He*He+1)-He)}function Ae(Re){return(Math.exp(Re)-Math.exp(-Re))/2}function ae(Re){return(Math.exp(Re)+Math.exp(-Re))/2}const we=Te(0);let $e=function(Re){return ae(we)/ae(we+Y*Re)},qe=function(Re){return ee*((ae(we)*(Ae(He=we+Y*Re)/ae(He))-Ae(we))/le)/X;var He},Ze=(Te(1)-we)/Y;if(Math.abs(X)<1e-6||!isFinite(Ze)){if(Math.abs(ee-oe)<1e-6)return this.easeTo(t,s);const Re=oe<ee?-1:1;Ze=Math.abs(Math.log(oe/ee))/Y,qe=function(){return 0},$e=function(He){return Math.exp(Re*Y*He)}}return t.duration="duration"in t?+t.duration:1e3*Ze/("screenSpeed"in t?+t.screenSpeed/Y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=_!==I,this._pitching=M!==v,this._padding=!h.isPaddingEqual(D),this._prepareEase(s,!1),this._ease(Re=>{const He=Re*Ze,wt=1/$e(He);h.zoom=Re===1?S:m+h.scaleZoom(wt),this._rotating&&(h.bearing=a.number(_,I,Re)),this._pitching&&(h.pitch=a.number(v,M,Re)),this._padding&&(h.interpolatePadding(b,D,Re),$=h.centerPoint.add(B));const ct=Re===1?K:h.unproject(N.add(Z.mult(qe(He))).mult(wt));h.setLocationAtPoint(h.renderWorldCopies?ct.wrap():ct,$),h._updateCenterElevation(),this._fireMoveEvents(s)},()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,s)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,s,h){h.animate===!1||h.duration===0?(t(1),s()):(this._easeStart=a.exported.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=a.wrap(t,-180,180);const h=Math.abs(t-s);return Math.abs(t-360-s)<h&&(t-=360),Math.abs(t+360-s)<h&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const h=t.lng-s.center.lng;t.lng+=h>180?-360:h<-180?360:0}}class yc{constructor(t={}){this.options=t,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact;return this._map=t,this._container=ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ie.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ie.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){ie.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const h=this._map._getUIString(`AttributionControl.${s}`);t.title=h,t.setAttribute("aria-label",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(t){const h=s.reduce((m,_,v)=>(_.value&&(m+=`${_.key}=${_.value}${v<s.length-1?"&":""}`),m),"?");t.href=`${a.config.FEEDBACK_URL}/${h}${this._map._hash?this._map._hash.getHashString(!0):""}`,t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._sourceCaches;for(const m in s){const _=s[m];if(_.used){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((m,_)=>m.length-_.length),t=t.filter((m,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(m)>=0)return!1;return!0});const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class xc{constructor(){a.bindAll(["_updateLogo"],this),a.bindAll(["_updateCompact"],this)}onAdd(t){this._map=t,this._container=ie.create("div","mapboxgl-ctrl");const s=ie.create("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ie.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const h=t[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class vc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const m of h)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function wc(u,t,s){if(u=new a.LngLat(u.lng,u.lat),t){const h=new a.LngLat(u.lng-360,u.lat),m=new a.LngLat(u.lng+360,u.lat),_=360*Math.ceil(Math.abs(u.lng-s.center.lng)/360),v=s.locationPoint(u).distSqr(t),b=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint(h).distSqr(t)<v&&(b||Math.abs(h.lng-s.center.lng)<_)?u=h:s.locationPoint(m).distSqr(t)<v&&(b||Math.abs(m.lng-s.center.lng)<_)&&(u=m)}for(;Math.abs(u.lng-s.center.lng)>180;){const h=s.locationPoint(u);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;u.lng>s.center.lng?u.lng-=360:u.lng+=360}return u}const Ua={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Na extends a.Evented{constructor(t,s){if(super(),(t instanceof a.window.HTMLElement||s)&&(t=a.extend({element:t},s)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=a.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=ie.create("div"),this._element.setAttribute("aria-label","Map marker");const m=ie.createNS("http://www.w3.org/2000/svg","svg"),_=41,v=27;m.setAttributeNS(null,"display","block"),m.setAttributeNS(null,"height",`${_}px`),m.setAttributeNS(null,"width",`${v}px`),m.setAttributeNS(null,"viewBox",`0 0 ${v} ${_}`);const b=ie.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const S=ie.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const I=ie.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const M=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Y of M){const ee=ie.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",Y.rx),ee.setAttributeNS(null,"ry",Y.ry),I.appendChild(ee)}const D=ie.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"fill",this._color);const F=ie.createNS("http://www.w3.org/2000/svg","path");F.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),D.appendChild(F);const B=ie.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"opacity","0.25"),B.setAttributeNS(null,"fill","#000000");const $=ie.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),B.appendChild($);const G=ie.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"transform","translate(6.0, 7.0)"),G.setAttributeNS(null,"fill","#FFFFFF");const K=ie.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(8.0, 8.0)");const N=ie.createNS("http://www.w3.org/2000/svg","circle");N.setAttributeNS(null,"fill","#000000"),N.setAttributeNS(null,"opacity","0.25"),N.setAttributeNS(null,"cx","5.5"),N.setAttributeNS(null,"cy","5.5"),N.setAttributeNS(null,"r","5.4999962");const Z=ie.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#FFFFFF"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962"),K.appendChild(N),K.appendChild(Z),S.appendChild(I),S.appendChild(D),S.appendChild(B),S.appendChild(G),S.appendChild(K),m.appendChild(S),m.setAttributeNS(null,"height",_*this._scale+"px"),m.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(m),this._offset=a.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",m=>{m.preventDefault()}),this._element.addEventListener("mousedown",m=>{m.preventDefault()});const h=this._element.classList;for(const m in Ua)h.remove(`mapboxgl-marker-anchor-${m}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),ie.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=a.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const s=t.code,h=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_evaluateOpacity(){const t=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(t))return void this._clearFadeTimer();const s=this._map.unproject(t);let h=!1;if(this._map.getTerrain()){const _=this._map.getFreeCameraOptions();if(_.position){const v=_.position.toLngLat();h=v.distanceTo(s)<.9*v.distanceTo(this._lngLat)}}const m=(1-this._map._queryFogOpacity(s))*(h?.2:1);this._element.style.opacity=`${m}`,this._popup&&this._popup._setOpacity(`${m}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(t){const s=this._map.transform;return!!t&&t.x>=0&&t.x<s.width&&t.y>=0&&t.y<s.height}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=wc(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let h="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?h="rotateX(0deg)":this._pitchAlignment==="map"&&(h=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&ie.setTransform(this._element,`${Ua[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${h} ${s}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const t=this._map.transform,s=this._offset.mult(this._scale);return this._rotationAlignment==="map"&&s._rotate(t.angle),this._pitchAlignment==="map"&&(s.y*=Math.cos(t._pitch)),s}getOffset(){return this._offset}setOffset(t){return this._offset=a.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class _h{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=a.easeCubicInOut((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,h){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+h}}const bc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:Ls,HTMLElement:gh,ImageBitmap:Kr}=a.window,yh={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Rs(u){u.parentNode&&u.parentNode.removeChild(u)}const xh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Tc{constructor(t,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new pc({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new sr({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ie.addEventListener(s,"mousedown",this.mousedown),ie.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),ie.addEventListener(s,"touchmove",this.touchmove),ie.addEventListener(s,"touchend",this.touchend),ie.addEventListener(s,"touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),ie.disableDrag()}move(t,s){const h=this.map,m=this.mouseRotate.mousemoveWindow(t,s);if(m&&m.bearingDelta&&h.setBearing(h.getBearing()+m.bearingDelta),this.mousePitch){const _=this.mousePitch.mousemoveWindow(t,s);_&&_.pitchDelta&&h.setPitch(h.getPitch()+_.pitchDelta)}}off(){const t=this.element;ie.removeEventListener(t,"mousedown",this.mousedown),ie.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),ie.removeEventListener(t,"touchmove",this.touchmove),ie.removeEventListener(t,"touchend",this.touchend),ie.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){ie.enableDrag(),ie.removeEventListener(a.window,"mousemove",this.mousemove),ie.removeEventListener(a.window,"mouseup",this.mouseup)}mousedown(t){this.down(a.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ie.mousePos(this.element,t)),ie.addEventListener(a.window,"mousemove",this.mousemove),ie.addEventListener(a.window,"mouseup",this.mouseup)}mousemove(t){this.move(t,ie.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ie.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ie.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const vh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Cr,Po=0,Qr=!1;const gp={maxWidth:100,unit:"metric"};function wh(u,t,s){const h=s&&s.maxWidth||100,m=u._container.getBoundingClientRect().height/2,_=u.unproject([0,m]),v=u.unproject([h,m]),b=_.distanceTo(v);if(s&&s.unit==="imperial"){const S=3.2808*b;S>5280?Jr(t,h,S/5280,u._getUIString("ScaleControl.Miles"),u):Jr(t,h,S,u._getUIString("ScaleControl.Feet"),u)}else s&&s.unit==="nautical"?Jr(t,h,b/1852,u._getUIString("ScaleControl.NauticalMiles"),u):b>=1e3?Jr(t,h,b/1e3,u._getUIString("ScaleControl.Kilometers"),u):Jr(t,h,b,u._getUIString("ScaleControl.Meters"),u)}function Jr(u,t,s,h,m){const _=function(b){const S=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/S;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(M){const D=Math.pow(10,Math.ceil(-Math.log(M)/Math.LN10));return Math.round(M*D)/D}(I),S*I}(s),v=_/s;m._requestDomTask(()=>{u.style.width=t*v+"px",u.innerHTML=`${_}&nbsp;${h}`})}const bh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Th=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Va={version:a.version,supported:H,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Oa{constructor(u){if((u=a.extend({},yh,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ao(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._interactive=u.interactive,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=u.collectResourceTiming,this._optimizeForTerrain=u.optimizeForTerrain,this._renderTaskQueue=new vc,this._domRenderTaskQueue=new vc,this._controls=[],this._markers=[],this._mapId=a.uniqueId(),this._locale=a.extend({},bc,u.locale),this._clickTolerance=u.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new _h(0),this._requestManager=new a.RequestManager(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,typeof u.container=="string"){if(this._container=a.window.document.getElementById(u.container),!this._container)throw new Error(`Container '${u.container}' not found.`)}else{if(!(u.container instanceof gh))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(u.maxBounds&&this.setMaxBounds(u.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new gc(this,u),this._hash=u.hash&&new Qu(typeof u.hash=="string"&&u.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch}),u.bounds&&(this.resize(),this.fitBounds(u.bounds,a.extend({},u.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,u.style&&this.setStyle(u.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.attributionControl&&this.addControl(new yc({customAttribution:u.customAttribution})),this._logoControl=new xc,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",t=>{this._update(t.dataType==="style"),this.fire(new a.Event(`${t.dataType}data`,t))}),this.on("dataloading",t=>{this.fire(new a.Event(`${t.dataType}dataloading`,t))})}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=u.onAdd(this);this._controls.push(u);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){const[t,s]=this._containerDimensions();if(t===this.transform.width&&s===this.transform.height)return this;this._resizeCanvas(t,s),this.transform.resize(t,s),this.painter.resize(Math.ceil(t),Math.ceil(s));const h=!this._moving;return h&&this.fire(new a.Event("movestart",u)).fire(new a.Event("move",u)),this.fire(new a.Event("resize",u)),h&&this.fire(new a.Event("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(a.LngLatBounds.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this._update()}project(u){return this.transform.locationPoint3D(a.LngLat.convert(u))}unproject(u){return this.transform.pointLocation3D(a.pointGeometry.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(u,t,s){if(u==="mouseenter"||u==="mouseover"){let h=!1;return{layer:t,listener:s,delegates:{mousemove:_=>{const v=this.getLayer(t)?this.queryRenderedFeatures(_.point,{layers:[t]}):[];v.length?h||(h=!0,s.call(this,new qi(u,this,_.originalEvent,{features:v}))):h=!1},mouseout:()=>{h=!1}}}}if(u==="mouseleave"||u==="mouseout"){let h=!1;return{layer:t,listener:s,delegates:{mousemove:v=>{(this.getLayer(t)?this.queryRenderedFeatures(v.point,{layers:[t]}):[]).length?h=!0:h&&(h=!1,s.call(this,new qi(u,this,v.originalEvent)))},mouseout:v=>{h&&(h=!1,s.call(this,new qi(u,this,v.originalEvent)))}}}}{const h=m=>{const _=this.getLayer(t)?this.queryRenderedFeatures(m.point,{layers:[t]}):[];_.length&&(m.features=_,s.call(this,m),delete m.features)};return{layer:t,listener:s,delegates:{[u]:h}}}}on(u,t,s){if(s===void 0)return super.on(u,t);const h=this._createDelegatedListener(u,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(u,t,s){if(s===void 0)return super.once(u,t);const h=this._createDelegatedListener(u,t,s);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(u,t,s){return s===void 0?super.off(u,t):(this._delegatedListeners&&this._delegatedListeners[u]&&(h=>{const m=this._delegatedListeners[u];for(let _=0;_<m.length;_++){const v=m[_];if(v.layer===t&&v.listener===s){for(const b in v.delegates)this.off(b,v.delegates[b]);return m.splice(_,1),this}}})(),this)}queryRenderedFeatures(u,t){return this.style?(t!==void 0||u===void 0||u instanceof a.pointGeometry||Array.isArray(u)||(t=u,u=void 0),this.style.queryRenderedFeatures(u=u||[[0,0],[this.transform.width,this.transform.height]],t=t||{},this.transform)):[]}querySourceFeatures(u,t){return this.style.querySourceFeatures(u,t)}queryTerrainElevation(u,t){const s=this.transform.elevation;return s?(t=a.extend({},{exaggerated:!0},t),s.getAtPoint(a.MercatorCoordinate.fromLngLat(u),null,t.exaggerated)):null}setStyle(u,t){return(t=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&t.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),u&&(this.style=new Dn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Dn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,t){if(typeof u=="string"){const s=this._requestManager.normalizeStyleURL(u),h=this._requestManager.transformRequest(s,a.ResourceType.Style);a.getJSON(h,(m,_)=>{m?this.fire(new a.ErrorEvent(m)):_&&this._updateDiff(_,t)})}else typeof u=="object"&&this._updateDiff(u,t)}_updateDiff(u,t){try{this.style.setState(u)&&this._update(!0)}catch(s){a.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(u,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.warnOnce("There is no style added to the map.")}addSource(u,t){return this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)}isSourceLoaded(u){const t=this.style&&this.style._getSourceCaches(u);if(t.length!==0)return t.every(s=>s.loaded());this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${u}'`)))}areTilesLoaded(){const u=this.style&&this.style._sourceCaches;for(const t in u){const s=u[t]._tiles;for(const h in s){const m=s[h];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(u,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,s)}removeSource(u){return this.style.removeSource(u),this._updateTerrain(),this._update(!0)}getSource(u){return this.style.getSource(u)}addImage(u,t,{pixelRatio:s=1,sdf:h=!1,stretchX:m,stretchY:_,content:v}={}){if(this._lazyInitEmptyStyle(),t instanceof Ls||Kr&&t instanceof Kr){const{width:b,height:S,data:I}=a.exported.getImageData(t);this.style.addImage(u,{data:new a.RGBAImage({width:b,height:S},I),pixelRatio:s,stretchX:m,stretchY:_,content:v,sdf:h,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:b,height:S,data:I}=t,M=t;this.style.addImage(u,{data:new a.RGBAImage({width:b,height:S},new Uint8Array(I)),pixelRatio:s,stretchX:m,stretchY:_,content:v,sdf:h,version:0,userImage:M}),M.onAdd&&M.onAdd(this,u)}}}updateImage(u,t){const s=this.style.getImage(u);if(!s)return this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=t instanceof Ls||Kr&&t instanceof Kr?a.exported.getImageData(t):t,{width:m,height:_,data:v}=h;return m===void 0||_===void 0?this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):m!==s.data.width||_!==s.data.height?this.fire(new a.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(s.data.replace(v,!(t instanceof Ls||Kr&&t instanceof Kr)),void this.style.updateImage(u,s))}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,t){a.getImage(this._requestManager.transformRequest(u,a.ResourceType.Image),(s,h)=>{t(s,h instanceof Ls?a.exported.getImageData(h):h)})}listImages(){return this.style.listImages()}addLayer(u,t){return this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)}moveLayer(u,t){return this.style.moveLayer(u,t),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}setLayerZoomRange(u,t,s){return this.style.setLayerZoomRange(u,t,s),this._update(!0)}setFilter(u,t,s={}){return this.style.setFilter(u,t,s),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,t,s,h={}){return this.style.setPaintProperty(u,t,s,h),this._update(!0)}getPaintProperty(u,t){return this.style.getPaintProperty(u,t)}setLayoutProperty(u,t,s,h={}){return this.style.setLayoutProperty(u,t,s,h),this._update(!0)}getLayoutProperty(u,t){return this.style.getLayoutProperty(u,t)}setLight(u,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,t),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(u){return this._lazyInitEmptyStyle(),this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(u),this.transform):0}setFeatureState(u,t){return this.style.setFeatureState(u,t),this._update()}removeFeatureState(u,t){return this.style.removeFeatureState(u,t),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}_containerDimensions(){let u=0,t=0;return this._container&&(u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300),[u,t]}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=ie.create("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ie.create("div","mapboxgl-canvas-container",u);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=ie.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1]);const h=this._controlContainer=ie.create("div","mapboxgl-control-container",u),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{m[_]=ie.create("div",`mapboxgl-ctrl-${_}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const s=a.exported.devicePixelRatio||1;this._canvas.width=s*Math.ceil(u),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_setupPainter(){const u=a.extend({},H.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",u)||this._canvas.getContext("experimental-webgl",u);t?(a.storeAuthState(t,!0),this.painter=new za(t,this.transform),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(t)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.isMoving()&&this.loaded()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;const s=this.painter.context.extTimerQuery,h=a.exported.now();this.listens("gpu-timing-frame")&&(t=s.createQueryEXT(),s.beginQueryEXT(s.TIME_ELAPSED_EXT,t));let m=this._updateAverageElevation(h);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;let _=!1;const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,I=a.exported.now();this.style.zoomHistory.update(S,I);const M=new a.EvaluationParameters(S,{now:I,fadeDuration:v,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=M.crossFadingFactor();D===1&&D===this._crossFadingFactor||(_=!0,this._crossFadingFactor=D),this.style.update(M)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&(this.style.hasTransitions()||_)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const S=a.exported.now()-h;s.endQueryEXT(s.TIME_ELAPSED_EXT,t),setTimeout(()=>{const I=s.getQueryObjectEXT(t,s.QUERY_RESULT_EXT)/1e6;s.deleteQueryEXT(t),this.fire(new a.Event("gpu-timing-frame",{cpuTime:S,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(S);this.fire(new a.Event("gpu-timing-layer",{layerTimes:I}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty||m;if(b||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(m=this._updateAverageElevation(h,!0)),m)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const u of this._markers)u._update()}_updateAverageElevation(u,t=!1){const s=h=>(this.transform.averageElevation=h,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);if((t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const h=this.transform.averageElevation;let m=this.transform.sampleAverageElevation();isNaN(m)?m=0:this._averageElevationLastSampledAt=u;const _=Math.abs(h-m);if(_>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(m),s(m);this._averageElevation.easeTo(m,u,300)}else if(_>1e-4)return this._averageElevation.jumpTo(m),s(m)}return!!this._averageElevation.isEasing(u)&&s(this._averageElevation.getValue(u))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===a.AUTH_ERR_MSG||u.status===401)){const t=this.painter.context.gl;a.storeAuthState(t,!1),this._logoControl instanceof xc&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function m(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);const v=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,v),v}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(m(u),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(u,t,s){let h=s[1]-s[0];const m=u.length/4;for(let _=0;_<t.length;_++){const v=t[_];let b=0;for(let S=0;S<v.length;S+=4)v[S]===u[S]&&v[S+1]===u[S+1]&&v[S+2]===u[S+2]&&v[S+3]===u[S+3]&&(b+=1);h+=(s[_+2]-s[_+1])*(1-b/m)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1));const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),Rs(this._canvasContainer),Rs(this._controlContainer),Rs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=a.exported.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}_setCacheLimits(u,t){a.setCacheLimits(u,t)}get version(){return a.version}},NavigationControl:class{constructor(u){this.options=a.extend({},xh,u),this._container=ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),ie.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),ie.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=ie.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const u=this._map.getZoom(),t=u===this._map.getMaxZoom(),s=u===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const u=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=u)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ie.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,t){const s=ie.create("button",u,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(u,t){const s=this._map._getUIString(`NavigationControl.${t}`);u.title=s,u.setAttribute("aria-label",s)}},GeolocateControl:class extends a.Evented{constructor(u){super(),this.options=a.extend({},vh,u),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=Ku(this._updateMarkerRotation,20)}onAdd(u){var t;return this._map=u,this._container=ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Cr!==void 0?t(Cr):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(s=>{Cr=s.state!=="denied",t(Cr)}):(Cr=!!a.window.navigator.geolocation,t(Cr)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ie.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Po=0,Qr=!1}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),s=u.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",u)),this._finish()}}_updateCamera(u){const t=new a.LngLat(u.coords.longitude,u.coords.latitude),s=u.coords.accuracy,h=this._map.getBearing(),m=a.extend({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new a.LngLat(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map._container.getBoundingClientRect().height/2,t=this._map.unproject([0,u]),s=this._map.unproject([100,u]),h=t.distanceTo(s)/100,m=Math.ceil(2*this._accuracy/h);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&Qr)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ie.create("button","mapboxgl-ctrl-geolocate",this._container),ie.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",u===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ie.create("div","mapboxgl-user-location"),this._dotElement.appendChild(ie.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ie.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Na({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ie.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Na({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Po--,Qr=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Po++,Po>1?(u={maximumAge:6e5,timeout:0},Qr=!0):(u=this.options.positionOptions,Qr=!1),this._geolocationWatchID=a.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else a.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){a.window.navigator.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:yc,ScaleControl:class{constructor(u){this.options=a.extend({},gp,u),a.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){wh(this._map,this._container,this.options)}onAdd(u){return this._map=u,this._container=ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ie.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(u){this.options.unit=u,wh(this._map,this._container,this.options)}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof a.window.HTMLElement?this._container=u.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=ie.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ie.remove(this._controlContainer),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=ie.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ie.create("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden",!0),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(u){super(),this.options=a.extend(Object.create(bh),u),a.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ie.remove(this._content),this._container&&(ie.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=a.LngLat.convert(u),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(a.window.document.createTextNode(u))}setHTML(u){const t=a.window.document.createDocumentFragment(),s=a.window.document.createElement("body");let h;for(s.innerHTML=u;h=s.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ie.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._container&&this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._container&&this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._container&&this._updateClassList(),t}_createCloseButton(){this.options.closeButton&&(this._closeButton=ie.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(u){this._update(u.point)}_onMouseMove(u){this._update(u.point)}_onDrag(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._pos,s=this._container.offsetWidth,h=this._container.offsetHeight;let m;return m=t.y+u.bottom.y<h?["top"]:t.y>this._map.transform.height-h?["bottom"]:[],t.x<s/2?m.push("left"):t.x>this._map.transform.width-s/2&&m.push("right"),m.length===0?"bottom":m.join("-")}_updateClassList(){const u=[...this._classList];u.push("mapboxgl-popup"),this._anchor&&u.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&u.push("mapboxgl-popup-track-pointer"),this._container.className=u.join(" ")}_update(u){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=ie.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ie.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=wc(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||u){const t=this._pos=this._trackPointer&&u?u:this._map.project(this._lngLat),s=function(_){if(_||(_=new a.pointGeometry(0,0)),typeof _=="number"){const v=Math.round(Math.sqrt(.5*Math.pow(_,2)));return{center:new a.pointGeometry(0,0),top:new a.pointGeometry(0,_),"top-left":new a.pointGeometry(v,v),"top-right":new a.pointGeometry(-v,v),bottom:new a.pointGeometry(0,-_),"bottom-left":new a.pointGeometry(v,-v),"bottom-right":new a.pointGeometry(-v,-v),left:new a.pointGeometry(_,0),right:new a.pointGeometry(-_,0)}}if(_ instanceof a.pointGeometry||Array.isArray(_)){const v=a.pointGeometry.convert(_);return{center:v,top:v,"top-left":v,"top-right":v,bottom:v,"bottom-left":v,"bottom-right":v,left:v,right:v}}return{center:a.pointGeometry.convert(_.center||[0,0]),top:a.pointGeometry.convert(_.top||[0,0]),"top-left":a.pointGeometry.convert(_["top-left"]||[0,0]),"top-right":a.pointGeometry.convert(_["top-right"]||[0,0]),bottom:a.pointGeometry.convert(_.bottom||[0,0]),"bottom-left":a.pointGeometry.convert(_["bottom-left"]||[0,0]),"bottom-right":a.pointGeometry.convert(_["bottom-right"]||[0,0]),left:a.pointGeometry.convert(_.left||[0,0]),right:a.pointGeometry.convert(_.right||[0,0])}}(this.options.offset),h=this._anchor=this._getAnchor(s),m=t.add(s[h]).round();this._map._requestDomTask(()=>{this._container&&h&&ie.setTransform(this._container,`${Ua[h]} translate(${m.x}px,${m.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Th);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._content&&(this._content.style.opacity=u),this._tip&&(this._tip.style.opacity=u)}},Marker:Na,Style:Dn,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.pointGeometry,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Da,Evented:a.Evented,config:a.config,prewarm:function(){Ue().acquire(re)},clearPrewarmedResources:function(){const u=ke;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(re),ke=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(u){a.config.ACCESS_TOKEN=u},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(u){a.config.API_URL=u},get workerCount(){return fe.workerCount},set workerCount(u){fe.workerCount=u},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){a.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){a.clearTileCache(u)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return Va});var R=T;return R})})(X2);const zv=km;const H2=({type:r,lineColor:l,landColor:f,lineWidth:x,handleColorChange:T,setLineWidth:A})=>r==="landColor"?Bt.createElement("div",{className:"option-widget",style:{display:"block"}},Bt.createElement("h4",null,"Land Color")):r==="lineColor"?Bt.createElement("div",{className:"option-widget",style:{display:"block"}},Bt.createElement("h4",null,"Line Color")):r==="lineWidth"?Bt.createElement("div",{className:"option-widget",style:{display:"block"}},Bt.createElement("h4",null,"Line Width"),Bt.createElement("input",{onChange:R=>A(parseFloat(R.target.value)),value:x,type:"range",min:"0.5",max:"1.5",step:"0.1"})):Bt.createElement("div",{style:{display:"none"}}),Y2=({setPlaces:r,setLineWidth:l,setContours:f,setLineColor:x,setLandColor:T,map:A,landColor:R,lineColor:a})=>{const H=gi.useRef(null),pe=gi.useRef(null),[Fe,ye]=gi.useState("");gi.useEffect(ve=>{console.log(ve)},[Fe]);const ie=ve=>{ye(Ee=>ve!==Ee?ve:"")},Se=ve=>{if(H.current.style.maxHeight==="0px"||!H.current.style.maxHeight)return H.current.style.maxHeight="500px";H.current.style.maxHeight="0px"},Ke=ve=>{if(pe.current.style.maxHeight==="0px"||!pe.current.style.maxHeight)return pe.current.style.maxHeight="500px";ye(""),pe.current.style.maxHeight="0px"},Qe=ve=>r(Ee=>!Ee),ue=ve=>f(Ee=>!Ee),ne=(ve,Ee)=>{switch(Ee){case"line-color":x(ve.hex);break;case"land-color":T(ve.hex);break}},ce=ve=>{let Ee=A.getCanvas().toDataURL();console.log(Ee);var nt=document.createElement("a");nt.href=Ee,nt.target="_blank",nt.download="map";let Be=document.createEvent("MouseEvents");Be.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),nt.dispatchEvent(Be)};return Bt.createElement("div",{id:"topo-nav"},Bt.createElement("div",{id:"nav-panel"},Bt.createElement("h2",{id:"title"},"TOPO"),Bt.createElement("ul",{id:"nav-list"},Bt.createElement("li",{onClick:Se},"Documentation"),Bt.createElement("li",{ref:H,id:"docs-container"},Bt.createElement("p",null,"Welcome to Topo! This is a map where you can create photos of contours on maps and edit the contour line colors and land color. Try editing this map using the options button below!")),Bt.createElement("li",{onClick:Ke},"Options"),Bt.createElement("li",{ref:pe,id:"option-container"},Bt.createElement("ul",{id:"option-list"},Bt.createElement("li",{onClick:()=>ie("landColor")},"Land Color"),Bt.createElement("li",{onClick:()=>ie("lineColor")},"Contour Line Color"),Bt.createElement("li",{onClick:()=>ie("lineWidth")},"Contour Line Width"),Bt.createElement("li",{onClick:ue},"Toggle Contours"),Bt.createElement("li",{onClick:Qe},"Toggle Places"))),Bt.createElement("li",{onClick:ce},"Download Map"))),Bt.createElement("div",{id:"nav-widgets"},Bt.createElement(H2,{type:Fe,landColor:R,lineColor:a,handleColorChange:ne,setLineWidth:l})))};zv.accessToken="pk.eyJ1IjoiZGNoaWNjaG9uIiwiYSI6ImNrMm5saGJsczB0emYzYm05dzV4c2lnMDMifQ.mHFtuW251o5kz5nKxKvc-A";const K2=()=>{const r=gi.useRef(null),[l,f]=gi.useState(null),[x,T]=gi.useState("hsl(185, 0%, 18%)"),[A,R]=gi.useState("#85ceff"),[a,H]=gi.useState(1),[pe,Fe]=gi.useState(!0),[ye,ie]=gi.useState(!0);return gi.useEffect(()=>{let Se=-70.9,Ke=42.35,Qe=9,ue=window.localStorage.getItem("lng"),ne=window.localStorage.getItem("lat"),ce=window.localStorage.getItem("zoom");parseFloat(ue)&&parseFloat(ne)&&parseFloat(ce)&&(Se=ue,Ke=ne,Qe=ce);const ve=new zv.Map({container:r.current,style:"mapbox://styles/dchicchon/ckvb5lorxb4ep14p13vc4exqp",center:[Se,Ke],zoom:Qe,preserveDrawingBuffer:!0});ve.on("load",()=>{ve.addSource("places",{type:"vector",url:"mapbox://mapbox.mapbox-streets-v8"}),ve.addLayer({id:"places",type:"symbol",source:"places","source-layer":"place_label",layout:{"text-field":["get","name"],"text-size":12,"text-offset":[0,-1.5]},paint:{"text-color":"#fff","text-halo-color":"#333333","text-halo-width":1}}),ve.addLayer({id:"POI",type:"symbol",source:"places","source-layer":"poi_label",layout:{"text-field":["get","name"],"text-size":12,"text-offset":[0,-1.5]},paint:{"text-color":"#fff","text-halo-color":"#333333","text-halo-width":1}}),ve.addSource("terrain",{type:"vector",url:"mapbox://mapbox.mapbox-terrain-v2"}),ve.addLayer({id:"contours",type:"line",source:"terrain","source-layer":"contour",layout:{visibility:"visible","line-join":"round","line-cap":"round"},paint:{"line-color":A,"line-width":a}})}),ve.on("move",()=>{window.localStorage.setItem("lng",ve.getCenter().lng.toFixed(4)),window.localStorage.setItem("lat",ve.getCenter().lat.toFixed(4)),window.localStorage.setItem("zoom",ve.getZoom().toFixed(2))}),f(ve)},[]),gi.useEffect(()=>{l&&(l.setPaintProperty("land","background-color",x),l.setPaintProperty("water-shadow","fill-color",x),l.setPaintProperty("waterway-shadow","line-color",x),l.setPaintProperty("waterway","line-color",x))},[x]),gi.useEffect(()=>{l&&l.setPaintProperty("contours","line-color",A)},[A]),gi.useEffect(()=>{l&&l.setPaintProperty("contours","line-width",a)},[a]),gi.useEffect(()=>{if(!l)return;console.log("Toggle Contours");const Se=pe?"visible":"none";l.setLayoutProperty("contours","visibility",Se)},[pe]),gi.useEffect(()=>{if(!l)return;const Se=ye?"visible":"none";l.setLayoutProperty("places","visibility",Se),l.setLayoutProperty("POI","visibility",Se)},[ye]),Bt.createElement("div",{style:{width:"100%",height:"100%"}},Bt.createElement("div",{id:"main"},Bt.createElement(Y2,{map:l,landColor:x,setLandColor:T,lineColor:A,setLineColor:R,lineWidth:a,setLineWidth:H,setPlaces:ie,setContours:Fe}),Bt.createElement("div",{ref:r,className:"map-container"})))},Q2="modulepreload",J2=function(r){return"/"+r},N0={},eT=function(l,f,x){if(!f||f.length===0)return l();const T=document.getElementsByTagName("link");return Promise.all(f.map(A=>{if(A=J2(A),A in N0)return;N0[A]=!0;const R=A.endsWith(".css"),a=R?'[rel="stylesheet"]':"";if(!!x)for(let Fe=T.length-1;Fe>=0;Fe--){const ye=T[Fe];if(ye.href===A&&(!R||ye.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${A}"]${a}`))return;const pe=document.createElement("link");if(pe.rel=R?"stylesheet":Q2,R||(pe.as="script",pe.crossOrigin=""),pe.href=A,document.head.appendChild(pe),R)return new Promise((Fe,ye)=>{pe.addEventListener("load",Fe),pe.addEventListener("error",()=>ye(new Error(`Unable to preload CSS for ${A}`)))})})).then(()=>l())},tT=r=>{r&&r instanceof Function&&eT(()=>import("./web-vitals-d4fac006.js"),[]).then(({getCLS:l,getFID:f,getFCP:x,getLCP:T,getTTFB:A})=>{l(r),f(r),x(r),T(r),A(r)})};W2.render(Bt.createElement(Bt.StrictMode,null,Bt.createElement(K2,null)),document.getElementById("root"));tT();
